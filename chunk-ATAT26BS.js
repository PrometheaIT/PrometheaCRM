import{a as O}from"./chunk-2QDHCWUP.js";import{a as V}from"./chunk-6MBYYD52.js";import{a as K}from"./chunk-WMLYL4YD.js";import{b as M}from"./chunk-Q4FMGKSF.js";import{d as I,e as y,h as E,j as D}from"./chunk-NOCF4HQD.js";import{Ga as P,La as c,S as x,Wa as s,X as z,Xa as t,Y as k,Ya as e,Za as f,db as b,ea as S,gb as C,hb as m,jb as w,kb as h,mb as i,nb as d,ob as p,pb as _,ua as a,xb as v,yb as g}from"./chunk-PE6PP35I.js";import"./chunk-X5YLR3NI.js";import{i as u}from"./chunk-ODN5LVDJ.js";function F(o,r){if(o&1){let n=b();t(0,"button",14),C("click",function(){z(n);let N=m();return k(N.toggleView())}),t(1,"span",15),i(2),e(),t(3,"span",16),i(4),e()()}if(o&2){let n=m();h("active",n.currentView==="global"),s("title",n.currentView==="personal"?"Visualizza KPI di tutti gli utenti":"Visualizza i miei KPI"),a(2),p(" ",n.currentView==="personal"?"groups":"person"," "),a(2),p(" ",n.currentView==="personal"?"KPI Globali":"I miei KPI"," ")}}function L(o,r){if(o&1&&(t(0,"div",17)(1,"div",18)(2,"div",19)(3,"i",15),i(4,"assignment"),e()(),t(5,"div",20)(6,"div",21),i(7),e(),t(8,"p"),i(9,"Totale Trattative"),e()()(),t(10,"div",18)(11,"div",22)(12,"i",15),i(13,"check_circle"),e()(),t(14,"div",20)(15,"div",21),i(16),e(),t(17,"p"),i(18,"Contratti Chiusi Totali"),e(),t(19,"div",23),i(20),v(21,"number"),e()()(),t(22,"div",18)(23,"div",24)(24,"i",15),i(25,"calendar_today"),e()(),t(26,"div",20)(27,"div",21),i(28),e(),t(29,"p"),i(30,"Chiusi Questo Mese"),e(),t(31,"div",23),i(32),v(33,"number"),e()()(),t(34,"div",18)(35,"div",25)(36,"i",15),i(37,"contacts"),e()(),t(38,"div",20)(39,"div",21),i(40),v(41,"number"),e(),t(42,"p"),i(43,"Nominativi Presi"),e(),t(44,"small"),i(45,"Quando si chiude contratto"),e()()(),t(46,"div",18)(47,"div",26)(48,"i",15),i(49,"schedule"),e()(),t(50,"div",20)(51,"div",21),i(52),v(53,"number"),e(),t(54,"p"),i(55,"Da Richiamare"),e()()(),t(56,"div",18)(57,"div",27)(58,"i",15),i(59,"group_add"),e()(),t(60,"div",20)(61,"div",21),i(62),e(),t(63,"p"),i(64,"Referenze da CTR"),e()()()()),o&2){let n=m();a(7),d(n.kpiData.totaleTrattative),a(9),d(n.kpiData.contrattiChiusiTotali),a(4),p(" ",g(21,8,n.kpiData.percentualeChiusiTotali,"1.1-1"),"% "),a(8),d(n.kpiData.contrattiChiusiMeseCorrente),a(4),p(" ",g(33,11,n.kpiData.percentualeChiusiMese,"1.1-1"),"% "),a(8),p("",g(41,14,n.kpiData.percentualeNominativiPresi,"1.1-1"),"%"),a(12),p("",g(53,17,n.kpiData.percentualeDaRichiamare,"1.1-1"),"%"),a(10),d(n.kpiData.referenzeDaCtr)}}function U(o,r){if(o&1&&(t(0,"div",39)(1,"span",40),i(2),e(),t(3,"span",41),i(4),e()()),o&2){let n=r.$implicit,l=m(4);a(2),d(n),a(2),p("(",l.kpiData.dettagliSoftware[n],")")}}function j(o,r){if(o&1&&(t(0,"div",37),c(1,U,5,2,"div",38),e()),o&2){let n=m(3);a(),s("ngForOf",n.getSoftwareKeys())}}function A(o,r){if(o&1&&(t(0,"div",30)(1,"div",31)(2,"span",32),i(3),e(),t(4,"span",33),i(5),v(6,"number"),e()(),c(7,j,2,1,"div",34),t(8,"div",35),f(9,"div",36),e()()),o&2){let n=r.$implicit,l=m(2);a(3),p(" ",l.getTestoMotivazione(n)," "),a(2),_(" ",l.kpiData.motivazioniNonChiusi[n]," (",g(6,6,l.kpiData.motivazioniNonChiusi[n]/l.kpiData.totaleTrattative*100,"1.1-1"),"%) "),a(2),s("ngIf",n==="usano_software_proprio"&&l.getSoftwareKeys().length>0),a(2),w("width",l.kpiData.motivazioniNonChiusi[n]/l.kpiData.totaleTrattative*100+"%")}}function B(o,r){if(o&1&&(t(0,"div",28)(1,"h3",6),i(2,"Motivazioni Non Chiusura"),e(),t(3,"div",17),c(4,A,10,9,"div",29),e()()),o&2){let n=m();a(4),s("ngForOf",n.getMotivazioniKeys())}}function R(o,r){o&1&&(t(0,"div",42)(1,"span",15),i(2,"analytics"),e(),t(3,"p"),i(4,"Nessun dato KPI disponibile"),e()())}function G(o,r){if(o&1&&(t(0,"div",30)(1,"div",31)(2,"span",32),i(3),e(),t(4,"span",33),i(5),e()()()),o&2){let n=r.$implicit,l=m(3);a(3),d(n),a(2),d(l.kpiDataPromethea.motivazioniNonChiusi[n])}}function Q(o,r){if(o&1&&(t(0,"div",28)(1,"h3",6),i(2,"Motivazioni Non Chiusura - Promethea"),e(),t(3,"div",17),c(4,G,6,2,"div",29),e()()),o&2){let n=m(2);a(4),s("ngForOf",n.getMotivazioniKeysFor(n.kpiDataPromethea))}}function Y(o,r){if(o&1&&(t(0,"div",43)(1,"div",3)(2,"i",4),i(3,"settings"),e(),t(4,"div",5)(5,"h2",6),i(6,"KPI Configurazioni Promethea"),e(),t(7,"p",7),i(8,"Panoramica sulle configurazioni create tramite Alchemizzatore"),e()(),f(9,"div",8),e(),t(10,"div",17)(11,"div",18)(12,"div",19)(13,"i",15),i(14,"assignment"),e()(),t(15,"div",20)(16,"div",21),i(17),e(),t(18,"p"),i(19,"Totale Configurazioni"),e()()(),t(20,"div",18)(21,"div",22)(22,"i",15),i(23,"check_circle"),e()(),t(24,"div",20)(25,"div",21),i(26),e(),t(27,"p"),i(28,"Configurazioni con Totale"),e(),t(29,"div",23),i(30),v(31,"number"),e()()(),t(32,"div",18)(33,"div",24)(34,"i",15),i(35,"calendar_today"),e()(),t(36,"div",20)(37,"div",21),i(38),e(),t(39,"p"),i(40,"Questo Mese"),e(),t(41,"div",23),i(42),v(43,"number"),e()()(),t(44,"div",18)(45,"div",25)(46,"i",15),i(47,"info"),e()(),t(48,"div",20)(49,"div",21),i(50),e(),t(51,"p"),i(52,"Referenze"),e()()(),t(53,"div",18)(54,"div",26)(55,"i",15),i(56,"schedule"),e()(),t(57,"div",20)(58,"div",21),i(59),v(60,"number"),e(),t(61,"p"),i(62,"Da Richiamare"),e()()()(),c(63,Q,5,1,"div",44),e()),o&2){let n=m();a(17),d(n.kpiDataPromethea.totaleTrattative),a(9),d(n.kpiDataPromethea.contrattiChiusiTotali),a(4),p("",g(31,8,n.kpiDataPromethea.percentualeChiusiTotali,"1.1-1"),"%"),a(8),d(n.kpiDataPromethea.contrattiChiusiMeseCorrente),a(4),p("",g(43,11,n.kpiDataPromethea.percentualeChiusiMese,"1.1-1"),"%"),a(8),d(n.kpiDataPromethea.referenzeDaCtr),a(9),p("",g(60,14,n.kpiDataPromethea.percentualeDaRichiamare,"1.1-1"),"%"),a(4),s("ngIf",n.getMotivazioniKeysFor(n.kpiDataPromethea).length>0)}}var T=class o{kpiService=x(V);supabaseService=x(M);userService=x(K);kpiData=null;kpiDataPromethea=null;currentUserId=null;isLoading=S(!0);isAdmin=!1;showGlobalKPI=!1;currentView="personal";ngOnInit(){return u(this,null,function*(){this.isLoading.set(!0);try{yield this.getCurrentUser(),this.isAdmin=this.userService.isAdmin();let r=this.isAdmin&&this.currentView==="global"?void 0:this.currentUserId,[n,l]=yield Promise.all([this.kpiService.getKPIYuvi(r||void 0),this.kpiService.getKPIPromethea(r||void 0)]);this.kpiData=n,this.kpiDataPromethea=l}finally{setTimeout(()=>this.isLoading.set(!1),300)}})}getCurrentUser(){return u(this,null,function*(){try{let{data:{user:r}}=yield this.supabaseService.getUser();this.currentUserId=r?.id||null}catch(r){console.error("Errore nel recupero utente:",r)}})}caricaKPI(){return u(this,null,function*(){try{let r=this.isAdmin&&this.currentView==="global"?void 0:this.currentUserId;this.kpiData=yield this.kpiService.getKPIYuvi(r||void 0)}catch(r){console.error("Errore nel caricamento KPI:",r)}})}toggleView(){return u(this,null,function*(){if(this.isAdmin){this.isLoading.set(!0);try{this.currentView=this.currentView==="personal"?"global":"personal",yield this.caricaKPI()}finally{setTimeout(()=>{this.isLoading.set(!1)},300)}}})}getTestoMotivazione(r){return{prezzo_troppo_alto:"Prezzo troppo alto",usano_software_proprio:"Usano gi\xE0 un software e si trovano bene",non_hanno_bisogno:"Non ne hanno bisogno",non_si_fidano:"Non si fidano",da_richiamare:"Da richiamare",contratto_chiuso:"Contratto chiuso",non_chiuso:"Non chiuso"}[r]||r}getMotivazioniKeys(){return!this.kpiData||!this.kpiData.motivazioniNonChiusi?[]:Object.keys(this.kpiData.motivazioniNonChiusi)}getSoftwareKeys(){return!this.kpiData||!this.kpiData.dettagliSoftware?[]:Object.keys(this.kpiData.dettagliSoftware)}getMotivazioniKeysFor(r){return!r||!r.motivazioniNonChiusi?[]:Object.keys(r.motivazioniNonChiusi)}getSoftwareKeysFor(r){return!r||!r.dettagliSoftware?[]:Object.keys(r.dettagliSoftware)}static \u0275fac=function(n){return new(n||o)};static \u0275cmp=P({type:o,selectors:[["app-visualizzazione-kpi"]],decls:18,vars:12,consts:[[3,"isLoading","title","subtitle"],[1,"kpi-container"],[1,"form-section"],[1,"section-header"],[1,"material-icons","header-icon"],[1,"section-titles"],[1,"section-title"],[1,"sottotitolo"],[1,"flex-1"],["class","promethea-button outline",3,"active","title","click",4,"ngIf"],["class","grid-responsive",4,"ngIf"],["class","form-section","style","margin-top: var(--gutter-lg);",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","form-section kpi-section","style","margin-top:var(--gutter-lg);",4,"ngIf"],[1,"promethea-button","outline",3,"click","title"],[1,"material-icons"],[1,"view-toggle-text"],[1,"grid-responsive"],[1,"card","kpi-card"],[1,"kpi-icon","primary"],[1,"kpi-content"],[1,"card-number"],[1,"kpi-icon","success"],[1,"kpi-percentage"],[1,"kpi-icon","calendar"],[1,"kpi-icon","info"],[1,"kpi-icon","warning"],[1,"kpi-icon","secondary"],[1,"form-section",2,"margin-top","var(--gutter-lg)"],["class","motivazione-item",4,"ngFor","ngForOf"],[1,"motivazione-item"],[1,"motivazione-header"],[1,"motivazione-text"],[1,"motivazione-count"],["class","software-details",4,"ngIf"],[1,"motivazione-bar"],[1,"motivazione-progress"],[1,"software-details"],["class","software-item text-muted",4,"ngFor","ngForOf"],[1,"software-item","text-muted"],[1,"software-name"],[1,"software-count"],[1,"empty-state"],[1,"form-section","kpi-section",2,"margin-top","var(--gutter-lg)"],["class","form-section","style","margin-top:var(--gutter-lg);",4,"ngIf"]],template:function(n,l){n&1&&(f(0,"app-page-loader",0),t(1,"div")(2,"div",1)(3,"div",2)(4,"div",3)(5,"i",4),i(6,"analytics"),e(),t(7,"div",5)(8,"h2",6),i(9,"KPI Trattative YUVI"),e(),t(10,"p",7),i(11),e()(),f(12,"div",8),c(13,F,5,5,"button",9),e(),c(14,L,65,20,"div",10)(15,B,5,1,"div",11)(16,R,5,0,"div",12),e()()(),c(17,Y,64,17,"div",13)),n&2&&(s("isLoading",l.isLoading())("title",l.currentView==="personal"?"Caricamento KPI Personali":"Caricamento KPI Globali")("subtitle","Stiamo analizzando i dati delle trattative..."),a(),h("hidden",l.isLoading()),a(10),_(" ",l.currentView==="personal"?"Panoramica KPI personali":"Panoramica KPI globali"," ",l.currentView==="global"?"(Tutti gli utenti)":""," "),a(2),s("ngIf",l.isAdmin),a(),s("ngIf",l.kpiData),a(),s("ngIf",l.kpiData&&l.getMotivazioniKeys().length>0),a(),s("ngIf",!l.kpiData&&!l.isLoading()),a(),s("ngIf",l.kpiDataPromethea))},dependencies:[D,I,y,O,E],styles:[".kpi-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm)}.kpi-icon[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:12px;display:grid;place-items:center;font-size:1.5rem}.card-number[_ngcontent-%COMP%]{font-size:var(--fs-md)}.kpi-icon.success[_ngcontent-%COMP%]{background:color-mix(in srgb,#10b981 15%,transparent);color:#10b981}.kpi-icon.primary[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--primary) 15%,transparent);color:var(--primary)}.kpi-icon.info[_ngcontent-%COMP%]{background:color-mix(in srgb,#3b82f6 15%,transparent);color:#3b82f6}.kpi-icon.warning[_ngcontent-%COMP%]{background:color-mix(in srgb,#f59e0b 15%,transparent);color:#f59e0b}.kpi-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:color-mix(in srgb,var(--text-color) 70%,transparent);font-weight:500}.kpi-percentage[_ngcontent-%COMP%]{font-size:var(--fs-sm);font-weight:700;color:var(--primary);margin-top:4px}.motivazione-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:minmax(0,1fr) auto minmax(100px,30%);align-items:center;gap:var(--gutter-md);padding:var(--gutter-sm);border:1px solid var(--smoke-color-1);border-radius:12px;background:var(--background)}.motivazione-text[_ngcontent-%COMP%]{font-weight:500;min-width:0;overflow-wrap:anywhere}.motivazione-count[_ngcontent-%COMP%]{font-weight:700;color:var(--primary);text-align:right}.motivazione-bar[_ngcontent-%COMP%]{height:8px;background:var(--smoke-color-1);border-radius:4px;overflow:hidden}.motivazione-progress[_ngcontent-%COMP%]{height:100%;background:var(--primary);border-radius:4px;transition:width .3s ease}.software-details[_ngcontent-%COMP%]{margin-top:.5rem;padding-left:1rem;border-left:2px solid #e2e8f0}.software-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:.25rem}.software-name[_ngcontent-%COMP%]{margin-right:var(--gutter-sm)}.software-count[_ngcontent-%COMP%]{font-weight:600}.motivazione-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%}.view-toggle-text[_ngcontent-%COMP%]{font-weight:500}.kpi-card[_ngcontent-%COMP%]   .kpi-icon.calendar[_ngcontent-%COMP%]{background:#3b82f6}.kpi-card[_ngcontent-%COMP%]   .kpi-icon.secondary[_ngcontent-%COMP%]{background:#8b5cf6}.software-details[_ngcontent-%COMP%]{margin-top:8px;padding-left:16px;border-left:2px solid #e5e7eb}.software-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:4px 0;font-size:14px}.software-name[_ngcontent-%COMP%]{color:var(--color-text)}.software-count[_ngcontent-%COMP%]{color:var(--color-text-light);font-weight:500}"]})};export{T as VisualizzazioneKpi};
