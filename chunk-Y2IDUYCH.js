import{a as xe}from"./chunk-3LEOX4U7.js";import{a as ce,b as me,d as de,f as ue,h as pe,n as _e,o as ze,p as ge,q as fe,r as ve,u as he}from"./chunk-3JKT2CHV.js";import{b as Ce}from"./chunk-3Y2ZP6KK.js";import"./chunk-3347WCPA.js";import{b as se}from"./chunk-2ONBSOVF.js";import{c as K,d as ee,e as te,h as ie,i as ne,j as oe,k as ae,o as re,q as le}from"./chunk-233B5766.js";import{Bb as O,Db as P,Fa as c,Fb as r,Gb as h,Hb as E,Ib as L,Jb as A,Kb as T,La as D,Lb as I,N as H,Pb as Y,Ra as Q,Rb as X,Ub as W,Vb as U,Wa as b,Wb as Z,X as _,Xb as F,Y as z,gb as g,hb as n,ib as a,jb as J,nb as k,ob as N,qb as w,tb as v,ub as m}from"./chunk-R6HFAJZF.js";import"./chunk-X5YLR3NI.js";import{a as q,b as j,i as V}from"./chunk-ODN5LVDJ.js";var B=class s{DEFAULT_LIMIT=18;parseItalianNumber(t){if(!t||typeof t!="string")return NaN;let e=t.trim().replace(/\s+/g,"");e.indexOf(".")!==-1&&e.indexOf(",")!==-1?e=e.replace(/\./g,"").replace(",","."):e.indexOf(",")!==-1&&e.indexOf(".")===-1?e=e.replace(",","."):e=e.replace(/[^\d\.]/g,"");let o=parseFloat(e);return isFinite(o)?o:NaN}decideKindFromText(t){let e=(t||"").toLowerCase();return/\bcifra\b|\btotale\b/.test(e)?"cifra":/\bpercento\b|\bpercentuale\b|\b%\b|\bsconto\b/.test(e)?"percent":null}decideTargetFromText(t){let e=(t||"").toLowerCase();return/\b(mensil|mensile|mese|mesi)\b/.test(e)?"mensile":/\buna\b.*\btantum\b|\btantum\b/.test(e)?"una_tantum":/\bentrambi\b|\btutto\b|\btotale\b/.test(e)?"entrambi":null}computeForCifra(t,e){let o=Number(t.una||0),l=Number(t.mensile||0)*12;if(o<=0)return{allowed:!1,reason:"Non ci sono voci una tantum su cui applicare una cifra."};if(e<0)return{allowed:!1,reason:"Valore non valido."};let d=(1-e/o)*100;if(!isFinite(d))return{allowed:!1,reason:"Impossibile calcolare la percentuale richiesta."};if(d<0)return{allowed:!1,reason:"La cifra richiesta \xE8 superiore alla quota una tantum attuale; nessuno sconto necessario."};let u=Math.round((e+l)*100)/100;return d>this.DEFAULT_LIMIT?{allowed:!1,candidatePercent:d,producedTotal:u,reason:"limit"}:{allowed:!0,candidatePercent:d,producedTotal:u}}computeForPercent(t,e,o){let i=Number(t.una||0),d=Number(t.mensile||0)*12,u=i+d;if(e<0||!isFinite(e))return{allowed:!1,reason:"Percentuale non valida"};let f=Math.min(100,Math.max(0,e));if(o==="entrambi"){let S=Math.round(u*(1-f/100)*100)/100;return{allowed:f<=this.DEFAULT_LIMIT,candidatePercent:f,producedTotal:S}}if(o==="una_tantum"){if(i<=0)return{allowed:!1,reason:"Non ci sono voci una tantum."};let S=Math.round((i*(1-f/100)+d)*100)/100;return{allowed:f<=this.DEFAULT_LIMIT,candidatePercent:f,producedTotal:S}}if(d<=0)return{allowed:!1,reason:"Non ci sono voci mensili."};let y=Math.round((i+d*(1-f/100))*100)/100;return{allowed:f<=this.DEFAULT_LIMIT,candidatePercent:f,producedTotal:y}}findPercentForDesired(t,e,o,i=this.DEFAULT_LIMIT){if(!t||e<=0)return null;let l=t.una,d=t.mensile*12,u=l+d;if(u<=0)return null;if(o==="entrambi"){let y=(1-e/u)*100;return this.computeForPercent(t,y,o)}if(o==="una_tantum"){if(l<=0)return null;let y=(1-(e-d)/l)*100;return this.computeForPercent(t,y,o)}if(d<=0)return null;let f=(1-(e-l)/d)*100;return this.computeForPercent(t,f,o)}getResponseDelay(t=1400,e=900){return t+Math.floor(Math.random()*e)}static \u0275fac=function(e){return new(e||s)};static \u0275prov=H({token:s,factory:s.\u0275fac,providedIn:"root"})};var Me=()=>[],Pe=(s,t)=>({"user-message":s,"assistance-message":t});function we(s,t){s&1&&(n(0,"div",30),J(1,"span",31),r(2," Ricerca in corso... "),a())}function Ee(s,t){if(s&1&&(n(0,"div",32),r(1),a()),s&2){let e=m(2);c(),h(e.searchError)}}function Ae(s,t){if(s&1){let e=w();n(0,"div",35),v("click",function(){let i=_(e).$implicit,l=m(3);return z(l.onSelectProspect(i))}),n(1,"div",36)(2,"div",37)(3,"strong"),r(4),a()(),n(5,"div",38),r(6),a()(),n(7,"div",39),r(8,"\u2795"),a()()}if(s&2){let e=t.$implicit;c(4),h(e.ragione_sociale),c(2),L(" ",e.email||"\u2014"," \u2022 ",e.telefono||"\u2014"," ")}}function Te(s,t){if(s&1&&(n(0,"div",33),b(1,Ae,9,3,"div",34),W(2,"slice"),a()),s&2){let e=m(2);c(),g("ngForOf",Z(2,1,e.searchResults,0,8))}}function Ie(s,t){if(s&1&&(n(0,"div",40)(1,"i",41),r(2,"check_circle"),a(),r(3," Selezionato: "),n(4,"strong"),r(5),a()()),s&2){let e=m(2);c(5),h(e.selectedProspect.ragione_sociale)}}function Ve(s,t){s&1&&(n(0,"div",42)(1,"i",41),r(2,"history"),a(),r(3," Modifica configurazione esistente: le variazioni saranno tracciate in storico. "),a())}function ke(s,t){if(s&1){let e=w();n(0,"section",14)(1,"div",15)(2,"i",16),r(3,"person_search"),a(),n(4,"div",17)(5,"h2",18),r(6,"Seleziona il Prospect"),a()()(),n(7,"div",19)(8,"label",20),r(9,"Cerca Prospect"),a(),n(10,"div",21)(11,"input",22),I("ngModelChange",function(i){_(e);let l=m();return T(l.queryProspect,i)||(l.queryProspect=i),z(i)}),v("input",function(){_(e);let i=m();return z(i.onSearchProspect(i.queryProspect))}),a(),b(12,we,3,0,"div",23)(13,Ee,2,1,"div",24)(14,Te,3,5,"div",25),a(),b(15,Ie,6,1,"div",26)(16,Ve,4,0,"div",27),a(),n(17,"div",28)(18,"button",29),v("click",function(){_(e);let i=m();return z(i.avanti())}),r(19," Inizia Configurazione "),a()()()}if(s&2){let e=m();c(11),A("ngModel",e.queryProspect),c(),g("ngIf",e.searchLoading),c(),g("ngIf",e.searchError),c(),g("ngIf",e.searchResults.length),c(),g("ngIf",e.selectedProspect),c(),g("ngIf",e.isModificaConfigurazione),c(),P("blocked",e.searchResults.length),c(),g("disabled",!e.selectedProspect||e.searchLoading)}}function Ne(s,t){s&1&&(k(0),r(1," Creazione del Brand "),N())}function Oe(s,t){if(s&1&&(k(0),r(1),N()),s&2){let e=m(2).$implicit;c(),E(" ",e.id==="social_2_post"?"Social Media Base":e.id==="social_3_post"?"Social Media Avanzata":e.id==="social_5_post"?"Social Media Premium":e.nome," ")}}function Fe(s,t){if(s&1&&r(0),s&2){let e=m(2).$implicit;h(e.nome)}}function De(s,t){if(s&1&&b(0,Oe,2,1,"ng-container",54)(1,Fe,1,1,"ng-template",null,1,F),s&2){let e=O(2),o=m().$implicit;g("ngIf",o.id==null?null:o.id.startsWith("social_"))("ngIfElse",e)}}function Re(s,t){s&1&&(n(0,"div",43),r(1,"(include logo)"),a())}function qe(s,t){s&1&&(n(0,"div",43),r(1,"(2 post/settimana)"),a())}function Le(s,t){s&1&&(n(0,"div",43),r(1,"(3 post/settimana)"),a())}function We(s,t){s&1&&(n(0,"div",43),r(1,"(5 post/settimana)"),a())}function Ue(s,t){if(s&1&&(n(0,"span",60),r(1),a()),s&2){let e=m().$implicit;c(),h(e.pacchetto)}}function Be(s,t){if(s&1){let e=w();n(0,"div",52),v("click",function(){let i=_(e).$implicit,l=m(2);return z(l.toggleServizio("immagine_marketing",i))}),n(1,"div",53)(2,"h4"),b(3,Ne,2,0,"ng-container",54)(4,De,3,2,"ng-template",null,0,F),a(),b(6,Re,2,0,"div",55)(7,qe,2,0,"div",55)(8,Le,2,0,"div",55)(9,We,2,0,"div",55),n(10,"div",56),r(11),a()(),n(12,"p",57),r(13),a(),b(14,Ue,2,1,"span",58),n(15,"div",59)(16,"i",41),r(17,"check"),a()()()}if(s&2){let e=t.$implicit,o=O(5),i=m(2);P("selezionato",e.selezionato)("disabled",i.isServizioDisabled("immagine_marketing",e)),c(3),g("ngIf",e.id==="creazione_brand")("ngIfElse",o),c(3),g("ngIf",e.id==="creazione_brand"),c(),g("ngIf",e.id==="social_2_post"),c(),g("ngIf",e.id==="social_3_post"),c(),g("ngIf",e.id==="social_5_post"),c(2),h(i.formatPrezzoServizio(e)),c(2),h(e.descrizione),c(),g("ngIf",e.pacchetto),c(),P("attivo",e.selezionato)}}function $e(s,t){s&1&&(k(0),r(1," Creazione del Brand "),N())}function Ge(s,t){if(s&1&&r(0),s&2){let e=m().$implicit;h(e.nome)}}function je(s,t){s&1&&(n(0,"div",43),r(1,"(Include anche il logo)"),a())}function He(s,t){if(s&1){let e=w();n(0,"div",52),v("click",function(){let i=_(e).$implicit,l=m(2);return z(l.toggleServizio("immagine_marketing",i))}),n(1,"div",53)(2,"h4"),b(3,$e,2,0,"ng-container",54)(4,Ge,1,1,"ng-template",null,2,F),a(),b(6,je,2,0,"div",55),n(7,"div",56),r(8),a()(),n(9,"p",57),r(10),a(),n(11,"div",59)(12,"i",41),r(13,"check"),a()()()}if(s&2){let e=t.$implicit,o=O(5),i=m(2);P("selezionato",e.selezionato),c(3),g("ngIf",e.id==="creazione_brand")("ngIfElse",o),c(3),g("ngIf",e.id==="creazione_brand"),c(2),h(i.formatPrezzoServizio(e)),c(2),h(e.descrizione),c(),P("attivo",e.selezionato)}}function Qe(s,t){if(s&1){let e=w();n(0,"section",14)(1,"div",15)(2,"i",16),r(3,"brush"),a(),n(4,"div",17)(5,"h2",18),r(6,"Immagine & Marketing"),a(),n(7,"p",43),r(8,"Configura i servizi di branding e comunicazione"),a()()(),n(9,"h3",44),r(10,"Social Media Manager"),a(),n(11,"div",45),b(12,Be,18,15,"div",46),a(),n(13,"h3",44),r(14,"Servizi singoli"),a(),n(15,"div",45),b(16,He,14,9,"div",47),a(),n(17,"div",48)(18,"div",49)(19,"div"),r(20),a(),n(21,"div"),r(22),a()()(),n(23,"div",28)(24,"button",50),v("click",function(){_(e);let i=m();return z(i.indietro())}),r(25,"Indietro"),a(),n(26,"button",51),v("click",function(){_(e);let i=m();return z(i.avanti())}),r(27,"Continua"),a()()()}if(s&2){let e=m();c(12),g("ngForOf",e.getServiziPacchetto("immagine_marketing")),c(4),g("ngForOf",e.getServiziSingoli("immagine_marketing")),c(4),E("Totale Modulo Una Tantum: ",e.formatCurrency(e.getTotaliModuloSplit("immagine_marketing").una)),c(2),E("Totale Modulo Mensile: ",e.formatCurrency(e.getTotaliModuloSplit("immagine_marketing").mensile))}}function Je(s,t){if(s&1&&(n(0,"span",60),r(1),a()),s&2){let e=m().$implicit;c(),h(e.pacchetto)}}function Ye(s,t){if(s&1){let e=w();n(0,"div",52),v("click",function(){let i=_(e).$implicit,l=m(2);return z(l.toggleServizio("digitalizzazione_automatismi",i))}),n(1,"div",53)(2,"h4"),r(3),a(),n(4,"div",56),r(5),a()(),n(6,"p",57),r(7),a(),b(8,Je,2,1,"span",58),n(9,"div",59)(10,"i",41),r(11,"check"),a()()()}if(s&2){let e=t.$implicit,o=m(2);P("selezionato",e.selezionato)("disabled",o.isServizioDisabled("digitalizzazione_automatismi",e)),c(3),h(e.nome),c(2),h(o.formatPrezzoServizio(e)),c(2),h(e.descrizione),c(),g("ngIf",e.pacchetto),c(),P("attivo",e.selezionato)}}function Xe(s,t){if(s&1){let e=w();n(0,"div",52),v("click",function(){let i=_(e).$implicit,l=m(2);return z(l.toggleServizio("digitalizzazione_automatismi",i))}),n(1,"div",53)(2,"h4"),r(3),a(),n(4,"div",56),r(5),a()(),n(6,"p",57),r(7),a(),n(8,"div",59)(9,"i",41),r(10,"check"),a()()()}if(s&2){let e=t.$implicit,o=m(2);P("selezionato",e.selezionato),c(3),h(e.nome),c(2),h(o.formatPrezzoServizio(e)),c(2),h(e.descrizione),c(),P("attivo",e.selezionato)}}function Ze(s,t){if(s&1){let e=w();n(0,"section",14)(1,"div",15)(2,"i",16),r(3,"memory"),a(),n(4,"div",17)(5,"h2",18),r(6,"Digitalizzazione & Automatismi"),a(),n(7,"p",43),r(8,"Configura i servizi digitali e di automazione"),a()()(),n(9,"h3",44),r(10,"Sito"),a(),n(11,"div",45),b(12,Ye,12,10,"div",46),a(),n(13,"h3",44),r(14,"Servizi singoli"),a(),n(15,"div",45),b(16,Xe,11,7,"div",47),a(),n(17,"div",48)(18,"div",49)(19,"div",61)(20,"span",62),r(21,"Totale Modulo Una Tantum"),a(),n(22,"span",63),r(23),a()(),n(24,"div",61)(25,"span",62),r(26,"Totale Modulo Mensile"),a(),n(27,"span",63),r(28),a()()()(),n(29,"div",28)(30,"button",50),v("click",function(){_(e);let i=m();return z(i.indietro())}),r(31,"Indietro"),a(),n(32,"button",51),v("click",function(){_(e);let i=m();return z(i.avanti())}),r(33,"Continua"),a()()()}if(s&2){let e=m();c(12),g("ngForOf",e.getServiziPacchetto("digitalizzazione_automatismi")),c(4),g("ngForOf",e.getServiziSingoli("digitalizzazione_automatismi")),c(7),h(e.formatCurrency(e.getTotaliModuloSplit("digitalizzazione_automatismi").una)),c(5),h(e.formatCurrency(e.getTotaliModuloSplit("digitalizzazione_automatismi").mensile))}}function Ke(s,t){if(s&1){let e=w();n(0,"div",52),v("click",function(){let i=_(e).$implicit,l=m(3);return z(l.isServizioContabilitaAbilitato(i)&&l.toggleServizioContabilita(i))}),n(1,"div",53)(2,"h4",68),r(3),a(),n(4,"div",69),r(5),a()(),n(6,"p",57),r(7),a(),n(8,"div",59)(9,"i",41),r(10,"check"),a()()()}if(s&2){let e=t.$implicit,o=m(3);P("selezionato",e.selezionato)("disabled",!o.isServizioContabilitaAbilitato(e)),c(3),h(e.nome),c(2),E("",e.prezzo," \u20AC"),c(2),h(e.descrizione),c(),P("attivo",e.selezionato)}}function et(s,t){if(s&1&&(n(0,"div")(1,"div",98),b(2,Ke,11,9,"div",99),a()()),s&2){let e=m(2);c(2),g("ngForOf",e.getServiziByCategoria("Costituzione"))}}function tt(s,t){if(s&1&&(n(0,"div",40)(1,"strong"),r(2,"Dettaglio calcolo:"),a(),r(3),a()),s&2){let e=m(2);c(3),E(" ",e.getDescrizioneContabilita(e.configurazioniContabilita.contabilita.tipo)," ")}}function it(s,t){if(s&1&&(n(0,"div",56),r(1),a()),s&2){let e=m(2);c(),E(" ",e.configurazioniContabilita==null||e.configurazioniContabilita.iva==null?null:e.configurazioniContabilita.iva.prezzoCalcolato," \u20AC ")}}function nt(s,t){if(s&1){let e=w();n(0,"div",102),v("click",function(i){return _(e),z(i.stopPropagation())}),n(1,"label",103)(2,"span"),r(3,"Quantit\xE0"),a(),n(4,"div",104)(5,"button",105),v("click",function(i){_(e);let l=m(5);return l.configurazioniContabilita.altriServizi.modello770Count=l.Math.max(1,(l.configurazioniContabilita.altriServizi.modello770Count||1)-1),l.calcolaTotali(),z(i.stopPropagation())}),n(6,"i",41),r(7,"remove"),a()(),n(8,"input",106),I("ngModelChange",function(i){_(e);let l=m(5);return T(l.configurazioniContabilita.altriServizi.modello770Count,i)||(l.configurazioniContabilita.altriServizi.modello770Count=i),z(i)}),v("ngModelChange",function(){_(e);let i=m(5);return z(i.calcolaTotali())})("click",function(i){return _(e),z(i.stopPropagation())}),a(),n(9,"button",107),v("click",function(i){_(e);let l=m(5);return l.configurazioniContabilita.altriServizi.modello770Count=(l.configurazioniContabilita.altriServizi.modello770Count||1)+1,l.calcolaTotali(),z(i.stopPropagation())}),n(10,"i",41),r(11,"add"),a()()()()()}if(s&2){let e=m(5);c(8),A("ngModel",e.configurazioniContabilita.altriServizi.modello770Count)}}function ot(s,t){if(s&1){let e=w();n(0,"div",102),v("click",function(i){return _(e),z(i.stopPropagation())}),n(1,"label",103)(2,"span"),r(3,"Quantit\xE0"),a(),n(4,"div",104)(5,"button",105),v("click",function(i){_(e);let l=m(5);return l.configurazioniContabilita.altriServizi.imuCount=l.Math.max(1,(l.configurazioniContabilita.altriServizi.imuCount||1)-1),l.calcolaTotali(),z(i.stopPropagation())}),n(6,"i",41),r(7,"remove"),a()(),n(8,"input",106),I("ngModelChange",function(i){_(e);let l=m(5);return T(l.configurazioniContabilita.altriServizi.imuCount,i)||(l.configurazioniContabilita.altriServizi.imuCount=i),z(i)}),v("ngModelChange",function(){_(e);let i=m(5);return z(i.calcolaTotali())})("click",function(i){return _(e),z(i.stopPropagation())}),a(),n(9,"button",107),v("click",function(i){_(e);let l=m(5);return l.configurazioniContabilita.altriServizi.imuCount=(l.configurazioniContabilita.altriServizi.imuCount||1)+1,l.calcolaTotali(),z(i.stopPropagation())}),n(10,"i",41),r(11,"add"),a()()()()()}if(s&2){let e=m(5);c(8),A("ngModel",e.configurazioniContabilita.altriServizi.imuCount)}}function at(s,t){if(s&1){let e=w();n(0,"div",102),v("click",function(i){return _(e),z(i.stopPropagation())}),n(1,"label",103)(2,"span"),r(3,"Quantit\xE0"),a(),n(4,"div",104)(5,"button",105),v("click",function(i){_(e);let l=m(5);return l.configurazioniContabilita.altriServizi.locazioniCount=l.Math.max(1,(l.configurazioniContabilita.altriServizi.locazioniCount||1)-1),l.calcolaTotali(),z(i.stopPropagation())}),n(6,"i",41),r(7,"remove"),a()(),n(8,"input",106),I("ngModelChange",function(i){_(e);let l=m(5);return T(l.configurazioniContabilita.altriServizi.locazioniCount,i)||(l.configurazioniContabilita.altriServizi.locazioniCount=i),z(i)}),v("ngModelChange",function(){_(e);let i=m(5);return z(i.calcolaTotali())})("click",function(i){return _(e),z(i.stopPropagation())}),a(),n(9,"button",107),v("click",function(i){_(e);let l=m(5);return l.configurazioniContabilita.altriServizi.locazioniCount=(l.configurazioniContabilita.altriServizi.locazioniCount||1)+1,l.calcolaTotali(),z(i.stopPropagation())}),n(10,"i",41),r(11,"add"),a()()()()()}if(s&2){let e=m(5);c(8),A("ngModel",e.configurazioniContabilita.altriServizi.locazioniCount)}}function rt(s,t){if(s&1){let e=w();n(0,"div",102),v("click",function(i){return _(e),z(i.stopPropagation())}),n(1,"label",103)(2,"span"),r(3,"Quantit\xE0"),a(),n(4,"div",104)(5,"button",105),v("click",function(i){_(e);let l=m(5);return l.configurazioniContabilita.altriServizi.smartCardRilascioCount=l.Math.max(1,(l.configurazioniContabilita.altriServizi.smartCardRilascioCount||1)-1),l.calcolaTotali(),z(i.stopPropagation())}),n(6,"i",41),r(7,"remove"),a()(),n(8,"input",106),I("ngModelChange",function(i){_(e);let l=m(5);return T(l.configurazioniContabilita.altriServizi.smartCardRilascioCount,i)||(l.configurazioniContabilita.altriServizi.smartCardRilascioCount=i),z(i)}),v("ngModelChange",function(){_(e);let i=m(5);return z(i.calcolaTotali())})("click",function(i){return _(e),z(i.stopPropagation())}),a(),n(9,"button",107),v("click",function(i){_(e);let l=m(5);return l.configurazioniContabilita.altriServizi.smartCardRilascioCount=(l.configurazioniContabilita.altriServizi.smartCardRilascioCount||1)+1,l.calcolaTotali(),z(i.stopPropagation())}),n(10,"i",41),r(11,"add"),a()()()()()}if(s&2){let e=m(5);c(8),A("ngModel",e.configurazioniContabilita.altriServizi.smartCardRilascioCount)}}function lt(s,t){if(s&1&&(n(0,"div"),b(1,nt,12,1,"div",101)(2,ot,12,1,"div",101)(3,at,12,1,"div",101)(4,rt,12,1,"div",101),a()),s&2){let e=m().$implicit;c(),g("ngIf",e.id==="altro_modello_770"),c(),g("ngIf",e.id==="altro_imu_dichiarazione"),c(),g("ngIf",e.id==="altro_locazioni"),c(),g("ngIf",e.id==="altro_smart_card_rilascio")}}function st(s,t){if(s&1){let e=w();n(0,"div",52),v("click",function(){let i=_(e).$implicit,l=m(3);return z(l.toggleServizioContabilita(i))}),n(1,"div",53)(2,"h4"),r(3),a(),n(4,"div",56),r(5),a()(),n(6,"p",57),r(7),a(),b(8,lt,5,4,"div",70),n(9,"div",59)(10,"i",41),r(11,"check"),a()()()}if(s&2){let e=t.$implicit,o=m(3);P("selezionato",e.selezionato),c(3),h(e.nome),c(2),h(o.formatPrezzoServizio(e)),c(2),h(e.descrizione),c(),g("ngIf",e.selezionato),c(),P("attivo",e.selezionato)}}function ct(s,t){if(s&1&&(n(0,"div",100),b(1,st,12,8,"div",47),a()),s&2){let e=m(2);c(),g("ngForOf",e.getServiziByCategoria("Altri Servizi"))}}function mt(s,t){if(s&1){let e=w();n(0,"section",14)(1,"div",15)(2,"i",16),r(3,"calculate"),a(),n(4,"div",17)(5,"h2",18),r(6,"Contabilit\xE0 e Fiscalit\xE0"),a(),n(7,"p",43),r(8,"Configura i servizi contabili e fiscali in base alle tue esigenze"),a()()(),n(9,"div",64)(10,"div",65)(11,"div",66)(12,"div",67),v("click",function(){_(e);let i=m();return z(i.toggleServizioContabilita(i.moduli.contabilita_fiscalita.servizi[0]))}),n(13,"div",68)(14,"div",53)(15,"h3",18),r(16,"Costituzione Azienda"),a(),n(17,"div",69),r(18,"Configurabile"),a()()(),n(19,"p",57),r(20,"Servizi di costituzione aziendale - Seleziona per attivare i servizi specifici"),a(),n(21,"div",59)(22,"i",41),r(23,"check"),a()()(),b(24,et,3,1,"div",70),a()(),n(25,"div",65)(26,"div",19)(27,"div",68)(28,"h3",18),r(29,"Contabilit\xE0"),a(),n(30,"div",56),r(31),a()(),n(32,"div",71)(33,"button",72),v("click",function(i){return _(e),m().toggleService("contabilita_fiscalita","contabilita_principale",!0),z(i.stopPropagation())}),n(34,"i",41),r(35),a()()(),n(36,"div",73)(37,"div",74)(38,"label",20),r(39,"Tipo di Contabilit\xE0:"),a(),n(40,"select",75),I("ngModelChange",function(i){_(e);let l=m();return T(l.configurazioniContabilita.contabilita.tipo,i)||(l.configurazioniContabilita.contabilita.tipo=i),z(i)}),v("change",function(){_(e);let i=m();return z(i.calcolaPrezzoContabilita())}),n(41,"option",76),r(42,"Seleziona"),a(),n(43,"option",77),r(44,"Semplificata"),a(),n(45,"option",78),r(46,"Ordinaria"),a(),n(47,"option",79),r(48,"Mista"),a()()(),n(49,"div",74)(50,"label",20),r(51,"Numero Registrazioni Annuali:"),a(),n(52,"input",80),I("ngModelChange",function(i){_(e);let l=m();return T(l.configurazioniContabilita.contabilita.registrazioni,i)||(l.configurazioniContabilita.contabilita.registrazioni=i),z(i)}),v("change",function(){_(e);let i=m();return z(i.calcolaPrezzoContabilita())}),a()()(),b(53,tt,4,1,"div",26),a()(),n(54,"div",65)(55,"div",19)(56,"div",68)(57,"h3",18),r(58,"Fatturazione"),a(),n(59,"div",56),r(60),a()(),n(61,"div",71)(62,"button",72),v("click",function(i){return _(e),m().toggleService("contabilita_fiscalita","fatturazione_principale",!0),z(i.stopPropagation())}),n(63,"i",41),r(64),a()()(),n(65,"div",73)(66,"div",74)(67,"label",20),r(68,"Tipo di Fatturazione:"),a(),n(69,"select",75),I("ngModelChange",function(i){_(e);let l=m();return T(l.configurazioniContabilita.fatturazione.tipo,i)||(l.configurazioniContabilita.fatturazione.tipo=i),z(i)}),v("change",function(){_(e);let i=m();return z(i.calcolaPrezzoFatturazione())}),n(70,"option",76),r(71,"Seleziona"),a(),n(72,"option",81),r(73,"Emissione da parte nostra (25\u20AC/fattura)"),a(),n(74,"option",82),r(75,"Piattaforma PassCom (4\u20AC/fattura)"),a()()(),n(76,"div",74)(77,"label",20),r(78,"Numero Fatture Annuali:"),a(),n(79,"input",83),I("ngModelChange",function(i){_(e);let l=m();return T(l.configurazioniContabilita.fatturazione.numeroFatture,i)||(l.configurazioniContabilita.fatturazione.numeroFatture=i),z(i)}),v("change",function(){_(e);let i=m();return z(i.calcolaPrezzoFatturazione())}),a()()()()(),n(80,"div",65)(81,"div",19)(82,"div",68)(83,"h3",18),r(84,"IVA"),a(),b(85,it,2,1,"div",84),a(),n(86,"div",71)(87,"button",72),v("click",function(i){return _(e),m().toggleService("contabilita_fiscalita","iva_principale",!0),z(i.stopPropagation())}),n(88,"i",41),r(89),a()()(),n(90,"div",73)(91,"div",74)(92,"label",20),r(93,"Liquidazione IVA:"),a(),n(94,"select",75),I("ngModelChange",function(i){_(e);let l=m();return T(l.configurazioniContabilita.iva.liquidazione,i)||(l.configurazioniContabilita.iva.liquidazione=i),z(i)}),v("change",function(){_(e);let i=m();return z(i.calcolaPrezzoIVA())}),n(95,"option",76),r(96,"Seleziona"),a(),n(97,"option",85),r(98,"Trimestrale"),a(),n(99,"option",86),r(100,"Mensile"),a()()(),n(101,"div",74)(102,"label",20),r(103,"LIPE:"),a(),n(104,"select",75),I("ngModelChange",function(i){_(e);let l=m();return T(l.configurazioniContabilita.iva.lipe,i)||(l.configurazioniContabilita.iva.lipe=i),z(i)}),v("change",function(){_(e);let i=m();return z(i.calcolaPrezzoIVA())}),n(105,"option",85),r(106,"Trimestrale"),a(),n(107,"option",86),r(108,"Mensile"),a()()(),n(109,"div",74)(110,"label",20),r(111,"Volume d'Affari per Dichiarazione Annuale:"),a(),n(112,"select",75),I("ngModelChange",function(i){_(e);let l=m();return T(l.configurazioniContabilita.iva.volumeAffari,i)||(l.configurazioniContabilita.iva.volumeAffari=i),z(i)}),v("change",function(){_(e);let i=m();return z(i.calcolaPrezzoIVA())}),n(113,"option",87),r(114,"Fino a 75.000\u20AC"),a(),n(115,"option",88),r(116,"75.001-150.000\u20AC"),a(),n(117,"option",89),r(118,"150.001-300.000\u20AC"),a(),n(119,"option",90),r(120,"300.001-500.000\u20AC"),a(),n(121,"option",91),r(122,"500.001-750.000\u20AC"),a(),n(123,"option",92),r(124,"Oltre 750.000\u20AC"),a()()()(),n(125,"div",73)(126,"div",93)(127,"label")(128,"input",94),I("ngModelChange",function(i){_(e);let l=m();return T(l.configurazioniContabilita.iva.vistoConformita,i)||(l.configurazioniContabilita.iva.vistoConformita=i),z(i)}),v("change",function(){_(e);let i=m();return z(i.calcolaPrezzoIVA())}),a(),r(129," Visto di Conformit\xE0 "),a()(),n(130,"div",93)(131,"label")(132,"input",94),I("ngModelChange",function(i){_(e);let l=m();return T(l.configurazioniContabilita.iva.modelloIVATR,i)||(l.configurazioniContabilita.iva.modelloIVATR=i),z(i)}),v("change",function(){_(e);let i=m();return z(i.calcolaPrezzoIVA())}),a(),r(133," Modello IVA TR "),a()(),n(134,"div",93)(135,"label")(136,"input",94),I("ngModelChange",function(i){_(e);let l=m();return T(l.configurazioniContabilita.iva.intrastat,i)||(l.configurazioniContabilita.iva.intrastat=i),z(i)}),v("change",function(){_(e);let i=m();return z(i.calcolaPrezzoIVA())}),a(),r(137," Intrastat "),a()()()()(),n(138,"div",65)(139,"h3",95)(140,"span"),r(141,"Altri Servizi"),a(),n(142,"button",96),v("click",function(i){return _(e),m().toggleAltriServizi(),z(i.stopPropagation())}),n(143,"i",41),r(144),a()()(),b(145,ct,2,1,"div",97),a()(),n(146,"div",48)(147,"div",49)(148,"div",61)(149,"span",62),r(150,"Totale Modulo Una Tantum"),a(),n(151,"span",63),r(152),a()(),n(153,"div",61)(154,"span",62),r(155,"Totale Modulo Mensile"),a(),n(156,"span",63),r(157),a()()()(),n(158,"div",28)(159,"button",50),v("click",function(){_(e);let i=m();return z(i.indietro())}),r(160,"Indietro"),a(),n(161,"button",51),v("click",function(){_(e);let i=m();return z(i.avanti())}),r(162,"Continua"),a()()()}if(s&2){let e=m();c(12),P("active",e.configurazioniContabilita.costituzione.attivo),c(9),P("attivo",e.configurazioniContabilita.costituzione.attivo),c(3),g("ngIf",e.configurazioniContabilita.costituzione.attivo),c(7),E("",e.configurazioniContabilita.contabilita.prezzoCalcolato," \u20AC"),c(2),g("title",e.isServiceSelected("contabilita_fiscalita","contabilita_principale")?"Rimuovi servizio":"Aggiungi servizio"),c(2),E(" ",e.isServiceSelected("contabilita_fiscalita","contabilita_principale")?"remove_circle_outline":"add_circle"," "),c(5),A("ngModel",e.configurazioniContabilita.contabilita.tipo),c(12),A("ngModel",e.configurazioniContabilita.contabilita.registrazioni),c(),g("ngIf",(e.configurazioniContabilita==null||e.configurazioniContabilita.contabilita==null?null:e.configurazioniContabilita.contabilita.prezzoCalcolato)>0&&(e.getServiziSelezionatiModulo("contabilita_fiscalita")||Y(29,Me)).length>0),c(7),E("",e.configurazioniContabilita.fatturazione.prezzoCalcolato," \u20AC"),c(2),g("title",e.isServiceSelected("contabilita_fiscalita","fatturazione_principale")?"Rimuovi servizio":"Aggiungi servizio"),c(2),E(" ",e.isServiceSelected("contabilita_fiscalita","fatturazione_principale")?"remove_circle_outline":"add_circle"," "),c(5),A("ngModel",e.configurazioniContabilita.fatturazione.tipo),c(10),A("ngModel",e.configurazioniContabilita.fatturazione.numeroFatture),c(6),g("ngIf",(e.configurazioniContabilita==null||e.configurazioniContabilita.iva==null?null:e.configurazioniContabilita.iva.prezzoCalcolato)>0),c(2),g("title",e.isServiceSelected("contabilita_fiscalita","iva_principale")?"Rimuovi servizio":"Aggiungi servizio"),c(2),E(" ",e.isServiceSelected("contabilita_fiscalita","iva_principale")?"remove_circle_outline":"add_circle"," "),c(5),A("ngModel",e.configurazioniContabilita.iva.liquidazione),c(10),A("ngModel",e.configurazioniContabilita.iva.lipe),c(8),A("ngModel",e.configurazioniContabilita.iva.volumeAffari),c(16),A("ngModel",e.configurazioniContabilita.iva.vistoConformita),c(4),A("ngModel",e.configurazioniContabilita.iva.modelloIVATR),c(4),A("ngModel",e.configurazioniContabilita.iva.intrastat),c(8),h(e.showAltriServizi?"expand_less":"expand_more"),c(),g("ngIf",e.showAltriServizi),c(7),h(e.formatCurrency(e.getTotaliModuloSplit("contabilita_fiscalita").una)),c(5),h(e.formatCurrency(e.getTotaliModuloSplit("contabilita_fiscalita").mensile))}}function dt(s,t){if(s&1&&(n(0,"span",60),r(1),a()),s&2){let e=m().$implicit;c(),h(e.pacchetto)}}function ut(s,t){if(s&1){let e=w();n(0,"div",52),v("click",function(){let i=_(e).$implicit,l=m(2);return z(l.toggleServizio("ottimizzazione_management",i))}),n(1,"div",53)(2,"h4"),r(3),a(),n(4,"div",56),r(5),a()(),n(6,"p",57),r(7),a(),b(8,dt,2,1,"span",58),n(9,"div",59)(10,"i",41),r(11,"check"),a()()()}if(s&2){let e=t.$implicit,o=m(2);P("selezionato",e.selezionato)("disabled",o.isServizioDisabled("ottimizzazione_management",e)),c(3),h(e.nome),c(2),h(o.formatPrezzoServizio(e)),c(2),h(e.descrizione),c(),g("ngIf",e.pacchetto),c(),P("attivo",e.selezionato)}}function pt(s,t){if(s&1&&(n(0,"span",60),r(1),a()),s&2){let e=m().$implicit;c(),h(e.pacchetto)}}function _t(s,t){if(s&1){let e=w();n(0,"div",52),v("click",function(){let i=_(e).$implicit,l=m(2);return z(l.toggleServizio("ottimizzazione_management",i))}),n(1,"div",53)(2,"h4"),r(3),a(),n(4,"div",56),r(5),a()(),n(6,"p",57),r(7),a(),b(8,pt,2,1,"span",58),n(9,"div",59)(10,"i",41),r(11,"check"),a()()()}if(s&2){let e=t.$implicit,o=m(2);P("selezionato",e.selezionato)("disabled",o.isServizioDisabled("ottimizzazione_management",e)),c(3),h(e.nome),c(2),h(o.formatPrezzoServizio(e)),c(2),h(e.descrizione),c(),g("ngIf",e.pacchetto),c(),P("attivo",e.selezionato)}}function zt(s,t){if(s&1){let e=w();n(0,"div",52),v("click",function(){let i=_(e).$implicit,l=m(2);return z(l.toggleServizio("ottimizzazione_management",i))}),n(1,"div",53)(2,"h4"),r(3),a(),n(4,"div",56),r(5),a()(),n(6,"p",57),r(7),a(),n(8,"div",59)(9,"i",41),r(10,"check"),a()()()}if(s&2){let e=t.$implicit,o=m(2);P("selezionato",e.selezionato),c(3),h(e.nome),c(2),h(o.formatPrezzoServizio(e)),c(2),h(e.descrizione),c(),P("attivo",e.selezionato)}}function gt(s,t){if(s&1){let e=w();n(0,"section",14)(1,"div",15)(2,"i",16),r(3,"tune"),a(),n(4,"div",17)(5,"h2",18),r(6,"Ottimizzazione e Management"),a(),n(7,"p",43),r(8,"Configura i servizi di ottimizzazione"),a()()(),n(9,"h3",44),r(10,"Pacchetti \u2014 Consulenze di Impresa"),a(),n(11,"div",45),b(12,ut,12,10,"div",99),a(),n(13,"h3",44),r(14,"Pacchetti \u2014 Formazione Commerciale"),a(),n(15,"div",45),b(16,_t,12,10,"div",99),a(),n(17,"h3",44),r(18,"Servizi singoli"),a(),n(19,"div",45),b(20,zt,11,7,"div",47),a(),n(21,"div",48)(22,"div",49)(23,"div",61)(24,"span",62),r(25,"Totale Modulo Una Tantum"),a(),n(26,"span",63),r(27),a()(),n(28,"div",61)(29,"span",62),r(30,"Totale Modulo Mensile"),a(),n(31,"span",63),r(32),a()()()(),n(33,"div",28)(34,"button",50),v("click",function(){_(e);let i=m();return z(i.indietro())}),r(35,"Indietro"),a(),n(36,"button",51),v("click",function(){_(e);let i=m();return z(i.avanti())}),r(37,"Vedi Riepilogo"),a()()()}if(s&2){let e=m();c(12),g("ngForOf",e.getPacchettiConsulenza()),c(4),g("ngForOf",e.getPacchettiFormazione()),c(4),g("ngForOf",e.getServiziSingoli("ottimizzazione_management")),c(7),h(e.formatCurrency(e.getTotaliModuloSplit("ottimizzazione_management").una)),c(5),h(e.formatCurrency(e.getTotaliModuloSplit("ottimizzazione_management").mensile))}}function ft(s,t){if(s&1&&(n(0,"div",40)(1,"i",41),r(2,"business"),a(),r(3," Prospect: "),n(4,"strong"),r(5),a()()),s&2){let e=m(2);c(5),h(e.selectedProspect.ragione_sociale)}}function vt(s,t){if(s&1&&(n(0,"div",124)(1,"div",125)(2,"span",126),r(3,"\u2713"),a(),n(4,"span",127),r(5),a()(),n(6,"div",128),r(7),a()()),s&2){let e=t.$implicit,o=m(3);c(5),h(e.nome),c(2),h(o.formatPrezzoServizio(e))}}function ht(s,t){if(s&1&&(n(0,"div",19)(1,"h2",68),r(2,"Immagine & Marketing"),a(),n(3,"div",73),b(4,vt,8,2,"div",122),a(),n(5,"div",49)(6,"div",61)(7,"span",123),r(8,"Totale Modulo Una Tantum"),a(),n(9,"span",63),r(10),a()(),n(11,"div",61)(12,"span",123),r(13,"Totale Modulo Mensile"),a(),n(14,"span",63),r(15),a()()()()),s&2){let e=m(2);c(4),g("ngForOf",e.getServiziSelezionatiModulo("immagine_marketing")),c(6),h(e.formatCurrency(e.getTotaliModuloSplit("immagine_marketing").una)),c(5),h(e.formatCurrency(e.getTotaliModuloSplit("immagine_marketing").mensile))}}function Ct(s,t){if(s&1&&(k(0),r(1),N()),s&2){let e=m().$implicit,o=m(3);c(),E(" ",o.formatCurrency(o.num(e.prezzo||0))," ")}}function xt(s,t){if(s&1&&r(0),s&2){let e=m().$implicit,o=m(3);E(" ",o.formatPrezzoServizio(e)," ")}}function bt(s,t){if(s&1&&(n(0,"div",124)(1,"div",125)(2,"span",133),r(3,"\u2713"),a(),n(4,"span",127),r(5,"Software Personalizzato Mantenimento"),a()(),n(6,"div",128),r(7),a()()),s&2){let e=m().$implicit,o=m(3);c(7),E(" ",o.formatCurrency(o.num(e.prezzo_mensile??e.prezzoMensile))," /mese ")}}function St(s,t){if(s&1&&(n(0,"div",130)(1,"div",124)(2,"div",125)(3,"span",131),r(4,"\u2713"),a(),n(5,"span",127),r(6),a()(),n(7,"div",128),b(8,Ct,2,1,"ng-container",54)(9,xt,1,1,"ng-template",null,5,F),a()(),b(11,bt,8,1,"div",132),a()),s&2){let e=t.$implicit,o=O(10),i=m(3);c(6),h(e.nome),c(2),g("ngIf",e.id==="software_personalizzato")("ngIfElse",o),c(3),g("ngIf",e.id==="software_personalizzato"&&i.num(e.prezzo_mensile??e.prezzoMensile)>0)}}function yt(s,t){if(s&1&&(n(0,"div",19)(1,"h2",68),r(2,"Digitalizzazione & Automatismi"),a(),n(3,"div",73),b(4,St,12,4,"div",129),a(),n(5,"div",49)(6,"div",61)(7,"span",123),r(8,"Totale Modulo Una Tantum"),a(),n(9,"span",63),r(10),a()(),n(11,"div",61)(12,"span",123),r(13,"Totale Modulo Mensile"),a(),n(14,"span",63),r(15),a()()()()),s&2){let e=m(2);c(4),g("ngForOf",e.getServiziSelezionatiModulo("digitalizzazione_automatismi")),c(6),h(e.formatCurrency(e.getTotaliModuloSplit("digitalizzazione_automatismi").una)),c(5),h(e.formatCurrency(e.getTotaliModuloSplit("digitalizzazione_automatismi").mensile))}}function Mt(s,t){if(s&1&&(k(0),n(1,"span"),r(2),a(),n(3,"span",135),r(4,"\xD7"),a(),n(5,"strong"),r(6),a(),n(7,"span",136),r(8),a(),N()),s&2){let e=m().$implicit,o=m(3);c(2),h(o.formatPrezzoServizio(e)),c(4),h(o.getAltriServiziCountFor(e.id)),c(2),E("= ",o.formatCurrency((e.prezzo||0)*o.getAltriServiziCountFor(e.id)))}}function Pt(s,t){if(s&1&&r(0),s&2){let e=m().$implicit,o=m(3);E(" ",o.formatPrezzoServizio(e)," ")}}function wt(s,t){if(s&1&&(n(0,"div",124)(1,"div",125)(2,"span",134),r(3,"\u2713"),a(),n(4,"span",127),r(5),a()(),n(6,"div",128),b(7,Mt,9,3,"ng-container",54)(8,Pt,1,1,"ng-template",null,6,F),a()()),s&2){let e=t.$implicit,o=O(9),i=m(3);c(5),h(e.nome),c(2),g("ngIf",i.isAltriServiziCounted(e.id))("ngIfElse",o)}}function Et(s,t){if(s&1&&(n(0,"div",19)(1,"h2",68),r(2,"Contabilit\xE0 e Fiscalit\xE0"),a(),n(3,"div",73),b(4,wt,10,3,"div",122),a(),n(5,"div",49)(6,"div",61)(7,"span",123),r(8,"Totale Modulo Una Tantum"),a(),n(9,"span",63),r(10),a()(),n(11,"div",61)(12,"span",123),r(13,"Totale Modulo Mensile"),a(),n(14,"span",63),r(15),a()()()()),s&2){let e=m(2);c(4),g("ngForOf",e.getServiziSelezionatiModulo("contabilita_fiscalita")),c(6),h(e.formatCurrency(e.getTotaliModuloSplit("contabilita_fiscalita").una)),c(5),h(e.formatCurrency(e.getTotaliModuloSplit("contabilita_fiscalita").mensile))}}function At(s,t){if(s&1&&(n(0,"div",124)(1,"div",125)(2,"span",137),r(3,"\u2713"),a(),n(4,"span",127),r(5),a()(),n(6,"div",128),r(7),a()()),s&2){let e=t.$implicit,o=m(3);c(5),h(e.nome),c(2),h(o.formatPrezzoServizio(e))}}function Tt(s,t){if(s&1&&(n(0,"div",19)(1,"h2",68),r(2,"Ottimizzazione e Management"),a(),n(3,"div",73),b(4,At,8,2,"div",122),a(),n(5,"div",49)(6,"div",61)(7,"span",123),r(8,"Totale Modulo Una Tantum"),a(),n(9,"span",63),r(10),a()(),n(11,"div",61)(12,"span",123),r(13,"Totale Modulo Mensile"),a(),n(14,"span",63),r(15),a()()()()),s&2){let e=m(2);c(4),g("ngForOf",e.getServiziSelezionatiModulo("ottimizzazione_management")),c(6),h(e.formatCurrency(e.getTotaliModuloSplit("ottimizzazione_management").una)),c(5),h(e.formatCurrency(e.getTotaliModuloSplit("ottimizzazione_management").mensile))}}function It(s,t){if(s&1&&(k(0),n(1,"span",138),r(2),a(),n(3,"strong",139),r(4),a(),n(5,"span"),r(6,"/mese"),a(),N()),s&2){let e=m(2);c(2),h(e.formatCurrency(e.totaleMensile)),c(2),h(e.formatCurrency(e.totaleMensileScontato))}}function Vt(s,t){if(s&1&&(n(0,"span",140),r(1),a(),n(2,"span"),r(3,"/mese"),a()),s&2){let e=m(2);c(),h(e.formatCurrency(e.totaleMensile))}}function kt(s,t){if(s&1&&(k(0),n(1,"span",138),r(2),a(),n(3,"strong",139),r(4),a(),N()),s&2){let e=m(2);c(2),h(e.formatCurrency(e.totaleUnaTantum)),c(2),h(e.formatCurrency(e.totaleUnaScontata))}}function Nt(s,t){if(s&1&&(n(0,"span"),r(1),a()),s&2){let e=m(2);c(),h(e.formatCurrency(e.totaleUnaTantum))}}function Ot(s,t){if(s&1&&(k(0),n(1,"div",141)(2,"small",142),r(3),W(4,"number"),a()(),N()),s&2){let e=m(2);c(3),L("(sconto ",U(4,2,e.scontoPercentuale,"1.2-2"),"% \u2014 target: ",e.scontoTarget,")")}}function Ft(s,t){if(s&1){let e=w();n(0,"button",143),v("click",function(){_(e);let i=m(2);return z(i.salvaConfigurazione())}),n(1,"i",41),r(2,"save"),a(),r(3," Salva Configurazione "),a()}}function Dt(s,t){if(s&1&&(n(0,"span",152),r(1),W(2,"number"),a()),s&2){let e=m(3);c(),L(" ",U(2,2,e.scontoPercentuale,"1.2-2"),"% - Risparmio: ",e.formatCurrency(e.totaleGenerale-e.totaleScontato)," ")}}function Rt(s,t){s&1&&(n(0,"span",142),r(1," In attesa di valutazione / da confermare "),a())}function qt(s,t){if(s&1){let e=w();n(0,"button",115),v("click",function(){_(e);let i=m(3);return i.applySconto(0),z(i.salvaConfigurazione())}),n(1,"span",41),r(2,"close"),a(),r(3," Rimuovi Sconto "),a()}}function Lt(s,t){if(s&1&&(n(0,"span"),r(1),a()),s&2){let e=m(3);c(),h(e.formatCurrency(e.totaleScontato))}}function Wt(s,t){if(s&1&&(n(0,"span"),r(1),a()),s&2){let e=m(3);c(),h(e.formatCurrency(e.totaleGenerale))}}function Ut(s,t){if(s&1&&(n(0,"div",74)(1,"label",20),r(2,"Totale non scontato"),a(),n(3,"div",153),r(4),a()()),s&2){let e=m(3);c(4),h(e.formatCurrency(e.totaleGenerale))}}function Bt(s,t){if(s&1&&(n(0,"div",8)(1,"h3",18)(2,"span",41),r(3,"local_offer"),a(),r(4," Gestione Sconto "),a(),n(5,"div",73)(6,"div",74)(7,"label",20),r(8,"Sconto Applicato"),a(),n(9,"div",144),b(10,Dt,3,5,"span",145)(11,Rt,2,0,"span",146),a()(),n(12,"div",74)(13,"label",20),r(14,"Azioni"),a(),n(15,"div",147),b(16,qt,4,0,"button",148),a()()(),n(17,"div",149)(18,"div",73)(19,"div",74)(20,"label",20),r(21,"Totale Preventivo"),a(),n(22,"div",150),b(23,Lt,2,1,"span",70)(24,Wt,2,1,"span",70),a()(),b(25,Ut,5,1,"div",151),a()()()),s&2){let e=m(2);c(10),g("ngIf",e.scontoPercentuale>0),c(),g("ngIf",e.scontoPercentuale===0),c(5),g("ngIf",e.scontoPercentuale>0),c(7),g("ngIf",e.scontoPercentuale>0),c(),g("ngIf",e.scontoPercentuale===0),c(),g("ngIf",e.scontoPercentuale>0)}}function $t(s,t){s&1&&(n(0,"span",41),r(1,"support_agent"),a())}function Gt(s,t){s&1&&(n(0,"span",41),r(1,"person"),a())}function jt(s,t){if(s&1&&(n(0,"div",164)(1,"div",165),b(2,$t,2,0,"span",166)(3,Gt,2,0,"span",166),a(),n(4,"div",167)(5,"div",60),r(6),a(),n(7,"div",142),r(8),W(9,"date"),a()()()),s&2){let e=t.$implicit;g("ngClass",X(8,Pe,e.autore==="utente",e.autore==="assistenza")),c(2),g("ngIf",e.autore==="assistenza"),c(),g("ngIf",e.autore==="utente"),c(3),h(e.testo),c(2),h(U(9,5,e.timestamp,"HH:mm"))}}function Ht(s,t){if(s&1){let e=w();n(0,"div",154)(1,"div",155)(2,"div",156)(3,"h3",157)(4,"span",41),r(5,"support_agent"),a(),r(6),a(),n(7,"button",158),v("click",function(){_(e);let i=m(2);return z(i.chiudiChatSconto())}),a()(),n(8,"div",159)(9,"div",160),b(10,jt,10,11,"div",161),a(),n(11,"div",162)(12,"input",163),I("ngModelChange",function(i){_(e);let l=m(2);return T(l.messaggioChat,i)||(l.messaggioChat=i),z(i)}),v("keyup.enter",function(){_(e);let i=m(2);return z(i.inviaMessaggio())}),a(),n(13,"button",29),v("click",function(){_(e);let i=m(2);return z(i.inviaMessaggio())}),n(14,"span",41),r(15,"send"),a()()()()()()}if(s&2){let e=m(2);c(6),E(" Assistenza Preventivo \xB7 ",(e.selectedProspect==null?null:e.selectedProspect.ragione_sociale)||"Cliente"," "),c(4),g("ngForOf",e.messaggiAssistenza),c(2),A("ngModel",e.messaggioChat),c(),g("disabled",!e.messaggioChat.trim())}}function Qt(s,t){if(s&1){let e=w();n(0,"section",108)(1,"div",15)(2,"i",16),r(3,"receipt_long"),a(),n(4,"div",17)(5,"h2",18),r(6,"Riepilogo Configurazione"),a()()(),n(7,"div"),b(8,ft,6,1,"div",26),n(9,"div",45),b(10,ht,16,3,"div",109)(11,yt,16,3,"div",109)(12,Et,16,3,"div",109)(13,Tt,16,3,"div",109),a(),n(14,"div",110)(15,"h3",111)(16,"div",112)(17,"div")(18,"span",113),r(19,"Totale mensile:"),a(),b(20,It,7,2,"ng-container",54)(21,Vt,4,1,"ng-template",null,3,F),a(),n(23,"div")(24,"span",113),r(25,"Totale una tantum:"),a(),b(26,kt,5,2,"ng-container",54)(27,Nt,2,1,"ng-template",null,4,F),a()(),b(29,Ot,5,5,"ng-container",70),a()()(),n(30,"div",114)(31,"button",115),v("click",function(){_(e);let i=m();return z(i.indietro())}),n(32,"span",41),r(33,"edit"),a(),r(34,"Modifica "),a(),n(35,"button",116),v("click",function(){_(e);let i=m();return z(i.apriChatSconto())}),n(36,"span",41),r(37,"support_agent"),a(),r(38,"Assistenza "),a(),n(39,"button",117),v("click",function(){_(e);let i=m();return z(i.visualizzaPreventivo())}),n(40,"span",41),r(41,"description"),a(),r(42," Visualizza Preventivo "),a(),b(43,Ft,4,0,"button",118),n(44,"button",119),v("click",function(){_(e);let i=m();return z(i.procediPerFirme())}),n(45,"i",41),r(46,"assignment_turned_in"),a(),r(47),a()(),b(48,Bt,26,6,"div",120)(49,Ht,16,4,"div",121),a()}if(s&2){let e=O(22),o=O(28),i=m();c(8),g("ngIf",i.selectedProspect),c(2),g("ngIf",i.getServiziSelezionatiModulo("immagine_marketing").length>0||i.moduli.immagine_marketing.totale>0),c(),g("ngIf",i.getServiziSelezionatiModulo("digitalizzazione_automatismi").length>0||i.moduli.digitalizzazione_automatismi.totale>0),c(),g("ngIf",i.getServiziSelezionatiModulo("contabilita_fiscalita").length>0||i.moduli.contabilita_fiscalita.totale>0),c(),g("ngIf",i.getServiziSelezionatiModulo("ottimizzazione_management").length>0||i.moduli.ottimizzazione_management.totale>0),c(7),g("ngIf",i.scontoPercentuale>0&&(i.scontoTarget==="mensile"||i.scontoTarget==="entrambi"))("ngIfElse",e),c(6),g("ngIf",i.scontoPercentuale>0&&(i.scontoTarget==="una_tantum"||i.scontoTarget==="entrambi"))("ngIfElse",o),c(3),g("ngIf",i.scontoPercentuale>0),c(14),g("ngIf",!i.isCliente),c(),g("disabled",!i.selectedProspect||i.totaleGenerale===0),c(3),E(" ",i.isProspect?"Procedi per le Firme":"Aggiorna Configurazione"," "),c(),g("ngIf",i.currentStep===6&&(i.mostraChatSconto||i.scontoPercentuale>0)),c(),g("ngIf",i.mostraChatSconto)}}function Jt(s,t){if(s&1){let e=w();n(0,"div",124)(1,"div",125)(2,"strong"),r(3),a(),n(4,"div",174),r(5),a()(),n(6,"div",175)(7,"button",176),v("click",function(){let i=_(e).index,l=m(3);return z(l.rimuoviNominativo(i))}),n(8,"i",41),r(9,"delete"),a()()()()}if(s&2){let e=t.$implicit;c(3),h(e.nome),c(2),L(" ",e.telefono||"\u2014"," \u2022 ",e.email||"\u2014"," ")}}function Yt(s,t){if(s&1&&(n(0,"div",173)(1,"h3",18),r(2),a(),n(3,"div",73),b(4,Jt,10,3,"div",122),a()()),s&2){let e=m(2);c(2),E("Nominativi Inseriti (",e.nominativi.length,")"),c(2),g("ngForOf",e.nominativi)}}function Xt(s,t){if(s&1){let e=w();n(0,"section",14)(1,"h2"),r(2,"Inserisci i Nominativi Ottenuti"),a(),n(3,"p",43),r(4,"Aggiungi i contatti ottenuti dalla trattativa. Saranno creati come nuovi prospect."),a(),n(5,"div",168)(6,"div",73)(7,"div",74)(8,"label",20),r(9,"Nome completo *"),a(),n(10,"input",169),I("ngModelChange",function(i){_(e);let l=m();return T(l.nuovoNominativo.nome,i)||(l.nuovoNominativo.nome=i),z(i)}),a()(),n(11,"div",74)(12,"label",20),r(13,"Telefono"),a(),n(14,"input",170),I("ngModelChange",function(i){_(e);let l=m();return T(l.nuovoNominativo.telefono,i)||(l.nuovoNominativo.telefono=i),z(i)}),a()(),n(15,"div",74)(16,"label",20),r(17,"Email"),a(),n(18,"input",171),I("ngModelChange",function(i){_(e);let l=m();return T(l.nuovoNominativo.email,i)||(l.nuovoNominativo.email=i),z(i)}),a()()(),n(19,"div",28)(20,"button",51),v("click",function(){_(e);let i=m();return z(i.aggiungiNominativo())}),n(21,"i",41),r(22,"add"),a(),r(23," Aggiungi Nominativo "),a()()(),b(24,Yt,5,2,"div",172),n(25,"div",28)(26,"button",50),v("click",function(){_(e);let i=m();return i.pendingFirmeProcess=!1,z(i.indietro())}),r(27,"Indietro"),a(),n(28,"button",29),v("click",function(){_(e);let i=m();return z(i.procediPerFirme())}),r(29,"Procedi"),a()()()}if(s&2){let e=m();c(10),A("ngModel",e.nuovoNominativo.nome),c(4),A("ngModel",e.nuovoNominativo.telefono),c(4),A("ngModel",e.nuovoNominativo.email),c(6),g("ngIf",e.nominativi.length>0),c(4),g("disabled",!e.selectedProspect)}}var be=class s{constructor(t,e,o,i,l,d){this.soggettiService=t;this.alchemizzatoreService=e;this.router=o;this.route=i;this.supabaseService=l;this.assistenzaService=d}currentStep=1;totaleSteps=7;scontoPercentuale=0;scontoTarget="entrambi";mostraChatSconto=!1;messaggioChat="";messaggiAssistenza=[];richiedendoSconto=!1;overrideNextLimitPercent=0;overrideConsumed=!1;baseAssistDelay=1400;assistJitter=900;pendingCifraRequest=null;totaleMensile=0;totaleUnaTantum=0;totaleMensileScontato=0;totaleUnaScontata=0;showContabilitaChildren=!0;showAltriServizi=!1;queryProspect="";searchResults=[];searchLoading=!1;searchError=null;selectedProspect=null;nominativi=[];nuovoNominativo={nome:"",telefono:"",email:""};pendingFirmeProcess=!1;ANNUAL_TO_MONTHLY_IDS=new Set(["contabilita_principale","fatturazione_principale","iva_principale"]);currentConfigurazioneId=null;previousConfigurazione=null;configurazioneCorrenteId=null;moduli={immagine_marketing:{nome:"Immagine & Marketing",servizi:[{id:"creazione_logo",nome:"Creazione del Logo",prezzo:300,selezionato:!1,descrizione:"Design professionale del logo aziendale"},{id:"creazione_brand",nome:"Creazione del Brand",prezzo:800,selezionato:!1,descrizione:"Identit\xE0 visiva completa: logo, palette colori, typography"},{id:"social_2_post",nome:"Gestione Social Media (2 post/settimana)",prezzo:400,selezionato:!1,pacchetto:"base",descrizione:"2 post settimanali su Facebook e Instagram"},{id:"social_3_post",nome:"Gestione Social Media (3 post/settimana)",prezzo:600,selezionato:!1,pacchetto:"avanzato",descrizione:"3 post settimanali su Facebook, Instagram e LinkedIn"},{id:"social_5_post",nome:"Gestione Social Media (5 post/settimana)",prezzo:800,selezionato:!1,pacchetto:"premium",descrizione:"5 post settimanali su tutti i social + stories"},{id:"servizio_fotografico",nome:"Servizio Fotografico",prezzo:500,selezionato:!1,descrizione:"Servizio fotografico professionale per prodotti/azienda"}],totale:0},digitalizzazione_automatismi:{nome:"Digitalizzazione & Automatismi",servizi:[{id:"landing_page",nome:"Landing Page",prezzo:1e3,selezionato:!1,pacchetto:"base",descrizione:"Pagina di destinazione ottimizzata per conversioni"},{id:"sito_completo",nome:"Sito Web Completo",prezzo:2e3,selezionato:!1,pacchetto:"avanzato",descrizione:"Sito web responsive"},{id:"sito_pro",nome:"Sito Web Pro",prezzo:3500,selezionato:!1,pacchetto:"premium",descrizione:"Sito web avanzato con funzionalit\xE0 personalizzate"},{id:"software_personalizzato",nome:"Software Personalizzato",prezzo:0,selezionato:!1,descrizione:"Richiesta di valutazione per software su misura"},{id:"consulenza_digitale",nome:"Consulenza Digitale",prezzo:300,selezionato:!1,descrizione:"Consulenza per mailing list, automazioni e digital strategy"}],totale:0},contabilita_fiscalita:{nome:"Contabilit\xE0 e Fiscalit\xE0",servizi:[{id:"costituzione_principale",nome:"Costituzione Azienda",prezzo:0,selezionato:!1,categoria:"Costituzione",descrizione:"Servizi di costituzione aziendale - Seleziona per attivare i servizi specifici",tipo:"gruppo"},{id:"cost_assic_redazione",nome:"Assistenza redazione atto costitutivo e Statuto",prezzo:150,selezionato:!1,categoria:"Costituzione",descrizione:"Assistenza redazione atto costitutivo e Statuto (oltre costo notaio e spese accessorie notaio)",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_apertura_piva",nome:"Apertura partita IVA",prezzo:100,selezionato:!1,categoria:"Costituzione",descrizione:"Apertura partita IVA",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_cciaa_no_scia",nome:"Pratica CCIAA senza SCIA",prezzo:80,selezionato:!1,categoria:"Costituzione",descrizione:"Pratica CCIAA per comunicazione attivit\xE0 (senza SCIA) - oltre accessorie (30 Euro diritti CCIAA)",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_cciaa_con_scia",nome:"Pratica CCIAA con SCIA",prezzo:200,selezionato:!1,categoria:"Costituzione",descrizione:"Pratica CCIAA per comunicazione attivit\xE0 (con SCIA al Comune) - oltre accessorie (30 Euro diritti CCIAA)",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_cciaa_scia_plus",nome:"Pratica CCIAA con SCIA plus",prezzo:250,selezionato:!1,categoria:"Costituzione",descrizione:"Pratica CCIAA per comunicazione attivit\xE0 (con SCIA al Comune e plus) - oltre accessorie",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_inps_artigiani",nome:"INPS art/comm",prezzo:50,selezionato:!1,categoria:"Costituzione",descrizione:"INPS artigiani commercianti (soci lavoratori) - per ciascuno",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_inps_gest_separata",nome:"INPS gestione separata",prezzo:80,selezionato:!1,categoria:"Costituzione",descrizione:"INPS gestione separata (P.IVA individuale e amministratori) - per ciascuno",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_vidimazione_libri",nome:"Vidimazione libri sociali",prezzo:20,selezionato:!1,categoria:"Costituzione",descrizione:"Vidimazione libri sociali (oltre accessori) - per libro",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_registrazione_verbali",nome:"Registrazione verbali",prezzo:100,selezionato:!1,categoria:"Costituzione",descrizione:"Registrazione verbali - oltre accessori",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"contabilita_principale",nome:"Servizi di Contabilit\xE0",prezzo:0,selezionato:!1,categoria:"Contabilit\xE0",descrizione:"Seleziona il tipo di contabilit\xE0 e inserisci il numero di registrazioni annuali",tipo:"configurabile"},{id:"fatturazione_principale",nome:"Servizi di Fatturazione",prezzo:0,selezionato:!1,categoria:"Fatturazione",descrizione:"Configura i servizi di fatturazione in base alle tue esigenze",tipo:"configurabile"},{id:"iva_principale",nome:"Servizi IVA",prezzo:0,selezionato:!1,categoria:"IVA",descrizione:"Configura i servizi IVA in base alla tua periodicit\xE0",tipo:"configurabile"},{id:"redditi_principale",nome:"Dichiarazione Redditi",prezzo:0,selezionato:!1,categoria:"Redditi",descrizione:"Configura la dichiarazione redditi in base al tipo di soggetto e volume d'affari",tipo:"configurabile"},{id:"bilancio_principale",nome:"Bilancio",prezzo:0,selezionato:!1,categoria:"Bilancio",descrizione:"Configura il servizio di bilancio in base alle tue esigenze",tipo:"configurabile"},{id:"altro_cu_autonomi",nome:"CU autonomi (fino a 5 percipienti)",prezzo:180,selezionato:!1,categoria:"Altri Servizi",descrizione:"CU per autonomi - fino a 5 percipienti",tipo:"fisso"},{id:"altro_modello_770",nome:"Modello 770",prezzo:100,selezionato:!1,categoria:"Altri Servizi",descrizione:"Modello 770 - autonomi e capitali - una tantum/anno",tipo:"fisso"},{id:"altro_f24_12",nome:"F24 (fino a 12/anno)",prezzo:300,selezionato:!1,categoria:"Altri Servizi",descrizione:"F24 - fino a 12 pagamenti/anno",tipo:"fisso"},{id:"altro_imu_dichiarazione",nome:"Dichiarazione IMU/ILIA",prezzo:60,selezionato:!1,categoria:"Altri Servizi",descrizione:"Dichiarazione IMU/ILIA",tipo:"fisso"},{id:"altro_imu_verifica",nome:"Verifica Esatto/calcolo IMU",prezzo:40,selezionato:!1,categoria:"Altri Servizi",descrizione:"Verifica Esatto/calcolo IMU",tipo:"fisso"},{id:"altro_imu_pagamento",nome:"Pagamento IMU a scadenza",prezzo:25,selezionato:!1,categoria:"Altri Servizi",descrizione:"Pagamento IMU a scadenza",tipo:"fisso"},{id:"altro_avvisi_bonari",nome:"Autotutela avvisi bonari",prezzo:70,selezionato:!1,categoria:"Altri Servizi",descrizione:"Autotutela avvisi bonari",tipo:"fisso"},{id:"altro_locazioni",nome:"Supporto contratti locazione",prezzo:180,selezionato:!1,categoria:"Altri Servizi",descrizione:"Supporto nella predisposizione e registrazione contratti locazione",tipo:"fisso"},{id:"altro_lettere_intento",nome:"Invio lettere d'intento",prezzo:85,selezionato:!1,categoria:"Altri Servizi",descrizione:"Invio lettere d'intento - per ciascuna",tipo:"fisso"},{id:"altro_smart_card_rilascio",nome:"Rilascio Smart Card",prezzo:60,selezionato:!1,categoria:"Altri Servizi",descrizione:"Rilascio Smart Card - per ciascuna",tipo:"fisso"},{id:"altro_smart_card_conservazione",nome:"Conservazione Smart Card",prezzo:30,selezionato:!1,categoria:"Altri Servizi",descrizione:"Conservazione Smart Card - annuale",tipo:"fisso"},{id:"altro_titolare_effettivo",nome:"Invio pratica titolare effettivo",prezzo:130,selezionato:!1,categoria:"Altri Servizi",descrizione:"Invio pratica titolare effettivo - prezzo medio",tipo:"fisso"},{id:"altro_visure_online",nome:"Visura ordinaria",prezzo:20,selezionato:!1,categoria:"Altri Servizi",descrizione:"Visura ordinaria",tipo:"fisso"},{id:"altro_chiamate_consulenza",nome:"Chiamate per consulenza",prezzo:300,selezionato:!1,categoria:"Altri Servizi",descrizione:"Chiamate per consulenza - una tantum",tipo:"fisso"},{id:"altro_gestione_pec",nome:"Gestione PEC mensile",prezzo:16,selezionato:!1,categoria:"Altri Servizi",descrizione:"Gestione mensile PEC",tipo:"fisso"}],totale:0},ottimizzazione_management:{nome:"Ottimizzazione e Management",servizi:[{id:"consulenza_impresa_base",nome:"Consulenza di Impresa Base",prezzo:800,selezionato:!1,pacchetto:"base",descrizione:"Analisi iniziale e piano di miglioramento base"},{id:"consulenza_impresa_avanzata",nome:"Consulenza di Impresa Avanzata",prezzo:1500,selezionato:!1,pacchetto:"avanzato",descrizione:"Consulenza strategica con piano d'azione dettagliato"},{id:"consulenza_impresa_premium",nome:"Consulenza di Impresa Premium",prezzo:2500,selezionato:!1,pacchetto:"premium",descrizione:"Consulenza completa con supporto continuativo"},{id:"formazione_commerciale_base",nome:"Formazione Commerciale Base",prezzo:600,selezionato:!1,pacchetto:"base",descrizione:"Corso base di tecniche di vendita"},{id:"formazione_commerciale_avanzata",nome:"Formazione Commerciale Avanzata",prezzo:1200,selezionato:!1,pacchetto:"avanzato",descrizione:"Formazione avanzata con simulazioni pratiche"},{id:"formazione_commerciale_premium",nome:"Formazione Commerciale Premium",prezzo:2e3,selezionato:!1,pacchetto:"premium",descrizione:"Programma completo con coaching individuale"}],totale:0}};totaleGenerale=0;Math=Math;ngOnInit(){return V(this,null,function*(){let e=this.router.getCurrentNavigation()?.extras?.state||history?.state||{},o=e?.prospect,i=this.route.snapshot.queryParamMap,l=o?.id||i.get("prospectId"),d=Number(e?.goToStep||i.get("step"))||0;if(o?.id)this.selectedProspect=o;else if(l)try{let{data:f,error:y}=yield this.soggettiService.getSoggettoById(l);!y&&f&&(this.selectedProspect=f)}catch{}l&&(yield this.loadConfigurazioneEsistente(l),this.currentStep=d&&d>=1&&d<=this.totaleSteps?d:6);let u=this.route.snapshot.queryParamMap.get("focusConfig");u&&this.openConfigurazioneById(u)})}openConfigurazioneById(t){return V(this,null,function*(){if(t)try{let e=yield this.alchemizzatoreService.getConfigurazioneById(t),o=e.data;if(e.error||!o){console.warn("Configurazione non trovata:",e.error);return}this.configurazioneCorrenteId=o.id??null,this.currentConfigurazioneId=this.configurazioneCorrenteId;let i=o.dettagli??{};this.applyConfigurazioneDettagli(i),this.previousConfigurazione=this.deepClone(i),this.calcolaTotali(),this.updateTotaleGeneraleFromDetails(),this.updateTotaliSplitFromConfig();let l=o.prospect_id??o.prospectId;if(l&&(!this.selectedProspect||this.selectedProspect.id!==l))try{let d=yield this.soggettiService.getSoggettoById(l);!d.error&&d.data&&(this.selectedProspect=d.data,this.queryProspect=this.selectedProspect?.ragione_sociale??"")}catch(d){console.warn("Impossibile caricare prospect per configurazione:",d)}this.currentStep=6}catch(e){console.error("Errore in openConfigurazioneById:",e)}})}loadConfigurazioneEsistente(t){return V(this,null,function*(){let{data:e,error:o}=yield this.alchemizzatoreService.getConfigurazioniByProspect(t);if(o||!Array.isArray(e)||e.length===0)return;let i=[...e].sort((d,u)=>new Date(u.updated_at||u.created_at||u.data_configurazione||0).getTime()-new Date(d.updated_at||d.created_at||d.data_configurazione||0).getTime())[0];this.configurazioneCorrenteId=i.id??null,this.currentConfigurazioneId=this.configurazioneCorrenteId;let l=i?.dettagli||{};this.applyConfigurazioneDettagli(l),this.previousConfigurazione=this.deepClone(l),this.calcolaTotali()})}applyConfigurazioneDettagli(t){if(!t)return;let e=t&&t.meta?t.meta:null;e&&(this.scontoTarget=e.scontoTarget??this.scontoTarget);let o=["immagine_marketing","digitalizzazione_automatismi","contabilita_fiscalita","ottimizzazione_management"],i=0,l=!1;for(let d of o){let u=t[d];if(!u){this.moduli[d].servizi.forEach(p=>p.selezionato=!1),this.moduli[d].totale=0;continue}let f=Array.isArray(u.servizi_selezionati)?u.servizi_selezionati:Array.isArray(u.servizi)?u.servizi:[],y=new Set(f.map(p=>typeof p=="string"?p:p?.id).filter(Boolean));if(d==="contabilita_fiscalita"&&this.configurazioniContabilita){let p={contabilita_principale:"contabilita",fatturazione_principale:"fatturazione",iva_principale:"iva",redditi_principale:"redditi",bilancio_principale:"bilancio"};f.forEach(x=>{let M=typeof x=="string"?x:x?.id;if(!M)return;let R=p[M];if(!R)return;let $=Number(x?.prezzo??0),G=Number(x?.prezzo_mensile??0);$>0?this.configurazioniContabilita[R].prezzoCalcolato=$:G>0&&(this.configurazioniContabilita[R].prezzoCalcolato=Math.round(G*12*100)/100)});let C=this.configurazioniContabilita.altriServizi||{};f.forEach(x=>{let M=x?.id;M&&(M==="altro_modello_770"&&typeof x.quantita<"u"&&(C.modello770Count=Number(x.quantita)||C.modello770Count),M==="altro_imu_dichiarazione"&&typeof x.quantita<"u"&&(C.imuCount=Number(x.quantita)||C.imuCount),M==="altro_locazioni"&&typeof x.quantita<"u"&&(C.locazioniCount=Number(x.quantita)||C.locazioniCount),M==="altro_smart_card_rilascio"&&typeof x.quantita<"u"&&(C.smartCardRilascioCount=Number(x.quantita)||C.smartCardRilascioCount))}),this.configurazioniContabilita.altriServizi=C}if(this.moduli[d].servizi.forEach(p=>{p.selezionato=y.has(p.id);let C=f.find(x=>typeof x=="string"?x===p.id:x?.id===p.id);C&&typeof C.prezzo<"u"&&(p.prezzo=Number(C.prezzo)||0),C&&typeof C.prezzo_mensile<"u"&&(p.prezzo_mensile=Number(C.prezzo_mensile)||0),d==="contabilita_fiscalita"&&(p.aggiuntoManualmente=!!p.selezionato)}),typeof u.totale<"u"&&u.totale!==null){let p=Number(u.totale)||0;this.moduli[d].totale=Math.round(p*100)/100,i+=this.moduli[d].totale,l=!0;continue}if(f.length>0){let p=f.reduce((C,x)=>C+(Number(x?.prezzo)||0),0);if(p>0){this.moduli[d].totale=Math.round(p*100)/100,i+=this.moduli[d].totale;continue}}let S=this.moduli[d].servizi.filter(p=>p.selezionato).reduce((p,C)=>p+(Number(C.prezzo)||0),0);this.moduli[d].totale=Math.round(S*100)/100,this.moduli[d].totale>0&&(i+=this.moduli[d].totale)}if(e){let d=Number(e.totaleOriginale??e.totaleGenerale??i)||0;this.totaleGenerale=Math.round(d*100)/100,this.scontoPercentuale=Number(e.scontoPercentuale??0)||0,i===0&&this.calcolaTotali()}else this.calcolaTotali();this.previousConfigurazione=this.deepClone(t),this.updateTotaliSplitFromConfig()}avanti(){if(this.currentStep===1&&!this.selectedProspect){alert("Seleziona un prospect prima di procedere.");return}this.currentStep<this.totaleSteps&&this.currentStep++}indietro(){this.currentStep>1&&this.currentStep--}vaiAStep(t){if(t>=1&&t<=this.totaleSteps){if(!this.selectedProspect&&t>1){alert("Seleziona un prospect prima di navigare agli altri step.");return}this.currentStep=t}}onSearchProspect(t){return V(this,null,function*(){if(this.searchError=null,!t?.trim()){this.searchResults=[];return}this.searchLoading=!0;try{let[e,o]=yield Promise.all([this.soggettiService.searchSoggetti(t,"prospect"),this.soggettiService.searchSoggetti(t,"cliente")]),i=e.data??[],l=o.data??[],d=Array.from(new Map([...i,...l].map(u=>[u.id,u])).values());this.searchResults=d}catch(e){console.error("Errore durante la ricerca soggetti",e),this.searchError="Errore durante la ricerca"}finally{this.searchLoading=!1}})}get isModificaConfigurazione(){return!!(this.selectedProspect?.tipo==="cliente"&&this.configurazioneCorrenteId)}onSelectProspect(t){return V(this,null,function*(){if(this.searchResults=[],this.queryProspect=t.ragione_sociale??"",!t.tipo){let{data:e}=yield this.soggettiService.getSoggettoById(t.id);e&&(t=e)}if(this.selectedProspect=t,this.queryProspect=t.ragione_sociale??"",this.searchResults=[],t.tipo==="cliente"){let{data:e}=yield this.supabaseService.getUltimaConfigurazionePromethea(t.id);if(e){this.configurazioneCorrenteId=e.id??null,this.currentConfigurazioneId=this.configurazioneCorrenteId,this.applyConfigurazioneDettagli(e.dettagli),this.previousConfigurazione=this.deepClone(e.dettagli??{});return}}this.configurazioneCorrenteId=null,this.currentConfigurazioneId=null,this.previousConfigurazione=null,yield this.loadConfigurazioneEsistente(t.id)})}toggleServizio(t,e){let o=this.moduli[t],i=!e.selezionato;if(t==="digitalizzazione_automatismi"&&i&&["landing_page","sito_completo","sito_pro"].includes(e.id)&&o.servizi.forEach(l=>{["landing_page","sito_completo","sito_pro"].includes(l.id)&&l.id!==e.id&&(l.selezionato=!1)}),t==="ottimizzazione_management"&&i&&e.id.startsWith("consulenza_impresa_")&&o.servizi.forEach(l=>{l.id.startsWith("consulenza_impresa_")&&l.id!==e.id&&(l.selezionato=!1)}),t==="ottimizzazione_management"&&i&&e.id.startsWith("formazione_commerciale_")&&o.servizi.forEach(l=>{l.id.startsWith("formazione_commerciale_")&&l.id!==e.id&&(l.selezionato=!1)}),i&&t==="immagine_marketing"){if(e.id.startsWith("social_")&&o.servizi.forEach(l=>{l.id.startsWith("social_")&&l.id!==e.id&&(l.selezionato=!1)}),e.id==="creazione_brand"){let l=o.servizi.find(d=>d.id==="creazione_logo");l&&(l.selezionato=!1)}else if(e.id==="creazione_logo"){let l=o.servizi.find(d=>d.id==="creazione_brand");l&&(l.selezionato=!1)}}if(i&&e.pacchetto){let l=e.id.split("_"),d=l.length>=2?`${l[0]}_${l[1]}`:l[0];o.servizi.forEach(u=>{if(u.pacchetto===e.pacchetto&&u.id!==e.id){let f=u.id.split("_");(f.length>=2?`${f[0]}_${f[1]}`:f[0])===d&&(u.selezionato=!1)}})}e.selezionato=i,this.calcolaTotali()}calcolaDifferenze(t,e){let o={},i=["immagine_marketing","digitalizzazione_automatismi","contabilita_fiscalita","ottimizzazione_management"],l=d=>d?(Array.isArray(d.servizi_selezionati)?d.servizi_selezionati:Array.isArray(d.servizi)?d.servizi:[]).map(f=>typeof f=="string"?f:f?.id).filter(f=>!!f):[];return i.forEach(d=>{let u=new Set(l(t?.[d])),f=new Set(l(e?.[d])),y=[...u].filter(p=>!f.has(p)),S=[...f].filter(p=>!u.has(p));(y.length||S.length)&&(o[d]={aggiunti:y,rimossi:S})}),o}isServizioDisabled(t,e){return e.pacchetto?this.moduli[t].servizi.filter(l=>l.pacchetto===e.pacchetto&&l.id!==e.id&&l.selezionato).length>0:!1}buildDettagliConfigurazione(){let t={};return Object.keys(this.moduli).forEach(e=>{let o=this.moduli[e],i=o.servizi.filter(p=>p.selezionato).map(p=>q({id:p.id,nome:p.nome,prezzo:Number(p.prezzo??0),pacchetto:p.pacchetto??null,descrizione:p.descrizione??null},typeof p.prezzo_mensile<"u"&&p.prezzo_mensile!==null?{prezzo_mensile:Number(p.prezzo_mensile)}:{})),l=this.previousConfigurazione&&this.previousConfigurazione[e]?Array.isArray(this.previousConfigurazione[e].servizi_selezionati)?this.previousConfigurazione[e].servizi_selezionati:[]:[],d=new Map;i.forEach(p=>{d.set(p.id,q({},p))}),l.forEach(p=>{let C=(p?.id??"").toString();if(!C||!d.has(C))return;let x=d.get(C)||{},M=j(q({},x),{nome:x.nome??p.nome??null,prezzo:typeof x.prezzo<"u"?Number(x.prezzo):Number(p.prezzo??0),pacchetto:typeof x.pacchetto<"u"?x.pacchetto:typeof p.pacchetto<"u"?p.pacchetto:null,descrizione:x.descrizione??p.descrizione??null});typeof p.prezzo_mensile<"u"&&typeof M.prezzo_mensile>"u"&&(M.prezzo_mensile=Number(p.prezzo_mensile||0)),typeof p.quantita<"u"&&typeof M.quantita>"u"&&(M.quantita=Number(p.quantita||0)),typeof p.prezzo_unitario<"u"&&typeof M.prezzo_unitario>"u"&&(M.prezzo_unitario=Number(p.prezzo_unitario||0)),d.set(C,M)});let u=Array.from(d.values()),f=this.configurazioniContabilita||{},y={contabilita_principale:"contabilita",fatturazione_principale:"fatturazione",iva_principale:"iva",redditi_principale:"redditi",bilancio_principale:"bilancio"};u.forEach(p=>{if(p.id&&y[p.id]){let x=y[p.id],M=Number(f[x]?.prezzoCalcolato)||0;M>0?(p.prezzo=0,p.prezzo_mensile=this.monthlyPrice(M),p.note="prezzo_calcolato_configurazione"):p.prezzo=Number(p.prezzo||0)}if(["altro_modello_770","altro_imu_dichiarazione","altro_locazioni","altro_smart_card_rilascio"].includes(p.id)){let x=this.getAltriServiziCountFor(p.id)||1,M=Number(p.prezzo||0);p.quantita=x,p.prezzo_unitario=M,p.prezzo=Math.round(M*x*100)/100}if(p.id==="software_personalizzato"&&(p.prezzo=Number(p.prezzo||0),typeof p.prezzo_mensile>"u"&&this.previousConfigurazione&&this.previousConfigurazione[e])){let x=(this.previousConfigurazione[e].servizi_selezionati||[]).find(M=>M.id==="software_personalizzato");x&&typeof x.prezzo_mensile<"u"&&(p.prezzo_mensile=Number(x.prezzo_mensile)||0)}});let S=0;if(u.length>0){let p=u.reduce((C,x)=>{let M=Number(x.prezzo||0),R=Number(x.prezzo_mensile||0);return M>0&&!(R>0&&M===0)?C+M:C},0);S=Math.round(p*100)/100}else S=0;t[e]={nome:o.nome,totale:Math.round(S*100)/100,servizi_selezionati:u}}),t.meta={totaleOriginale:this.totaleGenerale,totaleGenerale:this.totaleGenerale,scontoPercentuale:this.scontoPercentuale||0,scontoTarget:this.scontoTarget||"entrambi",totaleScontato:this.scontoPercentuale>0?this.totaleScontato:this.totaleGenerale,aggiornato_il:new Date().toISOString()},t}salvaConfigurazione(){return V(this,null,function*(){if(!window.confirm("Confermi il salvataggio della configurazione?"))return;let e=this.buildDettagliConfigurazione();if(!this.selectedProspect){console.warn("Nessun prospect selezionato: salvataggio annullato.");return}let o=Number(this.scontoPercentuale>0?this.totaleScontato:this.totaleGenerale);if(this.selectedProspect.tipo==="cliente"&&this.configurazioneCorrenteId&&this.previousConfigurazione)try{let l=this.calcolaDifferenze(e,this.previousConfigurazione);Object.keys(l).length>0&&(yield this.supabaseService.inserisciLogConfigurazione({configurazione_id:this.configurazioneCorrenteId,soggetto_id:this.selectedProspect.id,differenze:l,totale:o}))}catch(l){console.error("Errore durante l'inserimento log configurazione:",l)}let i={prospect_id:this.selectedProspect.id,data_configurazione:new Date().toISOString(),totale:o,dettagli:e};try{let{data:l,error:d}=yield this.alchemizzatoreService.salvaConfigurazione(i,this.configurazioneCorrenteId??void 0);if(d)throw console.error("Errore nel salvataggio configurazione:",d),alert("Errore durante il salvataggio della configurazione. Controlla la console."),d;if(l&&(this.configurazioneCorrenteId=l.id??this.configurazioneCorrenteId??null,this.currentConfigurazioneId=this.configurazioneCorrenteId,l.dettagli)){let u=l.dettagli,f=u.meta??{};if(this.applyConfigurazioneDettagli(u),this.scontoPercentuale=Number(f.scontoPercentuale??this.scontoPercentuale??0),this.updateTotaleGeneraleFromDetails(),this.totaleGenerale===0&&(typeof f.totaleOriginale<"u"||typeof l.totale<"u")){let y=Number(f.totaleOriginale??l.totale??0)||0;this.totaleGenerale=Math.round(y*100)/100}this.previousConfigurazione=this.deepClone(u)}alert("Configurazione salvata con successo.")}catch(l){throw console.error("salvaConfigurazione - errore finale:",l),l}})}resetConfigurazione(){this.currentStep=1,this.queryProspect="",Object.keys(this.moduli).forEach(t=>{let e=this.moduli[t];e.servizi.forEach(o=>{o.selezionato=!1}),e.totale=0}),this.totaleGenerale=0}getServiziSelezionatiModulo(t){return this.moduli[t].servizi.filter(o=>o.selezionato)}getTotaleModulo(t){return this.moduli[t].totale}getServiziPacchetto(t){return this.moduli[t].servizi.filter(e=>!!e.pacchetto)}getServiziSingoli(t){return this.moduli[t].servizi.filter(e=>!e.pacchetto)}getTuttiServiziSelezionati(){let t=[];return Object.keys(this.moduli).forEach(e=>{let o=this.moduli[e].servizi.filter(i=>i.selezionato);t.push(...o)}),t}procediPerFirme(){return V(this,null,function*(){if(!this.selectedProspect){alert("Seleziona prima un soggetto.");return}if(this.totaleGenerale===0){alert("Configura almeno un servizio.");return}let t=this.isProspect;if(t&&!this.pendingFirmeProcess){this.pendingFirmeProcess=!0,this.currentStep=7;return}if(!confirm(`Sei sicuro di voler procedere con l'operazione?${t?`
Il prospect verr\xE0 convertito in cliente.`:""}

Vuoi anche scaricare i documenti PDF?`)){console.log("Operazione annullata dall'utente");return}let o=[{percorso:"assets/contratti/privacy-promethea.pdf",nomeBase:"Privacy"},{percorso:"assets/contratti/contratto-promethea.pdf",nomeBase:"Contratto Servizi Promethea"}];this.haServiziDigitaliSelezionati()&&o.push({percorso:"assets/contratti/allegato-digitale.pdf",nomeBase:"Allegato Digitale"}),this.haServiziContabiliSelezionati()&&o.push({percorso:"assets/contratti/allegato-contabile.pdf",nomeBase:"Allegato Contabile"});try{if(t&&!(yield this.convertiProspectInCliente())){alert("Errore nella conversione del prospect in cliente.");return}let i=confirm(`Vuoi scaricare i documenti PDF ora?

Clicca "OK" per scaricare i documenti, "Annulla" per procedere senza scaricare.`);i?this.scaricaDocumenti(o):console.log("Download documenti annullato dall'utente"),yield this.salvaConfigurazione(),t&&this.nominativi.length>0&&(yield this.creaProspectDaNominativi()),this.pendingFirmeProcess=!1,this.currentStep=t?6:this.currentStep;let l=t?"Operazione completata! Il prospect \xE8 ora cliente."+(i?" Documenti scaricati.":""):"Configurazione aggiornata con successo."+(i?" Documenti scaricati.":"");alert(l)}catch(i){console.error("Errore nel processo:",i),alert("Errore durante l'operazione: "+(i?.message||"sconosciuto"))}})}convertiProspectInCliente(){return V(this,null,function*(){if(!this.selectedProspect||!this.isProspect)return!0;try{console.log("Conversione prospect in cliente:",this.selectedProspect.id);let t=yield this.soggettiService.convertiProspectInCliente(this.selectedProspect.id);return t.error?(console.error("Errore nella conversione:",t.error),!1):t.data?(this.selectedProspect=t.data,console.log("Prospect convertito in cliente con successo:",this.selectedProspect),!0):!1}catch(t){return console.error("Errore durante la conversione:",t),!1}})}aggiungiNominativo(){if(!this.nuovoNominativo.nome.trim()){alert("Il nome \xE8 obbligatorio");return}if(!this.nuovoNominativo.telefono.trim()&&!this.nuovoNominativo.email.trim()){alert("Inserire almeno il telefono o l'email");return}this.nominativi.push(q({},this.nuovoNominativo)),this.nuovoNominativo={nome:"",telefono:"",email:""}}rimuoviNominativo(t){this.nominativi.splice(t,1)}creaProspectDaNominativi(){return V(this,null,function*(){if(!(!this.nominativi||this.nominativi.length===0))for(let t of this.nominativi)try{let e={tipo:"prospect",ragioneSociale:t.nome,telefono:t.telefono||void 0,email:t.email||void 0,note:`Creato da configurazione Promethea - ${this.selectedProspect?.ragione_sociale}`,prodotto:"Promethea",referenzaDaId:this.selectedProspect?.id},o=yield this.soggettiService.createSoggetto(e);(!o||!o.success)&&(yield this.soggettiService.supabase.from("soggetti").insert([{tipo:e.tipo,ragione_sociale:e.ragioneSociale,telefono:e.telefono??null,email:e.email??null,note:e.note??null,prodotto:e.prodotto,referenza_da_id:e.referenzaDaId??null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]))}catch(e){console.error("Errore creazione prospect da nominativo:",e)}})}haServiziDigitaliSelezionati(){let t=this.moduli.digitalizzazione_automatismi.servizi.some(o=>o.selezionato),e=this.moduli.immagine_marketing.servizi.some(o=>o.selezionato&&o.id.startsWith("social_"));return t||e}haServiziContabiliSelezionati(){return this.moduli.contabilita_fiscalita.servizi.some(t=>t.selezionato)}scaricaDocumenti(t){let e=this.sanitizeFileName(this.selectedProspect.ragione_sociale);t.forEach((o,i)=>{setTimeout(()=>{let l=`${o.nomeBase} - ${e}.pdf`;this.scaricaPDF(o.percorso,l)},i*300)})}scaricaPDF(t,e){let o=document.createElement("a");o.href=t,o.download=e,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}sanitizeFileName(t){return t.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g," ").trim()}get isCliente(){return this.selectedProspect?.tipo==="cliente"}get isProspect(){return this.selectedProspect?.tipo==="prospect"}getCategorieContabilita(){let t=this.moduli.contabilita_fiscalita.servizi;return[...new Set(t.map(o=>o.categoria))].filter(o=>o!==void 0).sort()}getServiziByCategoria(t){return this.moduli.contabilita_fiscalita.servizi.filter(e=>e.categoria===t)}configurazioniContabilita={costituzione:{attivo:!1,serviziSelezionati:[]},contabilita:{tipo:"",registrazioni:90,prezzoCalcolato:0},fatturazione:{tipo:"",numeroFatture:40,prezzoCalcolato:0},iva:{liquidazione:"",lipe:"trimestrale",volumeAffari:75e3,vistoConformita:!1,modelloIVATR:!1,intrastat:!1,prezzoCalcolato:0},redditi:{tipoSoggetto:"persone_fisiche",volumeAffari:75e3,numeroPersone:1,vistoConformita:!1,prezzoCalcolato:0},bilancio:{tipo:"attivita",importo:13e4,depositoBilancio:!1,nominaCariche:!1,prezzoCalcolato:0},altriServizi:{cuPercipienti:5,prezzoCU:180,modello770:!1,f24Numero:12,prezzoF24:300,modello770Count:1,imuCount:1,locazioniCount:1,smartCardRilascioCount:1}};calcolaPrezzoContabilita(){let t=this.configurazioniContabilita?.contabilita;if(!t||!t.tipo){t&&(t.prezzoCalcolato=0);let i=this.getService("contabilita_fiscalita","contabilita_principale");i&&(delete i.prezzo_mensile,i.prezzo=Number(i.prezzo||0)),this.calcolaTotali();return}let e=t.registrazioni;switch(t.tipo){case"semplificata":e<=90?t.prezzoCalcolato=1421:e<=180?t.prezzoCalcolato=1811:e<=360?t.prezzoCalcolato=2805:t.prezzoCalcolato=2805+(e-360)*2;break;case"ordinaria":e<=600?t.prezzoCalcolato=3276:(e<=2e3,t.prezzoCalcolato=3276+(e-600)*3.38);break;case"mista":e<=600?t.prezzoCalcolato=2644:(e<=2e3,t.prezzoCalcolato=2644+(e-600)*3.38);break}t.prezzoCalcolato=Math.round(t.prezzoCalcolato*100)/100;let o=this.getService("contabilita_fiscalita","contabilita_principale");o&&(o.prezzo_mensile=this.monthlyPrice(t.prezzoCalcolato),o.prezzo=0),this.calcolaTotali()}calcolaPrezzoFatturazione(){let t=this.configurazioniContabilita.fatturazione;t.tipo==="emissione_noi"?t.prezzoCalcolato=t.numeroFatture*25:t.prezzoCalcolato=t.numeroFatture*4;let e=this.getService("contabilita_fiscalita","fatturazione_principale");e&&(e.prezzo_mensile=this.monthlyPrice(t.prezzoCalcolato),e.prezzo=0),this.calcolaTotali()}calcolaPrezzoIVA(){let t=this.configurazioniContabilita.iva;if(!t||!t.liquidazione){t&&(t.prezzoCalcolato=0);let i=this.getService("contabilita_fiscalita","iva_principale");i&&(delete i.prezzo_mensile,i.prezzo=Number(i.prezzo||0)),this.calcolaTotali();return}let e=0;t.liquidazione==="mensile"?e+=576:e+=280,t.lipe==="mensile"?e+=1038:e+=346,t.volumeAffari<=75e3?e+=277:t.volumeAffari<=15e4?e+=346:t.volumeAffari<=3e5?e+=439:t.volumeAffari<=5e5?e+=550:t.volumeAffari<=75e4?e+=732:e+=1208,t.vistoConformita&&(e+=287.5),t.modelloIVATR&&(e+=72),t.intrastat&&(e+=70),t.prezzoCalcolato=e;let o=this.getService("contabilita_fiscalita","iva_principale");o&&(o.prezzo_mensile=this.monthlyPrice(t.prezzoCalcolato),o.prezzo=0),this.calcolaTotali()}calcolaPrezzoRedditi(){let t=this.configurazioniContabilita.redditi,e=0;t.tipoSoggetto==="persone_fisiche"?t.volumeAffari<=75e3?e=440:t.volumeAffari<=15e4?e=659:t.volumeAffari<=3e5?e=879:t.volumeAffari<=5e5?e=1096.5:t.volumeAffari<=75e4?e=1317:e=1645.5:t.volumeAffari<=3e5?e=916.5:t.volumeAffari<=5e5?e=1372.5:t.volumeAffari<=15e5?e=1830:t.volumeAffari<=3e6?e=2285:t.volumeAffari<=5e6?e=2744:t.volumeAffari<=75e5?e=3201.5:e=4e3,t.tipoSoggetto==="persone_fisiche"&&(e*=t.numeroPersone),t.vistoConformita&&(e+=287.5),t.prezzoCalcolato=e;let o=this.getService("contabilita_fiscalita","redditi_principale");o&&(o.prezzo_mensile=this.monthlyPrice(t.prezzoCalcolato),o.prezzo=0),this.calcolaTotali()}calcolaPrezzoBilancio(){let t=this.configurazioniContabilita.bilancio,e=0;t.tipo==="attivita"?t.importo<=13e4?e=453.5:t.importo<=5e5?e=765.5:t.importo<=13e5?e=1184:t.importo<=26e5?e=1739.5:t.importo<=575e3?e=2435:e=3e3:t.importo<=3e5?e=590:t.importo<=5e5?e=765.5:t.importo<=15e5?e=905:t.importo<=3e6?e=1218:t.importo<=5e6?e=1739.5:t.importo<=75e5?e=2435:e=3e3,t.depositoBilancio&&(e+=350),t.nominaCariche&&(e+=420),t.prezzoCalcolato=e;let o=this.getService("contabilita_fiscalita","bilancio_principale");o&&(o.prezzo_mensile=this.monthlyPrice(t.prezzoCalcolato),o.prezzo=0),this.calcolaTotali()}calcolaPrezzoCU(){let t=this.configurazioniContabilita.altriServizi;t.cuPercipienti<=5?t.prezzoCU=180:t.cuPercipienti<=10?t.prezzoCU=330:t.cuPercipienti<=15?t.prezzoCU=480:t.cuPercipienti<=20?t.prezzoCU=630:t.prezzoCU=630+(t.cuPercipienti-20)*30,t.f24Numero<=12?t.prezzoF24=300:t.f24Numero<=24?t.prezzoF24=600:t.f24Numero<=36?t.prezzoF24=900:t.prezzoF24=900+(t.f24Numero-36)*25,this.calcolaTotali()}monthlyPrice(t){return Math.round(Number(t||0)/12*100)/100}isPriceAlreadyMonthly(t){return!t||!t.id?!1:!!(t.id.startsWith("social_")||t.id==="altro_gestione_pec")}isAnnualToConvert(t){return!t||!t.id?!1:this.ANNUAL_TO_MONTHLY_IDS.has(t.id)}calcolaTotali(){this.totaleMensile=0,this.totaleUnaTantum=0,Object.keys(this.moduli).forEach(t=>{let e=this.moduli[t];if(!(!e||!e.servizi)){if(e.totale=0,e.servizi.forEach(o=>{if(!o.selezionato)return;let i=typeof this.getAltriServiziCountFor=="function"?this.getAltriServiziCountFor(o.id):typeof this.getAltriServiziCount=="function"?this.getAltriServiziCount(o.id):1,l=Number(o.prezzo??0),d=Number(o.prezzo_mensile??o.prezzoMensile??0),u=Number(o.quantita??0),f=Number(o.prezzo_unitario??0),y=()=>f>0?f:u>0&&l>0?l/u:l;if(d>0){if(this.totaleMensile+=d*i,l>0){let C=y()*i;this.totaleUnaTantum+=C,e.totale+=C}return}if(this.isPriceAlreadyMonthly&&this.isPriceAlreadyMonthly(o)){this.totaleMensile+=l*i;return}if(this.isAnnualToConvert&&this.isAnnualToConvert(o)){let C=y();this.totaleMensile+=this.monthlyPrice(C)*i;return}let p=y()*i;this.totaleUnaTantum+=p,e.totale+=p}),t==="contabilita_fiscalita"&&this.configurazioniContabilita){let o=this.configurazioniContabilita,i=(l,d)=>{let u=Number(l||0);if(u<=0)return;let f=this.getService("contabilita_fiscalita",d);if(f&&f.selezionato||d&&!this.isAddedManually(d))return;let y=this.monthlyPrice(u);this.totaleMensile+=y};i(o?.contabilita?.prezzoCalcolato,"contabilita_principale"),i(o?.fatturazione?.prezzoCalcolato,"fatturazione_principale"),i(o?.iva?.prezzoCalcolato,"iva_principale"),i(o?.redditi?.prezzoCalcolato,"redditi_principale"),i(o?.bilancio?.prezzoCalcolato,"bilancio_principale")}e.totale=Math.round(e.totale*100)/100}}),this.totaleMensile=Math.round(this.totaleMensile*100)/100,this.totaleUnaTantum=Math.round(this.totaleUnaTantum*100)/100,this.totaleGenerale=Math.round((this.totaleUnaTantum+this.totaleMensile*12)*100)/100}toggleServizioContabilita(t){t.tipo==="gruppo"?(t.selezionato=!t.selezionato,t.id==="costituzione_principale"&&(this.configurazioniContabilita.costituzione.attivo=t.selezionato)):t.selezionato=!t.selezionato,this.calcolaTotali()}isServizioContabilitaAbilitato(t){return t.dipendeDa?this.moduli.contabilita_fiscalita.servizi.find(o=>o.id===t.dipendeDa)?.selezionato||!1:!0}deepClone(t){return t==null?t:JSON.parse(JSON.stringify(t))}visualizzaPreventivo(){this.configurazioneCorrenteId?this.router.navigate(["/preventivo",this.configurazioneCorrenteId]):this.salvaConfigurazione().then(()=>{this.configurazioneCorrenteId&&this.router.navigate(["/preventivo",this.configurazioneCorrenteId])}).catch(t=>{console.error("Errore nel salvataggio della configurazione:",t),alert("Errore nel salvataggio. Impossibile generare il preventivo.")})}getResponseDelay(){return this.baseAssistDelay+Math.floor(Math.random()*this.assistJitter)}num(t){let e=Number(t??0);return Math.round(e*100)/100}apriChatSconto(){this.mostraChatSconto=!0,this.messaggiAssistenza=[],this.richiedendoSconto=!1,this.addMessage(`Ciao! Sono l'assistenza Promethea. Dimmi quale sconto desideri richiedere per ${this.selectedProspect?.ragione_sociale||"il cliente"}.`,"assistenza"),setTimeout(()=>{document.getElementById("chat-input")?.focus()},120)}chiudiChatSconto(){this.mostraChatSconto=!1,this.messaggioChat=""}inviaMessaggio(){let t=this.messaggioChat?.trim();t&&(this.addMessage(t,"utente"),this.messaggioChat="",setTimeout(()=>this.handleAssistantReply(t),this.getResponseDelay()))}addMessage(t,e){this.messaggiAssistenza.push({testo:t,autore:e,timestamp:new Date}),setTimeout(()=>this.scrollChatToBottom(),30)}scrollChatToBottom(){let t=document.getElementById("chat-messages")||document.getElementById("modal-body")||document.querySelector(".modal .modal-body");if(t)try{t.scrollTo({top:t.scrollHeight,behavior:"smooth"})}catch{t.scrollTop=t.scrollHeight}}handleAssistantReply(t){return V(this,null,function*(){let e=(t||"").trim();if(/^sconto10072024$/i.test(e)){this.overrideNextLimitPercent=25,this.overrideConsumed=!1,this.addMessage("Deroga segreta attivata: prossimo sconto consentito fino al 25%.","assistenza");return}if(this.pendingCifraRequest&&this.pendingCifraRequest.stage==="awaiting_confirm"){let o=/^\s*(s|si|yes|y)\b/i.test(e),i=/^\s*(n|no|not)\b/i.test(e);if(o){yield this.confirmPendingCifra(!0);return}if(i){yield this.confirmPendingCifra(!1);return}this.addMessage(`Rispondi "si" per confermare l'applicazione dello sconto o "no" per annullare.`,"assistenza");return}this.processDiscountRequest(e)})}confirmPendingCifra(t){return V(this,null,function*(){if(!this.pendingCifraRequest){this.addMessage("Nessuna richiesta in sospeso.","assistenza");return}let e=this.pendingCifraRequest;if(this.pendingCifraRequest=null,!t){this.addMessage("Operazione annullata. Lo sconto non \xE8 stato applicato.","assistenza");return}let o=typeof e.candidatePercent=="number"?e.candidatePercent:typeof e.value=="number"?e.value:null,i=e.target??"entrambi";if(o===null){this.addMessage("Non \xE8 stato possibile determinare la percentuale da applicare.","assistenza");return}this.scontoPercentuale=Math.max(0,Math.min(100,Number(o))),this.scontoTarget=i,e&&e.note==="deroga"&&(this.overrideConsumed=!0,this.overrideNextLimitPercent=0);try{yield this.confermaApplicaSconto()}catch{this.addMessage("Errore durante il salvataggio dello sconto. Riprova.","assistenza")}})}processDiscountRequest(t){if(!this.pendingCifraRequest||!this.pendingCifraRequest.stage){this.pendingCifraRequest={stage:"awaiting_kind"},this.addMessage('Vuoi uno sconto in percentuale o una cifra? (rispondi "percentuale" o "cifra")',"assistenza");return}if(this.pendingCifraRequest.stage==="awaiting_kind"){let e=this.assistenzaService.decideKindFromText(t)??(/\bcifra\b/.test(t)?"cifra":/\bpercent/.test(t)?"percent":null);if(!e){this.addMessage('Non ho capito. Scrivi "percentuale" o "cifra".',"assistenza");return}if(this.pendingCifraRequest.kind=e,e==="cifra"){this.pendingCifraRequest.stage="awaiting_value",this.addMessage('Scrivi la cifra finale desiderata per la quota una-tantum (es. "5000").',"assistenza");return}else{this.pendingCifraRequest.stage="awaiting_value",this.addMessage('Scrivi la percentuale desiderata (es. "10%" oppure "10").',"assistenza");return}}if(this.pendingCifraRequest.stage==="awaiting_value"){let e=this.assistenzaService.parseItalianNumber(t);if(isNaN(e)){this.addMessage('Non ho capito il numero. Inserisci un valore numerico (es. "10%" o "5000").',"assistenza");return}if(this.pendingCifraRequest.kind==="cifra"){let o={una:this.totaleUnaTantum,mensile:this.totaleMensile},i=this.assistenzaService.computeForCifra(o,e);if(!i.allowed){if(i.reason==="limit"){this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:i.candidatePercent,producedTotal:i.producedTotal,value:e,target:"una_tantum"},this.addMessage(`\u274C Richiederebbe uno sconto del ${Number((i.candidatePercent||0).toFixed(2))}%, oltre il limite automatico del ${this.assistenzaService.DEFAULT_LIMIT}%. Vuoi comunque inviare richiesta di approvazione? (si/no)`,"assistenza");return}this.addMessage(i.reason||"Impossibile applicare la cifra richiesta.","assistenza"),this.pendingCifraRequest=null;return}this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:i.candidatePercent,producedTotal:i.producedTotal,value:e,target:"una_tantum"},this.addMessage(`\u2705 Posso applicare la cifra richiesta: quota una\u2011tantum risultante ${this.formatCurrency(e)}. Totale complessivo risultante: ${this.formatCurrency(i.producedTotal||0)}. Vuoi procedere? (si/no)`,"assistenza");return}else{let o=Math.max(0,Math.min(100,e));this.pendingCifraRequest.value=o,this.pendingCifraRequest.stage="awaiting_target",this.addMessage('Dove vuoi applicare la percentuale? Rispondi "mensile", "una tantum" o "entrambi".',"assistenza");return}}if(this.pendingCifraRequest.stage==="awaiting_target"){let e=this.assistenzaService.decideTargetFromText(t);if(!e){this.addMessage('Non ho capito. Rispondi "mensile", "una tantum" o "entrambi".',"assistenza");return}this.pendingCifraRequest.target=e;let o=Number(this.pendingCifraRequest.value??0),i={una:this.totaleUnaTantum,mensile:this.totaleMensile},l=this.assistenzaService.computeForPercent(i,o,e);if(!l.allowed&&typeof l.candidatePercent=="number"&&this.overrideNextLimitPercent>0&&!this.overrideConsumed){let u=Number(l.candidatePercent||o);if(u<=this.overrideNextLimitPercent){this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:u,producedTotal:l.producedTotal,target:e,value:o,note:"deroga"},this.addMessage(`\u26A0\uFE0F Deroga attiva: posso applicare fino a ${u}% per questa richiesta. Vuoi procedere? (si/no)`,"assistenza");return}}if(!l.allowed){if(typeof l.candidatePercent=="number"&&l.candidatePercent>this.assistenzaService.DEFAULT_LIMIT){this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:l.candidatePercent,producedTotal:l.producedTotal,target:e,value:o},this.addMessage(`\u26A0\uFE0F Lo sconto richiesto (${Number(l.candidatePercent.toFixed(2))}%) supera il limite automatico del ${this.assistenzaService.DEFAULT_LIMIT}%. Vuoi inviare richiesta di approvazione? (si/no)`,"assistenza");return}this.addMessage(l.reason||"Impossibile applicare la percentuale richiesta.","assistenza"),this.pendingCifraRequest=null;return}let d=Number((l.candidatePercent??o).toFixed(4));if(e==="mensile"){let u=Math.round(this.totaleMensile*(1-d/100)*100)/100,f=l.producedTotal??Math.round((this.totaleUnaTantum+u*12)*100)/100;this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:l.candidatePercent??d,producedTotal:f,target:e,value:o},this.addMessage(`\u2705 Posso applicare ${d}% sulla quota mensile. Totale mensile risultante: ${this.formatCurrency(u)}/mese \u2014 Totale complessivo risultante: ${this.formatCurrency(f)}. Vuoi procedere? (si/no)`,"assistenza")}else if(e==="una_tantum"){let u=Math.round(this.totaleUnaTantum*(1-d/100)*100)/100,f=l.producedTotal??Math.round((u+this.totaleMensile*12)*100)/100;this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:l.candidatePercent??d,producedTotal:f,target:e,value:o},this.addMessage(`\u2705 Posso applicare ${d}% sulla quota una tantum. Quota una tantum risultante: ${this.formatCurrency(u)} \u2014 Totale complessivo risultante: ${this.formatCurrency(f)}. Vuoi procedere? (si/no)`,"assistenza")}else{let u=l.producedTotal??Math.round((this.totaleUnaTantum+this.totaleMensile*12)*(1-d/100)*100)/100;this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:l.candidatePercent??d,producedTotal:u,target:e,value:o},this.addMessage(`\u2705 Posso applicare ${d}% su entrambi. Totale complessivo risultante: ${this.formatCurrency(u)}. Vuoi procedere? (si/no)`,"assistenza")}return}this.addMessage('Scrivi "sconto" per iniziare la procedura guidata.',"assistenza")}get totaleScontato(){let t=Number(this.scontoPercentuale||0)/100;if(this.scontoTarget==="mensile"){let e=this.totaleMensile*(1-t);return Math.round((this.totaleUnaTantum+e*12)*100)/100}else if(this.scontoTarget==="una_tantum"){let e=this.totaleUnaTantum*(1-t);return Math.round((e+this.totaleMensile*12)*100)/100}else{let e=this.totaleUnaTantum+this.totaleMensile*12;return Math.round(e*(1-t)*100)/100}}formatCurrency(t){return`\u20AC ${Number(t||0).toLocaleString("it-IT",{minimumFractionDigits:2,maximumFractionDigits:2})}`}applySconto(t,e){this.scontoPercentuale=Math.max(0,Math.min(100,Math.round(Number(t)*100)/100)),e&&(this.scontoTarget=e)}confermaApplicaSconto(){return V(this,null,function*(){try{yield this.salvaConfigurazione(),this.addMessage(`Sconto del ${this.scontoPercentuale}% applicato e salvato. Totale finale: ${this.formatCurrency(this.totaleScontato)}`,"assistenza"),this.mostraChatSconto=!1}catch(t){console.error("Errore salvataggio sconto:",t),this.addMessage("Errore nel salvataggio dello sconto. Riprova.","assistenza")}})}rimuoviSconto(){this.scontoPercentuale=0}formatPrezzoServizio(t){let e=Number(t?.prezzo??0),o=Number(t?.prezzo_mensile??t?.prezzoMensile??0);if(o>0)return`${this.formatCurrency(o)} /mese`;if(t?.id==="software_personalizzato"&&e===0)return"Valutazione Interna";let i={contabilita_principale:"contabilita",fatturazione_principale:"fatturazione",iva_principale:"iva",redditi_principale:"redditi",bilancio_principale:"bilancio"};if(t?.id&&i[t.id]){let l=i[t.id],d=Number(this.configurazioniContabilita&&this.configurazioniContabilita[l]?.prezzoCalcolato||0);if(d>0){let u=this.monthlyPrice(d);return`${this.formatCurrency(u)} /mese`}return"\u2014"}return this.isPriceAlreadyMonthly(t)?`${this.formatCurrency(e)} /mese`:`\u20AC ${e.toLocaleString("it-IT",{minimumFractionDigits:2,maximumFractionDigits:2})}`}formatTotaleModulo(t){let e=this.moduli?.[t];if(!e)return"\u2014";let o=e.servizi.filter(C=>C.selezionato).reduce((C,x)=>C+(Number(x.prezzo)||0),0),i=this.previousConfigurazione??null,l=0,d=[];if(i&&i[t]){let C=i[t];d=Array.isArray(C.servizi_selezionati)?C.servizi_selezionati:Array.isArray(C.servizi)?C.servizi:[],typeof C.totale<"u"&&C.totale!==null?l=Number(C.totale)||0:d.length>0&&(l=d.reduce((x,M)=>x+(Number(M?.prezzo)||0),0))}let u=Number(e.totale)||0,f=new Map;e.servizi.filter(C=>C.selezionato).forEach(C=>{C&&C.id&&f.set(C.id,C)}),d.forEach(C=>{let x=typeof C=="string"?C:C?.id;x&&(f.has(x)||f.set(x,{id:x,nome:C?.nome??null,prezzo:Number(C?.prezzo??0),prezzo_mensile:typeof C?.prezzo_mensile<"u"?Number(C.prezzo_mensile):void 0}))});let y=Array.from(f.values()).reduce((C,x)=>C+Number(x.prezzo||0),0),S=Math.max(o,l,u,y);return Array.from(f.values()).some(C=>C?.id==="software_personalizzato"&&(Number(C?.prezzo)||0)===0)?"Valutazione Interna":`\u20AC ${S.toLocaleString("it-IT",{minimumFractionDigits:2,maximumFractionDigits:2})}`}getNumericTotaleModulo(t){let e=this.moduli?.[t];if(!e)return 0;let o=e.servizi.filter(S=>S.selezionato).reduce((S,p)=>S+(Number(p.prezzo)||0),0),i=this.previousConfigurazione??null,l=0,d=[];if(i&&i[t]){let S=i[t];d=Array.isArray(S.servizi_selezionati)?S.servizi_selezionati:Array.isArray(S.servizi)?S.servizi:[],typeof S.totale<"u"&&S.totale!==null?l=Number(S.totale)||0:d.length>0&&(l=d.reduce((p,C)=>p+(Number(C?.prezzo)||0),0))}let u=Number(e.totale)||0,f=new Map;e.servizi.filter(S=>S.selezionato).forEach(S=>{S&&S.id&&f.set(S.id,S)}),d.forEach(S=>{let p=typeof S=="string"?S:S?.id;p&&(f.has(p)||f.set(p,{id:p,prezzo:Number(S?.prezzo??0)}))});let y=Array.from(f.values()).reduce((S,p)=>S+Number(p.prezzo||0),0);return Math.round(Math.max(o,l,u,y)*100)/100}updateTotaleGeneraleFromDetails(){let e=["immagine_marketing","digitalizzazione_automatismi","contabilita_fiscalita","ottimizzazione_management"].reduce((o,i)=>o+this.getNumericTotaleModulo(i),0);this.totaleGenerale=Math.round(e*100)/100}getServizioContabilitaByName(t){let e=this.moduli?.contabilita_fiscalita?.servizi??[];if(!e||e.length===0)return null;let o=e.find(u=>u.id===t);if(o)return o;let l={contabilita:"contabilita_principale",contabilita_principale:"contabilita_principale",fatturazione:"fatturazione_principale",fatturazione_principale:"fatturazione_principale",iva:"iva_principale",iva_principale:"iva_principale",costituzione:"costituzione_principale",costituzione_principale:"costituzione_principale"}[t.toLowerCase()];if(l){let u=e.find(f=>f.id===l);if(u)return u}return e.find(u=>(u.nome??"").toLowerCase().includes(t.toLowerCase()))??e.find(u=>u.tipo==="configurabile")??e[0]??null}toggleAltriServizi(){this.showAltriServizi=!this.showAltriServizi}toggleContabilitaChildren(){this.showContabilitaChildren=!this.showContabilitaChildren}getServiceById(t){return(this.moduli?.contabilita_fiscalita?.servizi??[]).find(o=>o.id===t)??null}toggleServiceById(t){let e=this.getServiceById(t);if(!e){console.warn(`Servizio non trovato: ${t}`);return}this.toggleServizioContabilita(e)}isContabilitaPrincipaleSelezionato(){return this.isServiceSelected("contabilita_fiscalita","contabilita_principale")}toggleContabilitaPrincipale(){this.toggleService("contabilita_fiscalita","contabilita_principale")}getService(t,e){let o=this.moduli[t];if(!o||!Array.isArray(o.servizi))return null;let i=o.servizi.find(u=>u.id===e);if(i)return i;let d={contabilita_principale:"contabilita_principale",contabilita:"contabilita_principale",fatturazione_principale:"fatturazione_principale",fatturazione:"fatturazione_principale",iva_principale:"iva_principale",iva:"iva_principale",costituzione_principale:"costituzione_principale",costituzione:"costituzione_principale"}[e];return d&&(i=o.servizi.find(u=>u.id===d),i)||(i=o.servizi.find(u=>(u.nome||"").toLowerCase().includes((e||"").toLowerCase())),i)?i:o.servizi.find(u=>u.tipo==="configurabile")??o.servizi[0]??null}toggleService(t,e,o=!1){let i=this.getService(t,e);if(!i){console.warn(`[Alchemizzatore] servizio non trovato in ${t}: ${e}`);return}if(t==="contabilita_fiscalita"){this.toggleServizioContabilita(i),o?i.aggiuntoManualmente=!!i.selezionato:i.selezionato||(i.aggiuntoManualmente=!1),this.calcolaTotali();return}this.toggleServizio(t,i),this.calcolaTotali()}isServiceSelected(t,e){let o=this.getService(t,e);return!!(o&&o.selezionato)}getDescrizioneContabilita(t){return{semplificata:"(fino a 90: 1.421\u20AC, 90-180: 1.811\u20AC, 180-360: 2.805\u20AC, oltre 360: 2.805\u20AC + 2\u20AC/registrazione)",ordinaria:"(fino a 600: 3.276\u20AC, oltre 600: 3.276\u20AC + 3.38\u20AC/registrazione)",mista:"(fino a 600: 2.644\u20AC, oltre 600: 2.644\u20AC + 3.38\u20AC/registrazione)"}[(t??"").toLowerCase()]??""}getAltriServiziCount(t){let e=this.configurazioniContabilita?.altriServizi??{};switch(t){case"altro_modello_770":return Number(e.modello770Count)||1;case"altro_imu_dichiarazione":return Number(e.imuCount)||1;case"altro_locazioni":return Number(e.locazioniCount)||1;case"altro_smart_card_rilascio":return Number(e.smartCardRilascioCount)||1;default:return 1}}detectDiscountTargetFromText(t){let e=(t||"").toLowerCase();return/\b(mensil|mensile|mese|mesi)\b/.test(e)?"mensile":/\buna\b.*\btantum\b|\buna_tantum\b|\buna tantum\b|\btantum\b/.test(e)?"una_tantum":(/\bentrambi\b|\btutto\b|\btotale\b|\bambedue\b/.test(e),"entrambi")}isAddedManually(t){let e=this.getService("contabilita_fiscalita",t);return!!(e&&e.aggiuntoManualmente)}getTotaliModuloSplit(t){let e={mensile:0,una:0},o=this.moduli[t];if(!o||!Array.isArray(o.servizi))return e;if(o.servizi.forEach(i=>{if(!i.selezionato)return;let l=typeof this.getAltriServiziCountFor=="function"?this.getAltriServiziCountFor(i.id):typeof this.getAltriServiziCount=="function"?this.getAltriServiziCount(i.id):1,d=Number(i.prezzo??0),u=Number(i.prezzo_mensile??i.prezzoMensile??0),f=Number(i.quantita??0),y=Number(i.prezzo_unitario??0),S=()=>y>0?y:f>0&&d>0?d/f:d;if(u>0){e.mensile+=u*l,d>0&&(e.una+=S()*l);return}if(this.isPriceAlreadyMonthly&&this.isPriceAlreadyMonthly(i)){d>0&&(e.mensile+=d*l);return}if(this.isAnnualToConvert&&this.isAnnualToConvert(i)){d>0&&(e.mensile+=this.monthlyPrice(S())*l);return}d>0&&(e.una+=S()*l)}),t==="contabilita_fiscalita"&&this.configurazioniContabilita){let i=this.configurazioniContabilita,l=(d,u)=>{let f=Number(d||0);if(f<=0)return;let y=this.getService("contabilita_fiscalita",u);y&&y.selezionato||this.isAddedManually(u)&&(e.mensile+=this.monthlyPrice(f))};l(i?.contabilita?.prezzoCalcolato,"contabilita_principale"),l(i?.fatturazione?.prezzoCalcolato,"fatturazione_principale"),l(i?.iva?.prezzoCalcolato,"iva_principale"),l(i?.redditi?.prezzoCalcolato,"redditi_principale"),l(i?.bilancio?.prezzoCalcolato,"bilancio_principale")}return e.mensile=Math.round(e.mensile*100)/100,e.una=Math.round(e.una*100)/100,e}getAltriServiziCountFor(t){let e=this.configurazioniContabilita&&this.configurazioniContabilita.altriServizi||{};switch(t){case"altro_modello_770":return Number(e.modello770Count||1);case"altro_imu_dichiarazione":return Number(e.imuCount||1);case"altro_locazioni":return Number(e.locazioniCount||1);case"altro_smart_card_rilascio":return Number(e.smartCardRilascioCount||1);default:return 1}}isAltriServiziCounted(t){return["altro_modello_770","altro_imu_dichiarazione","altro_locazioni","altro_smart_card_rilascio"].includes(t)}updateTotaliSplitFromConfig(t=!1){this.calcolaTotali();let e=this.previousConfigurazione&&this.previousConfigurazione.meta?this.previousConfigurazione.meta:this.configurazione?.dettagli?.meta??{},o=Number(e?.scontoPercentuale??0)||0,i=e?.scontoTarget??"entrambi";i==="una"&&(i="una_tantum");let l=i,d=t?o:typeof this.scontoPercentuale=="number"?this.scontoPercentuale:o,u=t?l:this.scontoTarget??l;this.totaleUnaScontata=d>0&&(u==="una_tantum"||u==="entrambi")?Math.round(this.totaleUnaTantum*(1-d/100)*100)/100:this.totaleUnaTantum,this.totaleMensileScontato=d>0&&(u==="mensile"||u==="entrambi")?Math.round(this.totaleMensile*(1-d/100)*100)/100:this.totaleMensile,t&&(this.scontoPercentuale=d,this.scontoTarget=u)}onScontoChange(){this.calcolaTotali(),this.updateTotaliSplitFromConfig(!1)}getPacchettiConsulenza(){return this.getServiziPacchetto("ottimizzazione_management").filter(t=>typeof t.id=="string"&&t.id.startsWith("consulenza_impresa_"))}getPacchettiFormazione(){return this.getServiziPacchetto("ottimizzazione_management").filter(t=>typeof t.id=="string"&&t.id.startsWith("formazione_commerciale_"))}static \u0275fac=function(e){return new(e||s)(D(Ce),D(xe),D(le),D(re),D(se),D(B))};static \u0275cmp=Q({type:s,selectors:[["app-alchemizzatore"]],decls:23,vars:19,consts:[["otherTitle",""],["normalTitle",""],["normalTitleSingoli",""],["mensileNoSconto",""],["unaNoSconto",""],["normalService",""],["normalPrice",""],[1,"alchemizzatore-container"],[1,"form-section"],[1,"progress-steps"],[1,"step",3,"click"],[1,"trattativa-section"],["class","form-section form-section",4,"ngIf"],["class","form-section form-section summary-step",4,"ngIf"],[1,"form-section","form-section"],[1,"section-header"],[1,"material-icons","header-icon"],[1,"section-titles"],[1,"section-title"],[1,"card"],[1,"form-label"],[1,"search-input-container"],["type","text","placeholder","Cerca per ragione sociale, P.IVA o referente...",3,"ngModelChange","input","ngModel"],["class","status-message loading",4,"ngIf"],["class","status-message error",4,"ngIf"],["class","search-results","role","listbox",4,"ngIf"],["class","status-message info",4,"ngIf"],["class","status-message warning",4,"ngIf"],[1,"actions-container"],[1,"promethea-button",3,"click","disabled"],[1,"status-message","loading"],[1,"loading-spinner"],[1,"status-message","error"],["role","listbox",1,"search-results"],["class","search-result-item","role","option",3,"click",4,"ngFor","ngForOf"],["role","option",1,"search-result-item",3,"click"],[1,"result-text"],[1,"result-title"],[1,"result-subtitle"],[1,"result-icon"],[1,"status-message","info"],[1,"material-icons"],[1,"status-message","warning"],[1,"sottotitolo"],[1,"section-title","sotto"],[1,"grid-responsive"],["class","card ",3,"selezionato","disabled","click",4,"ngFor","ngForOf"],["class","card ",3,"selezionato","click",4,"ngFor","ngForOf"],[1,"card","totale-modulo"],[1,"card-number","totale"],[1,"promethea-button","secondary",3,"click"],[1,"promethea-button",3,"click"],[1,"card",3,"click"],["aria-hidden","false",1,"card-title"],[4,"ngIf","ngIfElse"],["class","sottotitolo",4,"ngIf"],[1,"card-number"],[1,"servizio-descrizione"],["class","chip",4,"ngIf"],[1,"checkmark"],[1,"chip"],[1,"totale-row"],[1,"totale-label"],[1,"totale-amount"],[1,"categorie-contabilita"],[1,"categoria-contabilita"],[1,"configurazione-gruppo"],[1,"card","card-clickable",3,"click"],[1,"card-title"],[1,"card-number","card-number"],[4,"ngIf"],[1,"card-actions-absolute"],[1,"icon-btn",3,"click","title"],[1,"grid-form"],[1,"form-field"],[1,"table-inline-select",3,"ngModelChange","change","ngModel"],["value",""],["value","semplificata"],["value","ordinaria"],["value","mista"],["type","number","min","1","max","10000",1,"table-inline-input",3,"ngModelChange","change","ngModel"],["value","emissione_noi"],["value","piattaforma_passcom"],["type","number","min","1","max","1000",1,"table-inline-input",3,"ngModelChange","change","ngModel"],["class","card-number",4,"ngIf"],["value","trimestrale"],["value","mensile"],["value","75000"],["value","150000"],["value","300000"],["value","500000"],["value","750000"],["value","1000000"],[1,"form-field","checkbox"],["type","checkbox",3,"ngModelChange","change","ngModel"],[1,"section-title",2,"display","flex","align-items","center","justify-content","space-between"],["type","button","title","Mostra/Nascondi",1,"icon-btn",3,"click"],["class","grid-form alternativa",4,"ngIf"],[1,"grid-form","alternativa2"],["class","card",3,"selezionato","disabled","click",4,"ngFor","ngForOf"],[1,"grid-form","alternativa"],["class","small text-muted","style","margin-top:0.5rem;",3,"click",4,"ngIf"],[1,"small","text-muted",2,"margin-top","0.5rem",3,"click"],[1,"count-control"],[1,"count-controls"],["type","button",1,"action-btn","delete",3,"click"],["type","number","min","1",1,"count-input",3,"ngModelChange","click","ngModel"],["type","button",1,"action-btn","add",3,"click"],[1,"form-section","form-section","summary-step"],["class","card",4,"ngIf"],[1,"card","text-center"],["role","status","aria-live","polite",1,"totale-generale-wrapper"],[2,"display","flex","flex-direction","column","gap","0.4rem","align-items","center","margin-top","0.3rem"],[1,"totale-normale"],[1,"actions-container",2,"margin","var(--gutter-lg)","justify-content","center"],[1,"promethea-button","ghost",3,"click"],["title","Assistenza",1,"promethea-button","ghost",3,"click"],[1,"promethea-button","outline",3,"click"],["class","promethea-button success",3,"click",4,"ngIf"],[1,"promethea-button","success",3,"click","disabled"],["class","form-section",4,"ngIf"],["class","modal-backdrop",4,"ngIf"],["class","servizio-riepilogo",4,"ngFor","ngForOf"],[1,"totale-label2"],[1,"servizio-riepilogo"],[1,"servizio-left"],[1,"badge","badge-info"],[1,"card-servizio"],[1,"card-number","servizio"],["style","width: 100% ;",4,"ngFor","ngForOf"],[2,"width","100%"],[1,"badge","badge-secondary"],["class","servizio-riepilogo",4,"ngIf"],[1,"badge","badge-secondary",2,"visibility","hidden"],[1,"badge","badge-tertiary"],[2,"margin","0 0.5rem"],[2,"margin-left","0.6rem","color","var(--muted-color)"],[1,"badge","badge-primary"],[1,"totale-originale",2,"margin","0 0.6rem"],[1,"totale-normale",2,"color","var(--primary)"],[2,"margin-left","0.6rem"],[2,"margin-top","0.45rem"],[1,"text-muted"],[1,"promethea-button","success",3,"click"],[1,"sconto-display"],["class","sconto-value",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"actions"],["class","promethea-button ghost",3,"click",4,"ngIf"],[1,"totale-riepilogo"],[1,"totale-value"],["class","form-field",4,"ngIf"],[1,"sconto-value"],[1,"totale-value","text-muted"],[1,"modal-backdrop"],[1,"modal"],[1,"modal-header"],[1,"modal-title"],[1,"icon-btn","close",3,"click"],[1,"modal-body",2,"display","flex","flex-direction","column","height","calc(100% - 120px)"],["id","modal-body",1,"modal-body",2,"flex","1","overflow-y","auto","margin-bottom","var(--gutter-md)"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"form-field",2,"display","flex","gap","var(--gutter-sm)"],["id","form-field","type","text","placeholder","Scrivi il tuo messaggio...",1,"table-inline-input",2,"flex","1",3,"ngModelChange","keyup.enter","ngModel"],[3,"ngClass"],[1,"badge"],["class","material-icons",4,"ngIf"],[1,"message-content"],[1,"card",2,"margin-top","var(--gutter-lg)"],["type","text","placeholder","Nome e cognome",1,"form-input",3,"ngModelChange","ngModel"],["type","tel","placeholder","Telefono",1,"form-input",3,"ngModelChange","ngModel"],["type","email","placeholder","Email",1,"form-input",3,"ngModelChange","ngModel"],["class","card","style","margin-top: var(--gutter-md);",4,"ngIf"],[1,"card",2,"margin-top","var(--gutter-md)"],[1,"text-muted",2,"margin-left","0.6rem"],[1,"actions-container",2,"justify-content","flex-end"],[1,"action-btn","delete",3,"click"]],template:function(e,o){e&1&&(n(0,"div",7)(1,"div",8)(2,"div",9)(3,"button",10),v("click",function(){return o.vaiAStep(1)}),r(4,"1"),a(),n(5,"button",10),v("click",function(){return o.vaiAStep(2)}),r(6,"2"),a(),n(7,"button",10),v("click",function(){return o.vaiAStep(3)}),r(8,"3"),a(),n(9,"button",10),v("click",function(){return o.vaiAStep(4)}),r(10,"4"),a(),n(11,"button",10),v("click",function(){return o.vaiAStep(5)}),r(12,"5"),a(),n(13,"button",10),v("click",function(){return o.vaiAStep(6)}),r(14,"6"),a()()(),n(15,"div",11),b(16,ke,20,9,"section",12)(17,Qe,28,4,"section",12)(18,Ze,34,4,"section",12)(19,mt,163,30,"section",12)(20,gt,38,5,"section",12)(21,Qt,50,15,"section",13)(22,Xt,30,5,"section",12),a()()),e&2&&(c(3),P("active",o.currentStep===1),c(2),P("active",o.currentStep===2),c(2),P("active",o.currentStep===3),c(2),P("active",o.currentStep===4),c(2),P("active",o.currentStep===5),c(2),P("active",o.currentStep===6),c(3),g("ngIf",o.currentStep===1),c(),g("ngIf",o.currentStep===2),c(),g("ngIf",o.currentStep===3),c(),g("ngIf",o.currentStep===4),c(),g("ngIf",o.currentStep===5),c(),g("ngIf",o.currentStep===6),c(),g("ngIf",o.currentStep===7))},dependencies:[ae,K,ee,te,he,ze,ge,me,pe,ce,_e,de,ve,fe,ue,oe,ne,ie],styles:[".alchemizzatore-container[_ngcontent-%COMP%]{padding:var(--gutter-lg)}.trattativa-section[_ngcontent-%COMP%]{margin:var(--gutter-lg) 0}.section-title.sotto[_ngcontent-%COMP%]{margin-top:var(--gutter-lg);margin-bottom:var(--gutter-md)}.servizio-descrizione[_ngcontent-%COMP%]{color:color-mix(in srgb,var(--text-color) 70%,transparent);font-size:var(--fs-sm);margin:0 0 var(--gutter-sm) 0;line-height:1.4}.checkmark[_ngcontent-%COMP%]{position:absolute;top:var(--gutter-md);right:var(--gutter-md);width:24px;height:24px;border:2px solid var(--smoke-color-1);border-radius:50%;display:grid;place-items:center;color:transparent;transition:all .2s ease;background:transparent}.checkmark.attivo[_ngcontent-%COMP%]{background:var(--primary);border-color:var(--primary);color:#fff}.totale-modulo[_ngcontent-%COMP%]{font-weight:700;text-align:right;color:var(--primary);border-top:1px solid var(--smoke-color-1);padding:var(--gutter-lg);margin-top:var(--gutter-lg);font-size:var(--fs-md)}.promethea-button.success[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669)}.actions-container[_ngcontent-%COMP%]{margin-top:var(--gutter-lg)}.card-number[_ngcontent-%COMP%]{font-size:var(--fs-md)}.card-number.servizio[_ngcontent-%COMP%]{color:var(--text-color);font-size:var(--fs-sm);flex-wrap:wrap}.card-number.totale[_ngcontent-%COMP%]{margin-top:var(--gutter-md);text-align:right;display:flex;flex-direction:column;gap:var(--gutter-sm)}.categoria-contabilita[_ngcontent-%COMP%]{padding:var(--gutter-lg) 0}.grid-responsive[_ngcontent-%COMP%]{margin-top:var(--gutter-sm)}.servizi-elenco[_ngcontent-%COMP%], .card-clickable[_ngcontent-%COMP%]{margin-bottom:var(--gutter-sm);display:flex;flex-direction:column;gap:.5rem}.servizio-riepilogo[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;gap:var(--gutter-sm);width:100%;padding:var(--gutter-sm) 0;min-width:0;border-bottom:1px dashed color-mix(in srgb,var(--text-color) 80%,transparent)}.card-title[_ngcontent-%COMP%]{padding-right:var(--gutter-md)}.servizio-left[_ngcontent-%COMP%]{flex:1 1 0;min-width:0;display:flex;gap:.6rem;align-items:center}.servizio-nome[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;min-width:0}.servizio-price[_ngcontent-%COMP%]{flex:0 0 auto;margin-left:auto;color:var(--primary);font-weight:700;white-space:nowrap;min-width:0}.card-number.totale[_ngcontent-%COMP%], .totale-modulo[_ngcontent-%COMP%], .totale-amount[_ngcontent-%COMP%]{box-sizing:border-box;max-width:100%;word-break:break-word;overflow-wrap:anywhere;white-space:normal;min-width:0}.count-controls[_ngcontent-%COMP%], .count-input[_ngcontent-%COMP%], input[type=number][_ngcontent-%COMP%]{min-width:0;max-width:100%;box-sizing:border-box}.alchemizzatore-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{min-width:0;box-sizing:border-box}@media (min-width: 1100px){.grid-responsive[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}.user-message[_ngcontent-%COMP%]{flex-direction:row-reverse}.assistance-message[_ngcontent-%COMP%]{flex-direction:row}.user-message[_ngcontent-%COMP%]   .message-avatar[_ngcontent-%COMP%]{background:var(--primary);color:var(--background)}.assistance-message[_ngcontent-%COMP%]   .message-avatar[_ngcontent-%COMP%]{background:var(--smoke-color-1);color:var(--text-color)}.message-content[_ngcontent-%COMP%]{max-width:70%;display:flex;flex-direction:column;gap:var(--gutter-sm)}.user-message[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{align-items:flex-end}.assistance-message[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{align-items:flex-start}.message-content[_ngcontent-%COMP%]   .chip[_ngcontent-%COMP%]{border-radius:var(--fs-md);padding:var(--gutter-md)}.user-message[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{background:var(--primary);color:#fff;border-bottom-right-radius:4px}.assistance-message[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{background:var(--smoke-color-1);color:var(--text-color);border-bottom-left-radius:4px}.sconto-display[_ngcontent-%COMP%]{padding:var(--gutter-sm);border-radius:8px;background:color-mix(in srgb,var(--success) 10%,transparent);border:1px solid color-mix(in srgb,var(--success) 30%,transparent)}.sconto-value[_ngcontent-%COMP%]{color:var(--success);font-weight:600}.totale-value.scontato[_ngcontent-%COMP%]{font-size:var(--fs-md)}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--smoke-color-1);border-radius:3px}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.totale-generale-wrapper[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:center;gap:.6rem;flex-wrap:wrap}.totale-generale-wrapper[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-right:.25rem;color:var(--text-muted);font-weight:600}.totale-scontato[_ngcontent-%COMP%]{color:var(--primary);font-weight:800;font-size:1.25rem}.totale-originale[_ngcontent-%COMP%]{text-decoration:line-through;color:var(--text-muted);opacity:.85;margin-left:.4rem}.totale-normale[_ngcontent-%COMP%]{font-weight:700;font-size:var(--fs-md)}@media (max-width:640px){.totale-generale-wrapper[_ngcontent-%COMP%]{flex-direction:column;gap:.2rem;text-align:center}.totale-originale[_ngcontent-%COMP%]{margin-left:0}}.card.text-center[_ngcontent-%COMP%]{margin-top:var(--gutter-lg)}.card-actions-absolute[_ngcontent-%COMP%]{position:absolute;top:var(--gutter-sm);right:var(--gutter-sm);display:flex;gap:.5rem;z-index:10;pointer-events:auto}.card[_ngcontent-%COMP%]   .grid-form[_ngcontent-%COMP%]{gap:var(--gutter-sm);margin-top:var(--gutter-sm)}.alchemizzatore-container[_ngcontent-%COMP%]   .summary-step[_ngcontent-%COMP%]   .grid-responsive[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr);gap:var(--gutter-md);align-items:stretch}@media (max-width: 640px){.alchemizzatore-container[_ngcontent-%COMP%]   .summary-step[_ngcontent-%COMP%]   .grid-responsive[_ngcontent-%COMP%]{grid-template-columns:1fr}}.alchemizzatore-container[_ngcontent-%COMP%]   .summary-step[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.alchemizzatore-container[_ngcontent-%COMP%]   .summary-step[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-number.totale[_ngcontent-%COMP%]{margin-top:auto;align-self:stretch;border-top:1px solid var(--smoke-color-1);padding-top:var(--gutter-md)}.alchemizzatore-container[_ngcontent-%COMP%]   .grid-responsive[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:var(--gutter-md);align-items:start;justify-items:stretch}.alchemizzatore-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{min-width:0;box-sizing:border-box;width:100%;display:flex;flex-direction:column;overflow:hidden}.alchemizzatore-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{overflow:visible}.alchemizzatore-container[_ngcontent-%COMP%]   .search-input-container[_ngcontent-%COMP%]{position:relative}.alchemizzatore-container[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]{position:absolute;z-index:9999;top:calc(100% + var(--gutter-sm))}.alchemizzatore-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .grid-form[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:var(--gutter-sm);align-items:center;min-width:0}.alchemizzatore-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .grid-form[_ngcontent-%COMP%]   *[_ngcontent-%COMP%], .alchemizzatore-container[_ngcontent-%COMP%]   .grid-responsive[_ngcontent-%COMP%] > .card[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{min-width:0;box-sizing:border-box}.alchemizzatore-container[_ngcontent-%COMP%]   .card-number.servizio[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:0}.count-controls[_ngcontent-%COMP%], .count-input[_ngcontent-%COMP%]{min-width:0;max-width:100%;box-sizing:border-box}.totale-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:var(--gutter-sm);padding:var(--gutter-sm) 0;width:100%;box-sizing:border-box}.totale-label2[_ngcontent-%COMP%]{flex:1 1 0;min-width:0;font-weight:700;color:var(--text-color);font-size:var(--fs-sm);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.totale-amount[_ngcontent-%COMP%]{flex:0 0 auto;margin-left:1rem;font-weight:800;color:var(--primary);font-size:var(--fs-md);white-space:nowrap;min-width:0}.totale-row[_ngcontent-%COMP%] > .totale-amount[_ngcontent-%COMP%]{text-align:right;width:auto}.totale-row[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{min-width:0;box-sizing:border-box}"]})};export{be as Alchemizzatore};
