import{a as X}from"./chunk-B2TAGDN2.js";import{a as Y}from"./chunk-WXMXMCHO.js";import{a as Z}from"./chunk-JHFRRPN6.js";import{a as Q}from"./chunk-5STMSNPF.js";import{a as j,c as H,e as U,j as W,k as q,n as G}from"./chunk-RG37TT4Q.js";import{a as J}from"./chunk-PBTFW77J.js";import"./chunk-QQWCK2ZL.js";import{e as K}from"./chunk-7BQHTMQB.js";import{j as z,k as $,p as B}from"./chunk-VUYFDMJB.js";import{A as y,Bb as N,Ga as k,I as T,La as _,S as x,Wa as D,X as m,Xa as d,Y as f,Ya as t,Za as i,_a as R,cb as P,db as V,eb as b,f as F,fa as w,hb as g,ib as u,jb as E,lb as S,nb as r,ob as v,pb as I,rb as M,sb as O,ta as L,tb as A,ua as a,x as C}from"./chunk-CVFHM34U.js";import"./chunk-X5YLR3NI.js";import{i as h}from"./chunk-ODN5LVDJ.js";function te(l,e){if(l&1&&(t(0,"option",39),r(1),i()),l&2){let o=e.$implicit;d("value",o),a(),v(o)}}function ie(l,e){if(l&1&&(t(0,"option",39),r(1),i()),l&2){let o=e.$implicit;d("value",o),a(),v(o)}}function ne(l,e){if(l&1&&(P(0),t(1,"span"),r(2),i(),V()),l&2){let o=e.ngIf;a(2),v(o.tipo)}}function re(l,e){l&1&&r(0,"\u2014")}function oe(l,e){if(l&1){let o=b();t(0,"div",54)(1,"div",55)(2,"button",56),g("click",function(s){m(o);let p=u().$implicit,c=u();return s.stopPropagation(),c.onAddDocument(p),f(c.activeDropdownId=null)}),t(3,"span",19),r(4,"description"),i(),t(5,"span"),r(6,"Documento"),i()(),t(7,"button",57),g("click",function(s){m(o);let p=u().$implicit,c=u();return s.stopPropagation(),c.onDelete(p),f(c.activeDropdownId=null)}),t(8,"span",19),r(9,"delete"),i(),t(10,"span"),r(11,"Elimina"),i()()()()}if(l&2){let o=u().$implicit,n=u();a(7),d("disabled",n.deletingIds.has(o.id))}}function ae(l,e){if(l&1){let o=b();t(0,"tr")(1,"td",40)(2,"div",41)(3,"strong"),r(4),i()()(),t(5,"td",42)(6,"div",41),r(7),i()(),t(8,"td",43)(9,"div",41),r(10),i()(),t(11,"td",44)(12,"div",41),r(13),i()(),t(14,"td",45)(15,"div",41),r(16),i()(),t(17,"td",46)(18,"div",41),_(19,ne,3,1,"ng-container",47)(20,re,1,0,"ng-template",null,3,N),i()(),t(22,"td",48)(23,"div",49)(24,"button",50),g("click",function(s){let p=m(o).$implicit,c=u();return s.stopPropagation(),f(c.onEdit(p))}),t(25,"span",19),r(26,"edit"),i()(),t(27,"div",51)(28,"button",52),g("click",function(s){let p=m(o).$implicit,c=u();return s.stopPropagation(),f(c.toggleActionsDropdown(p.id))}),t(29,"span",19),r(30,"more_vert"),i()(),_(31,oe,12,1,"div",53),i()()()()}if(l&2){let o=e.$implicit,n=E(21),s=u();D("data-row-id",o.id),a(4),v(o.ragione_sociale),a(3),v(o.referente||"\u2014"),a(3),v(o.telefono||"\u2014"),a(3),v(o.email||"\u2014"),a(3),v(o.metodo_pagamento||"\u2014"),a(3),d("ngIf",o.ultimoEsito)("ngIfElse",n),a(8),S("open",s.activeDropdownId===o.id),a(4),d("ngIf",s.activeDropdownId===o.id)}}function le(l,e){if(l&1&&(t(0,"tr")(1,"td",58),r(2),i()()),l&2){let o=u();a(2),I(" ",o.searchTerm?"Nessun fornitore trovato":"Nessun fornitore"," ")}}function se(l,e){l&1&&(t(0,"span",19),r(1,"expand_more"),i())}function ce(l,e){l&1&&(t(0,"span",19),r(1,"hourglass_bottom"),i())}function de(l,e){if(l&1){let o=b();t(0,"div",59)(1,"button",60),g("click",function(){m(o);let s=u();return f(s.loadMore())}),_(2,se,2,0,"span",61)(3,ce,2,0,"span",61),r(4),i()()}if(l&2){let o=u();a(),d("disabled",o.loading()),a(),d("ngIf",!o.loading()),a(),d("ngIf",o.loading()),a(),I(" ",o.loading()?"Caricamento\u2026":"Carica altri"," ")}}function pe(l,e){if(l&1&&(t(0,"div",62),r(1),i()),l&2){let o=u();a(),I(" ",o.error()," ")}}var ee=class l{listaService=x(Y);soggettiService=x(J);kpiService=x(X);router=x(K);searchSubject=new F;destroy$=new F;rows=this.listaService.rows;filteredRows=this.listaService.filteredRows;loading=this.listaService.loading;error=this.listaService.error;hasMore=this.listaService.hasMore;currentFiltri=this.listaService.currentFiltri;province=w([]);kpi=w({totale:0,conIban:0,conReferente:0});deletingIds=new Set;activeDropdownId=null;esitiTipi=Z;searchTerm="";filtroConIban=!1;filtroConReferente=!1;isLoading=w(!0);constructor(){this.searchSubject.pipe(T(this.destroy$),C(300),y()).subscribe(e=>{this.onSearchExecuted(e)})}ngOnInit(){return h(this,null,function*(){console.log("\u{1F680} Lista Fornitori - START"),this.isLoading.set(!0);try{this.listaService.inizializza({tipo:"fornitore",abilitaConfigurazioni:!1,abilitaTrattative:!1}),console.log("\u2699\uFE0F Servizio fornitori inizializzato"),yield Promise.all([this.listaService.caricaAltri(!0),this.loadProvince(),this.refreshKpi()]);let e=this.rows();console.log("\u{1F4C4} Fornitori caricati:",{totalRows:e.length,firstRow:e[0]?.ragione_sociale||"N/A"}),console.log("\u2705 Init fornitori completato")}catch(e){console.error("\u274C Errore caricamento fornitori:",e)}finally{setTimeout(()=>{this.isLoading.set(!1)},300)}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadMore(e=!1){return h(this,null,function*(){yield this.listaService.caricaAltri(e)})}onSearchExecuted(e){return h(this,null,function*(){yield this.listaService.cerca(e)})}onSearchChange(e){this.searchTerm=e,this.searchSubject.next(e)}onChangeFiltroEsito(e){this.listaService.applicaFiltri({esito:e,conIban:this.filtroConIban,conReferente:this.filtroConReferente})}onChangeFiltroProvincia(e){this.listaService.applicaFiltri({provincia:e})}onChangeSortDir(e){this.listaService.applicaFiltri({sortDir:e})}onFiltroTotale(){this.filtroConIban=!1,this.filtroConReferente=!1,this.listaService.applicaFiltri({esito:"tutti",provincia:"tutte",conIban:!1,conReferente:!1})}onFiltroConIban(){this.filtroConIban=!0,this.filtroConReferente=!1,this.listaService.applicaFiltri({esito:"tutti",conIban:!0,conReferente:!1})}onFiltroConReferente(){this.filtroConIban=!1,this.filtroConReferente=!0,this.listaService.applicaFiltri({esito:"tutti",conIban:!1,conReferente:!0})}onDelete(e){return h(this,null,function*(){if(!(!e?.id||!confirm(`Eliminare il fornitore "${e.ragione_sociale}"?`))){this.deletingIds.add(e.id);try{(yield this.listaService.eliminaSoggetto(e.id))&&(yield this.refreshKpi())}catch(n){console.error("Errore durante l'eliminazione:",n)}finally{this.deletingIds.delete(e.id)}}})}onEdit(e){e?.id&&this.router.navigate(["/soggetti/modifica",e.id])}onAddDocument(e){console.log("Aggiungi documento per:",e.ragione_sociale)}trackById=(e,o)=>o.id;toggleActionsDropdown(e){let o=this.activeDropdownId===e;this.activeDropdownId=o?null:e;let n=document.querySelector(".table-container");n&&(this.activeDropdownId?n.classList.add("dropdown-open"):n.classList.remove("dropdown-open"))}closeDropdown(e){e.target.closest(".actions-dropdown")||(this.activeDropdownId=null)}loadProvince(){return h(this,null,function*(){let{data:e}=yield this.soggettiService.getProvinceByTipo("fornitore");e&&this.province.set(e)})}refreshKpi(){return h(this,null,function*(){try{let e=yield this.kpiService.getAnagraficaKPI("fornitore");this.kpi.set({totale:e.totale,conIban:e.conIban,conReferente:e.conReferente})}catch(e){console.error("Errore nel caricamento KPI:",e)}})}static \u0275fac=function(o){return new(o||l)};static \u0275cmp=k({type:l,selectors:[["app-lista-fornitori"]],hostBindings:function(o,n){o&1&&g("click",function(p){return n.closeDropdown(p)},L)},decls:91,vars:23,consts:[["filtroSel",""],["ordinaSel",""],["provSel",""],["noEsito",""],["title","Caricamento Fornitori","subtitle","Stiamo caricando i tuoi fornitori...",3,"isLoading"],[1,"form-section"],[1,"section-header"],[1,"material-icons","header-icon"],[1,"section-titles"],[1,"section-title"],[1,"sottotitolo"],[1,"prospect-cards"],[1,"card",3,"click"],[1,"card-title"],[1,"card-number"],[1,"table-section"],[1,"table-tools"],[1,"tool"],["for","search",1,"label"],[1,"material-icons"],["id","search","type","text","placeholder","Ragione sociale, telefono, email\u2026",1,"table-inline-input",3,"ngModelChange","ngModel"],["for","filtroEsito",1,"label"],["id","filtroEsito",1,"table-inline-select",3,"change","value"],["value","tutti"],["value","senza-esito"],[3,"value",4,"ngFor","ngForOf"],["for","ordinaPer",1,"label"],["id","ordinaPer",1,"table-inline-select",3,"change","value"],["value","desc"],["value","asc"],["for","filtroProvincia",1,"label"],["id","filtroProvincia",1,"table-inline-select",3,"change","value"],["value","tutte"],[1,"table-container"],[1,"crm-table"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],["class","load-more-container",4,"ngIf"],["style","text-align:center; color:#ef4444; margin-top:1rem;",4,"ngIf"],[3,"value"],["data-label","Ragione Sociale"],[1,"cell-content"],["data-label","Referente"],["data-label","Telefono"],["data-label","Email"],["data-label","Metodo Pagamento"],["data-label","Ultimo Esito"],[4,"ngIf","ngIfElse"],["data-label","Azioni"],[1,"actions-container"],["title","Modifica",1,"action-btn","edit",3,"click"],[1,"actions-dropdown"],["title","Altre azioni",1,"action-btn",3,"click"],["class","modal","style",`position: absolute; top: calc(100% + 8px); right: 0; 
                            width: 180px; transform: none; left: auto; 
                            max-height: none; overflow: visible;`,4,"ngIf"],[1,"modal",2,"position","absolute","top","calc(100% + 8px)","right","0","width","180px","transform","none","left","auto","max-height","none","overflow","visible"],[1,"modal-body",2,"padding","0"],[1,"dropdown-item",3,"click"],[1,"dropdown-item",2,"color","#ef4444",3,"click","disabled"],["colspan","7",2,"text-align","center","padding","1.5rem"],[1,"load-more-container"],[1,"promethea-button",3,"click","disabled"],["class","material-icons",4,"ngIf"],[2,"text-align","center","color","#ef4444","margin-top","1rem"]],template:function(o,n){if(o&1){let s=b();R(0,"app-page-loader",4),t(1,"div")(2,"div",5)(3,"div",6)(4,"i",7),r(5,"local_shipping"),i(),t(6,"div",8)(7,"h2",9),r(8,"Fornitori"),i(),t(9,"p",10),r(10,"Panoramica fornitori e KPI"),i()()(),t(11,"div",11)(12,"div",12),g("click",function(){return m(s),f(n.onFiltroTotale())}),t(13,"h3",13),r(14,"Totale Fornitori"),i(),t(15,"div",14),r(16),i()(),t(17,"div",12),g("click",function(){return m(s),f(n.onFiltroConIban())}),t(18,"h3",13),r(19,"Con IBAN"),i(),t(20,"div",14),r(21),i()(),t(22,"div",12),g("click",function(){return m(s),f(n.onFiltroConReferente())}),t(23,"h3",13),r(24,"Con Referente"),i(),t(25,"div",14),r(26),i()()()(),t(27,"section",15)(28,"div",16)(29,"div",17)(30,"label",18)(31,"span",19),r(32,"search"),i(),r(33," Cerca "),i(),t(34,"input",20),A("ngModelChange",function(c){return m(s),O(n.searchTerm,c)||(n.searchTerm=c),f(c)}),g("ngModelChange",function(c){return m(s),f(n.onSearchChange(c))}),i()(),t(35,"div",17)(36,"label",21)(37,"span",19),r(38,"filter_list"),i(),r(39," Ultimo esito "),i(),t(40,"select",22,0),g("change",function(){m(s);let c=E(41);return f(n.onChangeFiltroEsito(c.value))}),t(42,"option",23),r(43,"Tutti"),i(),t(44,"option",24),r(45,"Senza esito"),i(),_(46,te,2,2,"option",25),i()(),t(47,"div",17)(48,"label",26)(49,"span",19),r(50,"sort"),i(),r(51," Ordina per: "),i(),t(52,"select",27,1),g("change",function(){m(s);let c=E(53);return f(n.onChangeSortDir(c.value))}),t(54,"option",28),r(55,"Pi\xF9 recente"),i(),t(56,"option",29),r(57,"Meno recente"),i()()(),t(58,"div",17)(59,"label",30)(60,"span",19),r(61,"place"),i(),r(62," Provincia "),i(),t(63,"select",31,2),g("change",function(){m(s);let c=E(64);return f(n.onChangeFiltroProvincia(c.value))}),t(65,"option",32),r(66,"Tutte"),i(),_(67,ie,2,2,"option",25),i()()(),t(68,"div",33)(69,"table",34)(70,"thead")(71,"tr")(72,"th"),r(73,"Ragione Sociale"),i(),t(74,"th"),r(75,"Referente"),i(),t(76,"th"),r(77,"Telefono"),i(),t(78,"th"),r(79,"Email"),i(),t(80,"th"),r(81,"Metodo Pagamento"),i(),t(82,"th"),r(83,"Ultimo Esito"),i(),t(84,"th"),r(85,"Azioni"),i()()(),t(86,"tbody"),_(87,ae,32,11,"tr",35)(88,le,3,1,"tr",36),i()()(),_(89,de,5,4,"div",37)(90,pe,2,1,"div",38),i()()}o&2&&(d("isLoading",n.isLoading()),a(),S("hidden",n.isLoading()),a(11),S("card-active",n.currentFiltri().esito==="tutti"&&n.currentFiltri().provincia==="tutte"&&!n.currentFiltri().conIban&&!n.currentFiltri().conReferente),a(4),v(n.kpi().totale),a(),S("card-active",n.currentFiltri().conIban),a(4),v(n.kpi().conIban),a(),S("card-active",n.currentFiltri().conReferente),a(4),v(n.kpi().conReferente),a(8),M("ngModel",n.searchTerm),a(6),d("value",n.currentFiltri().esito),a(6),d("ngForOf",n.esitiTipi),a(6),d("value",n.currentFiltri().sortDir),a(11),d("value",n.currentFiltri().provincia),a(4),d("ngForOf",n.province()),a(20),d("ngForOf",n.filteredRows())("ngForTrackBy",n.trackById),a(),d("ngIf",!n.loading()&&!n.error()&&n.filteredRows().length===0),a(),d("ngIf",!n.error()&&n.hasMore()),a(),d("ngIf",n.error()))},dependencies:[B,z,$,G,W,q,j,H,U,Q],encapsulation:2})};export{ee as ListFornitori};
