import{a as kt}from"./chunk-5KFYA3P4.js";import{a as vt}from"./chunk-YR4IPSWQ.js";import{a as ut}from"./chunk-6ICYEFRY.js";import{a as pt}from"./chunk-OCVT6WLO.js";import{b as ot,d as rt,f as st,n as lt,o as dt,p as ct,s as mt,u as gt}from"./chunk-3JKT2CHV.js";import{b as _t}from"./chunk-3Y2ZP6KK.js";import{a as nt}from"./chunk-3347WCPA.js";import{c as at}from"./chunk-2ONBSOVF.js";import{c as Q,d as J,e as X,h as Y,k as Z,m as tt,o as et,q as it}from"./chunk-233B5766.js";import{Ba as A,Bb as O,Cb as G,Db as M,Ea as H,Eb as F,Fa as l,Fb as r,Gb as w,Hb as k,Ib as $,Jb as T,Kb as S,La as V,Lb as b,Pb as W,Ra as R,Ub as I,Vb as D,Wa as f,X as g,Xb as K,Y as _,fb as q,gb as m,hb as o,ib as n,jb as N,nb as B,ob as L,qb as x,tb as u,ub as c}from"./chunk-R6HFAJZF.js";import"./chunk-X5YLR3NI.js";import{a as U,c as j,i as h}from"./chunk-ODN5LVDJ.js";var ht=()=>[1,2,3,4,5],Tt=()=>["da_fare","in_lavorazione","completato"],St=()=>[];function bt(d,i){if(d&1&&(o(0,"div",18)(1,"p",19),r(2),n()()),d&2){let t=c();l(2),k("ID: ",t.macroTask.id)}}function yt(d,i){if(d&1){let t=x();o(0,"button",27),u("click",function(){g(t);let e=c(2);return _(e.eliminaMacroTask())}),o(1,"i",22),r(2,"delete_forever"),n(),o(3,"span",23),r(4,"Elimina"),n()()}if(d&2){let t=c(2);m("disabled",t.loading)}}function wt(d,i){if(d&1){let t=x();o(0,"button",28),u("click",function(){g(t);let e=c(2);return _(e.salvaComeTemplate())}),o(1,"i",22),r(2,"content_copy"),n(),o(3,"span",23),r(4,"Template"),n()()}if(d&2){let t=c(2);m("disabled",t.loading)}}function Ct(d,i){if(d&1){let t=x();o(0,"div",20)(1,"button",21),u("click",function(){g(t);let e=c();return _(e.router.navigate(["/task"]))}),o(2,"i",22),r(3,"arrow_back"),n(),o(4,"span",23),r(5,"Lista"),n()(),f(6,yt,5,1,"button",24)(7,wt,5,1,"button",25),o(8,"button",26),u("click",function(){g(t);let e=c();return _(e.salvaMacroTask())}),o(9,"i",22),r(10,"save"),n(),o(11,"span",23),r(12),n()()()}if(d&2){let t=c();l(6),m("ngIf",t.currentUser==null?null:t.currentUser.is_admin),l(),m("ngIf",t.currentUser==null?null:t.currentUser.is_admin),l(),m("disabled",t.loading),l(),M("spin",t.loading),l(3),w(t.loading?"Salva...":"Salva")}}function Mt(d,i){if(d&1&&(o(0,"div",29)(1,"i",22),r(2,"warning"),n(),r(3),n()),d&2){let t=c();l(3),k(" ",t.error," ")}}function Et(d,i){if(d&1&&(o(0,"option",43),r(1),n()),d&2){let t=i.$implicit;m("value",t.id),l(),k(" ",t.ragione_sociale," ")}}function zt(d,i){if(d&1&&(o(0,"option",73),r(1),n()),d&2){let t=i.$implicit,a=c(2);m("ngValue",t),l(),$(" P",t," - ",a.taskService.getNomePriorita(t)," ")}}function Pt(d,i){if(d&1){let t=x();o(0,"div",74)(1,"button",75),u("click",function(){g(t);let e=c(2);return _(e.salvaMacroTask())}),o(2,"i",22),r(3,"save"),n(),r(4," Crea Macro Task "),n()()}if(d&2){let t=c(2);l(),m("disabled",t.loading),l(),M("spin",t.loading)}}function Vt(d,i){d&1&&(o(0,"div",80)(1,"i",22),r(2,"layers"),n(),o(3,"h4"),r(4,"Nessuna sotto task"),n(),o(5,"p"),r(6,"Crea la prima sotto task per suddividere il lavoro"),n()())}function Ot(d,i){if(d&1&&(o(0,"span",103)(1,"i",22),r(2,"checklist"),n(),r(3),n()),d&2){let t=c().$implicit;l(3),k(" ",t.task_dettaglio.length," dettagli ")}}function It(d,i){if(d&1){let t=x();o(0,"li")(1,"a",98),u("click",function(){let e=g(t).$implicit,s=c(2).$implicit,p=O(27);return c(4).cambiaStatoSottoTask(s,e),_(p.close())}),r(2),n()()}if(d&2){let t=i.$implicit,a=c(6);l(2),k(" ",a.getStatoTesto(t)," ")}}function Dt(d,i){d&1&&(B(0),o(1,"li")(2,"h6",104),r(3,"Cambia Stato"),n()(),f(4,It,3,1,"li",105),o(5,"li"),N(6,"hr",106),n(),L()),d&2&&(l(4),m("ngForOf",W(1,Tt)))}function Nt(d,i){d&1&&(o(0,"div",107)(1,"i",22),r(2,"android"),n()())}function At(d,i){if(d&1){let t=x();o(0,"p",120),u("click",function(){g(t);let e=c().$implicit,s=c(2).$implicit,p=c(4);return _(p.apriDettaglio(e,s))}),n()}if(d&2){let t=c().$implicit,a=c(6);m("innerHTML",a.highlightDescrizione(t.descrizione),A)}}function Wt(d,i){if(d&1){let t=x();o(0,"div",110)(1,"div",111)(2,"input",112),u("change",function(){let e=g(t).$implicit,s=c(2).$implicit,p=c(4);return _(p.toggleDettaglioCompletato(e,s))})("click",function(e){return g(t),_(e.stopPropagation())})("mousedown",function(e){return g(t),_(e.stopPropagation())}),n(),o(3,"div",113)(4,"div",114),N(5,"strong",115),o(6,"span",19)(7,"i",22),r(8,"schedule"),n(),r(9),I(10,"date"),n(),o(11,"div",116),u("click",function(e){return g(t),_(e.stopPropagation())}),o(12,"button",117),u("click",function(e){let s=g(t).$implicit,p=c(2).$implicit,v=c(4);return e.stopPropagation(),_(v.apriDettaglio(s,p))}),o(13,"i",22),r(14,"edit"),n()(),o(15,"button",118),u("click",function(e){let s=g(t).$implicit,p=c(2).$implicit,v=c(4);return e.stopPropagation(),_(v.eliminaDettaglio(s,p))}),o(16,"i",22),r(17,"delete_forever"),n()()()(),f(18,At,1,1,"p",119),n()()()}if(d&2){let t=i.$implicit,a=c(6);l(2),m("checked",t.completato),l(3),M("completed",t.completato),m("innerHTML",a.highlightDettaglioNome(t.nome),A),l(4),k(" ",D(10,6,t.data_scadenza_prevista,"dd/MM/yyyy")," "),l(9),m("ngIf",t.descrizione)}}function Bt(d,i){if(d&1&&(o(0,"div",108),f(1,Wt,19,9,"div",109),n()),d&2){let t=c().$implicit,a=c(4);l(),m("ngForOf",a.getDettagliOrdinati(t))("ngForTrackBy",a.trackByDettaglio)}}function Lt(d,i){if(d&1){let t=x();o(0,"div",80)(1,"i",22),r(2,"info"),n(),r(3," Nessun dettaglio aggiunto. "),o(4,"a",121),u("click",function(){g(t);let e=c().$implicit,s=c(4);return _(s.apriModal("dettaglio",e))}),r(5,"Aggiungi il primo dettaglio"),n()()}}function Ft(d,i){if(d&1){let t=x();o(0,"div",83)(1,"div",84),u("click",function(){let e=g(t).$implicit,s=c(4);return _(s.toggleSottoTaskEspansa(e.id))}),o(2,"div",85)(3,"button",86),u("click",function(e){let s=g(t).$implicit,p=c(4);return e.stopPropagation(),_(p.toggleSottoTaskEspansa(s.id))}),o(4,"i",22),r(5),n()(),o(6,"div",87),N(7,"h4",88),o(8,"div",89)(9,"span",90),r(10),n(),o(11,"span",90),r(12),n(),o(13,"span",19)(14,"i",22),r(15,"calendar_today"),n(),r(16),I(17,"date"),n(),f(18,Ot,4,1,"span",91),n()()(),o(19,"div",92),u("click",function(e){return g(t),_(e.stopPropagation())}),o(20,"button",93),u("click",function(){let e=g(t).$implicit,s=c(4);return _(s.apriModal("modificaSottoTask",e))}),o(21,"i",22),r(22,"edit"),n()(),o(23,"button",94),u("click",function(){let e=g(t).$implicit,s=c(4);return _(s.exportSottoTask(e))}),o(24,"i",22),r(25,"content_copy"),n()(),o(26,"app-action-dropdown",95,3),u("action",function(e){let s=g(t).$implicit,p=c(4);return _(p.handleSottoTaskAction(e,s))}),o(28,"div",96),u("click",function(e){return g(t),_(e.stopPropagation())}),f(29,Dt,7,2,"ng-container",97),o(30,"li")(31,"a",98),u("click",function(){let e=g(t).$implicit,s=O(27);return c(4).apriModal("dettaglio",e),_(s.close())}),o(32,"i",22),r(33,"add"),n(),r(34," Aggiungi Dettaglio "),n()()()(),f(35,Nt,3,0,"div",99),n()(),o(36,"div",100),f(37,Bt,2,2,"div",101)(38,Lt,6,0,"div",102),n()()}if(d&2){let t=i.$implicit,a=c(4);M("expanded",a.isSottoTaskEspansa(t.id))("dropdown-open",a.isDropdownOpen(t.id)),l(3),m("title",a.isSottoTaskEspansa(t.id)?"Riduci dettagli":"Espandi dettagli"),q("aria-expanded",a.isSottoTaskEspansa(t.id)),l(2),k(" ",a.isSottoTaskEspansa(t.id)?"expand_less":"expand_more"," "),l(2),m("innerHTML",a.highlightSotto(t.nome),A),l(2),F(a.getPrioritaBadgeClass(t.priorita)),l(),k(" P",t.priorita," "),l(),F(a.getStatoBadgeClass(t.stato)),l(),k(" ",a.getStatoTesto(t.stato)," "),l(4),k(" ",D(17,23,t.created_at,"dd/MM/yyyy")," "),l(2),m("ngIf",t.task_dettaglio&&t.task_dettaglio.length>0),l(8),m("row",t),l(3),m("ngIf",a.puoiModificareSottoTask(t)),l(6),m("ngIf",!a.puoiModificareSottoTask(t)),l(),M("show",a.isSottoTaskEspansa(t.id)),l(),m("ngIf",t.task_dettaglio&&t.task_dettaglio.length>0),l(),m("ngIf",!t.task_dettaglio||t.task_dettaglio.length===0)}}function $t(d,i){if(d&1&&(o(0,"div",81),f(1,Ft,39,26,"div",82),n()),d&2){let t=c(3);l(),m("ngForOf",t.filteredSottoTasks())("ngForTrackBy",t.trackBySottoTask)}}function Ut(d,i){if(d&1){let t=x();o(0,"div",7)(1,"div",8)(2,"h3",10)(3,"i",22),r(4,"layers"),n(),r(5," Sotto Tasks "),o(6,"span",76),r(7),n()(),o(8,"div",20)(9,"button",77),u("click",function(){g(t);let e=c(2);return _(e.toggleEspandiTutti())}),o(10,"i",22),r(11),n(),o(12,"span",23),r(13),n()(),o(14,"button",78),u("click",function(){g(t);let e=c(2);return _(e.apriModal("sottoTask"))}),o(15,"i",22),r(16,"add"),n(),o(17,"span",23),r(18,"Nuova"),n()()()(),f(19,Vt,7,0,"ng-template",null,2,K)(21,$t,2,2,"div",79),n()}if(d&2){let t=O(20),a=c(2);l(7),w((a.macroTask.sotto_tasks==null?null:a.macroTask.sotto_tasks.length)||0),l(2),m("title",a.espandiTutti?"Riduci tutte":"Espandi tutte"),l(2),k(" ",a.espandiTutti?"unfold_less":"unfold_more"," "),l(2),w(a.espandiTutti?"Riduci":"Espandi"),l(8),m("ngIf",a.macroTask.sotto_tasks&&a.macroTask.sotto_tasks.length>0)("ngIfElse",t)}}function jt(d,i){if(d&1){let t=x();o(0,"div",30)(1,"div",31)(2,"div",7)(3,"h3",10),r(4,"Informazioni Principali"),n(),o(5,"div",32)(6,"div",33)(7,"label",34),r(8,"Nome Task *"),n(),o(9,"input",35,0),b("ngModelChange",function(e){g(t);let s=c();return S(s.macroTask.nome,e)||(s.macroTask.nome=e),_(e)}),n()(),o(11,"div",36)(12,"label",37),r(13,"Data Scadenza"),n(),o(14,"input",38),b("ngModelChange",function(e){g(t);let s=c();return S(s.macroTask.data_scadenza,e)||(s.macroTask.data_scadenza=e),_(e)}),n()(),o(15,"div",36)(16,"label",39),r(17,"Stato"),n(),N(18,"input",40),n()(),o(19,"div",36)(20,"label",41),r(21,"Cliente"),n(),o(22,"select",42),b("ngModelChange",function(e){g(t);let s=c();return S(s.macroTask.cliente_id,e)||(s.macroTask.cliente_id=e),_(e)}),o(23,"option",43),r(24,"Nessun cliente"),n(),f(25,Et,2,2,"option",44),n()(),o(26,"div",36)(27,"label",45),r(28,"Priorit\xE0"),n(),o(29,"select",46),b("ngModelChange",function(e){g(t);let s=c();return S(s.macroTask.priorita_globale,e)||(s.macroTask.priorita_globale=e),_(e)}),f(30,zt,2,3,"option",47),n()(),o(31,"div",36)(32,"label",48),r(33,"Modulo *"),n(),o(34,"select",49,1),b("ngModelChange",function(e){g(t);let s=c();return S(s.macroTask.assegnazione_id,e)||(s.macroTask.assegnazione_id=e),_(e)}),o(36,"option",43),r(37,"Seleziona Modulo"),n(),o(38,"option",50),r(39,"Immagine"),n(),o(40,"option",51),r(41,"Digitalizzazione"),n(),o(42,"option",52),r(43,"Contabilit\xE0"),n(),o(44,"option",53),r(45,"Ottimizzazione"),n(),o(46,"option",54),r(47,"Tutti i moduli"),n(),o(48,"option",55),r(49,"Task interna"),n()()(),o(50,"div",36)(51,"label",56),r(52,"Note"),n(),o(53,"textarea",57),b("ngModelChange",function(e){g(t);let s=c();return S(s.macroTask.note,e)||(s.macroTask.note=e),_(e)}),n()(),f(54,Pt,5,3,"div",58),n(),o(55,"div",59)(56,"label",60)(57,"span",22),r(58,"search"),n(),r(59," Cerca "),n(),o(60,"input",61),b("ngModelChange",function(e){g(t);let s=c();return S(s.sottoSearch,e)||(s.sottoSearch=e),_(e)}),n(),o(61,"div",62)(62,"span",63),r(63),n(),o(64,"span",63),r(65),n()()(),f(66,Ut,22,6,"div",64),n(),o(67,"div",65)(68,"div",66)(69,"h4"),r(70,"Riepilogo Task"),n(),o(71,"div",67)(72,"div",68)(73,"label"),r(74,"Stato:"),n(),o(75,"span",69),r(76),n()(),o(77,"div",68)(78,"label"),r(79,"Priorit\xE0:"),n(),o(80,"span",69),r(81),n()(),o(82,"div",68)(83,"label"),r(84,"Progresso:"),n(),o(85,"div",70)(86,"div",71)(87,"span",72),r(88),n()()()(),o(89,"div",68)(90,"label"),r(91,"Cliente:"),n(),o(92,"span"),r(93),n()(),o(94,"div",68)(95,"label"),r(96,"Modulo:"),n(),o(97,"span"),r(98),n()(),o(99,"div",68)(100,"label"),r(101,"Scadenza:"),n(),o(102,"span"),r(103),I(104,"date"),n()(),o(105,"div",68)(106,"label"),r(107,"Creato il:"),n(),o(108,"span"),r(109),I(110,"date"),n()(),o(111,"div",68)(112,"label"),r(113,"Aggiornato il:"),n(),o(114,"span"),r(115),I(116,"date"),n()()()()()()}if(d&2){let t=O(10),a=O(35),e=c();l(9),M("input-error",t.invalid&&(t.touched||e.submitted)),T("ngModel",e.macroTask.nome),l(5),T("ngModel",e.macroTask.data_scadenza),l(4),m("value",e.taskService.getStatoTesto(e.macroTask.stato)),l(4),T("ngModel",e.macroTask.cliente_id),l(),m("value",null),l(2),m("ngForOf",e.clienti),l(4),T("ngModel",e.macroTask.priorita_globale),l(),m("ngForOf",W(46,ht)),l(4),M("input-error",a.invalid&&(a.touched||e.submitted)),T("ngModel",e.macroTask.assegnazione_id),l(2),m("value",null),l(17),T("ngModel",e.macroTask.note),l(),m("ngIf",!e.macroTask.id),l(6),T("ngModel",e.sottoSearch),l(3),k("",e.getTaskCounts().sottoTasks," Sotto-task"),l(2),k("",e.getTaskCounts().dettagli," Dettagli"),l(),m("ngIf",e.macroTask.id),l(9),m("ngClass",e.taskService.getStatoBadgeClass(e.macroTask.stato)),l(),k(" ",e.taskService.getStatoTesto(e.macroTask.stato)," "),l(4),m("ngClass",e.taskService.getPrioritaBadgeClass(e.macroTask.priorita_globale)),l(),k(" P",e.macroTask.priorita_globale," "),l(5),G("width",e.macroTask.progresso,"%"),m("ngClass",e.taskService.getStatoBadgeClass(e.macroTask.stato)),l(2),k("",e.macroTask.progresso,"%"),l(5),w(e.getNomeCliente(e.macroTask.cliente_id)),l(5),w(e.taskService.getModuloName(e.macroTask.assegnazione_id||null)),l(4),M("text-danger",e.taskService.isScaduta(e.macroTask.data_scadenza))("text-warning",e.taskService.isScadenzaImminente(e.macroTask.data_scadenza)),l(),k(" ",D(104,37,e.macroTask.data_scadenza,"dd/MM/yyyy")," "),l(6),w(D(110,40,e.macroTask.created_at,"dd/MM/yyyy HH:mm")),l(6),w(D(116,43,e.macroTask.updated_at,"dd/MM/yyyy HH:mm"))}}function Ht(d,i){if(d&1){let t=x();o(0,"div",122),u("click",function(){g(t);let e=c();return _(e.chiudiModal("sottoTask"))}),n()}}function Rt(d,i){if(d&1){let t=x();o(0,"div",123)(1,"div",124)(2,"div",125)(3,"div",126)(4,"h5",127)(5,"i",22),r(6,"layers"),n(),r(7," Nuova Sotto Task "),n(),o(8,"button",128),u("click",function(){g(t);let e=c();return _(e.chiudiModal("sottoTask"))}),n()(),o(9,"div",129)(10,"div",36)(11,"label",130),r(12,"Nome *"),n(),o(13,"input",131,4),b("ngModelChange",function(e){g(t);let s=c();return S(s.nuovaSottoTask.nome,e)||(s.nuovaSottoTask.nome=e),_(e)}),n()(),o(15,"div",36)(16,"label",132),r(17,"Priorit\xE0"),n(),o(18,"select",133),b("ngModelChange",function(e){g(t);let s=c();return S(s.nuovaSottoTask.priorita,e)||(s.nuovaSottoTask.priorita=e),_(e)}),o(19,"option",73),r(20,"1 - Minima"),n(),o(21,"option",73),r(22,"2 - Bassa"),n(),o(23,"option",73),r(24,"3 - Media"),n(),o(25,"option",73),r(26,"4 - Alta"),n(),o(27,"option",73),r(28,"5 - Critica"),n()()()(),o(29,"div",134)(30,"button",135),u("click",function(){g(t);let e=c();return _(e.chiudiModal("sottoTask"))}),r(31,"Annulla"),n(),o(32,"button",136),u("click",function(){g(t);let e=c();return _(e.creaSottoTask())}),r(33,"Crea"),n()()()()()}if(d&2){let t=O(14),a=c();l(13),M("input-error",t.invalid&&(t.touched||a.submitted)),T("ngModel",a.nuovaSottoTask.nome),l(5),T("ngModel",a.nuovaSottoTask.priorita),l(),m("ngValue",1),l(2),m("ngValue",2),l(2),m("ngValue",3),l(2),m("ngValue",4),l(2),m("ngValue",5)}}function qt(d,i){if(d&1){let t=x();o(0,"div",122),u("click",function(){g(t);let e=c();return _(e.chiudiModal("modificaSottoTask"))}),n()}}function Gt(d,i){if(d&1){let t=x();o(0,"div",123)(1,"div",124)(2,"div",125)(3,"div",126)(4,"h5",127)(5,"i",22),r(6,"edit"),n(),r(7," Modifica Sotto Task "),n(),o(8,"button",128),u("click",function(){g(t);let e=c();return _(e.chiudiModal("modificaSottoTask"))}),n()(),o(9,"div",129)(10,"div",36)(11,"label",137),r(12,"Nome *"),n(),o(13,"input",138),b("ngModelChange",function(e){g(t);let s=c();return S(s.sottoTaskModificata.nome,e)||(s.sottoTaskModificata.nome=e),_(e)}),n()(),o(14,"div",36)(15,"label",139),r(16,"Priorit\xE0"),n(),o(17,"select",140),b("ngModelChange",function(e){g(t);let s=c();return S(s.sottoTaskModificata.priorita,e)||(s.sottoTaskModificata.priorita=e),_(e)}),o(18,"option",141),r(19,"1 - Minima"),n(),o(20,"option",142),r(21,"2 - Bassa"),n(),o(22,"option",143),r(23,"3 - Media"),n(),o(24,"option",144),r(25,"4 - Alta"),n(),o(26,"option",145),r(27,"5 - Critica"),n()()(),o(28,"div",36)(29,"label",146),r(30,"Stato"),n(),o(31,"select",147),b("ngModelChange",function(e){g(t);let s=c();return S(s.sottoTaskModificata.stato,e)||(s.sottoTaskModificata.stato=e),_(e)}),o(32,"option",148),r(33,"Da Fare"),n(),o(34,"option",149),r(35,"In Lavorazione"),n(),o(36,"option",150),r(37,"Completato"),n()()()(),o(38,"div",134)(39,"button",135),u("click",function(){g(t);let e=c();return _(e.chiudiModal("modificaSottoTask"))}),r(40,"Annulla"),n(),o(41,"button",136),u("click",function(){g(t);let e=c();return _(e.salvaModificaSottoTask())}),r(42,"Salva Modifiche"),n()()()()()}if(d&2){let t=c();l(13),T("ngModel",t.sottoTaskModificata.nome),l(4),T("ngModel",t.sottoTaskModificata.priorita),l(14),T("ngModel",t.sottoTaskModificata.stato)}}function Kt(d,i){if(d&1){let t=x();o(0,"div",122),u("click",function(){g(t);let e=c();return _(e.chiudiModal("dettaglio"))}),n()}}function Qt(d,i){if(d&1){let t=x();o(0,"div",123)(1,"div",124)(2,"div",125)(3,"div",126)(4,"h5",127)(5,"i",22),r(6,"task"),n(),r(7),n(),o(8,"button",128),u("click",function(){g(t);let e=c();return _(e.chiudiModal("dettaglio"))}),n()(),o(9,"div",129)(10,"div",36)(11,"label",151),r(12,"Nome *"),n(),o(13,"input",152),b("ngModelChange",function(e){g(t);let s=c();return S(s.dettaglioModal.nome,e)||(s.dettaglioModal.nome=e),_(e)}),n()(),o(14,"div",36)(15,"label",153),r(16,"Descrizione"),n(),o(17,"textarea",154),b("ngModelChange",function(e){g(t);let s=c();return S(s.dettaglioModal.descrizione,e)||(s.dettaglioModal.descrizione=e),_(e)}),n()(),o(18,"div",36)(19,"label",155),r(20,"Data Scadenza Prevista"),n(),o(21,"input",156),b("ngModelChange",function(e){g(t);let s=c();return S(s.dettaglioModal.data_scadenza_prevista,e)||(s.dettaglioModal.data_scadenza_prevista=e),_(e)}),n()()(),o(22,"div",134)(23,"button",135),u("click",function(){g(t);let e=c();return _(e.chiudiModal("dettaglio"))}),r(24,"Annulla"),n(),o(25,"button",157),u("click",function(){g(t);let e=c();return _(e.salvaDettaglio())}),o(26,"i",22),r(27),n(),r(28),n()()()()()}if(d&2){let t=c();l(7),k(" ",t.modalDettaglioMode==="create"?"Nuovo Task di Dettaglio":"Modifica Dettaglio"," "),l(6),T("ngModel",t.dettaglioModal.nome),l(4),T("ngModel",t.dettaglioModal.descrizione),l(4),T("ngModel",t.dettaglioModal.data_scadenza_prevista),l(4),m("disabled",t.loading),l(2),w(t.modalDettaglioMode==="create"?"save":"edit"),l(),k(" ",t.modalDettaglioMode==="create"?"Crea Dettaglio":"Salva Modifiche"," ")}}function Jt(d,i){if(d&1){let t=x();o(0,"div",122),u("click",function(){g(t);let e=c();return _(e.chiudiTemplateModal())}),n()}}function Xt(d,i){if(d&1&&(o(0,"li")(1,"strong"),r(2),n(),r(3),n()),d&2){let t=i.$implicit;l(2),w(t.nome),l(),k(" - ",t.descrizione," ")}}function Yt(d,i){if(d&1&&(o(0,"ul"),f(1,Xt,4,2,"li",105),n()),d&2){let t=c().$implicit;l(),m("ngForOf",t.task_dettaglio)}}function Zt(d,i){if(d&1&&(o(0,"div",166)(1,"strong"),r(2),n(),r(3),f(4,Yt,2,1,"ul",97),n()),d&2){let t=i.$implicit,a=i.index;l(2),$("",a+1,". ",t.nome),l(),k(" (Priorit\xE0: ",t.priorita,") "),l(),m("ngIf",t.task_dettaglio&&t.task_dettaglio.length>0)}}function te(d,i){if(d&1){let t=x();o(0,"div",123)(1,"div",124)(2,"div",125)(3,"div",126)(4,"h5",127)(5,"i",22),r(6,"content_copy"),n(),r(7," Salva come Template "),n(),o(8,"button",158),u("click",function(){g(t);let e=c();return _(e.chiudiTemplateModal())}),n()(),o(9,"div",129)(10,"div",36)(11,"label",159),r(12,"Nome Template *"),n(),o(13,"input",160),b("ngModelChange",function(e){g(t);let s=c();return S(s.nomeTemplate,e)||(s.nomeTemplate=e),_(e)}),n()(),o(14,"div",36)(15,"label",161),r(16,"Descrizione"),n(),o(17,"textarea",162),b("ngModelChange",function(e){g(t);let s=c();return S(s.descrizioneTemplate,e)||(s.descrizioneTemplate=e),_(e)}),n()(),o(18,"div",36)(19,"label",163),r(20,"Anteprima Struttura"),n(),o(21,"div",164),f(22,Zt,5,4,"div",165),n()()(),o(23,"div",134)(24,"button",135),u("click",function(){g(t);let e=c();return _(e.chiudiTemplateModal())}),r(25,"Annulla"),n(),o(26,"button",157),u("click",function(){g(t);let e=c();return _(e.confermaCreaTemplate())}),o(27,"i",22),r(28,"save"),n(),r(29),n()()()()()}if(d&2){let t=c();l(13),T("ngModel",t.nomeTemplate),l(4),T("ngModel",t.descrizioneTemplate),l(5),m("ngForOf",(t.macroTask==null?null:t.macroTask.sotto_tasks)||W(7,St)),l(4),m("disabled",!t.nomeTemplate.trim()||t.loading),l(),M("fa-spin",t.loading),l(2),k(" ",t.loading?"Salvataggio...":"Crea Template"," ")}}function ee(d,i){if(d&1){let t=x();o(0,"div",122),u("click",function(){g(t);let e=c();return _(e.chiudiModal("leggiDettaglio"))}),n()}}function ie(d,i){if(d&1&&(o(0,"div",36)(1,"label",163),r(2,"Scadenza prevista"),n(),o(3,"div"),r(4),I(5,"date"),n()()),d&2){let t=c().ngIf;l(4),w(D(5,1,t.data_scadenza_prevista,"dd/MM/yyyy"))}}function ae(d,i){if(d&1&&(o(0,"div",36)(1,"label",163),r(2,"Descrizione completa"),n(),o(3,"div",168),r(4),n()()),d&2){let t=c().ngIf;l(4),w(t.descrizione)}}function ne(d,i){if(d&1&&(B(0),o(1,"div",36)(2,"label",163),r(3,"Nome"),n(),o(4,"div"),r(5),n()(),f(6,ie,6,4,"div",167)(7,ae,5,1,"div",167),L()),d&2){let t=i.ngIf;l(5),w(t.nome),l(),m("ngIf",t.data_scadenza_prevista),l(),m("ngIf",t.descrizione)}}function oe(d,i){if(d&1){let t=x();o(0,"div",123)(1,"div",124)(2,"div",125)(3,"div",126)(4,"h5",127)(5,"i",22),r(6,"description"),n(),r(7," Dettaglio "),n(),o(8,"button",128),u("click",function(){g(t);let e=c();return _(e.chiudiModal("leggiDettaglio"))}),n()(),o(9,"div",129),f(10,ne,8,3,"ng-container",97),n(),o(11,"div",134)(12,"button",135),u("click",function(){g(t);let e=c();return _(e.chiudiModal("leggiDettaglio"))}),r(13,"Chiudi"),n()()()()()}if(d&2){let t=c();l(10),m("ngIf",t.selectedDettaglioView)}}var ft=class d{constructor(i,t,a,e,s,p,v,y){this.router=i;this.route=t;this.taskService=a;this.soggettiService=e;this.userService=s;this.authService=p;this.emailService=v;this.sanitizer=y}currentUser=null;macroTask=null;clienti=[];loading=!1;error="";activeDropdownId=null;selectedDettaglioView=null;modals={sottoTask:!1,dettaglio:!1,modificaSottoTask:!1,leggiDettaglio:!1};modalDettaglioMode="create";dettaglioModal={id:void 0,nome:"",descrizione:"",data_scadenza_prevista:new Date().toISOString().split("T")[0],sotto_task_id:""};sottoSearch="";sottoTaskStati=["da_fare","in_lavorazione","completato"];showTemplateModal=!1;nomeTemplate="";descrizioneTemplate="";submitted=!1;nuovaSottoTask={nome:"",priorita:3,macro_task_id:""};nuovoDettaglio={nome:"",descrizione:"",data_scadenza_prevista:new Date().toISOString().split("T")[0],sotto_task_id:""};sottoTaskModificata={};sottoTaskDaModificare=null;selectedSottoTask=null;sottoTaskEspanse=new Set;espandiTutti=!1;ngOnInit(){return h(this,null,function*(){try{let t=this.authService.user();if(t&&t.id){let a=yield this.userService.getUserById(t.id);this.currentUser=a.data??null}else this.currentUser=null;this.userService.refreshAdminStatus&&(yield this.userService.refreshAdminStatus())}catch(t){console.warn("Impossibile recuperare utente corrente",t),this.currentUser=null}let i=this.route.snapshot.paramMap.get("id");i==="nuova"?this.inizializzaNuovaTask():i?yield this.caricaTask(i):this.inizializzaNuovaTask();try{yield this.caricaDatiSupporto()}catch(t){console.warn("Errore caricamento dati di supporto",t)}})}inizializzaNuovaTask(){this.macroTask={id:"",nome:"",data_scadenza:new Date().toISOString().split("T")[0],cliente_id:"",assegnazione_id:null,note:"",stato:"da_fare",priorita_globale:1,progresso:0,created_at:"",updated_at:"",sotto_tasks:[],extra_data:{}}}caricaTask(i){return h(this,null,function*(){this.loading=!0;try{let t=yield this.taskService.getMacroTaskById(i);if(t.error)this.error="Errore: "+t.error.message;else{this.macroTask=t.data;let a=new Set((this.macroTask?.sotto_tasks||[]).map(e=>e.id));this.sottoTaskEspanse.forEach(e=>{a.has(e)||this.sottoTaskEspanse.delete(e)}),this.espandiTutti&&(this.macroTask?.sotto_tasks||[]).forEach(e=>this.sottoTaskEspanse.add(e.id))}}catch(t){this.error="Errore: "+t.message}finally{this.loading=!1}})}caricaDatiSupporto(){return h(this,null,function*(){try{let i=yield this.soggettiService.getSoggettiByTipo("cliente");this.clienti=i.data||[]}catch(i){console.error("Errore caricamento clienti:",i)}})}apriModal(i,t){if(this.modals[i]=!0,i==="sottoTask"){let a=this.macroTask?.id;a&&(this.nuovaSottoTask.macro_task_id=a)}i==="dettaglio"&&t&&(this.selectedSottoTask=t,this.modalDettaglioMode="create",this.dettaglioModal={id:void 0,nome:"",descrizione:"",data_scadenza_prevista:new Date().toISOString().split("T")[0],sotto_task_id:t.id}),i==="modificaSottoTask"&&t&&(this.sottoTaskDaModificare=t,this.sottoTaskModificata={id:t.id,nome:t.nome,descrizione:t.descrizione??void 0,priorita:t.priorita,stato:t.stato})}chiudiModal(i){this.modals[i]=!1,i==="sottoTask"&&(this.nuovaSottoTask={nome:"",priorita:3,macro_task_id:""}),i==="dettaglio"&&(this.modalDettaglioMode="create",this.dettaglioModal={id:void 0,nome:"",descrizione:"",data_scadenza_prevista:new Date().toISOString().split("T")[0],sotto_task_id:this.selectedSottoTask?.id??""},this.selectedSottoTask=null),i==="modificaSottoTask"&&(this.sottoTaskDaModificare=null,this.sottoTaskModificata={})}salvaDettaglio(){return h(this,null,function*(){if(!this.dettaglioModal.nome.trim()){this.error="Il nome del dettaglio \xE8 obbligatorio";return}if(!this.dettaglioModal.sotto_task_id){this.error="Seleziona una sotto-task valida";return}try{let i;if(this.modalDettaglioMode==="create"){let t={nome:this.dettaglioModal.nome,descrizione:this.dettaglioModal.descrizione,data_scadenza_prevista:this.dettaglioModal.data_scadenza_prevista,sotto_task_id:this.dettaglioModal.sotto_task_id};i=yield this.taskService.createTaskDettaglio(t)}else{if(!this.dettaglioModal.id)return;i=yield this.taskService.updateTaskDettaglio(this.dettaglioModal.id,{nome:this.dettaglioModal.nome,descrizione:this.dettaglioModal.descrizione,data_scadenza_prevista:this.dettaglioModal.data_scadenza_prevista})}i?.error?this.error="Errore: "+i.error.message:(yield this.aggiornaTask(),this.chiudiModal("dettaglio"))}catch(i){this.error="Errore: "+i.message}})}salvaMacroTask(){return h(this,null,function*(){if(this.submitted=!0,!(!this.macroTask||!this.validazioneTask())){this.loading=!0,this.error="";try{let t;if(this.macroTask.id){let i=this.macroTask,{cliente:a,sotto_tasks:e}=i,s=j(i,["cliente","sotto_tasks"]),p={nome:s.nome,data_scadenza:s.data_scadenza,note:s.note||"",stato:s.stato,priorita_globale:Number(s.priorita_globale)||1,progresso:s.progresso};s.cliente_id&&this.isValidUUID(s.cliente_id)&&(p.cliente_id=s.cliente_id),s.assegnazione_id&&(p.assegnazione_id=s.assegnazione_id),console.log("Aggiorno MacroTask:",this.macroTask.id,p),t=yield this.taskService.updateMacroTask(this.macroTask.id,p)}else{let a={nome:this.macroTask.nome,data_scadenza:this.macroTask.data_scadenza,note:this.macroTask.note||"",stato:"da_fare"};this.macroTask.cliente_id&&this.isValidUUID(this.macroTask.cliente_id)&&(a.cliente_id=this.macroTask.cliente_id),this.macroTask.assegnazione_id&&(a.assegnazione_id=this.macroTask.assegnazione_id),t=yield this.taskService.createMacroTask(a)}t.error?this.error="Errore: "+t.error.message:this.router.navigate(["/task"])}catch(t){this.error="Errore: "+t.message}finally{this.loading=!1}}})}isValidUUID(i){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}validazioneTask(){return this.macroTask.nome.trim()?this.macroTask.assegnazione_id?!0:(this.error="Seleziona un modulo per assegnare la task",!1):(this.error="Il nome della task \xE8 obbligatorio",!1)}creaSottoTask(){return h(this,null,function*(){if(!this.nuovaSottoTask.nome.trim()){this.error="Il nome della sotto-task \xE8 obbligatorio";return}try{let i=yield this.taskService.createSottoTask(this.nuovaSottoTask);i.error?this.error="Errore: "+i.error.message:yield this.aggiornaTask(),this.chiudiModal("sottoTask")}catch(i){this.error="Errore: "+i.message}})}creaTaskDettaglio(){return h(this,null,function*(){if(!this.nuovoDettaglio.nome.trim()){this.error="Il nome del dettaglio \xE8 obbligatorio";return}try{let i=yield this.taskService.createTaskDettaglio(this.nuovoDettaglio);i.error?this.error="Errore: "+i.error.message:yield this.aggiornaTask(),this.chiudiModal("dettaglio")}catch(i){this.error="Errore: "+i.message}})}salvaModificaSottoTask(){return h(this,null,function*(){if(!this.sottoTaskDaModificare||!this.sottoTaskModificata.nome?.trim()){this.error="Il nome della sotto-task \xE8 obbligatorio";return}try{let i=U({nome:this.sottoTaskModificata.nome,priorita:Number(this.sottoTaskModificata.priorita)||this.sottoTaskDaModificare.priorita},this.sottoTaskModificata.stato?{stato:this.sottoTaskModificata.stato}:{}),t=yield this.taskService.updateSottoTask(this.sottoTaskDaModificare.id,i);t.error?this.error="Errore: "+t.error.message:yield this.aggiornaTask(),this.chiudiModal("modificaSottoTask")}catch(i){this.error="Errore: "+i.message}})}toggleDettaglioCompletato(i,t){return h(this,null,function*(){try{(yield this.taskService.toggleTaskDettaglioCompletato(i.id,!i.completato)).error||(i.completato=!i.completato,i.data_completamento=i.completato?new Date().toISOString():null,yield this.aggiornaStatoSottoTaskAutomatico(t),yield this.aggiornaTask())}catch(a){this.error="Errore: "+a.message}})}aggiornaStatoSottoTaskAutomatico(i){return h(this,null,function*(){if(!i.task_dettaglio?.length)return;let t=i.task_dettaglio.every(s=>s.completato),a=i.task_dettaglio.every(s=>!s.completato),e=i.stato;if(t?e="completato":a?e="da_fare":e="in_lavorazione",e!==i.stato){let s=i.stato;try{yield this.taskService.updateSottoTask(i.id,{stato:e}),i.stato=e,s!=="completato"&&e==="completato"&&(console.log("Sotto-task completata, verifica invio email...",i),this.maybeAskAndSendCompletionEmail(i).catch(p=>{console.warn("Invio email completamento sotto-task fallito:",p)}))}catch(p){console.error("Errore aggiornamento stato sotto-task:",p)}yield this.aggiornaTask()}})}aggiornaTask(){return h(this,null,function*(){let i=this.macroTask?.id;i&&(yield this.caricaTask(i))})}toggleDropdown(i,t){t?.stopPropagation(),this.activeDropdownId=this.activeDropdownId===i?null:i}isDropdownOpen(i){return this.activeDropdownId===i}closeDropdown(){this.activeDropdownId=null}puoiModificareSottoTask(i){return!i.task_dettaglio||i.task_dettaglio.length===0}getNomeCliente(i){return this.clienti.find(t=>t.id===i)?.ragione_sociale||"Non assegnato"}trackBySottoTask(i,t){return t.id}trackByDettaglio(i,t){return t.id}eliminaMacroTask(){return h(this,null,function*(){if(!this.currentUser?.is_admin){this.error="Non autorizzato";return}let i=this.macroTask?.id;if(!(!i||!confirm("Sei sicuro di voler eliminare questa macro task e tutti i contenuti collegati?"))){this.loading=!0,this.error="";try{let a=yield this.taskService.deleteMacroTaskCascade(i);if(a.error){this.error="Errore eliminazione: "+a.error.message;return}this.router.navigate(["/task"])}catch(a){this.error="Errore: "+a.message}finally{this.loading=!1}}})}eliminaDettaglio(i,t){return h(this,null,function*(){if(confirm("Sei sicuro di eliminare questo dettaglio?"))try{let a=yield this.taskService.deleteTaskDettaglio(i.id);if(a.error){this.error="Errore: "+a.error.message;return}t.task_dettaglio&&(t.task_dettaglio=t.task_dettaglio.filter(s=>s.id!==i.id)),yield this.aggiornaStatoSottoTaskAutomatico(t);let e=this.macroTask?.id;e&&(yield this.caricaTask(e))}catch(a){this.error="Errore: "+a.message}})}cambiaStatoSottoTask(i,t){return h(this,null,function*(){if(!this.puoiModificareSottoTask(i)){this.error="Impossibile modificare lo stato: questa sotto-task ha dettagli e lo stato viene gestito automaticamente";return}try{let a=yield this.taskService.updateSottoTask(i.id,{stato:t});a.error?this.error="Errore: "+a.error.message:(i.stato=t,this.macroTask&&(yield this.caricaTask(this.macroTask.id)))}catch(a){this.error="Errore: "+a.message}})}getPrioritaBadgeClass(i){return this.taskService.getPrioritaBadgeClass(i)}getStatoBadgeClass(i){return this.taskService.getStatoBadgeClass(i)}getStatoTesto(i){return this.taskService.getStatoTesto(i)}getModuloName(i){return this.taskService.getModuloName(i.assegnazione_id||null)}isScaduta(i){return this.taskService.isScaduta(i)}isScadenzaImminente(i){return this.taskService.isScadenzaImminente(i)}salvaComeTemplate(){if(!this.currentUser?.is_admin){this.error="Non autorizzato";return}if(!this.macroTask){this.error="Nessuna task da salvare come template";return}this.nomeTemplate=this.macroTask.nome+" - Template",this.descrizioneTemplate=this.macroTask.note||"",this.showTemplateModal=!0}chiudiTemplateModal(){this.showTemplateModal=!1,this.nomeTemplate="",this.descrizioneTemplate=""}confermaCreaTemplate(){return h(this,null,function*(){if(!this.macroTask||!this.nomeTemplate.trim()){this.error="Il nome del template \xE8 obbligatorio";return}this.loading=!0;try{let i={sotto_tasks:[]};if(this.macroTask.sotto_tasks)for(let e of this.macroTask.sotto_tasks){let s={nome:e.nome,priorita:e.priorita,task_dettaglio:[]};if(e.task_dettaglio)for(let p of e.task_dettaglio){let v=this.calcolaOffsetGiorni(p.data_scadenza_prevista,this.macroTask.created_at),y={nome:p.nome,descrizione:p.descrizione||"",data_scadenza_prevista_offset:v};s.task_dettaglio.push(y)}i.sotto_tasks.push(s)}let t={nome:this.nomeTemplate,descrizione:this.descrizioneTemplate||null,modulo:this.macroTask.assegnazione_id||"immagine",priorita_globale:this.macroTask.priorita_globale,data_scadenza_default:30,struttura_template:i},a=yield this.taskService.createMacroTaskTemplate(t);a.error?this.error="Errore nel salvataggio del template: "+a.error.message:(this.chiudiTemplateModal(),alert("Template salvato con successo!"))}catch(i){this.error="Errore: "+i.message}finally{this.loading=!1}})}calcolaOffsetGiorni(i,t){let a=new Date(i),e=new Date(t),s=a.getTime()-e.getTime();return Math.ceil(s/(1e3*60*60*24))}apriDettaglio(i,t){this.selectedSottoTask=t,this.modalDettaglioMode="edit",this.dettaglioModal={id:i.id,nome:i.nome,descrizione:i.descrizione??"",data_scadenza_prevista:i.data_scadenza_prevista?i.data_scadenza_prevista.split("T")[0]:new Date().toISOString().split("T")[0],sotto_task_id:t.id},this.modals.dettaglio=!0}toggleSottoTaskEspansa(i){requestAnimationFrame(()=>{this.sottoTaskEspanse.has(i)?this.sottoTaskEspanse.delete(i):this.sottoTaskEspanse.add(i)})}isSottoTaskEspansa(i){return this.sottoTaskEspanse.has(i)}toggleEspandiTutti(){this.espandiTutti=!this.espandiTutti,requestAnimationFrame(()=>{this.espandiTutti&&this.macroTask?.sotto_tasks?this.macroTask.sotto_tasks.forEach(i=>{this.sottoTaskEspanse.add(i.id)}):this.sottoTaskEspanse.clear()})}canEditTask(){return this.taskService.canModifyTask(this.currentUser,this.macroTask??null)}maybeAskAndSendCompletionEmail(i){return h(this,null,function*(){try{if(!this.currentUser?.is_admin){console.log("Utente non admin: invio email disabilitato per completamento sotto-task",i.id);return}let t=this.macroTask?.assegnazione_id==="interna",a="",e="",s="";if(t)a="info@prometheasrl.it",e=`Completamento attivit\xE0 interna: ${i.nome}`,s="Team Promethea";else{let C=this.macroTask?.cliente_id;if(!C){console.warn("Nessun cliente associato alla macro task");return}let z=this.clienti.find(xt=>xt.id===C);if(!z){console.warn("Cliente non trovato");return}if(a=z.email||z?.referente_email||z?.contatto_email||z?.mail,!a||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)){console.warn("Email cliente non valida o assente:",a);return}e=`Completamento attivit\xE0: ${i.nome}`,s=z.referente||z.ragione_sociale||"Cliente"}if(!a){console.warn("Nessun destinatario email trovato");return}if(!confirm(`La sotto-task "${i.nome}" \xE8 stata completata.

Inviare una email di notifica${t?" al team Promethea":" al cliente"}?
Destinatario: ${a}`))return;let v=(i.task_dettaglio||[]).filter(C=>C.completato).map(C=>({nome:C.nome,data:C.data_scadenza_prevista?new Date(C.data_scadenza_prevista).toLocaleDateString("it-IT"):"N/D",descrizione:C.descrizione??""}));if(v.length===0){alert("Nessun dettaglio completato trovato nella sotto-task");return}let y="",P="";t?(y=this.emailService.generateEmailTextInterna(i.nome,v),P=this.emailService.generateEmailHtmlInterna(i.nome,v)):(y=this.generateEmailText({referente:s,ragione_sociale:s},i.nome,v),P=this.emailService.generateSottoTaskCompletionHtml({referente:s,ragione_sociale:s},i.nome,v)),console.log("\u{1F4E4} Invio email tramite servizio Aruba...");let E=yield this.emailService.sendEmail({to:a,subject:e,message:y,html:P});E.success?alert(`Email inviata con successo ${t?"al team Promethea":"al cliente"}!`):(this.error="Invio email fallito: "+(E.error||"Errore sconosciuto"),console.error("Errore invio email:",E.error))}catch(t){console.error("Errore durante l'invio dell'email:",t),this.error="Errore invio email: "+(t?.message||String(t))}})}generateEmailText(i,t,a){let e=i.referente||i.ragione_sociale||"Cliente",s=a.map(p=>`\u2022 ${p.nome}${p.data?` (Scadenza: ${p.data})`:""}${p.descrizione?` \u2014 ${p.descrizione}`:""}`).join(`
`);return`
Gentile ${e},

la informiamo che la sotto-task "${t}" \xE8 stata completata.

DETTAGLI COMPLETATI:
${s}

Cordiali saluti,
Il Team di Promethea S.r.l.

[Questo messaggio \xE8 stato generato automaticamente]
  `.trim()}handleSottoTaskAction(i,t){switch(i){case"edit":this.apriModal("modificaSottoTask",t);break;case"delete":confirm("Eliminare questa sotto-task?")&&console.log("delete requested",t.id);break;case"add-product":console.log("add-product per",t);break;default:console.log("Azione non gestita dall'action-dropdown:",i,t)}}buildExportTextFull(i,t=!1){let a=`Salve, vorrei vedere con te delle task che sto facendo.

Per programmare uso angular 20.0 (Controlla questa versione prima di rispondere) e ora ti dar\xF2 la lista delle task che vorrei che ti mi aiutassi a compilare.
Non dare nulla per scontato e prima di creare una nuova funzione verifica se gi\xE0 abbiamo una funzione che possiamo usare o modificare. Vorrei sempre soluzioni semplici senza complicare troppo il codice.

Ora ti dar\xF2 una lista di task con il dettaglio della stessa.

`,e=`

Ora dimmi come procedere per risolvere le task che ti ho elencato in ordine. Se hai bisogno di informazioni ulteriori per essere precisa e professionale fammi delle domande a cui posso risponderti per darti un contesto pi\xF9 preciso se ne hai bisogno.`,s=`Sotto-task: ${i.nome||"Senza nome"}

`,p=(i.task_dettaglio||[]).filter(y=>t?!y.completato:!0).map(y=>{let P=(y.nome||"").toString().trim(),E=(y.descrizione||"").toString().trim();return`- ${P}: ${E||"(nessuna descrizione)"}`}),v=p.length?p.join(`
`):"- (nessun dettaglio presente)";return`${a}${s}${v}${e}`}buildExportTextListOnly(i,t=!1){let a=`Sotto-task: ${i.nome||"Senza nome"}

`,e=(i.task_dettaglio||[]).filter(s=>t?!s.completato:!0).map(s=>{let p=(s.nome||"").toString().trim(),v=(s.descrizione||"").toString().trim();return`- ${p}: ${v||"(nessuna descrizione)"}`});return`${a}${e.length?e.join(`
`):"- (nessun dettaglio presente)"}`}exportSottoTask(i){return h(this,null,function*(){try{let t=window.confirm(`Vuoi includere anche il testo per l'IA (frase 1 e frase 2)?

Rispondi "OK" per S\xEC (testo completo) oppure "Annulla" per No (solo lista).`),a=window.confirm("Vuoi copiare solo i dettagli non completati? OK = solo non completati, Annulla = tutte"),e=t?this.buildExportTextFull(i,a):this.buildExportTextListOnly(i,a);if(typeof navigator<"u"&&navigator.clipboard&&navigator.clipboard.writeText){yield navigator.clipboard.writeText(e),alert(t?a?"Testo completo (solo non completati) copiato negli appunti.":"Testo completo copiato negli appunti.":a?"Lista dettagli (solo non completati) copiata negli appunti.":"Lista dettagli copiata negli appunti.");return}let s=new Blob([e],{type:"text/plain;charset=utf-8"}),p=URL.createObjectURL(s),v=document.createElement("a");v.href=p,v.download=`sotto-task-${i.id||"export"}.txt`,document.body.appendChild(v),v.click(),v.remove(),URL.revokeObjectURL(p),alert("Testo scaricato come file (fallback).")}catch(t){console.error("Export sotto-task error",t),alert("Errore esportazione testo: "+(t?.message||String(t)))}})}filteredSottoTasks(){let i=(this.sottoSearch||"").trim().toLowerCase();if(!this.macroTask)return[];let t=this.macroTask.sotto_tasks||[];i&&(t=t.filter(s=>this.matchesSubtask(s,i)));let a=t.filter(s=>s.stato!=="completato"),e=t.filter(s=>s.stato==="completato");return a.sort((s,p)=>p.priorita!==s.priorita?p.priorita-s.priorita:new Date(p.created_at).getTime()-new Date(s.created_at).getTime()),e.sort((s,p)=>{let v=y=>{if(y.task_dettaglio&&y.task_dettaglio.length>0){let P=y.task_dettaglio.filter(E=>E.completato&&E.data_completamento);if(P.length>0){let E=P.reduce((C,z)=>z.data_completamento>C?z.data_completamento:C,P[0].data_completamento);return new Date(E).getTime()}}return new Date(y.updated_at||y.created_at).getTime()};return v(p)-v(s)}),[...a,...e]}matchesSubtask(i,t){if((i.nome||"").toString().toLowerCase().includes(t))return!0;let a=i.task_dettaglio||[];for(let e of a)if((e.nome||"").toString().toLowerCase().includes(t)||(e.descrizione||"").toString().toLowerCase().includes(t))return!0;return!1}escapeHtml(i){return(i||"").toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}escapeRegex(i){return(i||"").toString().replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}highlightSotto(i){let t=(this.sottoSearch||"").trim(),a=this.escapeHtml(i||"");if(!t)return this.sanitizer.bypassSecurityTrustHtml(a);let e=new RegExp(this.escapeRegex(t),"ig");return this.sanitizer.bypassSecurityTrustHtml(a.replace(e,s=>`<mark>${s}</mark>`))}highlightDettaglioNome(i){return this.highlightSotto(i)}highlightDescrizione(i){let t=(this.sottoSearch||"").trim(),a=i||"",e=a.length>100?a.slice(0,100)+"\u2026":a,s=this.escapeHtml(e);if(!t)return this.sanitizer.bypassSecurityTrustHtml(s);let p=new RegExp(this.escapeRegex(t),"ig");return this.sanitizer.bypassSecurityTrustHtml(s.replace(p,v=>`<mark>${v}</mark>`))}getTaskCounts(){if(!this.macroTask?.sotto_tasks)return{sottoTasks:0,dettagli:0};let i=this.sottoSearch?this.filteredSottoTasks():this.macroTask.sotto_tasks,t=i.length,a=i.reduce((e,s)=>e+(s.task_dettaglio?.length||0),0);return{sottoTasks:t,dettagli:a}}generateEmailTextInterna(i,t){let a=t.map(e=>`\u2022 ${e.nome}${e.data?` (Scadenza: ${e.data})`:""}${e.descrizione?` \u2014 ${e.descrizione}`:""}`).join(`
`);return`
Completamento attivit\xE0 interna:

SOTTO-TASK: ${i}

DETTAGLI COMPLETATI:
${a}

Questa email \xE8 stata generata automaticamente dal sistema di gestione task.

Cordiali saluti,
Sistema di Gestione Task Promethea
  `.trim()}getDettagliOrdinati(i){return i.task_dettaglio?[...i.task_dettaglio].sort((t,a)=>t.completato&&!a.completato?1:!t.completato&&a.completato?-1:0):[]}static \u0275fac=function(t){return new(t||d)(V(it),V(et),V(kt),V(_t),V(nt),V(at),V(vt),V(tt))};static \u0275cmp=R({type:d,selectors:[["app-task-singola"]],hostBindings:function(t,a){t&1&&u("click",function(){return a.closeDropdown()},H)},decls:23,vars:16,consts:[["nomeCtrl","ngModel"],["assegnazioneCtrl","ngModel"],["tplNessunaSottoTask",""],["ad",""],["stNomeCtrl","ngModel"],["title","Caricamento task...","subtitle","Caricamento contenuti della task in corso...",3,"isLoading"],[1,"task-detail-container"],[1,"form-section"],[1,"section-header"],[1,"section-titles"],[1,"section-title"],[1,"material-icons","header-icon"],["class","table-section",4,"ngIf"],["class","header-actions",4,"ngIf"],["class","status-message error",4,"ngIf"],["class","task-content marcotaskform",4,"ngIf"],["class","modal-backdrop show",3,"click",4,"ngIf"],["class","modal show d-block","tabindex","-1",4,"ngIf"],[1,"table-section"],[1,"text-muted"],[1,"header-actions"],[1,"promethea-button","secondary",3,"click"],[1,"material-icons"],[1,"btn-text"],["class","promethea-button delete",3,"disabled","click",4,"ngIf"],["class","promethea-button edit",3,"disabled","click",4,"ngIf"],[1,"promethea-button","primary",3,"click","disabled"],[1,"promethea-button","delete",3,"click","disabled"],[1,"promethea-button","edit",3,"click","disabled"],[1,"status-message","error"],[1,"task-content","marcotaskform"],[1,"main-section"],[1,"grid-form"],[1,"form-field","full-width"],["for","nome",1,"form-label"],["type","text","id","nome","name","nome","required","","placeholder","Inserisci il nome della task",3,"ngModelChange","ngModel"],[1,"form-field"],["for","data_scadenza",1,"form-label"],["type","date","id","data_scadenza",3,"ngModelChange","ngModel"],["for","stato",1,"form-label"],["type","text","id","stato","disabled","",3,"value"],["for","cliente_id",1,"form-label"],["id","cliente_id",3,"ngModelChange","ngModel"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["for","priorita",1,"form-label"],["id","priorita",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],["for","assegnazione_id",1,"form-label"],["id","assegnazione_id","name","assegnazione_id","required","",3,"ngModelChange","ngModel"],["value","immagine"],["value","digitalizzazione"],["value","contabilita"],["value","ottimizzazione"],["value","tutti"],["value","interna"],["for","note",1,"form-label"],["id","note","rows","4","placeholder","Aggiungi note o descrizione...",3,"ngModelChange","ngModel"],["class","form-actions",4,"ngIf"],[1,"tool",2,"margin-top","var(--gutter-lg)"],["for","search",1,"label"],["id","search","type","text","placeholder","Cerca in sotto-task / dettagli...",1,"table-inline-input",3,"ngModelChange","ngModel"],[1,"counter-container",2,"display","flex","gap","8px","margin-top","8px","flex-wrap","wrap"],[1,"chip"],["class","form-section",4,"ngIf"],[1,"form-section","riepilogo"],[1,"card","info-card"],[1,"info-grid"],[1,"info-item"],[1,"badge",3,"ngClass"],[1,"progress","flex-1"],[1,"progress-bar",3,"ngClass"],[1,"progress-text"],[3,"ngValue"],[1,"form-actions"],[1,"promethea-button",2,"margin-top","var(--gutter-lg)",3,"click","disabled"],[1,"card-number",2,"font-size","var(--fs-md)"],[1,"promethea-button","outline",3,"click","title"],[1,"promethea-button","outline",3,"click"],["class","contenitore-sottotask",4,"ngIf","ngIfElse"],[1,"empty-state"],[1,"contenitore-sottotask"],["class","card sotto-task-card",3,"expanded","dropdown-open",4,"ngFor","ngForOf","ngForTrackBy"],[1,"card","sotto-task-card"],[1,"sotto-task-header",3,"click"],[1,"sotto-task-info"],[1,"icon-btn","expand",3,"click","title"],[1,"sotto-task-content"],[1,"sotto-task-title",3,"innerHTML"],[1,"sotto-task-meta"],[1,"badge"],["class","dettaglio-counter",4,"ngIf"],[1,"sotto-task-actions",3,"click"],["title","Modifica sotto-task",1,"action-btn",3,"click"],["title","Esporta dettagli (copia testo)",1,"action-btn",3,"click"],["mode","modal",3,"action","row"],["dropdown-items","",3,"click"],[4,"ngIf"],[1,"dropdown-item",3,"click"],["class","action-btn","style","cursor: auto;","title","Stato gestito automaticamente dai dettagli",4,"ngIf"],[1,"dettaglio-container"],["class","dettaglio-list",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"dettaglio-counter"],[1,"dropdown-header"],[4,"ngFor","ngForOf"],[1,"dropdown-divider"],["title","Stato gestito automaticamente dai dettagli",1,"action-btn",2,"cursor","auto"],[1,"dettaglio-list"],["class","dettaglio-item",4,"ngFor","ngForOf","ngForTrackBy"],[1,"dettaglio-item"],[1,"dettaglio-content"],["type","checkbox",3,"change","click","mousedown","checked"],[1,"dettaglio-info"],[1,"dettaglio-header"],[3,"innerHTML"],[1,"dettaglio-actions",3,"click"],["title","Modifica dettaglio",1,"icon-btn",3,"click"],["title","Elimina dettaglio",1,"icon-btn","danger",3,"click"],["class","dettaglio-descrizione text-muted",3,"innerHTML","click",4,"ngIf"],[1,"dettaglio-descrizione","text-muted",3,"click","innerHTML"],[3,"click"],[1,"modal-backdrop","show",3,"click"],["tabindex","-1",1,"modal","show","d-block"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Chiudi",1,"icon-btn","close",3,"click"],[1,"modal-body"],["for","stNome",1,"form-label"],["id","stNome","name","stNome","required","","type","text","placeholder","Inserisci nome sotto-task",3,"ngModelChange","ngModel"],["for","stPriorita",1,"form-label"],["id","stPriorita",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button",1,"promethea-button","secondary",3,"click"],["type","button",1,"promethea-button",3,"click"],["for","modificaNome",1,"form-label"],["type","text","id","modificaNome","placeholder","Inserisci il nome della sotto task",3,"ngModelChange","ngModel"],["for","modificaPriorita",1,"form-label"],["id","modificaPriorita",3,"ngModelChange","ngModel"],["value","1"],["value","2"],["value","3"],["value","4"],["value","5"],["for","modificaStato",1,"form-label"],["id","modificaStato",3,"ngModelChange","ngModel"],["value","da_fare"],["value","in_lavorazione"],["value","completato"],["for","dettaglioNome",1,"form-label"],["type","text","id","dettaglioNome","placeholder","Inserisci il nome del dettaglio",3,"ngModelChange","ngModel"],["for","dettaglioDescrizione",1,"form-label"],["id","dettaglioDescrizione","rows","3","placeholder","Aggiungi una descrizione...",3,"ngModelChange","ngModel"],["for","dettaglioScadenza",1,"form-label"],["type","date","id","dettaglioScadenza",3,"ngModelChange","ngModel"],["type","button",1,"promethea-button",3,"click","disabled"],["type","button",1,"icon-btn",3,"click"],["for","nomeTemplate",1,"form-label"],["type","text","id","nomeTemplate","placeholder","Inserisci un nome per il template",3,"ngModelChange","ngModel"],["for","descrizioneTemplate",1,"form-label"],["id","descrizioneTemplate","rows","3","placeholder","Aggiungi una descrizione...",3,"ngModelChange","ngModel"],[1,"form-label"],[1,"template-preview"],["class","sotto-task-preview",4,"ngFor","ngForOf"],[1,"sotto-task-preview"],["class","form-field",4,"ngIf"],[2,"white-space","pre-wrap"]],template:function(t,a){t&1&&(N(0,"app-page-loader",5),o(1,"div",6)(2,"div",7)(3,"div",8)(4,"div",9)(5,"h1",10)(6,"i",11),r(7,"task"),n(),r(8),n(),f(9,bt,3,1,"div",12),n(),f(10,Ct,13,6,"div",13),n()(),f(11,Mt,4,1,"div",14)(12,jt,117,47,"div",15)(13,Ht,1,0,"div",16)(14,Rt,34,9,"div",17)(15,qt,1,0,"div",16)(16,Gt,43,3,"div",17)(17,Kt,1,0,"div",16)(18,Qt,29,7,"div",17)(19,Jt,1,0,"div",16)(20,te,30,8,"div",17)(21,ee,1,0,"div",16)(22,oe,14,1,"div",17),n()),t&2&&(m("isLoading",a.loading&&!a.macroTask),l(8),k(" ",a.macroTask!=null&&a.macroTask.id?"Modifica Task":"Nuova Macro Task"," "),l(),m("ngIf",a.macroTask==null?null:a.macroTask.id),l(),m("ngIf",a.macroTask==null?null:a.macroTask.id),l(),m("ngIf",a.error),l(),m("ngIf",a.macroTask),l(),m("ngIf",a.modals.sottoTask),l(),m("ngIf",a.modals.sottoTask),l(),m("ngIf",a.modals.modificaSottoTask),l(),m("ngIf",a.modals.modificaSottoTask),l(),m("ngIf",a.modals.dettaglio),l(),m("ngIf",a.modals.dettaglio),l(),m("ngIf",a.showTemplateModal),l(),m("ngIf",a.showTemplateModal),l(),m("ngIf",a.modals.leggiDettaglio),l(),m("ngIf",a.modals.leggiDettaglio))},dependencies:[Z,Q,J,X,gt,dt,ct,ot,lt,rt,mt,st,ut,pt,Y],styles:['.section-title[_ngcontent-%COMP%]{margin:0}.header-actions[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:var(--gutter-sm);width:100%;max-width:320px;container-type:inline-size;padding:var(--gutter-md)}@container (max-width: 300px){.header-actions[_ngcontent-%COMP%]{grid-template-columns:1fr;max-width:100%}}@container (min-width: 301px) and (max-width: 500px){.header-actions[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr;max-width:280px}}@container (min-width: 501px){.header-actions[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr;max-width:320px}}.section-header[_ngcontent-%COMP%]{align-items:flex-start;justify-content:space-between;container-type:inline-size;margin:0}.task-detail-container[_ngcontent-%COMP%]{padding:var(--gutter-lg);background:var(--background);min-height:100vh}.task-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:minmax(0,1fr) minmax(260px,350px);gap:var(--gutter-lg);align-items:flex-start}@container (max-width: 600px){.section-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:var(--gutter-md)}.header-actions[_ngcontent-%COMP%]{max-width:100%;justify-self:center}}.header-actions[_ngcontent-%COMP%]   .promethea-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:var(--gutter-sm);padding:var(--gutter-sm) var(--gutter-md);font-size:var(--fs-sm);min-height:2.5rem;white-space:nowrap}@container (max-width: 160px){.header-actions[_ngcontent-%COMP%]   .promethea-button[_ngcontent-%COMP%]   .btn-text[_ngcontent-%COMP%]{display:none}.header-actions[_ngcontent-%COMP%]   .promethea-button[_ngcontent-%COMP%]{padding:var(--gutter-md);min-width:2.5rem}}.main-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-md);min-width:0}.task-card[_ngcontent-%COMP%]{position:relative;border-left:4px solid var(--primary);padding:var(--gutter-lg);gap:var(--gutter-sm);border-radius:18px;display:flex;flex-direction:column;justify-content:space-between;height:100%}.task-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-sm)}.task-card.scaduta[_ngcontent-%COMP%]{border-left-color:#ef4444;background:linear-gradient(135deg,var(--background) 0%,color-mix(in srgb,#ef4444 8%,transparent) 100%)}.task-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:var(--gutter-sm);margin-bottom:var(--gutter-sm);flex-wrap:wrap}.task-main-info[_ngcontent-%COMP%]{flex:1;min-width:0}.task-title[_ngcontent-%COMP%]{cursor:pointer;margin-bottom:var(--gutter-sm)}.task-meta-compact[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.meta-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);color:color-mix(in srgb,var(--text-color) 60%,transparent)}.task-header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);flex-shrink:0;margin-left:auto}.priority-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;min-width:5rem;height:var(--fs-md);padding:0 var(--gutter-sm);border-radius:6px;font-weight:700;border:1px solid var(--smoke-color-1);background:color-mix(in srgb,var(--text-color) 10%,transparent);text-transform:uppercase;letter-spacing:.5px}.priority-badge[data-priority="5"][_ngcontent-%COMP%]{background:linear-gradient(90deg,#6b0218,#a50b1f);color:#fff;border:1px solid rgba(0,0,0,.12);box-shadow:0 6px 16px #a50b1f1f}.priority-badge[data-priority="4"][_ngcontent-%COMP%]{background:linear-gradient(90deg,#ef4444,#c53030);color:#fff;border:1px solid rgba(0,0,0,.08)}.priority-badge[data-priority="3"][_ngcontent-%COMP%]{background:linear-gradient(90deg,#f59e0b,#d97706);color:#1a1a1a;border:1px solid rgba(0,0,0,.06)}.priority-badge[data-priority="2"][_ngcontent-%COMP%]{background:linear-gradient(90deg,#10b981,#059669);color:#fff;border:1px solid rgba(0,0,0,.06)}.priority-badge[data-priority="1"][_ngcontent-%COMP%], .priority-badge[data-priority="0"][_ngcontent-%COMP%], .priority-badge[_ngcontent-%COMP%]:not([data-priority]){background:color-mix(in srgb,var(--text-color) 6%,transparent);color:var(--text-color);border:1px solid var(--smoke-color-1)}.progress-section[_ngcontent-%COMP%]{margin:var(--gutter-sm) 0}.progress-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm)}.progress-stats[_ngcontent-%COMP%]{flex-shrink:0}.scadenza-date[_ngcontent-%COMP%]{font-weight:700;margin-top:var(--gutter-sm)}.task-counts-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-sm);margin:var(--gutter-sm) 0}.count-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:var(--gutter-sm);background:var(--smoke-color-2);border-radius:8px;border:1px solid var(--smoke-color-1)}.count-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:var(--fs-md);height:var(--fs-md);padding:var(--gutter-sm);border-radius:50%;font-weight:700;color:#fff}.count-badge.da-fare[_ngcontent-%COMP%]{background:#42464d}.count-badge.in-lavorazione[_ngcontent-%COMP%]{background:var(--secondary)}.count-badge.completate[_ngcontent-%COMP%]{background:#10b981}.count-label[_ngcontent-%COMP%]{margin-top:4px;text-align:center;color:color-mix(in srgb,var(--text-color) 70%,transparent);text-transform:uppercase;letter-spacing:.5px}.task-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-top:var(--gutter-sm);border-top:1px solid var(--smoke-color-1);margin-top:auto}.sotto-task-card[_ngcontent-%COMP%]{border-left:4px solid var(--primary);display:flex;flex-direction:column;height:100%;container-type:inline-size;min-width:0;position:relative;overflow:visible}.sotto-task-card.expanded[_ngcontent-%COMP%]{box-shadow:0 8px 24px var(--shadow2);border-color:var(--primary)}.sotto-task-card[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]{z-index:50}.sotto-task-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:var(--gutter-sm);margin-bottom:var(--gutter-sm);flex-wrap:wrap;cursor:pointer}.sotto-task-info[_ngcontent-%COMP%]{flex:1 1 auto;min-width:0;display:flex;align-items:flex-start;gap:var(--gutter-sm)}.sotto-task-content[_ngcontent-%COMP%]{flex:1;min-width:0}.sotto-task-meta[_ngcontent-%COMP%]{display:flex;gap:var(--gutter-sm);align-items:center;flex-wrap:wrap;margin-top:.25rem}.sotto-task-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);margin-left:auto;flex:1 1 auto;justify-content:flex-end;flex-wrap:wrap;min-width:0;max-width:100%;position:relative;z-index:2}.dettaglio-container[_ngcontent-%COMP%]{max-height:0;overflow:hidden;opacity:0;transition:max-height .5s cubic-bezier(.4,0,.2,1),opacity .3s ease .1s}.dettaglio-container.show[_ngcontent-%COMP%]{max-height:5000px;opacity:1;transition:max-height .8s cubic-bezier(.4,0,.2,1),opacity .4s ease .1s}.dettaglio-list[_ngcontent-%COMP%]{border-top:1px solid var(--smoke-color-1);padding-top:var(--gutter-sm);display:flex;flex-direction:column;gap:var(--gutter-sm)}.dettaglio-item[_ngcontent-%COMP%]{padding:var(--gutter-sm);background:var(--background);border-radius:10px;border:1px solid var(--smoke-color-1);transition:all .2s ease}.dettaglio-item[_ngcontent-%COMP%]:hover{border-color:var(--primary);background:var(--smoke-color-2)}.dettaglio-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;column-gap:var(--gutter-sm);justify-content:center;align-items:first baseline}.dettaglio-descrizione[_ngcontent-%COMP%]{padding:var(--gutter-sm) 0}.dettaglio-header[_ngcontent-%COMP%]{display:grid;grid-template-columns:minmax(0,1fr) auto auto;align-items:center;gap:var(--gutter-sm)}.dettaglio-header[_ngcontent-%COMP%]   strong.completed[_ngcontent-%COMP%]{text-decoration:line-through;color:color-mix(in srgb,var(--text-color) 50%,transparent)}.dettaglio-counter[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem;font-size:.75rem;color:color-mix(in srgb,var(--text-color) 60%,transparent);background:var(--smoke-color-2);padding:.125rem .5rem;border-radius:12px;border:1px solid var(--smoke-color-1)}.sotto-task-card[_ngcontent-%COMP%]:not(.expanded)   .dettaglio-counter[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--primary) 15%,transparent);color:var(--primary);border-color:color-mix(in srgb,var(--primary) 30%,transparent)}.form-section.riepilogo[_ngcontent-%COMP%]{padding:0;background:transparent;border:none;box-shadow:none;align-self:flex-start;position:sticky;top:var(--gutter-lg)}.contenitore-sottotask[_ngcontent-%COMP%]{gap:var(--gutter-md);display:flex;flex-direction:column}.marcotaskform[_ngcontent-%COMP%]{margin-top:var(--gutter-lg)!important}.info-card[_ngcontent-%COMP%]{background:var(--background);border:1px solid var(--smoke-color-1);border-radius:16px;padding:var(--gutter-lg);box-shadow:0 4px 12px var(--shadow);position:sticky;top:var(--gutter-lg);z-index:10}.info-card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:var(--text-color);margin-bottom:var(--gutter-sm);font-weight:600;border-bottom:2px solid var(--primary);padding-bottom:var(--gutter-sm)}.info-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:var(--gutter-sm);padding:var(--gutter-sm) 0;border-bottom:1px solid color-mix(in srgb,var(--text-color) 15%,transparent)}.info-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.info-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;color:var(--text-color);margin:0}.info-item[_ngcontent-%COMP%]   span.scaduta[_ngcontent-%COMP%]{color:#e74c3c;font-weight:500}.info-item[_ngcontent-%COMP%]   span.imminente[_ngcontent-%COMP%]{color:#f39c12;font-weight:500}.form-section.riepilogo[_ngcontent-%COMP%]{padding:0;background:transparent;border:none;box-shadow:none;align-self:flex-start;position:sticky;top:var(--gutter-lg);z-index:10}.sotto-task-actions[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%], .sotto-task-actions[_ngcontent-%COMP%]   .dropdown[_ngcontent-%COMP%]{flex:0 0 auto}.dropdown[_ngcontent-%COMP%]{position:relative;display:inline-block}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;display:none;min-width:180px;padding:8px 0;margin:4px 0 0;background:var(--background);border:1px solid var(--smoke-color-1);border-radius:8px;box-shadow:0 4px 12px var(--shadow);list-style:none;z-index:10000}.dropdown-menu.show[_ngcontent-%COMP%]{display:block}.dropdown-header[_ngcontent-%COMP%]{padding:var(--gutter-sm);font-weight:800;background:color-mix(in srgb,var(--text-color) 10%,transparent);text-transform:uppercase;border-bottom:1px solid color-mix(in srgb,var(--text-color) 30%,transparent)}.dropdown-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;width:100%;padding:8px 16px;background:transparent;border:none;color:var(--text-color);text-align:left;text-decoration:none;cursor:pointer;transition:all .2s ease;font-size:.85em}.dropdown-item[_ngcontent-%COMP%]:hover{background:var(--smoke-color-2);color:var(--primary)}.dropdown-divider[_ngcontent-%COMP%]{height:1px;background:var(--smoke-color-1);margin:8px 0;border:none}.sotto-task-card.dropdown-open[_ngcontent-%COMP%]{z-index:200}.dettaglio-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm)}.grid-responsive-tasks[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(380px,1fr));display:grid;gap:var(--gutter-lg)}@media (max-width: 1024px){.task-content[_ngcontent-%COMP%]{grid-template-columns:1fr}.form-section.riepilogo[_ngcontent-%COMP%]{position:static;order:-1}}@media (max-width: 768px){.section-header[_ngcontent-%COMP%]{display:flex;flex-direction:column}.contenitore-bottoni[_ngcontent-%COMP%]{display:flex;justify-content:center}.section-title[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center}.sotto-task-header[_ngcontent-%COMP%], .task-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.sotto-task-actions[_ngcontent-%COMP%], .task-header-actions[_ngcontent-%COMP%]{margin-left:0;justify-content:flex-start}.dettaglio-header[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:var(--gutter-sm)}.sotto-tasks-counts[_ngcontent-%COMP%]{grid-template-columns:1fr}.sotto-task-global-actions[_ngcontent-%COMP%]{flex-direction:column;width:100%;margin-top:var(--gutter-sm)}}.search-highlight[_ngcontent-%COMP%], mark.search-highlight[_ngcontent-%COMP%]{display:inline!important;background:#ffeb3b65;padding:0 .12em;border-radius:2px;line-height:inherit;vertical-align:baseline}']})};export{ft as TaskSingola};
