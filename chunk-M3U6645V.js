import{a as xe}from"./chunk-3NIJ5RIV.js";import{a as se,b as ce,d as me,f as de,h as ue,n as pe,o as _e,p as ze,q as ge,r as fe,u as ve}from"./chunk-RJG6IVUB.js";import{b as he}from"./chunk-DJQTFFKQ.js";import"./chunk-KESXA3II.js";import{b as le}from"./chunk-2LFLHQ3L.js";import{c as Z,d as K,e as ee,h as te,i as ie,j as ne,k as oe,n as ae,p as re}from"./chunk-CMIGMSNZ.js";import{Aa as R,Ab as W,Bb as B,Cb as X,Db as D,Ga as Q,La as C,N as H,Wa as p,X as z,Xa as n,Y as g,Ya as o,Za as J,bb as k,cb as O,eb as P,hb as f,ib as m,jb as N,lb as M,nb as r,ob as v,pb as A,qb as F,rb as E,sb as T,tb as I,ua as c,yb as Y}from"./chunk-54AF7LZE.js";import"./chunk-X5YLR3NI.js";import{a as L,b as j,i as V}from"./chunk-ODN5LVDJ.js";var U=class l{DEFAULT_LIMIT=18;parseItalianNumber(t){if(!t||typeof t!="string")return NaN;let e=t.trim().replace(/\s+/g,"");e.indexOf(".")!==-1&&e.indexOf(",")!==-1?e=e.replace(/\./g,"").replace(",","."):e.indexOf(",")!==-1&&e.indexOf(".")===-1?e=e.replace(",","."):e=e.replace(/[^\d\.]/g,"");let a=parseFloat(e);return isFinite(a)?a:NaN}decideKindFromText(t){let e=(t||"").toLowerCase();return/\bcifra\b|\btotale\b/.test(e)?"cifra":/\bpercento\b|\bpercentuale\b|\b%\b|\bsconto\b/.test(e)?"percent":null}decideTargetFromText(t){let e=(t||"").toLowerCase();return/\b(mensil|mensile|mese|mesi)\b/.test(e)?"mensile":/\buna\b.*\btantum\b|\btantum\b/.test(e)?"una_tantum":/\bentrambi\b|\btutto\b|\btotale\b/.test(e)?"entrambi":null}computeForCifra(t,e){let a=Number(t.una||0),s=Number(t.mensile||0)*12;if(a<=0)return{allowed:!1,reason:"Non ci sono voci una tantum su cui applicare una cifra."};if(e<0)return{allowed:!1,reason:"Valore non valido."};let d=(1-e/a)*100;if(!isFinite(d))return{allowed:!1,reason:"Impossibile calcolare la percentuale richiesta."};if(d<0)return{allowed:!1,reason:"La cifra richiesta \xE8 superiore alla quota una tantum attuale; nessuno sconto necessario."};let u=Math.round((e+s)*100)/100;return d>this.DEFAULT_LIMIT?{allowed:!1,candidatePercent:d,producedTotal:u,reason:"limit"}:{allowed:!0,candidatePercent:d,producedTotal:u}}computeForPercent(t,e,a){let i=Number(t.una||0),d=Number(t.mensile||0)*12,u=i+d;if(e<0||!isFinite(e))return{allowed:!1,reason:"Percentuale non valida"};let h=Math.min(100,Math.max(0,e));if(a==="entrambi"){let S=Math.round(u*(1-h/100)*100)/100;return{allowed:h<=this.DEFAULT_LIMIT,candidatePercent:h,producedTotal:S}}if(a==="una_tantum"){if(i<=0)return{allowed:!1,reason:"Non ci sono voci una tantum."};let S=Math.round((i*(1-h/100)+d)*100)/100;return{allowed:h<=this.DEFAULT_LIMIT,candidatePercent:h,producedTotal:S}}if(d<=0)return{allowed:!1,reason:"Non ci sono voci mensili."};let w=Math.round((i+d*(1-h/100))*100)/100;return{allowed:h<=this.DEFAULT_LIMIT,candidatePercent:h,producedTotal:w}}findPercentForDesired(t,e,a,i=this.DEFAULT_LIMIT){if(!t||e<=0)return null;let s=t.una,d=t.mensile*12,u=s+d;if(u<=0)return null;if(a==="entrambi"){let w=(1-e/u)*100;return this.computeForPercent(t,w,a)}if(a==="una_tantum"){if(s<=0)return null;let w=(1-(e-d)/s)*100;return this.computeForPercent(t,w,a)}if(d<=0)return null;let h=(1-(e-s)/d)*100;return this.computeForPercent(t,h,a)}getResponseDelay(t=1400,e=900){return t+Math.floor(Math.random()*e)}static \u0275fac=function(e){return new(e||l)};static \u0275prov=H({token:l,factory:l.\u0275fac,providedIn:"root"})};var ye=(l,t)=>({"user-message":l,"assistance-message":t});function Me(l,t){l&1&&(n(0,"div",30),J(1,"span",31),r(2," Ricerca in corso... "),o())}function we(l,t){if(l&1&&(n(0,"div",32),r(1),o()),l&2){let e=m(2);c(),v(e.searchError)}}function Pe(l,t){if(l&1){let e=P();n(0,"div",35),f("click",function(){let i=z(e).$implicit,s=m(3);return g(s.onSelectProspect(i))}),n(1,"div",36)(2,"div",37)(3,"strong"),r(4),o()(),n(5,"div",38),r(6),o()(),n(7,"div",39),r(8,"\u2795"),o()()}if(l&2){let e=t.$implicit;c(4),v(e.ragione_sociale),c(2),F(" ",e.email||"\u2014"," \u2022 ",e.telefono||"\u2014"," ")}}function Ae(l,t){if(l&1&&(n(0,"div",33),C(1,Pe,9,3,"div",34),W(2,"slice"),o()),l&2){let e=m(2);c(),p("ngForOf",X(2,1,e.searchResults,0,8))}}function Ee(l,t){if(l&1&&(n(0,"div",40)(1,"i",41),r(2,"check_circle"),o(),r(3," Selezionato: "),n(4,"strong"),r(5),o()()),l&2){let e=m(2);c(5),v(e.selectedProspect.ragione_sociale)}}function Te(l,t){l&1&&(n(0,"div",42)(1,"i",41),r(2,"history"),o(),r(3," Modifica configurazione esistente: le variazioni saranno tracciate in storico. "),o())}function Ie(l,t){if(l&1){let e=P();n(0,"section",14)(1,"div",15)(2,"i",16),r(3,"person_search"),o(),n(4,"div",17)(5,"h2",18),r(6,"Seleziona il Prospect"),o()()(),n(7,"div",19)(8,"label",20),r(9,"Cerca Prospect"),o(),n(10,"div",21)(11,"input",22),I("ngModelChange",function(i){z(e);let s=m();return T(s.queryProspect,i)||(s.queryProspect=i),g(i)}),f("input",function(){z(e);let i=m();return g(i.onSearchProspect(i.queryProspect))}),o(),C(12,Me,3,0,"div",23)(13,we,2,1,"div",24)(14,Ae,3,5,"div",25),o(),C(15,Ee,6,1,"div",26)(16,Te,4,0,"div",27),o(),n(17,"div",28)(18,"button",29),f("click",function(){z(e);let i=m();return g(i.avanti())}),r(19," Inizia Configurazione "),o()()()}if(l&2){let e=m();c(11),E("ngModel",e.queryProspect),c(),p("ngIf",e.searchLoading),c(),p("ngIf",e.searchError),c(),p("ngIf",e.searchResults.length),c(),p("ngIf",e.selectedProspect),c(),p("ngIf",e.isModificaConfigurazione),c(),M("blocked",e.searchResults.length),c(),p("disabled",!e.selectedProspect||e.searchLoading)}}function Ve(l,t){l&1&&(k(0),r(1," Creazione del Brand "),O())}function ke(l,t){if(l&1&&(k(0),r(1),O()),l&2){let e=m(2).$implicit;c(),A(" ",e.id==="social_2_post"?"Social Media Base":e.id==="social_3_post"?"Social Media Avanzata":e.id==="social_5_post"?"Social Media Premium":e.nome," ")}}function Oe(l,t){if(l&1&&r(0),l&2){let e=m(2).$implicit;v(e.nome)}}function Ne(l,t){if(l&1&&C(0,ke,2,1,"ng-container",54)(1,Oe,1,1,"ng-template",null,1,D),l&2){let e=N(2),a=m().$implicit;p("ngIf",a.id==null?null:a.id.startsWith("social_"))("ngIfElse",e)}}function Fe(l,t){l&1&&(n(0,"div",43),r(1,"(include logo)"),o())}function De(l,t){l&1&&(n(0,"div",43),r(1,"(2 post/settimana)"),o())}function Re(l,t){l&1&&(n(0,"div",43),r(1,"(3 post/settimana)"),o())}function qe(l,t){l&1&&(n(0,"div",43),r(1,"(5 post/settimana)"),o())}function Le(l,t){if(l&1&&(n(0,"span",60),r(1),o()),l&2){let e=m().$implicit;c(),v(e.pacchetto)}}function We(l,t){if(l&1){let e=P();n(0,"div",52),f("click",function(){let i=z(e).$implicit,s=m(2);return g(s.toggleServizio("immagine_marketing",i))}),n(1,"div",53)(2,"h4"),C(3,Ve,2,0,"ng-container",54)(4,Ne,3,2,"ng-template",null,0,D),o(),C(6,Fe,2,0,"div",55)(7,De,2,0,"div",55)(8,Re,2,0,"div",55)(9,qe,2,0,"div",55),n(10,"div",56),r(11),o()(),n(12,"p",57),r(13),o(),C(14,Le,2,1,"span",58),n(15,"div",59)(16,"i",41),r(17,"check"),o()()()}if(l&2){let e=t.$implicit,a=N(5),i=m(2);M("selezionato",e.selezionato)("disabled",i.isServizioDisabled("immagine_marketing",e)),c(3),p("ngIf",e.id==="creazione_brand")("ngIfElse",a),c(3),p("ngIf",e.id==="creazione_brand"),c(),p("ngIf",e.id==="social_2_post"),c(),p("ngIf",e.id==="social_3_post"),c(),p("ngIf",e.id==="social_5_post"),c(2),v(i.formatPrezzoServizio(e)),c(2),v(e.descrizione),c(),p("ngIf",e.pacchetto),c(),M("attivo",e.selezionato)}}function Ue(l,t){l&1&&(k(0),r(1," Creazione del Brand "),O())}function Be(l,t){if(l&1&&r(0),l&2){let e=m().$implicit;v(e.nome)}}function $e(l,t){l&1&&(n(0,"div",43),r(1,"(Include anche il logo)"),o())}function Ge(l,t){if(l&1){let e=P();n(0,"div",52),f("click",function(){let i=z(e).$implicit,s=m(2);return g(s.toggleServizio("immagine_marketing",i))}),n(1,"div",53)(2,"h4"),C(3,Ue,2,0,"ng-container",54)(4,Be,1,1,"ng-template",null,2,D),o(),C(6,$e,2,0,"div",55),n(7,"div",56),r(8),o()(),n(9,"p",57),r(10),o(),n(11,"div",59)(12,"i",41),r(13,"check"),o()()()}if(l&2){let e=t.$implicit,a=N(5),i=m(2);M("selezionato",e.selezionato),c(3),p("ngIf",e.id==="creazione_brand")("ngIfElse",a),c(3),p("ngIf",e.id==="creazione_brand"),c(2),v(i.formatPrezzoServizio(e)),c(2),v(e.descrizione),c(),M("attivo",e.selezionato)}}function je(l,t){if(l&1){let e=P();n(0,"section",14)(1,"div",15)(2,"i",16),r(3,"brush"),o(),n(4,"div",17)(5,"h2",18),r(6,"Immagine & Marketing"),o(),n(7,"p",43),r(8,"Configura i servizi di branding e comunicazione"),o()()(),n(9,"h3",44),r(10,"Social Media Manager"),o(),n(11,"div",45),C(12,We,18,15,"div",46),o(),n(13,"h3",44),r(14,"Servizi singoli"),o(),n(15,"div",45),C(16,Ge,14,9,"div",47),o(),n(17,"div",48)(18,"div",49)(19,"div"),r(20),o(),n(21,"div"),r(22),o()()(),n(23,"div",28)(24,"button",50),f("click",function(){z(e);let i=m();return g(i.indietro())}),r(25,"Indietro"),o(),n(26,"button",51),f("click",function(){z(e);let i=m();return g(i.avanti())}),r(27,"Continua"),o()()()}if(l&2){let e=m();c(12),p("ngForOf",e.getServiziPacchetto("immagine_marketing")),c(4),p("ngForOf",e.getServiziSingoli("immagine_marketing")),c(4),A("Totale Modulo Una Tantum: ",e.formatCurrency(e.getTotaliModuloSplit("immagine_marketing").una)),c(2),A("Totale Modulo Mensile: ",e.formatCurrency(e.getTotaliModuloSplit("immagine_marketing").mensile))}}function He(l,t){if(l&1&&(n(0,"span",60),r(1),o()),l&2){let e=m().$implicit;c(),v(e.pacchetto)}}function Qe(l,t){if(l&1){let e=P();n(0,"div",52),f("click",function(){let i=z(e).$implicit,s=m(2);return g(s.toggleServizio("digitalizzazione_automatismi",i))}),n(1,"div",53)(2,"h4"),r(3),o(),n(4,"div",56),r(5),o()(),n(6,"p",57),r(7),o(),C(8,He,2,1,"span",58),n(9,"div",59)(10,"i",41),r(11,"check"),o()()()}if(l&2){let e=t.$implicit,a=m(2);M("selezionato",e.selezionato)("disabled",a.isServizioDisabled("digitalizzazione_automatismi",e)),c(3),v(e.nome),c(2),v(a.formatPrezzoServizio(e)),c(2),v(e.descrizione),c(),p("ngIf",e.pacchetto),c(),M("attivo",e.selezionato)}}function Je(l,t){if(l&1){let e=P();n(0,"div",52),f("click",function(){let i=z(e).$implicit,s=m(2);return g(s.toggleServizio("digitalizzazione_automatismi",i))}),n(1,"div",53)(2,"h4"),r(3),o(),n(4,"div",56),r(5),o()(),n(6,"p",57),r(7),o(),n(8,"div",59)(9,"i",41),r(10,"check"),o()()()}if(l&2){let e=t.$implicit,a=m(2);M("selezionato",e.selezionato),c(3),v(e.nome),c(2),v(a.formatPrezzoServizio(e)),c(2),v(e.descrizione),c(),M("attivo",e.selezionato)}}function Ye(l,t){if(l&1){let e=P();n(0,"section",14)(1,"div",15)(2,"i",16),r(3,"memory"),o(),n(4,"div",17)(5,"h2",18),r(6,"Digitalizzazione & Automatismi"),o(),n(7,"p",43),r(8,"Configura i servizi digitali e di automazione"),o()()(),n(9,"h3",44),r(10,"Sito"),o(),n(11,"div",45),C(12,Qe,12,10,"div",46),o(),n(13,"h3",44),r(14,"Servizi singoli"),o(),n(15,"div",45),C(16,Je,11,7,"div",47),o(),n(17,"div",48)(18,"div",49)(19,"div",61)(20,"span",62),r(21,"Totale Modulo Una Tantum"),o(),n(22,"span",63),r(23),o()(),n(24,"div",61)(25,"span",62),r(26,"Totale Modulo Mensile"),o(),n(27,"span",63),r(28),o()()()(),n(29,"div",28)(30,"button",50),f("click",function(){z(e);let i=m();return g(i.indietro())}),r(31,"Indietro"),o(),n(32,"button",51),f("click",function(){z(e);let i=m();return g(i.avanti())}),r(33,"Continua"),o()()()}if(l&2){let e=m();c(12),p("ngForOf",e.getServiziPacchetto("digitalizzazione_automatismi")),c(4),p("ngForOf",e.getServiziSingoli("digitalizzazione_automatismi")),c(7),v(e.formatCurrency(e.getTotaliModuloSplit("digitalizzazione_automatismi").una)),c(5),v(e.formatCurrency(e.getTotaliModuloSplit("digitalizzazione_automatismi").mensile))}}function Xe(l,t){if(l&1){let e=P();n(0,"div",52),f("click",function(){let i=z(e).$implicit,s=m(3);return g(s.isServizioContabilitaAbilitato(i)&&s.toggleServizioContabilita(i))}),n(1,"div",53)(2,"h4",68),r(3),o(),n(4,"div",69),r(5),o()(),n(6,"p",57),r(7),o(),n(8,"div",59)(9,"i",41),r(10,"check"),o()()()}if(l&2){let e=t.$implicit,a=m(3);M("selezionato",e.selezionato)("disabled",!a.isServizioContabilitaAbilitato(e)),c(3),v(e.nome),c(2),A("",e.prezzo," \u20AC"),c(2),v(e.descrizione),c(),M("attivo",e.selezionato)}}function Ze(l,t){if(l&1&&(n(0,"div")(1,"div",98),C(2,Xe,11,9,"div",99),o()()),l&2){let e=m(2);c(2),p("ngForOf",e.getServiziByCategoria("Costituzione"))}}function Ke(l,t){l&1&&(n(0,"span"),r(1," Fino a 90 registrazioni: 1.421\u20AC "),o())}function et(l,t){l&1&&(n(0,"span"),r(1," Fino a 180 registrazioni: 1.811\u20AC "),o())}function tt(l,t){l&1&&(n(0,"span"),r(1," Fino a 360 registrazioni: 2.805\u20AC "),o())}function it(l,t){if(l&1&&(n(0,"span"),r(1),o()),l&2){let e=m(4);c(),F(" Oltre 360 registrazioni: 2.805\u20AC + (",e.configurazioniContabilita.contabilita.registrazioni-360," \xD7 2\u20AC) = ",e.configurazioniContabilita.contabilita.prezzoCalcolato,"\u20AC ")}}function nt(l,t){if(l&1&&(n(0,"div"),C(1,Ke,2,0,"span",70)(2,et,2,0,"span",70)(3,tt,2,0,"span",70)(4,it,2,2,"span",70),o()),l&2){let e=m(3);c(),p("ngIf",e.configurazioniContabilita.contabilita.registrazioni<=90),c(),p("ngIf",e.configurazioniContabilita.contabilita.registrazioni>90&&e.configurazioniContabilita.contabilita.registrazioni<=180),c(),p("ngIf",e.configurazioniContabilita.contabilita.registrazioni>180&&e.configurazioniContabilita.contabilita.registrazioni<=360),c(),p("ngIf",e.configurazioniContabilita.contabilita.registrazioni>360)}}function ot(l,t){l&1&&(n(0,"span"),r(1," Fino a 600 registrazioni: 3.276\u20AC "),o())}function at(l,t){if(l&1&&(n(0,"span"),r(1),o()),l&2){let e=m(4);c(),F(" Oltre 600 registrazioni: 3.276\u20AC + (",e.configurazioniContabilita.contabilita.registrazioni-600," \xD7 3.38\u20AC) = ",e.configurazioniContabilita.contabilita.prezzoCalcolato,"\u20AC ")}}function rt(l,t){if(l&1&&(n(0,"div"),C(1,ot,2,0,"span",70)(2,at,2,2,"span",70),o()),l&2){let e=m(3);c(),p("ngIf",e.configurazioniContabilita.contabilita.registrazioni<=600),c(),p("ngIf",e.configurazioniContabilita.contabilita.registrazioni>600)}}function lt(l,t){l&1&&(n(0,"span"),r(1," Fino a 600 registrazioni: 2.644\u20AC "),o())}function st(l,t){if(l&1&&(n(0,"span"),r(1),o()),l&2){let e=m(4);c(),F(" Oltre 600 registrazioni: 2.644\u20AC + (",e.configurazioniContabilita.contabilita.registrazioni-600," \xD7 3.38\u20AC) = ",e.configurazioniContabilita.contabilita.prezzoCalcolato,"\u20AC ")}}function ct(l,t){if(l&1&&(n(0,"div"),C(1,lt,2,0,"span",70)(2,st,2,2,"span",70),o()),l&2){let e=m(3);c(),p("ngIf",e.configurazioniContabilita.contabilita.registrazioni<=600),c(),p("ngIf",e.configurazioniContabilita.contabilita.registrazioni>600)}}function mt(l,t){if(l&1&&(n(0,"div",40)(1,"strong"),r(2,"Dettaglio calcolo:"),o(),C(3,nt,5,4,"div",70)(4,rt,3,2,"div",70)(5,ct,3,2,"div",70),o()),l&2){let e=m(2);c(3),p("ngIf",e.configurazioniContabilita.contabilita.tipo==="semplificata"),c(),p("ngIf",e.configurazioniContabilita.contabilita.tipo==="ordinaria"),c(),p("ngIf",e.configurazioniContabilita.contabilita.tipo==="mista")}}function dt(l,t){if(l&1){let e=P();n(0,"div",102),f("click",function(i){return z(e),g(i.stopPropagation())}),n(1,"label",103)(2,"span"),r(3,"Quantit\xE0"),o(),n(4,"div",104)(5,"button",105),f("click",function(i){z(e);let s=m(5);return s.configurazioniContabilita.altriServizi.modello770Count=s.Math.max(1,(s.configurazioniContabilita.altriServizi.modello770Count||1)-1),s.calcolaTotali(),g(i.stopPropagation())}),n(6,"i",41),r(7,"remove"),o()(),n(8,"input",106),I("ngModelChange",function(i){z(e);let s=m(5);return T(s.configurazioniContabilita.altriServizi.modello770Count,i)||(s.configurazioniContabilita.altriServizi.modello770Count=i),g(i)}),f("ngModelChange",function(){z(e);let i=m(5);return g(i.calcolaTotali())})("click",function(i){return z(e),g(i.stopPropagation())}),o(),n(9,"button",107),f("click",function(i){z(e);let s=m(5);return s.configurazioniContabilita.altriServizi.modello770Count=(s.configurazioniContabilita.altriServizi.modello770Count||1)+1,s.calcolaTotali(),g(i.stopPropagation())}),n(10,"i",41),r(11,"add"),o()()()()()}if(l&2){let e=m(5);c(8),E("ngModel",e.configurazioniContabilita.altriServizi.modello770Count)}}function ut(l,t){if(l&1){let e=P();n(0,"div",102),f("click",function(i){return z(e),g(i.stopPropagation())}),n(1,"label",103)(2,"span"),r(3,"Quantit\xE0"),o(),n(4,"div",104)(5,"button",105),f("click",function(i){z(e);let s=m(5);return s.configurazioniContabilita.altriServizi.imuCount=s.Math.max(1,(s.configurazioniContabilita.altriServizi.imuCount||1)-1),s.calcolaTotali(),g(i.stopPropagation())}),n(6,"i",41),r(7,"remove"),o()(),n(8,"input",106),I("ngModelChange",function(i){z(e);let s=m(5);return T(s.configurazioniContabilita.altriServizi.imuCount,i)||(s.configurazioniContabilita.altriServizi.imuCount=i),g(i)}),f("ngModelChange",function(){z(e);let i=m(5);return g(i.calcolaTotali())})("click",function(i){return z(e),g(i.stopPropagation())}),o(),n(9,"button",107),f("click",function(i){z(e);let s=m(5);return s.configurazioniContabilita.altriServizi.imuCount=(s.configurazioniContabilita.altriServizi.imuCount||1)+1,s.calcolaTotali(),g(i.stopPropagation())}),n(10,"i",41),r(11,"add"),o()()()()()}if(l&2){let e=m(5);c(8),E("ngModel",e.configurazioniContabilita.altriServizi.imuCount)}}function pt(l,t){if(l&1){let e=P();n(0,"div",102),f("click",function(i){return z(e),g(i.stopPropagation())}),n(1,"label",103)(2,"span"),r(3,"Quantit\xE0"),o(),n(4,"div",104)(5,"button",105),f("click",function(i){z(e);let s=m(5);return s.configurazioniContabilita.altriServizi.locazioniCount=s.Math.max(1,(s.configurazioniContabilita.altriServizi.locazioniCount||1)-1),s.calcolaTotali(),g(i.stopPropagation())}),n(6,"i",41),r(7,"remove"),o()(),n(8,"input",106),I("ngModelChange",function(i){z(e);let s=m(5);return T(s.configurazioniContabilita.altriServizi.locazioniCount,i)||(s.configurazioniContabilita.altriServizi.locazioniCount=i),g(i)}),f("ngModelChange",function(){z(e);let i=m(5);return g(i.calcolaTotali())})("click",function(i){return z(e),g(i.stopPropagation())}),o(),n(9,"button",107),f("click",function(i){z(e);let s=m(5);return s.configurazioniContabilita.altriServizi.locazioniCount=(s.configurazioniContabilita.altriServizi.locazioniCount||1)+1,s.calcolaTotali(),g(i.stopPropagation())}),n(10,"i",41),r(11,"add"),o()()()()()}if(l&2){let e=m(5);c(8),E("ngModel",e.configurazioniContabilita.altriServizi.locazioniCount)}}function _t(l,t){if(l&1){let e=P();n(0,"div",102),f("click",function(i){return z(e),g(i.stopPropagation())}),n(1,"label",103)(2,"span"),r(3,"Quantit\xE0"),o(),n(4,"div",104)(5,"button",105),f("click",function(i){z(e);let s=m(5);return s.configurazioniContabilita.altriServizi.smartCardRilascioCount=s.Math.max(1,(s.configurazioniContabilita.altriServizi.smartCardRilascioCount||1)-1),s.calcolaTotali(),g(i.stopPropagation())}),n(6,"i",41),r(7,"remove"),o()(),n(8,"input",106),I("ngModelChange",function(i){z(e);let s=m(5);return T(s.configurazioniContabilita.altriServizi.smartCardRilascioCount,i)||(s.configurazioniContabilita.altriServizi.smartCardRilascioCount=i),g(i)}),f("ngModelChange",function(){z(e);let i=m(5);return g(i.calcolaTotali())})("click",function(i){return z(e),g(i.stopPropagation())}),o(),n(9,"button",107),f("click",function(i){z(e);let s=m(5);return s.configurazioniContabilita.altriServizi.smartCardRilascioCount=(s.configurazioniContabilita.altriServizi.smartCardRilascioCount||1)+1,s.calcolaTotali(),g(i.stopPropagation())}),n(10,"i",41),r(11,"add"),o()()()()()}if(l&2){let e=m(5);c(8),E("ngModel",e.configurazioniContabilita.altriServizi.smartCardRilascioCount)}}function zt(l,t){if(l&1&&(n(0,"div"),C(1,dt,12,1,"div",101)(2,ut,12,1,"div",101)(3,pt,12,1,"div",101)(4,_t,12,1,"div",101),o()),l&2){let e=m().$implicit;c(),p("ngIf",e.id==="altro_modello_770"),c(),p("ngIf",e.id==="altro_imu_dichiarazione"),c(),p("ngIf",e.id==="altro_locazioni"),c(),p("ngIf",e.id==="altro_smart_card_rilascio")}}function gt(l,t){if(l&1){let e=P();n(0,"div",52),f("click",function(){let i=z(e).$implicit,s=m(3);return g(s.toggleServizioContabilita(i))}),n(1,"div",53)(2,"h4"),r(3),o(),n(4,"div",56),r(5),o()(),n(6,"p",57),r(7),o(),C(8,zt,5,4,"div",70),n(9,"div",59)(10,"i",41),r(11,"check"),o()()()}if(l&2){let e=t.$implicit,a=m(3);M("selezionato",e.selezionato),c(3),v(e.nome),c(2),v(a.formatPrezzoServizio(e)),c(2),v(e.descrizione),c(),p("ngIf",e.selezionato),c(),M("attivo",e.selezionato)}}function ft(l,t){if(l&1&&(n(0,"div",100),C(1,gt,12,8,"div",47),o()),l&2){let e=m(2);c(),p("ngForOf",e.getServiziByCategoria("Altri Servizi"))}}function vt(l,t){if(l&1){let e=P();n(0,"section",14)(1,"div",15)(2,"i",16),r(3,"calculate"),o(),n(4,"div",17)(5,"h2",18),r(6,"Contabilit\xE0 e Fiscalit\xE0"),o(),n(7,"p",43),r(8,"Configura i servizi contabili e fiscali in base alle tue esigenze"),o()()(),n(9,"div",64)(10,"div",65)(11,"div",66)(12,"div",67),f("click",function(){z(e);let i=m();return g(i.toggleServizioContabilita(i.moduli.contabilita_fiscalita.servizi[0]))}),n(13,"div",68)(14,"div",53)(15,"h3",18),r(16,"Costituzione Azienda"),o(),n(17,"div",69),r(18,"Configurabile"),o()()(),n(19,"p",57),r(20,"Servizi di costituzione aziendale - Seleziona per attivare i servizi specifici"),o(),n(21,"div",59)(22,"i",41),r(23,"check"),o()()(),C(24,Ze,3,1,"div",70),o()(),n(25,"div",65)(26,"div",19)(27,"div",68)(28,"h3",18),r(29,"Contabilit\xE0"),o(),n(30,"div",56),r(31),o()(),n(32,"div",71)(33,"button",72),f("click",function(i){return z(e),m().toggleService("contabilita_fiscalita","contabilita_principale",!0),g(i.stopPropagation())}),n(34,"i",41),r(35),o()()(),n(36,"div",73)(37,"div",74)(38,"label",20),r(39,"Tipo di Contabilit\xE0:"),o(),n(40,"select",75),I("ngModelChange",function(i){z(e);let s=m();return T(s.configurazioniContabilita.contabilita.tipo,i)||(s.configurazioniContabilita.contabilita.tipo=i),g(i)}),f("change",function(){z(e);let i=m();return g(i.calcolaPrezzoContabilita())}),n(41,"option",76),r(42,"Seleziona"),o(),n(43,"option",77),r(44,"Semplificata"),o(),n(45,"option",78),r(46,"Ordinaria"),o(),n(47,"option",79),r(48,"Mista"),o()(),n(49,"div",80),r(50),o()(),n(51,"div",74)(52,"label",20),r(53,"Numero Registrazioni Annuali:"),o(),n(54,"input",81),I("ngModelChange",function(i){z(e);let s=m();return T(s.configurazioniContabilita.contabilita.registrazioni,i)||(s.configurazioniContabilita.contabilita.registrazioni=i),g(i)}),f("change",function(){z(e);let i=m();return g(i.calcolaPrezzoContabilita())}),o()()(),C(55,mt,6,3,"div",26),o()(),n(56,"div",65)(57,"div",19)(58,"div",68)(59,"h3",18),r(60,"Fatturazione"),o(),n(61,"div",56),r(62),o()(),n(63,"div",71)(64,"button",72),f("click",function(i){return z(e),m().toggleService("contabilita_fiscalita","fatturazione_principale",!0),g(i.stopPropagation())}),n(65,"i",41),r(66),o()()(),n(67,"div",73)(68,"div",74)(69,"label",20),r(70,"Tipo di Fatturazione:"),o(),n(71,"select",75),I("ngModelChange",function(i){z(e);let s=m();return T(s.configurazioniContabilita.fatturazione.tipo,i)||(s.configurazioniContabilita.fatturazione.tipo=i),g(i)}),f("change",function(){z(e);let i=m();return g(i.calcolaPrezzoFatturazione())}),n(72,"option",76),r(73,"Seleziona"),o(),n(74,"option",82),r(75,"Emissione da parte nostra (25\u20AC/fattura)"),o(),n(76,"option",83),r(77,"Piattaforma PassCom (4\u20AC/fattura)"),o()()(),n(78,"div",74)(79,"label",20),r(80,"Numero Fatture Annuali:"),o(),n(81,"input",84),I("ngModelChange",function(i){z(e);let s=m();return T(s.configurazioniContabilita.fatturazione.numeroFatture,i)||(s.configurazioniContabilita.fatturazione.numeroFatture=i),g(i)}),f("change",function(){z(e);let i=m();return g(i.calcolaPrezzoFatturazione())}),o()()()()(),n(82,"div",65)(83,"div",19)(84,"div",68)(85,"h3",18),r(86,"IVA"),o(),n(87,"div",56),r(88),o()(),n(89,"div",71)(90,"button",72),f("click",function(i){return z(e),m().toggleService("contabilita_fiscalita","iva_principale",!0),g(i.stopPropagation())}),n(91,"i",41),r(92),o()()(),n(93,"div",73)(94,"div",74)(95,"label",20),r(96,"Liquidazione IVA:"),o(),n(97,"select",75),I("ngModelChange",function(i){z(e);let s=m();return T(s.configurazioniContabilita.iva.liquidazione,i)||(s.configurazioniContabilita.iva.liquidazione=i),g(i)}),f("change",function(){z(e);let i=m();return g(i.calcolaPrezzoIVA())}),n(98,"option",76),r(99,"Seleziona"),o(),n(100,"option",85),r(101,"Trimestrale"),o(),n(102,"option",86),r(103,"Mensile"),o()()(),n(104,"div",74)(105,"label",20),r(106,"LIPE:"),o(),n(107,"select",75),I("ngModelChange",function(i){z(e);let s=m();return T(s.configurazioniContabilita.iva.lipe,i)||(s.configurazioniContabilita.iva.lipe=i),g(i)}),f("change",function(){z(e);let i=m();return g(i.calcolaPrezzoIVA())}),n(108,"option",85),r(109,"Trimestrale"),o(),n(110,"option",86),r(111,"Mensile"),o()()(),n(112,"div",74)(113,"label",20),r(114,"Volume d'Affari per Dichiarazione Annuale:"),o(),n(115,"select",75),I("ngModelChange",function(i){z(e);let s=m();return T(s.configurazioniContabilita.iva.volumeAffari,i)||(s.configurazioniContabilita.iva.volumeAffari=i),g(i)}),f("change",function(){z(e);let i=m();return g(i.calcolaPrezzoIVA())}),n(116,"option",87),r(117,"Fino a 75.000\u20AC"),o(),n(118,"option",88),r(119,"75.001-150.000\u20AC"),o(),n(120,"option",89),r(121,"150.001-300.000\u20AC"),o(),n(122,"option",90),r(123,"300.001-500.000\u20AC"),o(),n(124,"option",91),r(125,"500.001-750.000\u20AC"),o(),n(126,"option",92),r(127,"Oltre 750.000\u20AC"),o()()(),n(128,"div",93)(129,"label")(130,"input",94),I("ngModelChange",function(i){z(e);let s=m();return T(s.configurazioniContabilita.iva.vistoConformita,i)||(s.configurazioniContabilita.iva.vistoConformita=i),g(i)}),f("change",function(){z(e);let i=m();return g(i.calcolaPrezzoIVA())}),o(),r(131," Visto di Conformit\xE0 "),o()(),n(132,"div",93)(133,"label")(134,"input",94),I("ngModelChange",function(i){z(e);let s=m();return T(s.configurazioniContabilita.iva.modelloIVATR,i)||(s.configurazioniContabilita.iva.modelloIVATR=i),g(i)}),f("change",function(){z(e);let i=m();return g(i.calcolaPrezzoIVA())}),o(),r(135," Modello IVA TR "),o()(),n(136,"div",93)(137,"label")(138,"input",94),I("ngModelChange",function(i){z(e);let s=m();return T(s.configurazioniContabilita.iva.intrastat,i)||(s.configurazioniContabilita.iva.intrastat=i),g(i)}),f("change",function(){z(e);let i=m();return g(i.calcolaPrezzoIVA())}),o(),r(139," Intrastat "),o()()()()(),n(140,"div",65)(141,"h3",95)(142,"span"),r(143,"Altri Servizi"),o(),n(144,"button",96),f("click",function(i){return z(e),m().toggleAltriServizi(),g(i.stopPropagation())}),n(145,"i",41),r(146),o()()(),C(147,ft,2,1,"div",97),o()(),n(148,"div",48)(149,"div",49)(150,"div",61)(151,"span",62),r(152,"Totale Modulo Una Tantum"),o(),n(153,"span",63),r(154),o()(),n(155,"div",61)(156,"span",62),r(157,"Totale Modulo Mensile"),o(),n(158,"span",63),r(159),o()()()(),n(160,"div",28)(161,"button",50),f("click",function(){z(e);let i=m();return g(i.indietro())}),r(162,"Indietro"),o(),n(163,"button",51),f("click",function(){z(e);let i=m();return g(i.avanti())}),r(164,"Continua"),o()()()}if(l&2){let e=m();c(12),M("active",e.configurazioniContabilita.costituzione.attivo),c(9),M("attivo",e.configurazioniContabilita.costituzione.attivo),c(3),p("ngIf",e.configurazioniContabilita.costituzione.attivo),c(7),A("",e.configurazioniContabilita.contabilita.prezzoCalcolato," \u20AC"),c(2),p("title",e.isServiceSelected("contabilita_fiscalita","contabilita_principale")?"Rimuovi servizio":"Aggiungi servizio"),c(2),A(" ",e.isServiceSelected("contabilita_fiscalita","contabilita_principale")?"remove_circle_outline":"add_circle"," "),c(5),E("ngModel",e.configurazioniContabilita.contabilita.tipo),c(10),A(" ",e.getDescrizioneContabilita(e.configurazioniContabilita.contabilita.tipo)," "),c(4),E("ngModel",e.configurazioniContabilita.contabilita.registrazioni),c(),p("ngIf",e.configurazioniContabilita.contabilita.prezzoCalcolato>0),c(7),A("",e.configurazioniContabilita.fatturazione.prezzoCalcolato," \u20AC"),c(2),p("title",e.isServiceSelected("contabilita_fiscalita","fatturazione_principale")?"Rimuovi servizio":"Aggiungi servizio"),c(2),A(" ",e.isServiceSelected("contabilita_fiscalita","fatturazione_principale")?"remove_circle_outline":"add_circle"," "),c(5),E("ngModel",e.configurazioniContabilita.fatturazione.tipo),c(10),E("ngModel",e.configurazioniContabilita.fatturazione.numeroFatture),c(7),A("",e.configurazioniContabilita.iva.prezzoCalcolato," \u20AC"),c(2),p("title",e.isServiceSelected("contabilita_fiscalita","iva_principale")?"Rimuovi servizio":"Aggiungi servizio"),c(2),A(" ",e.isServiceSelected("contabilita_fiscalita","iva_principale")?"remove_circle_outline":"add_circle"," "),c(5),E("ngModel",e.configurazioniContabilita.iva.liquidazione),c(10),E("ngModel",e.configurazioniContabilita.iva.lipe),c(8),E("ngModel",e.configurazioniContabilita.iva.volumeAffari),c(15),E("ngModel",e.configurazioniContabilita.iva.vistoConformita),c(4),E("ngModel",e.configurazioniContabilita.iva.modelloIVATR),c(4),E("ngModel",e.configurazioniContabilita.iva.intrastat),c(8),v(e.showAltriServizi?"expand_less":"expand_more"),c(),p("ngIf",e.showAltriServizi),c(7),v(e.formatCurrency(e.getTotaliModuloSplit("contabilita_fiscalita").una)),c(5),v(e.formatCurrency(e.getTotaliModuloSplit("contabilita_fiscalita").mensile))}}function ht(l,t){if(l&1&&(n(0,"span",60),r(1),o()),l&2){let e=m().$implicit;c(),v(e.pacchetto)}}function xt(l,t){if(l&1){let e=P();n(0,"div",52),f("click",function(){let i=z(e).$implicit,s=m(2);return g(s.toggleServizio("ottimizzazione_management",i))}),n(1,"div",53)(2,"h4"),r(3),o(),n(4,"div",56),r(5),o()(),n(6,"p",57),r(7),o(),C(8,ht,2,1,"span",58),n(9,"div",59)(10,"i",41),r(11,"check"),o()()()}if(l&2){let e=t.$implicit,a=m(2);M("selezionato",e.selezionato)("disabled",a.isServizioDisabled("ottimizzazione_management",e)),c(3),v(e.nome),c(2),v(a.formatPrezzoServizio(e)),c(2),v(e.descrizione),c(),p("ngIf",e.pacchetto),c(),M("attivo",e.selezionato)}}function Ct(l,t){if(l&1&&(n(0,"span",60),r(1),o()),l&2){let e=m().$implicit;c(),v(e.pacchetto)}}function bt(l,t){if(l&1){let e=P();n(0,"div",52),f("click",function(){let i=z(e).$implicit,s=m(2);return g(s.toggleServizio("ottimizzazione_management",i))}),n(1,"div",53)(2,"h4"),r(3),o(),n(4,"div",56),r(5),o()(),n(6,"p",57),r(7),o(),C(8,Ct,2,1,"span",58),n(9,"div",59)(10,"i",41),r(11,"check"),o()()()}if(l&2){let e=t.$implicit,a=m(2);M("selezionato",e.selezionato)("disabled",a.isServizioDisabled("ottimizzazione_management",e)),c(3),v(e.nome),c(2),v(a.formatPrezzoServizio(e)),c(2),v(e.descrizione),c(),p("ngIf",e.pacchetto),c(),M("attivo",e.selezionato)}}function St(l,t){if(l&1){let e=P();n(0,"div",52),f("click",function(){let i=z(e).$implicit,s=m(2);return g(s.toggleServizio("ottimizzazione_management",i))}),n(1,"div",53)(2,"h4"),r(3),o(),n(4,"div",56),r(5),o()(),n(6,"p",57),r(7),o(),n(8,"div",59)(9,"i",41),r(10,"check"),o()()()}if(l&2){let e=t.$implicit,a=m(2);M("selezionato",e.selezionato),c(3),v(e.nome),c(2),v(a.formatPrezzoServizio(e)),c(2),v(e.descrizione),c(),M("attivo",e.selezionato)}}function yt(l,t){if(l&1){let e=P();n(0,"section",14)(1,"div",15)(2,"i",16),r(3,"tune"),o(),n(4,"div",17)(5,"h2",18),r(6,"Ottimizzazione e Management"),o(),n(7,"p",43),r(8,"Configura i servizi di ottimizzazione"),o()()(),n(9,"h3",44),r(10,"Pacchetti \u2014 Consulenze di Impresa"),o(),n(11,"div",45),C(12,xt,12,10,"div",99),o(),n(13,"h3",44),r(14,"Pacchetti \u2014 Formazione Commerciale"),o(),n(15,"div",45),C(16,bt,12,10,"div",99),o(),n(17,"h3",44),r(18,"Servizi singoli"),o(),n(19,"div",45),C(20,St,11,7,"div",47),o(),n(21,"div",48)(22,"div",49)(23,"div",61)(24,"span",62),r(25,"Totale Modulo Una Tantum"),o(),n(26,"span",63),r(27),o()(),n(28,"div",61)(29,"span",62),r(30,"Totale Modulo Mensile"),o(),n(31,"span",63),r(32),o()()()(),n(33,"div",28)(34,"button",50),f("click",function(){z(e);let i=m();return g(i.indietro())}),r(35,"Indietro"),o(),n(36,"button",51),f("click",function(){z(e);let i=m();return g(i.avanti())}),r(37,"Vedi Riepilogo"),o()()()}if(l&2){let e=m();c(12),p("ngForOf",e.getPacchettiConsulenza()),c(4),p("ngForOf",e.getPacchettiFormazione()),c(4),p("ngForOf",e.getServiziSingoli("ottimizzazione_management")),c(7),v(e.formatCurrency(e.getTotaliModuloSplit("ottimizzazione_management").una)),c(5),v(e.formatCurrency(e.getTotaliModuloSplit("ottimizzazione_management").mensile))}}function Mt(l,t){if(l&1&&(n(0,"div",40)(1,"i",41),r(2,"business"),o(),r(3," Prospect: "),n(4,"strong"),r(5),o()()),l&2){let e=m(2);c(5),v(e.selectedProspect.ragione_sociale)}}function wt(l,t){if(l&1&&(n(0,"div",124)(1,"div",125)(2,"span",126),r(3,"\u2713"),o(),n(4,"span",127),r(5),o()(),n(6,"div",128),r(7),o()()),l&2){let e=t.$implicit,a=m(3);c(5),v(e.nome),c(2),v(a.formatPrezzoServizio(e))}}function Pt(l,t){if(l&1&&(n(0,"div",19)(1,"h2",68),r(2,"Immagine & Marketing"),o(),n(3,"div",73),C(4,wt,8,2,"div",122),o(),n(5,"div",49)(6,"div",61)(7,"span",123),r(8,"Totale Modulo Una Tantum"),o(),n(9,"span",63),r(10),o()(),n(11,"div",61)(12,"span",123),r(13,"Totale Modulo Mensile"),o(),n(14,"span",63),r(15),o()()()()),l&2){let e=m(2);c(4),p("ngForOf",e.getServiziSelezionatiModulo("immagine_marketing")),c(6),v(e.formatCurrency(e.getTotaliModuloSplit("immagine_marketing").una)),c(5),v(e.formatCurrency(e.getTotaliModuloSplit("immagine_marketing").mensile))}}function At(l,t){if(l&1&&(k(0),r(1),O()),l&2){let e=m().$implicit,a=m(3);c(),A(" ",a.formatCurrency(a.num(e.prezzo||0))," ")}}function Et(l,t){if(l&1&&r(0),l&2){let e=m().$implicit,a=m(3);A(" ",a.formatPrezzoServizio(e)," ")}}function Tt(l,t){if(l&1&&(n(0,"div",124)(1,"div",125)(2,"span",133),r(3,"\u2713"),o(),n(4,"span",127),r(5,"Software Personalizzato Mantenimento"),o()(),n(6,"div",128),r(7),o()()),l&2){let e=m().$implicit,a=m(3);c(7),A(" ",a.formatCurrency(a.num(e.prezzo_mensile??e.prezzoMensile))," /mese ")}}function It(l,t){if(l&1&&(n(0,"div",130)(1,"div",124)(2,"div",125)(3,"span",131),r(4,"\u2713"),o(),n(5,"span",127),r(6),o()(),n(7,"div",128),C(8,At,2,1,"ng-container",54)(9,Et,1,1,"ng-template",null,5,D),o()(),C(11,Tt,8,1,"div",132),o()),l&2){let e=t.$implicit,a=N(10),i=m(3);c(6),v(e.nome),c(2),p("ngIf",e.id==="software_personalizzato")("ngIfElse",a),c(3),p("ngIf",e.id==="software_personalizzato"&&i.num(e.prezzo_mensile??e.prezzoMensile)>0)}}function Vt(l,t){if(l&1&&(n(0,"div",19)(1,"h2",68),r(2,"Digitalizzazione & Automatismi"),o(),n(3,"div",73),C(4,It,12,4,"div",129),o(),n(5,"div",49)(6,"div",61)(7,"span",123),r(8,"Totale Modulo Una Tantum"),o(),n(9,"span",63),r(10),o()(),n(11,"div",61)(12,"span",123),r(13,"Totale Modulo Mensile"),o(),n(14,"span",63),r(15),o()()()()),l&2){let e=m(2);c(4),p("ngForOf",e.getServiziSelezionatiModulo("digitalizzazione_automatismi")),c(6),v(e.formatCurrency(e.getTotaliModuloSplit("digitalizzazione_automatismi").una)),c(5),v(e.formatCurrency(e.getTotaliModuloSplit("digitalizzazione_automatismi").mensile))}}function kt(l,t){if(l&1&&(k(0),n(1,"span"),r(2),o(),n(3,"span",135),r(4,"\xD7"),o(),n(5,"strong"),r(6),o(),n(7,"span",136),r(8),o(),O()),l&2){let e=m().$implicit,a=m(3);c(2),v(a.formatPrezzoServizio(e)),c(4),v(a.getAltriServiziCountFor(e.id)),c(2),A("= ",a.formatCurrency((e.prezzo||0)*a.getAltriServiziCountFor(e.id)))}}function Ot(l,t){if(l&1&&r(0),l&2){let e=m().$implicit,a=m(3);A(" ",a.formatPrezzoServizio(e)," ")}}function Nt(l,t){if(l&1&&(n(0,"div",124)(1,"div",125)(2,"span",134),r(3,"\u2713"),o(),n(4,"span",127),r(5),o()(),n(6,"div",128),C(7,kt,9,3,"ng-container",54)(8,Ot,1,1,"ng-template",null,6,D),o()()),l&2){let e=t.$implicit,a=N(9),i=m(3);c(5),v(e.nome),c(2),p("ngIf",i.isAltriServiziCounted(e.id))("ngIfElse",a)}}function Ft(l,t){if(l&1&&(n(0,"div",19)(1,"h2",68),r(2,"Contabilit\xE0 e Fiscalit\xE0"),o(),n(3,"div",73),C(4,Nt,10,3,"div",122),o(),n(5,"div",49)(6,"div",61)(7,"span",123),r(8,"Totale Modulo Una Tantum"),o(),n(9,"span",63),r(10),o()(),n(11,"div",61)(12,"span",123),r(13,"Totale Modulo Mensile"),o(),n(14,"span",63),r(15),o()()()()),l&2){let e=m(2);c(4),p("ngForOf",e.getServiziSelezionatiModulo("contabilita_fiscalita")),c(6),v(e.formatCurrency(e.getTotaliModuloSplit("contabilita_fiscalita").una)),c(5),v(e.formatCurrency(e.getTotaliModuloSplit("contabilita_fiscalita").mensile))}}function Dt(l,t){if(l&1&&(n(0,"div",124)(1,"div",125)(2,"span",137),r(3,"\u2713"),o(),n(4,"span",127),r(5),o()(),n(6,"div",128),r(7),o()()),l&2){let e=t.$implicit,a=m(3);c(5),v(e.nome),c(2),v(a.formatPrezzoServizio(e))}}function Rt(l,t){if(l&1&&(n(0,"div",19)(1,"h2",68),r(2,"Ottimizzazione e Management"),o(),n(3,"div",73),C(4,Dt,8,2,"div",122),o(),n(5,"div",49)(6,"div",61)(7,"span",123),r(8,"Totale Modulo Una Tantum"),o(),n(9,"span",63),r(10),o()(),n(11,"div",61)(12,"span",123),r(13,"Totale Modulo Mensile"),o(),n(14,"span",63),r(15),o()()()()),l&2){let e=m(2);c(4),p("ngForOf",e.getServiziSelezionatiModulo("ottimizzazione_management")),c(6),v(e.formatCurrency(e.getTotaliModuloSplit("ottimizzazione_management").una)),c(5),v(e.formatCurrency(e.getTotaliModuloSplit("ottimizzazione_management").mensile))}}function qt(l,t){if(l&1&&(k(0),n(1,"span",138),r(2),o(),n(3,"strong",139),r(4),o(),n(5,"span"),r(6,"/mese"),o(),O()),l&2){let e=m(2);c(2),v(e.formatCurrency(e.totaleMensile)),c(2),v(e.formatCurrency(e.totaleMensileScontato))}}function Lt(l,t){if(l&1&&(n(0,"span",140),r(1),o(),n(2,"span"),r(3,"/mese"),o()),l&2){let e=m(2);c(),v(e.formatCurrency(e.totaleMensile))}}function Wt(l,t){if(l&1&&(k(0),n(1,"span",138),r(2),o(),n(3,"strong",139),r(4),o(),O()),l&2){let e=m(2);c(2),v(e.formatCurrency(e.totaleUnaTantum)),c(2),v(e.formatCurrency(e.totaleUnaScontata))}}function Ut(l,t){if(l&1&&(n(0,"span"),r(1),o()),l&2){let e=m(2);c(),v(e.formatCurrency(e.totaleUnaTantum))}}function Bt(l,t){if(l&1&&(k(0),n(1,"div",141)(2,"small",142),r(3),W(4,"number"),o()(),O()),l&2){let e=m(2);c(3),F("(sconto ",B(4,2,e.scontoPercentuale,"1.2-2"),"% \u2014 target: ",e.scontoTarget,")")}}function $t(l,t){if(l&1){let e=P();n(0,"button",143),f("click",function(){z(e);let i=m(2);return g(i.salvaConfigurazione())}),n(1,"i",41),r(2,"save"),o(),r(3," Salva Configurazione "),o()}}function Gt(l,t){if(l&1&&(n(0,"span",153),r(1),o()),l&2){let e=m(3);c(),F(" ",e.scontoPercentuale,"% - Risparmio: ",e.formatCurrency(e.totaleGenerale-e.totaleScontato)," ")}}function jt(l,t){l&1&&(n(0,"span",142),r(1," In attesa di valutazione / da confermare "),o())}function Ht(l,t){if(l&1){let e=P();n(0,"button",50),f("click",function(){z(e);let i=m(3);return g(i.apriChatSconto())}),n(1,"span",41),r(2,"support_agent"),o(),r(3," Richiedi Sconto "),o()}}function Qt(l,t){if(l&1){let e=P();n(0,"button",115),f("click",function(){z(e);let i=m(3);return i.applySconto(0),g(i.salvaConfigurazione())}),n(1,"span",41),r(2,"close"),o(),r(3," Rimuovi Sconto "),o()}}function Jt(l,t){if(l&1&&(n(0,"span"),r(1),o()),l&2){let e=m(3);c(),v(e.formatCurrency(e.totaleScontato))}}function Yt(l,t){if(l&1&&(n(0,"span"),r(1),o()),l&2){let e=m(3);c(),v(e.formatCurrency(e.totaleGenerale))}}function Xt(l,t){if(l&1&&(n(0,"div",74)(1,"label",20),r(2,"Totale non scontato"),o(),n(3,"div",154),r(4),o()()),l&2){let e=m(3);c(4),v(e.formatCurrency(e.totaleGenerale))}}function Zt(l,t){if(l&1&&(n(0,"div",8)(1,"h3",18)(2,"span",41),r(3,"local_offer"),o(),r(4," Gestione Sconto "),o(),n(5,"div",73)(6,"div",74)(7,"label",20),r(8,"Sconto Applicato"),o(),n(9,"div",144),C(10,Gt,2,2,"span",145)(11,jt,2,0,"span",146),o()(),n(12,"div",74)(13,"label",20),r(14,"Azioni"),o(),n(15,"div",147),C(16,Ht,4,0,"button",148)(17,Qt,4,0,"button",149),o()()(),n(18,"div",150)(19,"div",73)(20,"div",74)(21,"label",20),r(22,"Totale Preventivo"),o(),n(23,"div",151),C(24,Jt,2,1,"span",70)(25,Yt,2,1,"span",70),o()(),C(26,Xt,5,1,"div",152),o()()()),l&2){let e=m(2);c(10),p("ngIf",e.scontoPercentuale>0),c(),p("ngIf",e.scontoPercentuale===0),c(5),p("ngIf",!e.mostraChatSconto),c(),p("ngIf",e.scontoPercentuale>0),c(7),p("ngIf",e.scontoPercentuale>0),c(),p("ngIf",e.scontoPercentuale===0),c(),p("ngIf",e.scontoPercentuale>0)}}function Kt(l,t){l&1&&(n(0,"span",41),r(1,"support_agent"),o())}function ei(l,t){l&1&&(n(0,"span",41),r(1,"person"),o())}function ti(l,t){if(l&1&&(n(0,"div",165)(1,"div",166),C(2,Kt,2,0,"span",167)(3,ei,2,0,"span",167),o(),n(4,"div",168)(5,"div",60),r(6),o(),n(7,"div",142),r(8),W(9,"date"),o()()()),l&2){let e=t.$implicit;p("ngClass",Y(8,ye,e.autore==="utente",e.autore==="assistenza")),c(2),p("ngIf",e.autore==="assistenza"),c(),p("ngIf",e.autore==="utente"),c(3),v(e.testo),c(2),v(B(9,5,e.timestamp,"HH:mm"))}}function ii(l,t){if(l&1){let e=P();n(0,"div",155)(1,"div",156)(2,"div",157)(3,"h3",158)(4,"span",41),r(5,"support_agent"),o(),r(6),o(),n(7,"button",159),f("click",function(){z(e);let i=m(2);return g(i.chiudiChatSconto())}),o()(),n(8,"div",160)(9,"div",161),C(10,ti,10,11,"div",162),o(),n(11,"div",163)(12,"input",164),I("ngModelChange",function(i){z(e);let s=m(2);return T(s.messaggioChat,i)||(s.messaggioChat=i),g(i)}),f("keyup.enter",function(){z(e);let i=m(2);return g(i.inviaMessaggio())}),o(),n(13,"button",29),f("click",function(){z(e);let i=m(2);return g(i.inviaMessaggio())}),n(14,"span",41),r(15,"send"),o()()()()()()}if(l&2){let e=m(2);c(6),A(" Assistenza Preventivo \xB7 ",(e.selectedProspect==null?null:e.selectedProspect.ragione_sociale)||"Cliente"," "),c(4),p("ngForOf",e.messaggiAssistenza),c(2),E("ngModel",e.messaggioChat),c(),p("disabled",!e.messaggioChat.trim())}}function ni(l,t){if(l&1){let e=P();n(0,"section",108)(1,"div",15)(2,"i",16),r(3,"receipt_long"),o(),n(4,"div",17)(5,"h2",18),r(6,"Riepilogo Configurazione"),o()()(),n(7,"div"),C(8,Mt,6,1,"div",26),n(9,"div",45),C(10,Pt,16,3,"div",109)(11,Vt,16,3,"div",109)(12,Ft,16,3,"div",109)(13,Rt,16,3,"div",109),o(),n(14,"div",110)(15,"h3",111)(16,"div",112)(17,"div")(18,"span",113),r(19,"Totale mensile:"),o(),C(20,qt,7,2,"ng-container",54)(21,Lt,4,1,"ng-template",null,3,D),o(),n(23,"div")(24,"span",113),r(25,"Totale una tantum:"),o(),C(26,Wt,5,2,"ng-container",54)(27,Ut,2,1,"ng-template",null,4,D),o()(),C(29,Bt,5,5,"ng-container",70),o()()(),n(30,"div",114)(31,"button",115),f("click",function(){z(e);let i=m();return g(i.indietro())}),n(32,"span",41),r(33,"edit"),o(),r(34,"Modifica "),o(),n(35,"button",116),f("click",function(){z(e);let i=m();return g(i.apriChatSconto())}),n(36,"span",41),r(37,"support_agent"),o(),r(38,"Assistenza "),o(),n(39,"button",117),f("click",function(){z(e);let i=m();return g(i.visualizzaPreventivo())}),n(40,"span",41),r(41,"description"),o(),r(42," Visualizza Preventivo "),o(),C(43,$t,4,0,"button",118),n(44,"button",119),f("click",function(){z(e);let i=m();return g(i.procediPerFirme())}),n(45,"i",41),r(46,"assignment_turned_in"),o(),r(47),o()(),C(48,Zt,27,7,"div",120)(49,ii,16,4,"div",121),o()}if(l&2){let e=N(22),a=N(28),i=m();c(8),p("ngIf",i.selectedProspect),c(2),p("ngIf",i.getServiziSelezionatiModulo("immagine_marketing").length>0||i.moduli.immagine_marketing.totale>0),c(),p("ngIf",i.getServiziSelezionatiModulo("digitalizzazione_automatismi").length>0||i.moduli.digitalizzazione_automatismi.totale>0),c(),p("ngIf",i.getServiziSelezionatiModulo("contabilita_fiscalita").length>0||i.moduli.contabilita_fiscalita.totale>0),c(),p("ngIf",i.getServiziSelezionatiModulo("ottimizzazione_management").length>0||i.moduli.ottimizzazione_management.totale>0),c(7),p("ngIf",i.scontoPercentuale>0&&(i.scontoTarget==="mensile"||i.scontoTarget==="entrambi"))("ngIfElse",e),c(6),p("ngIf",i.scontoPercentuale>0&&(i.scontoTarget==="una_tantum"||i.scontoTarget==="entrambi"))("ngIfElse",a),c(3),p("ngIf",i.scontoPercentuale>0),c(14),p("ngIf",!i.isCliente),c(),p("disabled",!i.selectedProspect||i.totaleGenerale===0),c(3),A(" ",i.isProspect?"Procedi per le Firme":"Aggiorna Configurazione"," "),c(),p("ngIf",i.currentStep===6&&(i.mostraChatSconto||i.scontoPercentuale>0)),c(),p("ngIf",i.mostraChatSconto)}}function oi(l,t){if(l&1){let e=P();n(0,"div",124)(1,"div",125)(2,"strong"),r(3),o(),n(4,"div",175),r(5),o()(),n(6,"div",176)(7,"button",177),f("click",function(){let i=z(e).index,s=m(3);return g(s.rimuoviNominativo(i))}),n(8,"i",41),r(9,"delete"),o()()()()}if(l&2){let e=t.$implicit;c(3),v(e.nome),c(2),F(" ",e.telefono||"\u2014"," \u2022 ",e.email||"\u2014"," ")}}function ai(l,t){if(l&1&&(n(0,"div",174)(1,"h3",18),r(2),o(),n(3,"div",73),C(4,oi,10,3,"div",122),o()()),l&2){let e=m(2);c(2),A("Nominativi Inseriti (",e.nominativi.length,")"),c(2),p("ngForOf",e.nominativi)}}function ri(l,t){if(l&1){let e=P();n(0,"section",14)(1,"h2"),r(2,"Inserisci i Nominativi Ottenuti"),o(),n(3,"p",43),r(4,"Aggiungi i contatti ottenuti dalla trattativa. Saranno creati come nuovi prospect."),o(),n(5,"div",169)(6,"div",73)(7,"div",74)(8,"label",20),r(9,"Nome completo *"),o(),n(10,"input",170),I("ngModelChange",function(i){z(e);let s=m();return T(s.nuovoNominativo.nome,i)||(s.nuovoNominativo.nome=i),g(i)}),o()(),n(11,"div",74)(12,"label",20),r(13,"Telefono"),o(),n(14,"input",171),I("ngModelChange",function(i){z(e);let s=m();return T(s.nuovoNominativo.telefono,i)||(s.nuovoNominativo.telefono=i),g(i)}),o()(),n(15,"div",74)(16,"label",20),r(17,"Email"),o(),n(18,"input",172),I("ngModelChange",function(i){z(e);let s=m();return T(s.nuovoNominativo.email,i)||(s.nuovoNominativo.email=i),g(i)}),o()()(),n(19,"div",28)(20,"button",51),f("click",function(){z(e);let i=m();return g(i.aggiungiNominativo())}),n(21,"i",41),r(22,"add"),o(),r(23," Aggiungi Nominativo "),o()()(),C(24,ai,5,2,"div",173),n(25,"div",28)(26,"button",50),f("click",function(){z(e);let i=m();return i.pendingFirmeProcess=!1,g(i.indietro())}),r(27,"Indietro"),o(),n(28,"button",29),f("click",function(){z(e);let i=m();return g(i.procediPerFirme())}),r(29,"Procedi"),o()()()}if(l&2){let e=m();c(10),E("ngModel",e.nuovoNominativo.nome),c(4),E("ngModel",e.nuovoNominativo.telefono),c(4),E("ngModel",e.nuovoNominativo.email),c(6),p("ngIf",e.nominativi.length>0),c(4),p("disabled",!e.selectedProspect)}}var Ce=class l{constructor(t,e,a,i,s,d){this.soggettiService=t;this.alchemizzatoreService=e;this.router=a;this.route=i;this.supabaseService=s;this.assistenzaService=d}currentStep=1;totaleSteps=7;scontoPercentuale=0;scontoTarget="entrambi";mostraChatSconto=!1;messaggioChat="";messaggiAssistenza=[];richiedendoSconto=!1;baseAssistDelay=1400;assistJitter=900;pendingCifraRequest=null;totaleMensile=0;totaleUnaTantum=0;totaleMensileScontato=0;totaleUnaScontata=0;showContabilitaChildren=!0;showAltriServizi=!1;queryProspect="";searchResults=[];searchLoading=!1;searchError=null;selectedProspect=null;nominativi=[];nuovoNominativo={nome:"",telefono:"",email:""};pendingFirmeProcess=!1;ANNUAL_TO_MONTHLY_IDS=new Set(["contabilita_principale","fatturazione_principale","iva_principale"]);currentConfigurazioneId=null;previousConfigurazione=null;configurazioneCorrenteId=null;moduli={immagine_marketing:{nome:"Immagine & Marketing",servizi:[{id:"creazione_logo",nome:"Creazione del Logo",prezzo:300,selezionato:!1,descrizione:"Design professionale del logo aziendale"},{id:"creazione_brand",nome:"Creazione del Brand",prezzo:800,selezionato:!1,descrizione:"Identit\xE0 visiva completa: logo, palette colori, typography"},{id:"social_2_post",nome:"Gestione Social Media (2 post/settimana)",prezzo:400,selezionato:!1,pacchetto:"base",descrizione:"2 post settimanali su Facebook e Instagram"},{id:"social_3_post",nome:"Gestione Social Media (3 post/settimana)",prezzo:600,selezionato:!1,pacchetto:"avanzato",descrizione:"3 post settimanali su Facebook, Instagram e LinkedIn"},{id:"social_5_post",nome:"Gestione Social Media (5 post/settimana)",prezzo:800,selezionato:!1,pacchetto:"premium",descrizione:"5 post settimanali su tutti i social + stories"},{id:"servizio_fotografico",nome:"Servizio Fotografico",prezzo:500,selezionato:!1,descrizione:"Servizio fotografico professionale per prodotti/azienda"}],totale:0},digitalizzazione_automatismi:{nome:"Digitalizzazione & Automatismi",servizi:[{id:"landing_page",nome:"Landing Page",prezzo:1e3,selezionato:!1,pacchetto:"base",descrizione:"Pagina di destinazione ottimizzata per conversioni"},{id:"sito_completo",nome:"Sito Web Completo",prezzo:2e3,selezionato:!1,pacchetto:"avanzato",descrizione:"Sito web responsive"},{id:"sito_pro",nome:"Sito Web Pro",prezzo:3500,selezionato:!1,pacchetto:"premium",descrizione:"Sito web avanzato con funzionalit\xE0 personalizzate"},{id:"software_personalizzato",nome:"Software Personalizzato",prezzo:0,selezionato:!1,descrizione:"Richiesta di valutazione per software su misura"},{id:"consulenza_digitale",nome:"Consulenza Digitale",prezzo:300,selezionato:!1,descrizione:"Consulenza per mailing list, automazioni e digital strategy"}],totale:0},contabilita_fiscalita:{nome:"Contabilit\xE0 e Fiscalit\xE0",servizi:[{id:"costituzione_principale",nome:"Costituzione Azienda",prezzo:0,selezionato:!1,categoria:"Costituzione",descrizione:"Servizi di costituzione aziendale - Seleziona per attivare i servizi specifici",tipo:"gruppo"},{id:"cost_assic_redazione",nome:"Assistenza redazione atto costitutivo e Statuto",prezzo:150,selezionato:!1,categoria:"Costituzione",descrizione:"Assistenza redazione atto costitutivo e Statuto (oltre costo notaio e spese accessorie notaio)",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_apertura_piva",nome:"Apertura partita IVA",prezzo:100,selezionato:!1,categoria:"Costituzione",descrizione:"Apertura partita IVA",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_cciaa_no_scia",nome:"Pratica CCIAA senza SCIA",prezzo:80,selezionato:!1,categoria:"Costituzione",descrizione:"Pratica CCIAA per comunicazione attivit\xE0 (senza SCIA) - oltre accessorie (30 Euro diritti CCIAA)",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_cciaa_con_scia",nome:"Pratica CCIAA con SCIA",prezzo:200,selezionato:!1,categoria:"Costituzione",descrizione:"Pratica CCIAA per comunicazione attivit\xE0 (con SCIA al Comune) - oltre accessorie (30 Euro diritti CCIAA)",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_cciaa_scia_plus",nome:"Pratica CCIAA con SCIA plus",prezzo:250,selezionato:!1,categoria:"Costituzione",descrizione:"Pratica CCIAA per comunicazione attivit\xE0 (con SCIA al Comune e plus) - oltre accessorie",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_inps_artigiani",nome:"INPS art/comm",prezzo:50,selezionato:!1,categoria:"Costituzione",descrizione:"INPS artigiani commercianti (soci lavoratori) - per ciascuno",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_inps_gest_separata",nome:"INPS gestione separata",prezzo:80,selezionato:!1,categoria:"Costituzione",descrizione:"INPS gestione separata (P.IVA individuale e amministratori) - per ciascuno",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_vidimazione_libri",nome:"Vidimazione libri sociali",prezzo:20,selezionato:!1,categoria:"Costituzione",descrizione:"Vidimazione libri sociali (oltre accessori) - per libro",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_registrazione_verbali",nome:"Registrazione verbali",prezzo:100,selezionato:!1,categoria:"Costituzione",descrizione:"Registrazione verbali - oltre accessori",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"contabilita_principale",nome:"Servizi di Contabilit\xE0",prezzo:0,selezionato:!1,categoria:"Contabilit\xE0",descrizione:"Seleziona il tipo di contabilit\xE0 e inserisci il numero di registrazioni annuali",tipo:"configurabile"},{id:"fatturazione_principale",nome:"Servizi di Fatturazione",prezzo:0,selezionato:!1,categoria:"Fatturazione",descrizione:"Configura i servizi di fatturazione in base alle tue esigenze",tipo:"configurabile"},{id:"iva_principale",nome:"Servizi IVA",prezzo:0,selezionato:!1,categoria:"IVA",descrizione:"Configura i servizi IVA in base alla tua periodicit\xE0",tipo:"configurabile"},{id:"redditi_principale",nome:"Dichiarazione Redditi",prezzo:0,selezionato:!1,categoria:"Redditi",descrizione:"Configura la dichiarazione redditi in base al tipo di soggetto e volume d'affari",tipo:"configurabile"},{id:"bilancio_principale",nome:"Bilancio",prezzo:0,selezionato:!1,categoria:"Bilancio",descrizione:"Configura il servizio di bilancio in base alle tue esigenze",tipo:"configurabile"},{id:"altro_cu_autonomi",nome:"CU autonomi (fino a 5 percipienti)",prezzo:180,selezionato:!1,categoria:"Altri Servizi",descrizione:"CU per autonomi - fino a 5 percipienti",tipo:"fisso"},{id:"altro_modello_770",nome:"Modello 770",prezzo:100,selezionato:!1,categoria:"Altri Servizi",descrizione:"Modello 770 - autonomi e capitali - una tantum/anno",tipo:"fisso"},{id:"altro_f24_12",nome:"F24 (fino a 12/anno)",prezzo:300,selezionato:!1,categoria:"Altri Servizi",descrizione:"F24 - fino a 12 pagamenti/anno",tipo:"fisso"},{id:"altro_imu_dichiarazione",nome:"Dichiarazione IMU/ILIA",prezzo:60,selezionato:!1,categoria:"Altri Servizi",descrizione:"Dichiarazione IMU/ILIA",tipo:"fisso"},{id:"altro_imu_verifica",nome:"Verifica Esatto/calcolo IMU",prezzo:40,selezionato:!1,categoria:"Altri Servizi",descrizione:"Verifica Esatto/calcolo IMU",tipo:"fisso"},{id:"altro_imu_pagamento",nome:"Pagamento IMU a scadenza",prezzo:25,selezionato:!1,categoria:"Altri Servizi",descrizione:"Pagamento IMU a scadenza",tipo:"fisso"},{id:"altro_avvisi_bonari",nome:"Autotutela avvisi bonari",prezzo:70,selezionato:!1,categoria:"Altri Servizi",descrizione:"Autotutela avvisi bonari",tipo:"fisso"},{id:"altro_locazioni",nome:"Supporto contratti locazione",prezzo:180,selezionato:!1,categoria:"Altri Servizi",descrizione:"Supporto nella predisposizione e registrazione contratti locazione",tipo:"fisso"},{id:"altro_lettere_intento",nome:"Invio lettere d'intento",prezzo:85,selezionato:!1,categoria:"Altri Servizi",descrizione:"Invio lettere d'intento - per ciascuna",tipo:"fisso"},{id:"altro_smart_card_rilascio",nome:"Rilascio Smart Card",prezzo:60,selezionato:!1,categoria:"Altri Servizi",descrizione:"Rilascio Smart Card - per ciascuna",tipo:"fisso"},{id:"altro_smart_card_conservazione",nome:"Conservazione Smart Card",prezzo:30,selezionato:!1,categoria:"Altri Servizi",descrizione:"Conservazione Smart Card - annuale",tipo:"fisso"},{id:"altro_titolare_effettivo",nome:"Invio pratica titolare effettivo",prezzo:130,selezionato:!1,categoria:"Altri Servizi",descrizione:"Invio pratica titolare effettivo - prezzo medio",tipo:"fisso"},{id:"altro_visure_online",nome:"Visura ordinaria",prezzo:20,selezionato:!1,categoria:"Altri Servizi",descrizione:"Visura ordinaria",tipo:"fisso"},{id:"altro_chiamate_consulenza",nome:"Chiamate per consulenza",prezzo:300,selezionato:!1,categoria:"Altri Servizi",descrizione:"Chiamate per consulenza - una tantum",tipo:"fisso"},{id:"altro_gestione_pec",nome:"Gestione PEC mensile",prezzo:16,selezionato:!1,categoria:"Altri Servizi",descrizione:"Gestione mensile PEC",tipo:"fisso"}],totale:0},ottimizzazione_management:{nome:"Ottimizzazione e Management",servizi:[{id:"consulenza_impresa_base",nome:"Consulenza di Impresa Base",prezzo:800,selezionato:!1,pacchetto:"base",descrizione:"Analisi iniziale e piano di miglioramento base"},{id:"consulenza_impresa_avanzata",nome:"Consulenza di Impresa Avanzata",prezzo:1500,selezionato:!1,pacchetto:"avanzato",descrizione:"Consulenza strategica con piano d'azione dettagliato"},{id:"consulenza_impresa_premium",nome:"Consulenza di Impresa Premium",prezzo:2500,selezionato:!1,pacchetto:"premium",descrizione:"Consulenza completa con supporto continuativo"},{id:"formazione_commerciale_base",nome:"Formazione Commerciale Base",prezzo:600,selezionato:!1,pacchetto:"base",descrizione:"Corso base di tecniche di vendita"},{id:"formazione_commerciale_avanzata",nome:"Formazione Commerciale Avanzata",prezzo:1200,selezionato:!1,pacchetto:"avanzato",descrizione:"Formazione avanzata con simulazioni pratiche"},{id:"formazione_commerciale_premium",nome:"Formazione Commerciale Premium",prezzo:2e3,selezionato:!1,pacchetto:"premium",descrizione:"Programma completo con coaching individuale"}],totale:0}};totaleGenerale=0;Math=Math;ngOnInit(){return V(this,null,function*(){let e=this.router.getCurrentNavigation()?.extras?.state||history?.state||{},a=e?.prospect,i=this.route.snapshot.queryParamMap,s=a?.id||i.get("prospectId"),d=Number(e?.goToStep||i.get("step"))||0;if(a?.id)this.selectedProspect=a;else if(s)try{let{data:h,error:w}=yield this.soggettiService.getSoggettoById(s);!w&&h&&(this.selectedProspect=h)}catch{}s&&(yield this.loadConfigurazioneEsistente(s),this.currentStep=d&&d>=1&&d<=this.totaleSteps?d:6);let u=this.route.snapshot.queryParamMap.get("focusConfig");u&&this.openConfigurazioneById(u)})}openConfigurazioneById(t){return V(this,null,function*(){if(t)try{let e=yield this.alchemizzatoreService.getConfigurazioneById(t),a=e.data;if(e.error||!a){console.warn("Configurazione non trovata:",e.error);return}this.configurazioneCorrenteId=a.id??null,this.currentConfigurazioneId=this.configurazioneCorrenteId;let i=a.dettagli??{};this.applyConfigurazioneDettagli(i),this.previousConfigurazione=this.deepClone(i),this.calcolaTotali(),this.updateTotaleGeneraleFromDetails(),this.updateTotaliSplitFromConfig();let s=a.prospect_id??a.prospectId;if(s&&(!this.selectedProspect||this.selectedProspect.id!==s))try{let d=yield this.soggettiService.getSoggettoById(s);!d.error&&d.data&&(this.selectedProspect=d.data,this.queryProspect=this.selectedProspect?.ragione_sociale??"")}catch(d){console.warn("Impossibile caricare prospect per configurazione:",d)}this.currentStep=6}catch(e){console.error("Errore in openConfigurazioneById:",e)}})}loadConfigurazioneEsistente(t){return V(this,null,function*(){let{data:e,error:a}=yield this.alchemizzatoreService.getConfigurazioniByProspect(t);if(a||!Array.isArray(e)||e.length===0)return;let i=[...e].sort((d,u)=>new Date(u.updated_at||u.created_at||u.data_configurazione||0).getTime()-new Date(d.updated_at||d.created_at||d.data_configurazione||0).getTime())[0];this.configurazioneCorrenteId=i.id??null,this.currentConfigurazioneId=this.configurazioneCorrenteId;let s=i?.dettagli||{};this.applyConfigurazioneDettagli(s),this.previousConfigurazione=this.deepClone(s),this.calcolaTotali()})}applyConfigurazioneDettagli(t){if(!t)return;let e=t&&t.meta?t.meta:null;e&&(this.scontoTarget=e.scontoTarget??this.scontoTarget);let a=["immagine_marketing","digitalizzazione_automatismi","contabilita_fiscalita","ottimizzazione_management"],i=0,s=!1;for(let d of a){let u=t[d];if(!u){this.moduli[d].servizi.forEach(_=>_.selezionato=!1),this.moduli[d].totale=0;continue}let h=Array.isArray(u.servizi_selezionati)?u.servizi_selezionati:Array.isArray(u.servizi)?u.servizi:[],w=new Set(h.map(_=>typeof _=="string"?_:_?.id).filter(Boolean));if(d==="contabilita_fiscalita"&&this.configurazioniContabilita){let _={contabilita_principale:"contabilita",fatturazione_principale:"fatturazione",iva_principale:"iva",redditi_principale:"redditi",bilancio_principale:"bilancio"};h.forEach(b=>{let y=typeof b=="string"?b:b?.id;if(!y)return;let q=_[y];if(!q)return;let $=Number(b?.prezzo??0),G=Number(b?.prezzo_mensile??0);$>0?this.configurazioniContabilita[q].prezzoCalcolato=$:G>0&&(this.configurazioniContabilita[q].prezzoCalcolato=Math.round(G*12*100)/100)});let x=this.configurazioniContabilita.altriServizi||{};h.forEach(b=>{let y=b?.id;y&&(y==="altro_modello_770"&&typeof b.quantita<"u"&&(x.modello770Count=Number(b.quantita)||x.modello770Count),y==="altro_imu_dichiarazione"&&typeof b.quantita<"u"&&(x.imuCount=Number(b.quantita)||x.imuCount),y==="altro_locazioni"&&typeof b.quantita<"u"&&(x.locazioniCount=Number(b.quantita)||x.locazioniCount),y==="altro_smart_card_rilascio"&&typeof b.quantita<"u"&&(x.smartCardRilascioCount=Number(b.quantita)||x.smartCardRilascioCount))}),this.configurazioniContabilita.altriServizi=x}if(this.moduli[d].servizi.forEach(_=>{_.selezionato=w.has(_.id);let x=h.find(b=>typeof b=="string"?b===_.id:b?.id===_.id);x&&typeof x.prezzo<"u"&&(_.prezzo=Number(x.prezzo)||0),x&&typeof x.prezzo_mensile<"u"&&(_.prezzo_mensile=Number(x.prezzo_mensile)||0),d==="contabilita_fiscalita"&&(_.aggiuntoManualmente=!!_.selezionato)}),typeof u.totale<"u"&&u.totale!==null){let _=Number(u.totale)||0;this.moduli[d].totale=Math.round(_*100)/100,i+=this.moduli[d].totale,s=!0;continue}if(h.length>0){let _=h.reduce((x,b)=>x+(Number(b?.prezzo)||0),0);if(_>0){this.moduli[d].totale=Math.round(_*100)/100,i+=this.moduli[d].totale;continue}}let S=this.moduli[d].servizi.filter(_=>_.selezionato).reduce((_,x)=>_+(Number(x.prezzo)||0),0);this.moduli[d].totale=Math.round(S*100)/100,this.moduli[d].totale>0&&(i+=this.moduli[d].totale)}if(e){let d=Number(e.totaleOriginale??e.totaleGenerale??i)||0;this.totaleGenerale=Math.round(d*100)/100,this.scontoPercentuale=Number(e.scontoPercentuale??0)||0,i===0&&this.calcolaTotali()}else this.calcolaTotali();this.previousConfigurazione=this.deepClone(t),this.updateTotaliSplitFromConfig()}avanti(){if(this.currentStep===1&&!this.selectedProspect){alert("Seleziona un prospect prima di procedere.");return}this.currentStep<this.totaleSteps&&this.currentStep++}indietro(){this.currentStep>1&&this.currentStep--}vaiAStep(t){if(t>=1&&t<=this.totaleSteps){if(!this.selectedProspect&&t>1){alert("Seleziona un prospect prima di navigare agli altri step.");return}this.currentStep=t}}onSearchProspect(t){return V(this,null,function*(){if(this.searchError=null,!t?.trim()){this.searchResults=[];return}this.searchLoading=!0;try{let[e,a]=yield Promise.all([this.soggettiService.searchSoggetti(t,"prospect"),this.soggettiService.searchSoggetti(t,"cliente")]),i=e.data??[],s=a.data??[],d=Array.from(new Map([...i,...s].map(u=>[u.id,u])).values());this.searchResults=d}catch(e){console.error("Errore durante la ricerca soggetti",e),this.searchError="Errore durante la ricerca"}finally{this.searchLoading=!1}})}get isModificaConfigurazione(){return!!(this.selectedProspect?.tipo==="cliente"&&this.configurazioneCorrenteId)}onSelectProspect(t){return V(this,null,function*(){if(this.searchResults=[],this.queryProspect=t.ragione_sociale??"",!t.tipo){let{data:e}=yield this.soggettiService.getSoggettoById(t.id);e&&(t=e)}if(this.selectedProspect=t,this.queryProspect=t.ragione_sociale??"",this.searchResults=[],t.tipo==="cliente"){let{data:e}=yield this.supabaseService.getUltimaConfigurazionePromethea(t.id);if(e){this.configurazioneCorrenteId=e.id??null,this.currentConfigurazioneId=this.configurazioneCorrenteId,this.applyConfigurazioneDettagli(e.dettagli),this.previousConfigurazione=this.deepClone(e.dettagli??{});return}}this.configurazioneCorrenteId=null,this.currentConfigurazioneId=null,this.previousConfigurazione=null,yield this.loadConfigurazioneEsistente(t.id)})}toggleServizio(t,e){let a=this.moduli[t],i=!e.selezionato;if(t==="digitalizzazione_automatismi"&&i&&["landing_page","sito_completo","sito_pro"].includes(e.id)&&a.servizi.forEach(s=>{["landing_page","sito_completo","sito_pro"].includes(s.id)&&s.id!==e.id&&(s.selezionato=!1)}),t==="ottimizzazione_management"&&i&&e.id.startsWith("consulenza_impresa_")&&a.servizi.forEach(s=>{s.id.startsWith("consulenza_impresa_")&&s.id!==e.id&&(s.selezionato=!1)}),t==="ottimizzazione_management"&&i&&e.id.startsWith("formazione_commerciale_")&&a.servizi.forEach(s=>{s.id.startsWith("formazione_commerciale_")&&s.id!==e.id&&(s.selezionato=!1)}),i&&t==="immagine_marketing"){if(e.id.startsWith("social_")&&a.servizi.forEach(s=>{s.id.startsWith("social_")&&s.id!==e.id&&(s.selezionato=!1)}),e.id==="creazione_brand"){let s=a.servizi.find(d=>d.id==="creazione_logo");s&&(s.selezionato=!1)}else if(e.id==="creazione_logo"){let s=a.servizi.find(d=>d.id==="creazione_brand");s&&(s.selezionato=!1)}}if(i&&e.pacchetto){let s=e.id.split("_"),d=s.length>=2?`${s[0]}_${s[1]}`:s[0];a.servizi.forEach(u=>{if(u.pacchetto===e.pacchetto&&u.id!==e.id){let h=u.id.split("_");(h.length>=2?`${h[0]}_${h[1]}`:h[0])===d&&(u.selezionato=!1)}})}e.selezionato=i,this.calcolaTotali()}calcolaDifferenze(t,e){let a={},i=["immagine_marketing","digitalizzazione_automatismi","contabilita_fiscalita","ottimizzazione_management"],s=d=>d?(Array.isArray(d.servizi_selezionati)?d.servizi_selezionati:Array.isArray(d.servizi)?d.servizi:[]).map(h=>typeof h=="string"?h:h?.id).filter(h=>!!h):[];return i.forEach(d=>{let u=new Set(s(t?.[d])),h=new Set(s(e?.[d])),w=[...u].filter(_=>!h.has(_)),S=[...h].filter(_=>!u.has(_));(w.length||S.length)&&(a[d]={aggiunti:w,rimossi:S})}),a}isServizioDisabled(t,e){return e.pacchetto?this.moduli[t].servizi.filter(s=>s.pacchetto===e.pacchetto&&s.id!==e.id&&s.selezionato).length>0:!1}buildDettagliConfigurazione(){let t={};return Object.keys(this.moduli).forEach(e=>{let a=this.moduli[e],i=a.servizi.filter(_=>_.selezionato).map(_=>L({id:_.id,nome:_.nome,prezzo:Number(_.prezzo??0),pacchetto:_.pacchetto??null,descrizione:_.descrizione??null},typeof _.prezzo_mensile<"u"&&_.prezzo_mensile!==null?{prezzo_mensile:Number(_.prezzo_mensile)}:{})),s=this.previousConfigurazione&&this.previousConfigurazione[e]?Array.isArray(this.previousConfigurazione[e].servizi_selezionati)?this.previousConfigurazione[e].servizi_selezionati:[]:[],d=new Map;i.forEach(_=>{d.set(_.id,L({},_))}),s.forEach(_=>{let x=(_?.id??"").toString();if(!x||!d.has(x))return;let b=d.get(x)||{},y=j(L({},b),{nome:b.nome??_.nome??null,prezzo:typeof b.prezzo<"u"?Number(b.prezzo):Number(_.prezzo??0),pacchetto:typeof b.pacchetto<"u"?b.pacchetto:typeof _.pacchetto<"u"?_.pacchetto:null,descrizione:b.descrizione??_.descrizione??null});typeof _.prezzo_mensile<"u"&&typeof y.prezzo_mensile>"u"&&(y.prezzo_mensile=Number(_.prezzo_mensile||0)),typeof _.quantita<"u"&&typeof y.quantita>"u"&&(y.quantita=Number(_.quantita||0)),typeof _.prezzo_unitario<"u"&&typeof y.prezzo_unitario>"u"&&(y.prezzo_unitario=Number(_.prezzo_unitario||0)),d.set(x,y)});let u=Array.from(d.values()),h=this.configurazioniContabilita||{},w={contabilita_principale:"contabilita",fatturazione_principale:"fatturazione",iva_principale:"iva",redditi_principale:"redditi",bilancio_principale:"bilancio"};u.forEach(_=>{if(_.id&&w[_.id]){let b=w[_.id],y=Number(h[b]?.prezzoCalcolato)||0;y>0?(_.prezzo=0,_.prezzo_mensile=this.monthlyPrice(y),_.note="prezzo_calcolato_configurazione"):_.prezzo=Number(_.prezzo||0)}if(["altro_modello_770","altro_imu_dichiarazione","altro_locazioni","altro_smart_card_rilascio"].includes(_.id)){let b=this.getAltriServiziCountFor(_.id)||1,y=Number(_.prezzo||0);_.quantita=b,_.prezzo_unitario=y,_.prezzo=Math.round(y*b*100)/100}if(_.id==="software_personalizzato"&&(_.prezzo=Number(_.prezzo||0),typeof _.prezzo_mensile>"u"&&this.previousConfigurazione&&this.previousConfigurazione[e])){let b=(this.previousConfigurazione[e].servizi_selezionati||[]).find(y=>y.id==="software_personalizzato");b&&typeof b.prezzo_mensile<"u"&&(_.prezzo_mensile=Number(b.prezzo_mensile)||0)}});let S=0;if(u.length>0){let _=u.reduce((x,b)=>{let y=Number(b.prezzo||0),q=Number(b.prezzo_mensile||0);return y>0&&!(q>0&&y===0)?x+y:x},0);S=Math.round(_*100)/100}else S=0;t[e]={nome:a.nome,totale:Math.round(S*100)/100,servizi_selezionati:u}}),t.meta={totaleOriginale:this.totaleGenerale,totaleGenerale:this.totaleGenerale,scontoPercentuale:this.scontoPercentuale||0,scontoTarget:this.scontoTarget||"entrambi",totaleScontato:this.scontoPercentuale>0?this.totaleScontato:this.totaleGenerale,aggiornato_il:new Date().toISOString()},t}salvaConfigurazione(){return V(this,null,function*(){if(!window.confirm("Confermi il salvataggio della configurazione?"))return;let e=this.buildDettagliConfigurazione();if(!this.selectedProspect){console.warn("Nessun prospect selezionato: salvataggio annullato.");return}let a=Number(this.scontoPercentuale>0?this.totaleScontato:this.totaleGenerale);if(this.selectedProspect.tipo==="cliente"&&this.configurazioneCorrenteId&&this.previousConfigurazione)try{let s=this.calcolaDifferenze(e,this.previousConfigurazione);Object.keys(s).length>0&&(yield this.supabaseService.inserisciLogConfigurazione({configurazione_id:this.configurazioneCorrenteId,soggetto_id:this.selectedProspect.id,differenze:s,totale:a}))}catch(s){console.error("Errore durante l'inserimento log configurazione:",s)}let i={prospect_id:this.selectedProspect.id,data_configurazione:new Date().toISOString(),totale:a,dettagli:e};try{let{data:s,error:d}=yield this.alchemizzatoreService.salvaConfigurazione(i,this.configurazioneCorrenteId??void 0);if(d)throw console.error("Errore nel salvataggio configurazione:",d),alert("Errore durante il salvataggio della configurazione. Controlla la console."),d;if(s&&(this.configurazioneCorrenteId=s.id??this.configurazioneCorrenteId??null,this.currentConfigurazioneId=this.configurazioneCorrenteId,s.dettagli)){let u=s.dettagli,h=u.meta??{};if(this.applyConfigurazioneDettagli(u),this.scontoPercentuale=Number(h.scontoPercentuale??this.scontoPercentuale??0),this.updateTotaleGeneraleFromDetails(),this.totaleGenerale===0&&(typeof h.totaleOriginale<"u"||typeof s.totale<"u")){let w=Number(h.totaleOriginale??s.totale??0)||0;this.totaleGenerale=Math.round(w*100)/100}this.previousConfigurazione=this.deepClone(u)}alert("Configurazione salvata con successo.")}catch(s){throw console.error("salvaConfigurazione - errore finale:",s),s}})}resetConfigurazione(){this.currentStep=1,this.queryProspect="",Object.keys(this.moduli).forEach(t=>{let e=this.moduli[t];e.servizi.forEach(a=>{a.selezionato=!1}),e.totale=0}),this.totaleGenerale=0}getServiziSelezionatiModulo(t){return this.moduli[t].servizi.filter(a=>a.selezionato)}getTotaleModulo(t){return this.moduli[t].totale}getServiziPacchetto(t){return this.moduli[t].servizi.filter(e=>!!e.pacchetto)}getServiziSingoli(t){return this.moduli[t].servizi.filter(e=>!e.pacchetto)}getTuttiServiziSelezionati(){let t=[];return Object.keys(this.moduli).forEach(e=>{let a=this.moduli[e].servizi.filter(i=>i.selezionato);t.push(...a)}),t}procediPerFirme(){return V(this,null,function*(){if(!this.selectedProspect){alert("Seleziona prima un soggetto.");return}if(this.totaleGenerale===0){alert("Configura almeno un servizio.");return}let t=this.isProspect;if(t&&!this.pendingFirmeProcess){this.pendingFirmeProcess=!0,this.currentStep=7;return}let e=[{percorso:"assets/contratti/privacy-promethea.pdf",nomeBase:"Privacy"},{percorso:"assets/contratti/contratto-promethea.pdf",nomeBase:"Contratto Servizi Promethea"}];this.haServiziDigitaliSelezionati()&&e.push({percorso:"assets/contratti/allegato-digitale.pdf",nomeBase:"Allegato Digitale"}),this.haServiziContabiliSelezionati()&&e.push({percorso:"assets/contratti/allegato-contabile.pdf",nomeBase:"Allegato Contabile"});try{if(t&&!(yield this.convertiProspectInCliente())){alert("Errore nella conversione del prospect in cliente.");return}this.scaricaDocumenti(e),yield this.salvaConfigurazione(),t&&this.nominativi.length>0&&(yield this.creaProspectDaNominativi()),this.pendingFirmeProcess=!1,this.currentStep=t?6:this.currentStep,alert(t?"Operazione completata! Il prospect \xE8 ora cliente.":"Configurazione aggiornata con successo.")}catch(a){console.error("Errore nel processo:",a),alert("Errore durante l'operazione: "+(a?.message||"sconosciuto"))}})}convertiProspectInCliente(){return V(this,null,function*(){if(!this.selectedProspect||!this.isProspect)return!0;try{console.log("Conversione prospect in cliente:",this.selectedProspect.id);let t=yield this.soggettiService.convertiProspectInCliente(this.selectedProspect.id);return t.error?(console.error("Errore nella conversione:",t.error),!1):t.data?(this.selectedProspect=t.data,console.log("Prospect convertito in cliente con successo:",this.selectedProspect),!0):!1}catch(t){return console.error("Errore durante la conversione:",t),!1}})}aggiungiNominativo(){if(!this.nuovoNominativo.nome.trim()){alert("Il nome \xE8 obbligatorio");return}if(!this.nuovoNominativo.telefono.trim()&&!this.nuovoNominativo.email.trim()){alert("Inserire almeno il telefono o l'email");return}this.nominativi.push(L({},this.nuovoNominativo)),this.nuovoNominativo={nome:"",telefono:"",email:""}}rimuoviNominativo(t){this.nominativi.splice(t,1)}creaProspectDaNominativi(){return V(this,null,function*(){if(!(!this.nominativi||this.nominativi.length===0))for(let t of this.nominativi)try{let e={tipo:"prospect",ragioneSociale:t.nome,telefono:t.telefono||void 0,email:t.email||void 0,note:`Creato da configurazione Promethea - ${this.selectedProspect?.ragione_sociale}`,prodotto:"Promethea",referenzaDaId:this.selectedProspect?.id},a=yield this.soggettiService.createSoggetto(e);(!a||!a.success)&&(yield this.soggettiService.supabase.from("soggetti").insert([{tipo:e.tipo,ragione_sociale:e.ragioneSociale,telefono:e.telefono??null,email:e.email??null,note:e.note??null,prodotto:e.prodotto,referenza_da_id:e.referenzaDaId??null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]))}catch(e){console.error("Errore creazione prospect da nominativo:",e)}})}haServiziDigitaliSelezionati(){let t=this.moduli.digitalizzazione_automatismi.servizi.some(a=>a.selezionato),e=this.moduli.immagine_marketing.servizi.some(a=>a.selezionato&&a.id.startsWith("social_"));return t||e}haServiziContabiliSelezionati(){return this.moduli.contabilita_fiscalita.servizi.some(t=>t.selezionato)}scaricaDocumenti(t){let e=this.sanitizeFileName(this.selectedProspect.ragione_sociale);t.forEach((a,i)=>{setTimeout(()=>{let s=`${a.nomeBase} - ${e}.pdf`;this.scaricaPDF(a.percorso,s)},i*300)})}scaricaPDF(t,e){let a=document.createElement("a");a.href=t,a.download=e,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}sanitizeFileName(t){return t.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g," ").trim()}get isCliente(){return this.selectedProspect?.tipo==="cliente"}get isProspect(){return this.selectedProspect?.tipo==="prospect"}getCategorieContabilita(){let t=this.moduli.contabilita_fiscalita.servizi;return[...new Set(t.map(a=>a.categoria))].filter(a=>a!==void 0).sort()}getServiziByCategoria(t){return this.moduli.contabilita_fiscalita.servizi.filter(e=>e.categoria===t)}configurazioniContabilita={costituzione:{attivo:!1,serviziSelezionati:[]},contabilita:{tipo:"",registrazioni:90,prezzoCalcolato:0},fatturazione:{tipo:"",numeroFatture:40,prezzoCalcolato:0},iva:{liquidazione:"",lipe:"trimestrale",volumeAffari:75e3,vistoConformita:!1,modelloIVATR:!1,intrastat:!1,prezzoCalcolato:0},redditi:{tipoSoggetto:"persone_fisiche",volumeAffari:75e3,numeroPersone:1,vistoConformita:!1,prezzoCalcolato:0},bilancio:{tipo:"attivita",importo:13e4,depositoBilancio:!1,nominaCariche:!1,prezzoCalcolato:0},altriServizi:{cuPercipienti:5,prezzoCU:180,modello770:!1,f24Numero:12,prezzoF24:300,modello770Count:1,imuCount:1,locazioniCount:1,smartCardRilascioCount:1}};calcolaPrezzoContabilita(){let t=this.configurazioniContabilita?.contabilita;if(!t||!t.tipo){t&&(t.prezzoCalcolato=0);let i=this.getService("contabilita_fiscalita","contabilita_principale");i&&(delete i.prezzo_mensile,i.prezzo=Number(i.prezzo||0)),this.calcolaTotali();return}let e=t.registrazioni;switch(t.tipo){case"semplificata":e<=90?t.prezzoCalcolato=1421:e<=180?t.prezzoCalcolato=1811:e<=360?t.prezzoCalcolato=2805:t.prezzoCalcolato=2805+(e-360)*2;break;case"ordinaria":e<=600?t.prezzoCalcolato=3276:(e<=2e3,t.prezzoCalcolato=3276+(e-600)*3.38);break;case"mista":e<=600?t.prezzoCalcolato=2644:(e<=2e3,t.prezzoCalcolato=2644+(e-600)*3.38);break}t.prezzoCalcolato=Math.round(t.prezzoCalcolato*100)/100;let a=this.getService("contabilita_fiscalita","contabilita_principale");a&&(a.prezzo_mensile=this.monthlyPrice(t.prezzoCalcolato),a.prezzo=0),this.calcolaTotali()}calcolaPrezzoFatturazione(){let t=this.configurazioniContabilita.fatturazione;t.tipo==="emissione_noi"?t.prezzoCalcolato=t.numeroFatture*25:t.prezzoCalcolato=t.numeroFatture*4;let e=this.getService("contabilita_fiscalita","fatturazione_principale");e&&(e.prezzo_mensile=this.monthlyPrice(t.prezzoCalcolato),e.prezzo=0),this.calcolaTotali()}calcolaPrezzoIVA(){let t=this.configurazioniContabilita.iva,e=0;t.liquidazione==="mensile"?e+=576:e+=280,t.lipe==="mensile"?e+=1038:e+=346,t.volumeAffari<=75e3?e+=277:t.volumeAffari<=15e4?e+=346:t.volumeAffari<=3e5?e+=439:t.volumeAffari<=5e5?e+=550:t.volumeAffari<=75e4?e+=732:e+=1208,t.vistoConformita&&(e+=287.5),t.modelloIVATR&&(e+=72),t.intrastat&&(e+=70),t.prezzoCalcolato=e;let a=this.getService("contabilita_fiscalita","iva_principale");a&&(a.prezzo_mensile=this.monthlyPrice(t.prezzoCalcolato),a.prezzo=0),this.calcolaTotali()}calcolaPrezzoRedditi(){let t=this.configurazioniContabilita.redditi,e=0;t.tipoSoggetto==="persone_fisiche"?t.volumeAffari<=75e3?e=440:t.volumeAffari<=15e4?e=659:t.volumeAffari<=3e5?e=879:t.volumeAffari<=5e5?e=1096.5:t.volumeAffari<=75e4?e=1317:e=1645.5:t.volumeAffari<=3e5?e=916.5:t.volumeAffari<=5e5?e=1372.5:t.volumeAffari<=15e5?e=1830:t.volumeAffari<=3e6?e=2285:t.volumeAffari<=5e6?e=2744:t.volumeAffari<=75e5?e=3201.5:e=4e3,t.tipoSoggetto==="persone_fisiche"&&(e*=t.numeroPersone),t.vistoConformita&&(e+=287.5),t.prezzoCalcolato=e;let a=this.getService("contabilita_fiscalita","redditi_principale");a&&(a.prezzo_mensile=this.monthlyPrice(t.prezzoCalcolato),a.prezzo=0),this.calcolaTotali()}calcolaPrezzoBilancio(){let t=this.configurazioniContabilita.bilancio,e=0;t.tipo==="attivita"?t.importo<=13e4?e=453.5:t.importo<=5e5?e=765.5:t.importo<=13e5?e=1184:t.importo<=26e5?e=1739.5:t.importo<=575e3?e=2435:e=3e3:t.importo<=3e5?e=590:t.importo<=5e5?e=765.5:t.importo<=15e5?e=905:t.importo<=3e6?e=1218:t.importo<=5e6?e=1739.5:t.importo<=75e5?e=2435:e=3e3,t.depositoBilancio&&(e+=350),t.nominaCariche&&(e+=420),t.prezzoCalcolato=e;let a=this.getService("contabilita_fiscalita","bilancio_principale");a&&(a.prezzo_mensile=this.monthlyPrice(t.prezzoCalcolato),a.prezzo=0),this.calcolaTotali()}calcolaPrezzoCU(){let t=this.configurazioniContabilita.altriServizi;t.cuPercipienti<=5?t.prezzoCU=180:t.cuPercipienti<=10?t.prezzoCU=330:t.cuPercipienti<=15?t.prezzoCU=480:t.cuPercipienti<=20?t.prezzoCU=630:t.prezzoCU=630+(t.cuPercipienti-20)*30,t.f24Numero<=12?t.prezzoF24=300:t.f24Numero<=24?t.prezzoF24=600:t.f24Numero<=36?t.prezzoF24=900:t.prezzoF24=900+(t.f24Numero-36)*25,this.calcolaTotali()}monthlyPrice(t){return Math.round(Number(t||0)/12*100)/100}isPriceAlreadyMonthly(t){return!t||!t.id?!1:!!(t.id.startsWith("social_")||t.id==="altro_gestione_pec")}isAnnualToConvert(t){return!t||!t.id?!1:this.ANNUAL_TO_MONTHLY_IDS.has(t.id)}calcolaTotali(){this.totaleMensile=0,this.totaleUnaTantum=0,Object.keys(this.moduli).forEach(t=>{let e=this.moduli[t];if(!(!e||!e.servizi)){if(e.totale=0,e.servizi.forEach(a=>{if(!a.selezionato)return;let i=this.getAltriServiziCount?this.getAltriServiziCount(a.id):1,s=Number(a.prezzo??0),d=Number(a.prezzo_mensile??a.prezzoMensile??0);if(d>0){if(this.totaleMensile+=d*i,s>0){let h=s*i;this.totaleUnaTantum+=h,e.totale+=h}return}if(this.isPriceAlreadyMonthly&&this.isPriceAlreadyMonthly(a)){this.totaleMensile+=s*i;return}if(this.isAnnualToConvert&&this.isAnnualToConvert(a)){this.totaleMensile+=this.monthlyPrice(s)*i;return}let u=s*i;this.totaleUnaTantum+=u,e.totale+=u}),t==="contabilita_fiscalita"&&this.configurazioniContabilita){let a=this.configurazioniContabilita,i=(s,d)=>{let u=Number(s||0);if(u<=0)return;let h=this.getService("contabilita_fiscalita",d);if(h&&h.selezionato||d&&!this.isAddedManually(d))return;let w=this.monthlyPrice(u);this.totaleMensile+=w};i(a?.contabilita?.prezzoCalcolato,"contabilita_principale"),i(a?.fatturazione?.prezzoCalcolato,"fatturazione_principale"),i(a?.iva?.prezzoCalcolato,"iva_principale"),i(a?.redditi?.prezzoCalcolato,"redditi_principale"),i(a?.bilancio?.prezzoCalcolato,"bilancio_principale")}e.totale=Math.round(e.totale*100)/100}}),this.totaleMensile=Math.round(this.totaleMensile*100)/100,this.totaleUnaTantum=Math.round(this.totaleUnaTantum*100)/100,this.totaleGenerale=Math.round((this.totaleUnaTantum+this.totaleMensile*12)*100)/100}toggleServizioContabilita(t){t.tipo==="gruppo"?(t.selezionato=!t.selezionato,t.id==="costituzione_principale"&&(this.configurazioniContabilita.costituzione.attivo=t.selezionato)):t.selezionato=!t.selezionato,this.calcolaTotali()}isServizioContabilitaAbilitato(t){return t.dipendeDa?this.moduli.contabilita_fiscalita.servizi.find(a=>a.id===t.dipendeDa)?.selezionato||!1:!0}deepClone(t){return t==null?t:JSON.parse(JSON.stringify(t))}visualizzaPreventivo(){this.configurazioneCorrenteId?this.router.navigate(["/preventivo",this.configurazioneCorrenteId]):this.salvaConfigurazione().then(()=>{this.configurazioneCorrenteId&&this.router.navigate(["/preventivo",this.configurazioneCorrenteId])}).catch(t=>{console.error("Errore nel salvataggio della configurazione:",t),alert("Errore nel salvataggio. Impossibile generare il preventivo.")})}getResponseDelay(){return this.baseAssistDelay+Math.floor(Math.random()*this.assistJitter)}num(t){let e=Number(t??0);return Math.round(e*100)/100}apriChatSconto(){this.mostraChatSconto=!0,this.messaggiAssistenza=[],this.richiedendoSconto=!1,this.addMessage(`Ciao! Sono l'assistenza Promethea. Dimmi quale sconto desideri richiedere per ${this.selectedProspect?.ragione_sociale||"il cliente"}.`,"assistenza"),setTimeout(()=>{document.getElementById("chat-input")?.focus()},120)}chiudiChatSconto(){this.mostraChatSconto=!1,this.messaggioChat=""}inviaMessaggio(){let t=this.messaggioChat?.trim();t&&(this.addMessage(t,"utente"),this.messaggioChat="",setTimeout(()=>this.handleAssistantReply(t),this.getResponseDelay()))}addMessage(t,e){this.messaggiAssistenza.push({testo:t,autore:e,timestamp:new Date}),setTimeout(()=>this.scrollChatToBottom(),30)}scrollChatToBottom(){let t=document.getElementById("chat-messages");if(t)try{t.scrollTo({top:t.scrollHeight,behavior:"smooth"})}catch{t.scrollTop=t.scrollHeight}}handleAssistantReply(t){return V(this,null,function*(){let e=(t||"").trim();if(this.pendingCifraRequest&&this.pendingCifraRequest.stage==="awaiting_confirm"){let a=/^\s*(s|si|yes|y)\b/i.test(e),i=/^\s*(n|no|not)\b/i.test(e);if(a){yield this.confirmPendingCifra(!0);return}if(i){yield this.confirmPendingCifra(!1);return}this.addMessage(`Rispondi "si" per confermare l'applicazione dello sconto o "no" per annullare.`,"assistenza");return}this.processDiscountRequest(e)})}confirmPendingCifra(t){return V(this,null,function*(){if(!this.pendingCifraRequest){this.addMessage("Nessuna richiesta in sospeso.","assistenza");return}let e=this.pendingCifraRequest;if(this.pendingCifraRequest=null,!t){this.addMessage("Operazione annullata. Lo sconto non \xE8 stato applicato.","assistenza");return}let a=typeof e.candidatePercent=="number"?e.candidatePercent:typeof e.value=="number"?e.value:null,i=e.target??"entrambi";if(a===null){this.addMessage("Non \xE8 stato possibile determinare la percentuale da applicare.","assistenza");return}this.scontoPercentuale=Math.max(0,Math.min(100,Number(a))),this.scontoTarget=i;try{yield this.confermaApplicaSconto()}catch{this.addMessage("Errore durante il salvataggio dello sconto. Riprova.","assistenza")}})}processDiscountRequest(t){if(!this.pendingCifraRequest||!this.pendingCifraRequest.stage){this.pendingCifraRequest={stage:"awaiting_kind"},this.addMessage('Vuoi uno sconto in percentuale o una cifra? (rispondi "percentuale" o "cifra")',"assistenza");return}if(this.pendingCifraRequest.stage==="awaiting_kind"){let e=this.assistenzaService.decideKindFromText(t)??(/\bcifra\b/.test(t)?"cifra":/\bpercent/.test(t)?"percent":null);if(!e){this.addMessage('Non ho capito. Scrivi "percentuale" o "cifra".',"assistenza");return}if(this.pendingCifraRequest.kind=e,e==="cifra"){this.pendingCifraRequest.stage="awaiting_value",this.addMessage('Scrivi la cifra finale desiderata per la quota una-tantum (es. "5000").',"assistenza");return}else{this.pendingCifraRequest.stage="awaiting_value",this.addMessage('Scrivi la percentuale desiderata (es. "10%" oppure "10").',"assistenza");return}}if(this.pendingCifraRequest.stage==="awaiting_value"){let e=this.assistenzaService.parseItalianNumber(t);if(isNaN(e)){this.addMessage('Non ho capito il numero. Inserisci un valore numerico (es. "10%" o "5000").',"assistenza");return}if(this.pendingCifraRequest.kind==="cifra"){let a={una:this.totaleUnaTantum,mensile:this.totaleMensile},i=this.assistenzaService.computeForCifra(a,e);if(!i.allowed){if(i.reason==="limit"){this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:i.candidatePercent,producedTotal:i.producedTotal,value:e,target:"una_tantum"},this.addMessage(`\u274C Richiederebbe uno sconto del ${Number((i.candidatePercent||0).toFixed(2))}%, oltre il limite automatico del ${this.assistenzaService.DEFAULT_LIMIT}%. Vuoi comunque inviare richiesta di approvazione? (si/no)`,"assistenza");return}this.addMessage(i.reason||"Impossibile applicare la cifra richiesta.","assistenza"),this.pendingCifraRequest=null;return}this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:i.candidatePercent,producedTotal:i.producedTotal,value:e,target:"una_tantum"},this.addMessage(`\u2705 Posso applicare la cifra richiesta: quota una\u2011tantum risultante ${this.formatCurrency(e)}. Totale complessivo risultante: ${this.formatCurrency(i.producedTotal||0)}. Vuoi procedere? (si/no)`,"assistenza");return}else{let a=Math.max(0,Math.min(100,e));this.pendingCifraRequest.value=a,this.pendingCifraRequest.stage="awaiting_target",this.addMessage('Dove vuoi applicare la percentuale? Rispondi "mensile", "una tantum" o "entrambi".',"assistenza");return}}if(this.pendingCifraRequest.stage==="awaiting_target"){let e=this.assistenzaService.decideTargetFromText(t);if(!e){this.addMessage('Non ho capito. Rispondi "mensile", "una tantum" o "entrambi".',"assistenza");return}this.pendingCifraRequest.target=e;let a=Number(this.pendingCifraRequest.value??0),i={una:this.totaleUnaTantum,mensile:this.totaleMensile},s=this.assistenzaService.computeForPercent(i,a,e);if(!s.allowed){if(typeof s.candidatePercent=="number"&&s.candidatePercent>this.assistenzaService.DEFAULT_LIMIT){this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:s.candidatePercent,producedTotal:s.producedTotal,target:e,value:a},this.addMessage(`\u26A0\uFE0F Lo sconto richiesto (${Number(s.candidatePercent.toFixed(2))}%) supera il limite automatico del ${this.assistenzaService.DEFAULT_LIMIT}%. Vuoi inviare richiesta di approvazione? (si/no)`,"assistenza");return}this.addMessage(s.reason||"Impossibile applicare la percentuale richiesta.","assistenza"),this.pendingCifraRequest=null;return}let d=Number((s.candidatePercent??a).toFixed(4));if(e==="mensile"){let u=Math.round(this.totaleMensile*(1-d/100)*100)/100,h=s.producedTotal??Math.round((this.totaleUnaTantum+u*12)*100)/100;this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:s.candidatePercent??d,producedTotal:h,target:e,value:a},this.addMessage(`\u2705 Posso applicare ${d}% sulla quota mensile. Totale mensile risultante: ${this.formatCurrency(u)}/mese \u2014 Totale complessivo risultante: ${this.formatCurrency(h)}. Vuoi procedere? (si/no)`,"assistenza")}else if(e==="una_tantum"){let u=Math.round(this.totaleUnaTantum*(1-d/100)*100)/100,h=s.producedTotal??Math.round((u+this.totaleMensile*12)*100)/100;this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:s.candidatePercent??d,producedTotal:h,target:e,value:a},this.addMessage(`\u2705 Posso applicare ${d}% sulla quota una tantum. Quota una tantum risultante: ${this.formatCurrency(u)} \u2014 Totale complessivo risultante: ${this.formatCurrency(h)}. Vuoi procedere? (si/no)`,"assistenza")}else{let u=s.producedTotal??Math.round((this.totaleUnaTantum+this.totaleMensile*12)*(1-d/100)*100)/100;this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:s.candidatePercent??d,producedTotal:u,target:e,value:a},this.addMessage(`\u2705 Posso applicare ${d}% su entrambi. Totale complessivo risultante: ${this.formatCurrency(u)}. Vuoi procedere? (si/no)`,"assistenza")}return}this.addMessage('Scrivi "sconto" per iniziare la procedura guidata.',"assistenza")}get totaleScontato(){let t=Number(this.scontoPercentuale||0)/100;if(this.scontoTarget==="mensile"){let e=this.totaleMensile*(1-t);return Math.round((this.totaleUnaTantum+e*12)*100)/100}else if(this.scontoTarget==="una_tantum"){let e=this.totaleUnaTantum*(1-t);return Math.round((e+this.totaleMensile*12)*100)/100}else{let e=this.totaleUnaTantum+this.totaleMensile*12;return Math.round(e*(1-t)*100)/100}}formatCurrency(t){return`\u20AC ${Number(t||0).toLocaleString("it-IT",{minimumFractionDigits:2,maximumFractionDigits:2})}`}applySconto(t,e){this.scontoPercentuale=Math.max(0,Math.min(100,Math.round(Number(t)*100)/100)),e&&(this.scontoTarget=e)}confermaApplicaSconto(){return V(this,null,function*(){try{yield this.salvaConfigurazione(),this.addMessage(`Sconto del ${this.scontoPercentuale}% applicato e salvato. Totale finale: ${this.formatCurrency(this.totaleScontato)}`,"assistenza"),this.mostraChatSconto=!1}catch(t){console.error("Errore salvataggio sconto:",t),this.addMessage("Errore nel salvataggio dello sconto. Riprova.","assistenza")}})}rimuoviSconto(){this.scontoPercentuale=0}formatPrezzoServizio(t){let e=Number(t?.prezzo??0),a=Number(t?.prezzo_mensile??t?.prezzoMensile??0);if(a>0)return`${this.formatCurrency(a)} /mese`;if(t?.id==="software_personalizzato"&&e===0)return"Valutazione Interna";let i={contabilita_principale:"contabilita",fatturazione_principale:"fatturazione",iva_principale:"iva",redditi_principale:"redditi",bilancio_principale:"bilancio"};if(t?.id&&i[t.id]){let s=i[t.id],d=Number(this.configurazioniContabilita&&this.configurazioniContabilita[s]?.prezzoCalcolato||0);if(d>0){let u=this.monthlyPrice(d);return`${this.formatCurrency(u)} /mese`}return"\u2014"}return this.isPriceAlreadyMonthly(t)?`${this.formatCurrency(e)} /mese`:`\u20AC ${e.toLocaleString("it-IT",{minimumFractionDigits:2,maximumFractionDigits:2})}`}formatTotaleModulo(t){let e=this.moduli?.[t];if(!e)return"\u2014";let a=e.servizi.filter(x=>x.selezionato).reduce((x,b)=>x+(Number(b.prezzo)||0),0),i=this.previousConfigurazione??null,s=0,d=[];if(i&&i[t]){let x=i[t];d=Array.isArray(x.servizi_selezionati)?x.servizi_selezionati:Array.isArray(x.servizi)?x.servizi:[],typeof x.totale<"u"&&x.totale!==null?s=Number(x.totale)||0:d.length>0&&(s=d.reduce((b,y)=>b+(Number(y?.prezzo)||0),0))}let u=Number(e.totale)||0,h=new Map;e.servizi.filter(x=>x.selezionato).forEach(x=>{x&&x.id&&h.set(x.id,x)}),d.forEach(x=>{let b=typeof x=="string"?x:x?.id;b&&(h.has(b)||h.set(b,{id:b,nome:x?.nome??null,prezzo:Number(x?.prezzo??0),prezzo_mensile:typeof x?.prezzo_mensile<"u"?Number(x.prezzo_mensile):void 0}))});let w=Array.from(h.values()).reduce((x,b)=>x+Number(b.prezzo||0),0),S=Math.max(a,s,u,w);return Array.from(h.values()).some(x=>x?.id==="software_personalizzato"&&(Number(x?.prezzo)||0)===0)?"Valutazione Interna":`\u20AC ${S.toLocaleString("it-IT",{minimumFractionDigits:2,maximumFractionDigits:2})}`}getNumericTotaleModulo(t){let e=this.moduli?.[t];if(!e)return 0;let a=e.servizi.filter(S=>S.selezionato).reduce((S,_)=>S+(Number(_.prezzo)||0),0),i=this.previousConfigurazione??null,s=0,d=[];if(i&&i[t]){let S=i[t];d=Array.isArray(S.servizi_selezionati)?S.servizi_selezionati:Array.isArray(S.servizi)?S.servizi:[],typeof S.totale<"u"&&S.totale!==null?s=Number(S.totale)||0:d.length>0&&(s=d.reduce((_,x)=>_+(Number(x?.prezzo)||0),0))}let u=Number(e.totale)||0,h=new Map;e.servizi.filter(S=>S.selezionato).forEach(S=>{S&&S.id&&h.set(S.id,S)}),d.forEach(S=>{let _=typeof S=="string"?S:S?.id;_&&(h.has(_)||h.set(_,{id:_,prezzo:Number(S?.prezzo??0)}))});let w=Array.from(h.values()).reduce((S,_)=>S+Number(_.prezzo||0),0);return Math.round(Math.max(a,s,u,w)*100)/100}updateTotaleGeneraleFromDetails(){let e=["immagine_marketing","digitalizzazione_automatismi","contabilita_fiscalita","ottimizzazione_management"].reduce((a,i)=>a+this.getNumericTotaleModulo(i),0);this.totaleGenerale=Math.round(e*100)/100}getServizioContabilitaByName(t){let e=this.moduli?.contabilita_fiscalita?.servizi??[];if(!e||e.length===0)return null;let a=e.find(u=>u.id===t);if(a)return a;let s={contabilita:"contabilita_principale",contabilita_principale:"contabilita_principale",fatturazione:"fatturazione_principale",fatturazione_principale:"fatturazione_principale",iva:"iva_principale",iva_principale:"iva_principale",costituzione:"costituzione_principale",costituzione_principale:"costituzione_principale"}[t.toLowerCase()];if(s){let u=e.find(h=>h.id===s);if(u)return u}return e.find(u=>(u.nome??"").toLowerCase().includes(t.toLowerCase()))??e.find(u=>u.tipo==="configurabile")??e[0]??null}toggleAltriServizi(){this.showAltriServizi=!this.showAltriServizi}toggleContabilitaChildren(){this.showContabilitaChildren=!this.showContabilitaChildren}getServiceById(t){return(this.moduli?.contabilita_fiscalita?.servizi??[]).find(a=>a.id===t)??null}toggleServiceById(t){let e=this.getServiceById(t);if(!e){console.warn(`Servizio non trovato: ${t}`);return}this.toggleServizioContabilita(e)}isContabilitaPrincipaleSelezionato(){return this.isServiceSelected("contabilita_fiscalita","contabilita_principale")}toggleContabilitaPrincipale(){this.toggleService("contabilita_fiscalita","contabilita_principale")}getService(t,e){let a=this.moduli[t];if(!a||!Array.isArray(a.servizi))return null;let i=a.servizi.find(u=>u.id===e);if(i)return i;let d={contabilita_principale:"contabilita_principale",contabilita:"contabilita_principale",fatturazione_principale:"fatturazione_principale",fatturazione:"fatturazione_principale",iva_principale:"iva_principale",iva:"iva_principale",costituzione_principale:"costituzione_principale",costituzione:"costituzione_principale"}[e];return d&&(i=a.servizi.find(u=>u.id===d),i)||(i=a.servizi.find(u=>(u.nome||"").toLowerCase().includes((e||"").toLowerCase())),i)?i:a.servizi.find(u=>u.tipo==="configurabile")??a.servizi[0]??null}toggleService(t,e,a=!1){let i=this.getService(t,e);if(!i){console.warn(`[Alchemizzatore] servizio non trovato in ${t}: ${e}`);return}if(t==="contabilita_fiscalita"){this.toggleServizioContabilita(i),a?i.aggiuntoManualmente=!!i.selezionato:i.selezionato||(i.aggiuntoManualmente=!1),this.calcolaTotali();return}this.toggleServizio(t,i),this.calcolaTotali()}isServiceSelected(t,e){let a=this.getService(t,e);return!!(a&&a.selezionato)}getDescrizioneContabilita(t){return{semplificata:"(fino a 90: 1.421\u20AC, 90-180: 1.811\u20AC, 180-360: 2.805\u20AC, oltre 360: 2.805\u20AC + 2\u20AC/registrazione)",ordinaria:"(fino a 600: 3.276\u20AC, oltre 600: 3.276\u20AC + 3.38\u20AC/registrazione)",mista:"(fino a 600: 2.644\u20AC, oltre 600: 2.644\u20AC + 3.38\u20AC/registrazione)"}[(t??"").toLowerCase()]??""}getAltriServiziCount(t){let e=this.configurazioniContabilita?.altriServizi??{};switch(t){case"altro_modello_770":return Number(e.modello770Count)||1;case"altro_imu_dichiarazione":return Number(e.imuCount)||1;case"altro_locazioni":return Number(e.locazioniCount)||1;case"altro_smart_card_rilascio":return Number(e.smartCardRilascioCount)||1;default:return 1}}detectDiscountTargetFromText(t){let e=(t||"").toLowerCase();return/\b(mensil|mensile|mese|mesi)\b/.test(e)?"mensile":/\buna\b.*\btantum\b|\buna_tantum\b|\buna tantum\b|\btantum\b/.test(e)?"una_tantum":(/\bentrambi\b|\btutto\b|\btotale\b|\bambedue\b/.test(e),"entrambi")}isAddedManually(t){let e=this.getService("contabilita_fiscalita",t);return!!(e&&e.aggiuntoManualmente)}getTotaliModuloSplit(t){let e={mensile:0,una:0},a=this.moduli[t];if(!a||!Array.isArray(a.servizi))return e;if(a.servizi.forEach(i=>{if(!i.selezionato)return;let s=this.getAltriServiziCount?this.getAltriServiziCount(i.id):1,d=Number(i.prezzo??0),u=Number(i.prezzo_mensile??i.prezzoMensile??0);if(u>0){e.mensile+=u*s,d>0&&(e.una+=d*s);return}if(this.isPriceAlreadyMonthly&&this.isPriceAlreadyMonthly(i)){d>0&&(e.mensile+=d*s);return}if(this.isAnnualToConvert&&this.isAnnualToConvert(i)){d>0&&(e.mensile+=this.monthlyPrice(d)*s);return}d>0&&(e.una+=d*s)}),t==="contabilita_fiscalita"&&this.configurazioniContabilita){let i=this.configurazioniContabilita,s=(d,u)=>{let h=Number(d||0);if(h<=0)return;let w=this.getService("contabilita_fiscalita",u);w&&w.selezionato||this.isAddedManually(u)&&(e.mensile+=this.monthlyPrice(h))};s(i?.contabilita?.prezzoCalcolato,"contabilita_principale"),s(i?.fatturazione?.prezzoCalcolato,"fatturazione_principale"),s(i?.iva?.prezzoCalcolato,"iva_principale"),s(i?.redditi?.prezzoCalcolato,"redditi_principale"),s(i?.bilancio?.prezzoCalcolato,"bilancio_principale")}return e.mensile=Math.round(e.mensile*100)/100,e.una=Math.round(e.una*100)/100,e}getAltriServiziCountFor(t){let e=this.configurazioniContabilita&&this.configurazioniContabilita.altriServizi||{};switch(t){case"altro_modello_770":return Number(e.modello770Count||1);case"altro_imu_dichiarazione":return Number(e.imuCount||1);case"altro_locazioni":return Number(e.locazioniCount||1);case"altro_smart_card_rilascio":return Number(e.smartCardRilascioCount||1);default:return 1}}isAltriServiziCounted(t){return["altro_modello_770","altro_imu_dichiarazione","altro_locazioni","altro_smart_card_rilascio"].includes(t)}updateTotaliSplitFromConfig(t=!1){this.calcolaTotali();let e=this.previousConfigurazione&&this.previousConfigurazione.meta?this.previousConfigurazione.meta:this.configurazione?.dettagli?.meta??{},a=Number(e?.scontoPercentuale??0)||0,i=e?.scontoTarget??"entrambi";i==="una"&&(i="una_tantum");let s=i,d=t?a:typeof this.scontoPercentuale=="number"?this.scontoPercentuale:a,u=t?s:this.scontoTarget??s;this.totaleUnaScontata=d>0&&(u==="una_tantum"||u==="entrambi")?Math.round(this.totaleUnaTantum*(1-d/100)*100)/100:this.totaleUnaTantum,this.totaleMensileScontato=d>0&&(u==="mensile"||u==="entrambi")?Math.round(this.totaleMensile*(1-d/100)*100)/100:this.totaleMensile,t&&(this.scontoPercentuale=d,this.scontoTarget=u)}onScontoChange(){this.calcolaTotali(),this.updateTotaliSplitFromConfig(!1)}getPacchettiConsulenza(){return this.getServiziPacchetto("ottimizzazione_management").filter(t=>typeof t.id=="string"&&t.id.startsWith("consulenza_impresa_"))}getPacchettiFormazione(){return this.getServiziPacchetto("ottimizzazione_management").filter(t=>typeof t.id=="string"&&t.id.startsWith("formazione_commerciale_"))}static \u0275fac=function(e){return new(e||l)(R(he),R(xe),R(re),R(ae),R(le),R(U))};static \u0275cmp=Q({type:l,selectors:[["app-alchemizzatore"]],decls:23,vars:19,consts:[["otherTitle",""],["normalTitle",""],["normalTitleSingoli",""],["mensileNoSconto",""],["unaNoSconto",""],["normalService",""],["normalPrice",""],[1,"alchemizzatore-container"],[1,"form-section"],[1,"progress-steps"],[1,"step",3,"click"],[1,"trattativa-section"],["class","form-section form-section",4,"ngIf"],["class","form-section form-section summary-step",4,"ngIf"],[1,"form-section","form-section"],[1,"section-header"],[1,"material-icons","header-icon"],[1,"section-titles"],[1,"section-title"],[1,"card"],[1,"form-label"],[1,"search-input-container"],["type","text","placeholder","Cerca per ragione sociale, P.IVA o referente...",3,"ngModelChange","input","ngModel"],["class","status-message loading",4,"ngIf"],["class","status-message error",4,"ngIf"],["class","search-results","role","listbox",4,"ngIf"],["class","status-message info",4,"ngIf"],["class","status-message warning",4,"ngIf"],[1,"actions-container"],[1,"promethea-button",3,"click","disabled"],[1,"status-message","loading"],[1,"loading-spinner"],[1,"status-message","error"],["role","listbox",1,"search-results"],["class","search-result-item","role","option",3,"click",4,"ngFor","ngForOf"],["role","option",1,"search-result-item",3,"click"],[1,"result-text"],[1,"result-title"],[1,"result-subtitle"],[1,"result-icon"],[1,"status-message","info"],[1,"material-icons"],[1,"status-message","warning"],[1,"sottotitolo"],[1,"section-title","sotto"],[1,"grid-responsive"],["class","card ",3,"selezionato","disabled","click",4,"ngFor","ngForOf"],["class","card ",3,"selezionato","click",4,"ngFor","ngForOf"],[1,"card","totale-modulo"],[1,"card-number","totale"],[1,"promethea-button","secondary",3,"click"],[1,"promethea-button",3,"click"],[1,"card",3,"click"],["aria-hidden","false",1,"card-title"],[4,"ngIf","ngIfElse"],["class","sottotitolo",4,"ngIf"],[1,"card-number"],[1,"servizio-descrizione"],["class","chip",4,"ngIf"],[1,"checkmark"],[1,"chip"],[1,"totale-row"],[1,"totale-label"],[1,"totale-amount"],[1,"categorie-contabilita"],[1,"categoria-contabilita"],[1,"configurazione-gruppo"],[1,"card","card-clickable",3,"click"],[1,"card-title"],[1,"card-number","card-number"],[4,"ngIf"],[1,"card-actions-absolute"],[1,"icon-btn",3,"click","title"],[1,"grid-form"],[1,"form-field"],[1,"table-inline-select",3,"ngModelChange","change","ngModel"],["value",""],["value","semplificata"],["value","ordinaria"],["value","mista"],[1,"text-muted","small",2,"margin-top","0.4rem"],["type","number","min","1","max","10000",1,"table-inline-input",3,"ngModelChange","change","ngModel"],["value","emissione_noi"],["value","piattaforma_passcom"],["type","number","min","1","max","1000",1,"table-inline-input",3,"ngModelChange","change","ngModel"],["value","trimestrale"],["value","mensile"],["value","75000"],["value","150000"],["value","300000"],["value","500000"],["value","750000"],["value","1000000"],[1,"form-field","checkbox"],["type","checkbox",3,"ngModelChange","change","ngModel"],[1,"section-title",2,"display","flex","align-items","center","justify-content","space-between"],["type","button","title","Mostra/Nascondi",1,"icon-btn",3,"click"],["class","grid-form alternativa",4,"ngIf"],[1,"grid-form","alternativa2"],["class","card",3,"selezionato","disabled","click",4,"ngFor","ngForOf"],[1,"grid-form","alternativa"],["class","small text-muted","style","margin-top:0.5rem;",3,"click",4,"ngIf"],[1,"small","text-muted",2,"margin-top","0.5rem",3,"click"],[1,"count-control"],[1,"count-controls"],["type","button",1,"action-btn","delete",3,"click"],["type","number","min","1",1,"count-input",3,"ngModelChange","click","ngModel"],["type","button",1,"action-btn","add",3,"click"],[1,"form-section","form-section","summary-step"],["class","card",4,"ngIf"],[1,"card","text-center"],["role","status","aria-live","polite",1,"totale-generale-wrapper"],[2,"display","flex","flex-direction","column","gap","0.4rem","align-items","center","margin-top","0.3rem"],[1,"totale-normale"],[1,"actions-container",2,"margin","var(--gutter-lg)","justify-content","center"],[1,"promethea-button","ghost",3,"click"],["title","Assistenza",1,"promethea-button","ghost",3,"click"],[1,"promethea-button","outline",3,"click"],["class","promethea-button success",3,"click",4,"ngIf"],[1,"promethea-button","success",3,"click","disabled"],["class","form-section",4,"ngIf"],["class","modal-backdrop",4,"ngIf"],["class","servizio-riepilogo",4,"ngFor","ngForOf"],[1,"totale-label2"],[1,"servizio-riepilogo"],[1,"servizio-left"],[1,"badge","badge-info"],[1,"card-servizio"],[1,"card-number","servizio"],["style","width: 100% ;",4,"ngFor","ngForOf"],[2,"width","100%"],[1,"badge","badge-secondary"],["class","servizio-riepilogo",4,"ngIf"],[1,"badge","badge-secondary",2,"visibility","hidden"],[1,"badge","badge-tertiary"],[2,"margin","0 0.5rem"],[2,"margin-left","0.6rem","color","var(--muted-color)"],[1,"badge","badge-primary"],[1,"totale-originale",2,"margin","0 0.6rem"],[1,"totale-normale",2,"color","var(--primary)"],[2,"margin-left","0.6rem"],[2,"margin-top","0.45rem"],[1,"text-muted"],[1,"promethea-button","success",3,"click"],[1,"sconto-display"],["class","sconto-value",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"actions"],["class","promethea-button secondary",3,"click",4,"ngIf"],["class","promethea-button ghost",3,"click",4,"ngIf"],[1,"totale-riepilogo"],[1,"totale-value"],["class","form-field",4,"ngIf"],[1,"sconto-value"],[1,"totale-value","text-muted"],[1,"modal-backdrop"],[1,"modal"],[1,"modal-header"],[1,"modal-title"],[1,"icon-btn","close",3,"click"],[1,"modal-body",2,"display","flex","flex-direction","column","height","calc(100% - 120px)"],["id","modal-body",1,"modal-body",2,"flex","1","overflow-y","auto","margin-bottom","var(--gutter-md)"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"form-field",2,"display","flex","gap","var(--gutter-sm)"],["id","form-field","type","text","placeholder","Scrivi il tuo messaggio...",1,"table-inline-input",2,"flex","1",3,"ngModelChange","keyup.enter","ngModel"],[3,"ngClass"],[1,"badge"],["class","material-icons",4,"ngIf"],[1,"message-content"],[1,"card",2,"margin-top","var(--gutter-lg)"],["type","text","placeholder","Nome e cognome",1,"form-input",3,"ngModelChange","ngModel"],["type","tel","placeholder","Telefono",1,"form-input",3,"ngModelChange","ngModel"],["type","email","placeholder","Email",1,"form-input",3,"ngModelChange","ngModel"],["class","card","style","margin-top: var(--gutter-md);",4,"ngIf"],[1,"card",2,"margin-top","var(--gutter-md)"],[1,"text-muted",2,"margin-left","0.6rem"],[1,"actions-container",2,"justify-content","flex-end"],[1,"action-btn","delete",3,"click"]],template:function(e,a){e&1&&(n(0,"div",7)(1,"div",8)(2,"div",9)(3,"button",10),f("click",function(){return a.vaiAStep(1)}),r(4,"1"),o(),n(5,"button",10),f("click",function(){return a.vaiAStep(2)}),r(6,"2"),o(),n(7,"button",10),f("click",function(){return a.vaiAStep(3)}),r(8,"3"),o(),n(9,"button",10),f("click",function(){return a.vaiAStep(4)}),r(10,"4"),o(),n(11,"button",10),f("click",function(){return a.vaiAStep(5)}),r(12,"5"),o(),n(13,"button",10),f("click",function(){return a.vaiAStep(6)}),r(14,"6"),o()()(),n(15,"div",11),C(16,Ie,20,9,"section",12)(17,je,28,4,"section",12)(18,Ye,34,4,"section",12)(19,vt,165,30,"section",12)(20,yt,38,5,"section",12)(21,ni,50,15,"section",13)(22,ri,30,5,"section",12),o()()),e&2&&(c(3),M("active",a.currentStep===1),c(2),M("active",a.currentStep===2),c(2),M("active",a.currentStep===3),c(2),M("active",a.currentStep===4),c(2),M("active",a.currentStep===5),c(2),M("active",a.currentStep===6),c(3),p("ngIf",a.currentStep===1),c(),p("ngIf",a.currentStep===2),c(),p("ngIf",a.currentStep===3),c(),p("ngIf",a.currentStep===4),c(),p("ngIf",a.currentStep===5),c(),p("ngIf",a.currentStep===6),c(),p("ngIf",a.currentStep===7))},dependencies:[oe,Z,K,ee,ve,_e,ze,ce,ue,se,pe,me,fe,ge,de,ne,ie,te],styles:[".alchemizzatore-container[_ngcontent-%COMP%]{padding:var(--gutter-lg)}.trattativa-section[_ngcontent-%COMP%]{margin:var(--gutter-lg) 0}.section-title.sotto[_ngcontent-%COMP%]{margin-top:var(--gutter-lg);margin-bottom:var(--gutter-md)}.servizio-descrizione[_ngcontent-%COMP%]{color:color-mix(in srgb,var(--text-color) 70%,transparent);font-size:var(--fs-sm);margin:0 0 var(--gutter-sm) 0;line-height:1.4}.checkmark[_ngcontent-%COMP%]{position:absolute;top:var(--gutter-md);right:var(--gutter-md);width:24px;height:24px;border:2px solid var(--smoke-color-1);border-radius:50%;display:grid;place-items:center;color:transparent;transition:all .2s ease;background:transparent}.checkmark.attivo[_ngcontent-%COMP%]{background:var(--primary);border-color:var(--primary);color:#fff}.totale-modulo[_ngcontent-%COMP%]{font-weight:700;text-align:right;color:var(--primary);border-top:1px solid var(--smoke-color-1);padding:var(--gutter-lg);margin-top:var(--gutter-lg);font-size:var(--fs-md)}.promethea-button.success[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669)}.actions-container[_ngcontent-%COMP%]{margin-top:var(--gutter-lg)}.card-number[_ngcontent-%COMP%]{font-size:var(--fs-md)}.card-number.servizio[_ngcontent-%COMP%]{color:var(--text-color);font-size:var(--fs-sm);flex-wrap:wrap}.card-number.totale[_ngcontent-%COMP%]{margin-top:var(--gutter-md);text-align:right;display:flex;flex-direction:column;gap:var(--gutter-sm)}.categoria-contabilita[_ngcontent-%COMP%]{padding:var(--gutter-lg) 0}.grid-responsive[_ngcontent-%COMP%]{margin-top:var(--gutter-sm)}.servizi-elenco[_ngcontent-%COMP%], .card-clickable[_ngcontent-%COMP%]{margin-bottom:var(--gutter-sm);display:flex;flex-direction:column;gap:.5rem}.servizio-riepilogo[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;gap:var(--gutter-sm);width:100%;padding:var(--gutter-sm) 0;min-width:0;border-bottom:1px dashed color-mix(in srgb,var(--text-color) 80%,transparent)}.card-title[_ngcontent-%COMP%]{padding-right:var(--gutter-md)}.servizio-left[_ngcontent-%COMP%]{flex:1 1 0;min-width:0;display:flex;gap:.6rem;align-items:center}.servizio-nome[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;min-width:0}.servizio-price[_ngcontent-%COMP%]{flex:0 0 auto;margin-left:auto;color:var(--primary);font-weight:700;white-space:nowrap;min-width:0}.card-number.totale[_ngcontent-%COMP%], .totale-modulo[_ngcontent-%COMP%], .totale-amount[_ngcontent-%COMP%]{box-sizing:border-box;max-width:100%;word-break:break-word;overflow-wrap:anywhere;white-space:normal;min-width:0}.count-controls[_ngcontent-%COMP%], .count-input[_ngcontent-%COMP%], input[type=number][_ngcontent-%COMP%]{min-width:0;max-width:100%;box-sizing:border-box}.alchemizzatore-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{min-width:0;box-sizing:border-box}@media (min-width: 1100px){.grid-responsive[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}.user-message[_ngcontent-%COMP%]{flex-direction:row-reverse}.assistance-message[_ngcontent-%COMP%]{flex-direction:row}.user-message[_ngcontent-%COMP%]   .message-avatar[_ngcontent-%COMP%]{background:var(--primary);color:#fff}.assistance-message[_ngcontent-%COMP%]   .message-avatar[_ngcontent-%COMP%]{background:var(--smoke-color-1);color:var(--text-color)}.message-content[_ngcontent-%COMP%]{max-width:70%;display:flex;flex-direction:column;gap:.25rem}.user-message[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{align-items:flex-end}.assistance-message[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{align-items:flex-start}.user-message[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{background:var(--primary);color:#fff;border-bottom-right-radius:4px}.assistance-message[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{background:var(--smoke-color-1);color:var(--text-color);border-bottom-left-radius:4px}.sconto-display[_ngcontent-%COMP%]{padding:var(--gutter-sm);border-radius:8px;background:color-mix(in srgb,var(--success) 10%,transparent);border:1px solid color-mix(in srgb,var(--success) 30%,transparent)}.sconto-value[_ngcontent-%COMP%]{color:var(--success);font-weight:600}.totale-value.scontato[_ngcontent-%COMP%]{font-size:var(--fs-md)}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--smoke-color-1);border-radius:3px}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.totale-generale-wrapper[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:center;gap:.6rem;flex-wrap:wrap}.totale-generale-wrapper[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-right:.25rem;color:var(--text-muted);font-weight:600}.totale-scontato[_ngcontent-%COMP%]{color:var(--primary);font-weight:800;font-size:1.25rem}.totale-originale[_ngcontent-%COMP%]{text-decoration:line-through;color:var(--text-muted);opacity:.85;margin-left:.4rem}.totale-normale[_ngcontent-%COMP%]{font-weight:700;font-size:var(--fs-md)}@media (max-width:640px){.totale-generale-wrapper[_ngcontent-%COMP%]{flex-direction:column;gap:.2rem;text-align:center}.totale-originale[_ngcontent-%COMP%]{margin-left:0}}.card.text-center[_ngcontent-%COMP%]{margin-top:var(--gutter-lg)}.card-actions-absolute[_ngcontent-%COMP%]{position:absolute;top:var(--gutter-sm);right:var(--gutter-sm);display:flex;gap:.5rem;z-index:10;pointer-events:auto}.card[_ngcontent-%COMP%]   .grid-form[_ngcontent-%COMP%]{gap:var(--gutter-sm);margin-top:var(--gutter-sm)}.alchemizzatore-container[_ngcontent-%COMP%]   .summary-step[_ngcontent-%COMP%]   .grid-responsive[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr);gap:var(--gutter-md);align-items:stretch}@media (max-width: 640px){.alchemizzatore-container[_ngcontent-%COMP%]   .summary-step[_ngcontent-%COMP%]   .grid-responsive[_ngcontent-%COMP%]{grid-template-columns:1fr}}.alchemizzatore-container[_ngcontent-%COMP%]   .summary-step[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.alchemizzatore-container[_ngcontent-%COMP%]   .summary-step[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-number.totale[_ngcontent-%COMP%]{margin-top:auto;align-self:stretch;border-top:1px solid var(--smoke-color-1);padding-top:var(--gutter-md)}.alchemizzatore-container[_ngcontent-%COMP%]   .grid-responsive[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:var(--gutter-md);align-items:start;justify-items:stretch}.alchemizzatore-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{min-width:0;box-sizing:border-box;width:100%;display:flex;flex-direction:column;overflow:hidden}.alchemizzatore-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{overflow:visible}.alchemizzatore-container[_ngcontent-%COMP%]   .search-input-container[_ngcontent-%COMP%]{position:relative}.alchemizzatore-container[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]{position:absolute;z-index:9999;top:calc(100% + var(--gutter-sm))}.alchemizzatore-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .grid-form[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:var(--gutter-sm);align-items:center;min-width:0}.alchemizzatore-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .grid-form[_ngcontent-%COMP%]   *[_ngcontent-%COMP%], .alchemizzatore-container[_ngcontent-%COMP%]   .grid-responsive[_ngcontent-%COMP%] > .card[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{min-width:0;box-sizing:border-box}.alchemizzatore-container[_ngcontent-%COMP%]   .card-number.servizio[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:0}.count-controls[_ngcontent-%COMP%], .count-input[_ngcontent-%COMP%]{min-width:0;max-width:100%;box-sizing:border-box}.totale-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:var(--gutter-sm);padding:var(--gutter-sm) 0;width:100%;box-sizing:border-box}.totale-label2[_ngcontent-%COMP%]{flex:1 1 0;min-width:0;font-weight:700;color:var(--text-color);font-size:var(--fs-sm);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.totale-amount[_ngcontent-%COMP%]{flex:0 0 auto;margin-left:1rem;font-weight:800;color:var(--primary);font-size:var(--fs-md);white-space:nowrap;min-width:0}.totale-row[_ngcontent-%COMP%] > .totale-amount[_ngcontent-%COMP%]{text-align:right;width:auto}.totale-row[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{min-width:0;box-sizing:border-box}"]})};export{Ce as Alchemizzatore};
