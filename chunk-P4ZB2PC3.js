import{a as ft}from"./chunk-HL45SJJW.js";import{a as mt}from"./chunk-6H2VKAM3.js";import{a as _t}from"./chunk-6ICYEFRY.js";import{c as gt}from"./chunk-DS74SF54.js";import{a as pt}from"./chunk-OCVT6WLO.js";import{a as ut}from"./chunk-WOMB6SWO.js";import{b as rt,d as ot,f as at,o as st,p as lt,u as ct}from"./chunk-3JKT2CHV.js";import{b as dt}from"./chunk-3Y2ZP6KK.js";import{a as nt}from"./chunk-3347WCPA.js";import{b as et,c as it}from"./chunk-2ONBSOVF.js";import{c as J,d as G,e as Q,k as X,q as Z,r as tt}from"./chunk-233B5766.js";import{A as F,Bb as k,Db as S,Fa as l,Fb as s,Gb as y,Hb as w,I as V,Jb as U,Ka as z,Kb as Y,Lb as j,Nb as B,Pb as K,Ra as R,Rb as q,S as C,Sb as W,Wa as v,X as m,Xb as H,Y as g,ea as b,f as A,fb as D,gb as c,hb as n,ib as r,jb as P,nb as N,ob as $,qb as x,tb as f,ub as p,x as L}from"./chunk-R6HFAJZF.js";import"./chunk-X5YLR3NI.js";import{a as M,b as O,i as _}from"./chunk-ODN5LVDJ.js";var yt=()=>["/soggetto","nuovo","cliente"],Ct=(o,t,e)=>({promethea:o,yuvi:t,infoTecniche:e}),bt=(o,t)=>({"product-promethea":o,"product-yuvi":t});function xt(o,t){o&1&&(n(0,"a",46)(1,"span",22),s(2,"add_circle"),r()()),o&2&&c("routerLink",K(1,yt))}function St(o,t){if(o&1&&(n(0,"option",47),s(1),r()),o&2){let e=t.$implicit;c("value",e),l(),y(e)}}function wt(o,t){if(o&1&&(n(0,"option",47),s(1),r()),o&2){let e=t.$implicit;c("value",e),l(),y(e)}}function Pt(o,t){if(o&1&&(n(0,"span"),s(1),r()),o&2){let e=p().$implicit;l(),y(e.comune)}}function It(o,t){if(o&1&&(n(0,"span"),s(1),r()),o&2){let e=p().$implicit;l(),w(" (",e.provincia,")")}}function Et(o,t){o&1&&(n(0,"span",70),s(1," Nessun indirizzo "),r())}function kt(o,t){if(o&1){let e=x();n(0,"button",75),f("click",function(){m(e);let a=p().$implicit,d=p(2).$implicit,u=p();return g(u.removeSelectedProduct(d,a))}),s(1," \xD7 "),r()}if(o&2){let e=p().$implicit;c("title",B("Rimuovi ",e))}}function Tt(o,t){if(o&1&&(n(0,"span",73),s(1),v(2,kt,2,2,"button",74),r()),o&2){let e=t.$implicit,i=p(2).$implicit,a=p();c("ngClass",q(3,bt,e==="Promethea",e==="YUVI")),l(),w(" ",e," "),l(),c("ngIf",!a.isProdottoAutomatico(e,i))}}function At(o,t){if(o&1&&(n(0,"div",71),v(1,Tt,3,6,"span",72),r()),o&2){let e=p().$implicit,i=p();l(),c("ngForOf",i.getSelectedProducts(e))}}function Mt(o,t){if(o&1&&(n(0,"option",47),s(1),r()),o&2){let e=t.$implicit;c("value",e.nome),l(),w(" ",e.nome," ")}}function Ot(o,t){o&1&&(n(0,"div",81),P(1,"span",82),r())}function Lt(o,t){if(o&1){let e=x();n(0,"div",76)(1,"select",77,4),f("change",function(a){m(e);let d=p().$implicit,u=p();return g(u.onProductSelectChange(d,a))}),v(3,Mt,2,2,"option",28),r(),n(4,"div",78)(5,"button",79),f("click",function(){m(e);let a=p(2);return g(a.closeProductPicker())}),s(6,"Chiudi"),r(),v(7,Ot,2,0,"div",80),r()()}if(o&2){let e=p().$implicit,i=p();l(),c("value",i.getSelectedProducts(e))("disabled",i.updatingProdottoIds.has(e.id)),l(2),c("ngForOf",i.getManualProducts()),l(4),c("ngIf",i.updatingProdottoIds.has(e.id))}}function Ft(o,t){o&1&&(n(0,"span",83),s(1,"S\xEC"),r())}function Vt(o,t){o&1&&(n(0,"span",84),s(1,"No"),r())}function zt(o,t){if(o&1&&(N(0),n(1,"span"),s(2),r(),$()),o&2){let e=t.ngIf;l(2),y(e.tipo)}}function Rt(o,t){o&1&&s(0,"\u2014")}function Dt(o,t){if(o&1){let e=x();n(0,"button",85),f("click",function(a){m(e);let d=p().$implicit,u=p();return a.stopPropagation(),g(u.vediConfigurazionePromethea(d))}),P(1,"img",86),r()}}function Nt(o,t){if(o&1){let e=x();n(0,"button",87),f("click",function(a){m(e);let d=p().$implicit,u=p();return a.stopPropagation(),g(u.vediTrattativaYuvi(d))}),P(1,"img",88),r()}}function $t(o,t){if(o&1){let e=x();n(0,"button",89),f("click",function(a){m(e);let d=p().$implicit,u=p();return a.stopPropagation(),g(u.goToInformazioniTecniche(d))}),n(1,"span",22),s(2,"build"),r()()}}function Ut(o,t){if(o&1){let e=x();n(0,"tr",48)(1,"td",49)(2,"div",50)(3,"strong",51),f("click",function(){let a=m(e).$implicit,d=p();return g(d.apriScheda(a))}),s(4),r()()(),n(5,"td",52)(6,"div",50),s(7),r()(),n(8,"td",53)(9,"div",50),s(10),r()(),n(11,"td",54)(12,"div",50),v(13,Pt,2,1,"span",42)(14,It,2,1,"span",42)(15,Et,2,0,"span",55),r()(),n(16,"td",56)(17,"div",50),v(18,At,2,1,"div",57)(19,Lt,8,4,"div",58),r()(),n(20,"td",59)(21,"div",50),v(22,Ft,2,0,"span",60)(23,Vt,2,0,"span",61),r()(),n(24,"td",62)(25,"div",50),v(26,zt,3,1,"ng-container",63)(27,Rt,1,0,"ng-template",null,3,H),r()(),n(29,"td",64)(30,"div",65),v(31,Dt,2,0,"button",66)(32,Nt,2,0,"button",67)(33,$t,3,0,"button",68),n(34,"app-action-dropdown",69),f("opened",function(){m(e);let a=p();return g(a.dropdownAnyOpen.set(!0))})("closed",function(){m(e);let a=p();return g(a.dropdownAnyOpen.set(!1))})("action",function(a){let d=m(e).$implicit,u=p();return g(u.handleRowAction(a,d))}),r()()()()}if(o&2){let e=t.$implicit,i=k(28),a=p();D("data-row-id",e.id),l(4),y(e.ragione_sociale),l(3),y(e.referente||"\u2014"),l(3),y(e.telefono||"\u2014"),l(3),c("ngIf",e.comune),l(),c("ngIf",e.provincia),l(),c("ngIf",!e.comune&&!e.provincia),l(3),c("ngIf",a.getSelectedProducts(e).length>0),l(),c("ngIf",a.isProductPickerOpen(e)),l(3),c("ngIf",e.configurato),l(),c("ngIf",!e.configurato),l(3),c("ngIf",e.ultimoEsito)("ngIfElse",i),l(5),c("ngIf",e.hasConfigPromethea),l(),c("ngIf",e.hasTrattativaYuvi),l(),c("ngIf",a.showInformazioniTecniche(e)),l(),c("row",e)("hideAddProduct",a.dropdownAnyOpen())("showPromethea",!1)("primaryIcons",W(20,Ct,e.hasConfigPromethea,e.hasTrattativaYuvi,a.showInformazioniTecniche(e)))}}function Yt(o,t){if(o&1&&(n(0,"tr")(1,"td",90),s(2),r()()),o&2){let e=p();l(2),w(" ",e.searchTerm?"Nessun cliente trovato":"Nessun cliente"," ")}}function jt(o,t){o&1&&(n(0,"span",22),s(1,"unfold_more"),r())}function Bt(o,t){o&1&&(n(0,"span",22),s(1,"hourglass_bottom"),r())}function Kt(o,t){if(o&1){let e=x();n(0,"div",91)(1,"button",92),f("click",function(){m(e);let a=p();return g(a.caricaTutti())}),v(2,jt,2,0,"span",93)(3,Bt,2,0,"span",93),s(4),r()()}if(o&2){let e=p();l(),c("disabled",e.loading()),l(),c("ngIf",!e.loading()),l(),c("ngIf",e.loading()),l(),w(" ",e.loading()?"Caricamento\u2026":"Carica tutti"," ")}}function qt(o,t){if(o&1&&(n(0,"div",94),s(1),r()),o&2){let e=p();l(),w(" ",e.error()," ")}}var vt=class o{listaService=C(mt);supabaseService=C(et);soggettiService=C(dt);kpiService=C(ut);authService=C(it);router=C(Z);userService=C(nt);searchSubject=new A;destroy$=new A;rows=this.listaService.rows;filteredRows=this.listaService.filteredRows;loading=this.listaService.loading;error=this.listaService.error;hasMore=this.listaService.hasMore;currentFiltri=this.listaService.currentFiltri;userModuli=b([]);isUserAdmin=b(!1);_configuredIds=new Set;dropdownAnyOpen=b(!1);_configuredCount=b(-1);get configuredCount(){let t=this._configuredCount();if(t>=0)return t;try{let e=this.rows,i=typeof e=="function"?e():Array.isArray(e)?e:[];return Array.isArray(i)?i.filter(a=>!!a.configurato).length:0}catch{return 0}}get configuredCardCount(){try{let t=this.rows,e=typeof t=="function"?t():Array.isArray(t)?t:[];return Array.isArray(e)?e.filter(i=>i?.configurato===!0&&(i?.tipo==="cliente"||!i?.tipo)).length:0}catch{return 0}}kpiLoading=b(!1);province=b([]);kpi=b({totale:0,conIban:0,conReferente:0});_openProductPickerForId=null;deletingIds=new Set;showEsito=!1;selectedId=null;updatingProdottoIds=new Set;esitiTipi=gt;searchTerm="";filtroConIban=!1;filtroConReferente=!1;isLoading=b(!0);renderer=C(z);constructor(){this.searchSubject.pipe(V(this.destroy$),L(300),F()).subscribe(t=>{this.onSearchExecuted(t)})}ngOnInit(){return _(this,null,function*(){this.listaService.inizializza({tipo:"cliente",abilitaConfigurazioni:!0,abilitaTrattative:!0});try{yield Promise.all([this.listaService.caricaIniziali(),this.loadProvince(),this.refreshKpi(),this.loadUserData()]),yield this.loadConfiguredCount()}finally{setTimeout(()=>{this.isLoading.set(!1)},300)}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadUserData(){return _(this,null,function*(){try{let t=this.authService.user();if(!t)return;let e=yield this.soggettiService.supabaseService.isAdmin();this.isUserAdmin.set(e);let{data:i}=yield this.soggettiService.supabaseService.getAppUserById(t.id);i&&i.moduli&&this.userModuli.set(i.moduli)}catch(t){console.error("Errore nel caricamento dati utente:",t)}})}caricaTutti(){return _(this,null,function*(){yield this.listaService.caricaTutti()})}allLoaded(){return this.listaService.allLoaded()}onSearchExecuted(t){return _(this,null,function*(){yield this.listaService.cerca(t)})}onSearchChange(t){this.searchTerm=t,this.searchSubject.next(t)}onChangeFiltroEsito(t){this.listaService.applicaFiltri({esito:t,conIban:this.filtroConIban,conReferente:this.filtroConReferente})}onChangeFiltroProvincia(t){this.listaService.applicaFiltri({provincia:t})}onChangeSortDir(t){this.listaService.applicaFiltri({sortDir:t})}onFiltroTotale(){return _(this,null,function*(){this.filtroConIban=!1,this.filtroConReferente=!1,this.listaService.applicaFiltri({esito:"tutti",provincia:"tutte",conIban:!1,conReferente:!1}),yield this.listaService.caricaIniziali()})}onFiltroConIban(){this.filtroConIban=!0,this.filtroConReferente=!1,this.listaService.applicaFiltri({esito:"tutti",conIban:!0,conReferente:!1})}onFiltroConReferente(){this.filtroConIban=!1,this.filtroConReferente=!0,this.listaService.applicaFiltri({esito:"tutti",conIban:!1,conReferente:!0})}vediConfigurazionePromethea(t){this.router.navigate(["/alchemizzatore"],{queryParams:{prospectId:t.id,step:6},state:{prospect:t,goToStep:6,from:"lista-clienti"}})}vediTrattativaYuvi(t){return _(this,null,function*(){try{let{data:e,error:i}=yield this.soggettiService.supabaseService.supabase.from("trattative_yuvi").select("*").eq("prospect_id",t.id).order("created_at",{ascending:!1}).limit(1).single();if(i)throw i;if(!e){alert("Nessuna trattativa YUVI trovata per questo cliente");return}this.router.navigate(["/yuvi-trattativa"],{queryParams:{clienteId:t.id,trattativaId:e.id},state:{cliente:t,trattativaEsistente:e}})}catch(e){alert("Errore nel caricamento della trattativa: "+e.message)}})}onDelete(t){return _(this,null,function*(){if(!(!t?.id||!confirm(`Eliminare il cliente "${t.ragione_sociale}"?`))){this.deletingIds.add(t.id);try{(yield this.listaService.eliminaSoggetto(t.id))&&(yield this.refreshKpi())}catch(i){console.error("Errore durante l'eliminazione:",i)}finally{this.deletingIds.delete(t.id)}}})}onEdit(t){t?.id&&this.router.navigate(["/soggetto",t.id,"edit"])}openEsito(t){this.selectedId=t.id,this.showEsito=!0}apriScheda(t){t?.id&&this.router.navigate(["/soggetto",t.id])}onPopupClosed(t){return _(this,null,function*(){this.showEsito=!1,this.selectedId=null,t.saved&&(yield Promise.all([this.listaService.caricaTutti(),this.refreshKpi()]))})}onChangeProdotto(t,e){return _(this,null,function*(){if(!t?.id)return;let i=e;if(t.prodotto!==i){this.updatingProdottoIds.add(t.id);try{yield this.listaService.aggiornaProdotto(t.id,i)}catch(a){console.error("Errore durante l'aggiornamento del prodotto:",a)}finally{this.updatingProdottoIds.delete(t.id)}}})}showInformazioniTecniche(t){if(!t.moduliAttivi||t.moduliAttivi.length===0)return!1;if(this.isUserAdmin())return!0;let e=this.userModuli();return t.moduliAttivi.some(i=>e.includes(i))}getModuloDaAprire(t){let e=this.userModuli(),i=t.moduliAttivi||[];return this.isUserAdmin()?i[0]||"social":i.find(d=>e.includes(d))||"social"}goToInformazioniTecniche(t){if(!t.id){console.error("Cliente senza ID:",t);return}console.log("Navigando a informazioni tecniche per cliente:",t.id),this.router.navigate(["/informazioni-tecniche"],{queryParams:{clienteId:t.id}})}isAdmin(){return this.userService.isAdmin()}trackById=(t,e)=>e.id;loadProvince(){return _(this,null,function*(){let{data:t}=yield this.soggettiService.getProvinceByTipo("cliente");t&&this.province.set(t)})}refreshKpi(){return _(this,null,function*(){try{this.kpiLoading.set(!0);let t=yield this.kpiService.getAnagraficaKPI("cliente");this.kpi.set({totale:t.totale,conIban:t.conIban,conReferente:t.conReferente})}catch(t){console.error("Errore nel caricamento KPI:",t)}finally{this.kpiLoading.set(!1)}})}getLastEsito(t){return!Array.isArray(t)||t.length===0?null:t.reduce((e,i)=>{let a=new Date(i.ts).getTime(),d=new Date(e.ts).getTime();return a>d?i:e})}handleRowAction(t,e){switch(t){case"promethea":this.vediConfigurazionePromethea(e);break;case"yuvi":this.vediTrattativaYuvi(e);break;case"info-tecniche":this.goToInformazioniTecniche(e);break;case"edit":this.onEdit(e);break;case"esito":this.openEsito(e);break;case"delete":this.onDelete(e);break;default:console.warn("Azione non gestita",t)}}get filteredCount(){try{let t=this.filteredRows??this.rows;if(typeof t=="function"){let i=t();return Array.isArray(i)?i.length:0}if(Array.isArray(t))return t.length;let e=this.displayRows;if(typeof e=="function"){let i=e();return Array.isArray(i)?i.length:0}return 0}catch{return 0}}resetAllFilters(){return _(this,null,function*(){this.searchTerm="",this.filtroConIban=!1,this.filtroConReferente=!1,this.listaService.applicaFiltri({provincia:"tutte",searchTerm:"",esito:"tutti",sortDir:"desc",configurato:null,conIban:!1,conReferente:!1,prodotto:"tutti",categoria_ateco:"tutte"});try{yield this.listaService.caricaIniziali(),yield this.refreshKpi()}catch(t){console.error("Errore reset filtri:",t)}})}loadConfiguredCount(){return _(this,null,function*(){try{let t=new Set,[e,i]=yield Promise.all([this.supabaseService.supabase.from("configurazioni_promethea").select("cliente_id, prospect_id"),this.supabaseService.supabase.from("trattative_yuvi").select("cliente_id, prospect_id")]);!e.error&&Array.isArray(e.data)&&e.data.forEach(h=>{h?.cliente_id&&t.add(String(h.cliente_id).trim()),h?.prospect_id&&t.add(String(h.prospect_id).trim())}),!i.error&&Array.isArray(i.data)&&i.data.forEach(h=>{h?.cliente_id&&t.add(String(h.cliente_id).trim()),h?.prospect_id&&t.add(String(h.prospect_id).trim())});let a=Array.from(t).filter(Boolean);if(this._configuredIds=new Set(a),a.length===0){this._configuredCount.set(0);return}let d=(h,I=100)=>{let E=[];for(let T=0;T<h.length;T+=I)E.push(h.slice(T,T+I));return E},u=0,ht=d(a,100);for(let h of ht){let{data:I,error:E}=yield this.supabaseService.supabase.from("soggetti").select("id").in("id",h).eq("tipo","cliente");if(E){console.warn("Partial soggetti fetch error (configured count chunk):",E);continue}Array.isArray(I)&&(u+=I.length)}this._configuredCount.set(u);return}catch(t){console.error("Errore loadConfiguredCount clienti",t),this._configuredCount.set(0)}})}onFiltroConfigurati(){if(this.listaService&&typeof this.listaService.applicaFiltri=="function"){this.listaService.applicaFiltri({configurato:!0,configuredIds:Array.from(this._configuredIds)});return}this.filtri=O(M({},this.filtri||{}),{configurato:!0}),typeof this.refresh=="function"?this.refresh():typeof this.loadRows=="function"?this.loadRows():console.warn("Impossibile applicare filtro configurato: implementa listaService.applicaFiltri o refresh/loadRows")}getSelectedProducts(t){try{if(Array.isArray(t.prodotti)&&t.prodotti.length)return t.prodotti.map(e=>(e?.nome??e?.product_name??String(e)).toString());if(t.prodotto)return[String(t.prodotto)];if(t.prodotto_nome)return[String(t.prodotto_nome)];if(t.extra_data){if(typeof t.extra_data=="string")try{t.extra_data=JSON.parse(t.extra_data)}catch{}if(t.extra_data?.prodotti){let e=t.extra_data.prodotti;if(Array.isArray(e))return e.map(i=>String(i.nome??i));if(typeof e=="string")return[e]}}for(let e of Object.keys(t||{}))if(/prodotti?|product|prodotto_nome/i.test(e)&&t[e]){let i=t[e];return Array.isArray(i)?i.map(a=>String(a.nome??a)):[String(i)]}}catch(e){console.warn("getSelectedProducts fallback error",e)}return[]}getManualProducts(){return this.manualProducts||[]}isProductPickerOpen(t){return this._openProductPickerForId===t.id}openProductPicker(t){this._openProductPickerForId=t.id,(!this.manualProducts||!this.manualProducts.length)&&this.loadManualProducts?.()}closeProductPicker(){this._openProductPickerForId=null}onProductSelectChange(t,e){return _(this,null,function*(){let i=e.target,a=Array.from(i.selectedOptions).map(d=>d.value);yield this.updateRowProducts(t,a)})}removeSelectedProduct(t,e){return _(this,null,function*(){let a=this.getSelectedProducts(t).filter(d=>d!==e);yield this.updateRowProducts(t,a)})}updateRowProducts(t,e){return _(this,null,function*(){try{this.updatingProdottoIds.add(t.id);let i=Array.isArray(e)?e.join(", "):String(e||""),a=yield this.soggettiService.updateProdotto(t.id,i);if(a&&!a.error)t.prodotto=i,t.prodotti=(e||[]).map(d=>({nome:d}));else throw console.error("Errore aggiornamento prodotti:",a?.error||a),a?.error||new Error("Aggiornamento prodotti fallito")}catch(i){console.error("Errore aggiornamento prodotti",i),alert("Errore aggiornamento prodotti: "+(i?.message||String(i)))}finally{this.updatingProdottoIds.delete(t.id),this.closeProductPicker()}})}isProdottoAutomatico(t,e){if(!t)return!1;let i=String(t).trim().toLowerCase();return["promethea","yuvi"].includes(i)}onDropdownOpened(){this.dropdownAnyOpen.set(!0)}onDropdownClosed(){this.dropdownAnyOpen.set(!1)}getActionItemsForRow(t,e){return Array.isArray(e)?this.dropdownAnyOpen()?e.filter(i=>{let a=i&&i.key?String(i.key).toLowerCase():"",d=i&&i.label?String(i.label).toLowerCase():"";return a!=="aggiungi-prodotto"&&d!=="aggiungi prodotto"}):e:[]}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=R({type:o,selectors:[["app-lista-clienti"]],decls:111,vars:33,consts:[["filtroSel",""],["ordinaSel",""],["provSel",""],["noEsito",""],["sel",""],["title","Caricamento Clienti","subtitle","Stiamo caricando i tuoi clienti...",3,"isLoading"],[1,"form-section"],[1,"section-header"],[1,"material-icons","header-icon"],[1,"section-titles"],[1,"section-title"],[1,"sottotitolo"],[1,"flex-1"],["class","icon-btn","title","Aggiungi cliente","aria-label","Aggiungi cliente",3,"routerLink",4,"ngIf"],[1,"prospect-cards"],[1,"card",3,"click"],[1,"card-title"],[1,"card-number"],[1,"table-section"],[1,"table-tools"],[1,"tool"],["for","search",1,"label"],[1,"material-icons"],["id","search","type","text","placeholder","Nome, telefono, email...",1,"table-inline-input",3,"ngModelChange","ngModel"],["for","filtroEsito",1,"label"],["id","filtroEsito",1,"table-inline-select",3,"change","value"],["value","tutti"],["value","senza-esito"],[3,"value",4,"ngFor","ngForOf"],["for","ordinaPer",1,"label"],["id","ordinaPer",1,"table-inline-select",3,"change","value"],["value","desc"],["value","asc"],["for","filtroProvincia",1,"label"],["id","filtroProvincia",1,"table-inline-select",3,"change","value"],["value","tutte"],["type","button",1,"promethea-button","ghost",3,"click"],[1,"tool",2,"display","flex","align-items","center","gap","var(--gutter-sm)","margin","var(--gutter-sm) 0"],["title","Risultati filtrati",1,"chip",2,"margin","0 var(--gutter-lg)"],[1,"table-container"],[1,"crm-table"],["class","row-clickable",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],["class","load-more-container",4,"ngIf"],["style","text-align:center; color:#ef4444; margin-top:1rem;",4,"ngIf"],[3,"closed","open","soggettoId","tipo"],["title","Aggiungi cliente","aria-label","Aggiungi cliente",1,"icon-btn",3,"routerLink"],[3,"value"],[1,"row-clickable"],["data-label","Ragione Sociale"],[1,"cell-content"],[1,"link",3,"click"],["data-label","Referente"],["data-label","Telefono"],["data-label","Localit\xE0"],["style","color: #6b7280; font-style: italic;",4,"ngIf"],["data-label","Prodotto"],["class","selected-badges",4,"ngIf"],["class","product-picker",4,"ngIf"],["data-label","Configurato"],["class","badge badge-success",4,"ngIf"],["class","badge badge-danger",4,"ngIf"],["data-label","Ultimo Esito"],[4,"ngIf","ngIfElse"],["data-label","Azioni"],[1,"actions-container"],["class","action-btn document","title","Configurazione Promethea",3,"click",4,"ngIf"],["class","action-btn email","title","Trattativa YUVI",3,"click",4,"ngIf"],["class","action-btn info-tecniche","title","Informazioni Tecniche",3,"click",4,"ngIf"],[3,"opened","closed","action","row","hideAddProduct","showPromethea","primaryIcons"],[2,"color","#6b7280","font-style","italic"],[1,"selected-badges"],["class","product-badge",3,"ngClass",4,"ngFor","ngForOf"],[1,"product-badge",3,"ngClass"],["class","badge-remove","type","button",3,"title","click",4,"ngIf"],["type","button",1,"badge-remove",3,"click","title"],[1,"product-picker"],["multiple","",1,"table-inline-select",3,"change","value","disabled"],[2,"margin-top","0.5rem","display","flex","gap","0.5rem","align-items","center"],[1,"promethea-button","outline",3,"click"],["class","loading-indicator","style","margin-left:0.5rem;",4,"ngIf"],[1,"loading-indicator",2,"margin-left","0.5rem"],[1,"loading-spinner",2,"width","20px","height","20px","border-width","2px"],[1,"badge","badge-success"],[1,"badge","badge-danger"],["title","Configurazione Promethea",1,"action-btn","document",3,"click"],["src","assets/Logo.png","alt","Promethea",1,"icon-img"],["title","Trattativa YUVI",1,"action-btn","email",3,"click"],["src","assets/yuvi.png","alt","YUVI",1,"icon-img"],["title","Informazioni Tecniche",1,"action-btn","info-tecniche",3,"click"],["colspan","8",2,"text-align","center","padding","1.5rem"],[1,"load-more-container"],[1,"promethea-button",3,"click","disabled"],["class","material-icons",4,"ngIf"],[2,"text-align","center","color","#ef4444","margin-top","1rem"]],template:function(e,i){if(e&1){let a=x();P(0,"app-page-loader",5),n(1,"div")(2,"div",6)(3,"div",7)(4,"i",8),s(5,"business"),r(),n(6,"div",9)(7,"h2",10),s(8,"Clienti"),r(),n(9,"p",11),s(10,"Panoramica clienti e filtri rapidi"),r()(),P(11,"div",12),v(12,xt,3,2,"a",13),r(),n(13,"div",14)(14,"div",15),f("click",function(){return m(a),g(i.resetAllFilters())}),n(15,"h3",16),s(16,"Totale"),r(),n(17,"div",17),s(18),r()(),n(19,"div",15),f("click",function(){return m(a),g(i.onFiltroConIban())}),n(20,"h3",16),s(21,"Con IBAN"),r(),n(22,"div",17),s(23),r()(),n(24,"div",15),f("click",function(){return m(a),g(i.onFiltroConReferente())}),n(25,"h3",16),s(26,"Con Referente"),r(),n(27,"div",17),s(28),r()(),n(29,"div",15),f("click",function(){return m(a),g(i.onFiltroConfigurati())}),n(30,"h3",16),s(31,"Configurati"),r(),n(32,"div",17),s(33),r()()()(),n(34,"section",18)(35,"div",19)(36,"div",20)(37,"label",21)(38,"span",22),s(39,"search"),r(),s(40," Cerca "),r(),n(41,"input",23),j("ngModelChange",function(u){return m(a),Y(i.searchTerm,u)||(i.searchTerm=u),g(u)}),f("ngModelChange",function(u){return m(a),g(i.onSearchChange(u))}),r()(),n(42,"div",20)(43,"label",24)(44,"span",22),s(45,"filter_list"),r(),s(46," Ultimo esito "),r(),n(47,"select",25,0),f("change",function(){m(a);let u=k(48);return g(i.onChangeFiltroEsito(u.value))}),n(49,"option",26),s(50,"Tutti"),r(),n(51,"option",27),s(52,"Senza esito"),r(),v(53,St,2,2,"option",28),r()(),n(54,"div",20)(55,"label",29)(56,"span",22),s(57,"sort"),r(),s(58," Ordina per: "),r(),n(59,"select",30,1),f("change",function(){m(a);let u=k(60);return g(i.onChangeSortDir(u.value))}),n(61,"option",31),s(62,"Pi\xF9 recente"),r(),n(63,"option",32),s(64,"Meno recente"),r()()(),n(65,"div",20)(66,"label",33)(67,"span",22),s(68,"place"),r(),s(69," Provincia "),r(),n(70,"select",34,2),f("change",function(){m(a);let u=k(71);return g(i.onChangeFiltroProvincia(u.value))}),n(72,"option",35),s(73,"Tutte"),r(),v(74,wt,2,2,"option",28),r()(),n(75,"div",20)(76,"button",36),f("click",function(){return m(a),g(i.resetAllFilters())}),n(77,"span",22),s(78,"filter_alt_off"),r(),s(79," Azzera filtri "),r()(),n(80,"div",37)(81,"span",38),s(82," Risultati: "),n(83,"strong"),s(84),r()()()(),n(85,"div",39)(86,"table",40)(87,"thead")(88,"tr")(89,"th"),s(90,"Ragione Sociale"),r(),n(91,"th"),s(92,"Referente"),r(),n(93,"th"),s(94,"Telefono"),r(),n(95,"th"),s(96,"Localit\xE0"),r(),n(97,"th"),s(98,"Prodotto"),r(),n(99,"th"),s(100,"Configurato"),r(),n(101,"th"),s(102,"Ultimo Esito"),r(),n(103,"th"),s(104,"Azioni"),r()()(),n(105,"tbody"),v(106,Ut,35,24,"tr",41)(107,Yt,3,1,"tr",42),r()()(),v(108,Kt,5,4,"div",43)(109,qt,2,1,"div",44),r(),n(110,"app-esito-popup",45),f("closed",function(u){return m(a),g(i.onPopupClosed(u))}),r()()}e&2&&(c("isLoading",i.isLoading()),l(),S("hidden",i.isLoading()),l(11),c("ngIf",i.isAdmin()),l(2),S("card-active",i.currentFiltri().esito==="tutti"&&i.currentFiltri().provincia==="tutte"&&!i.currentFiltri().conIban&&!i.currentFiltri().conReferente),l(4),y(i.kpi().totale),l(),S("card-active",i.currentFiltri().conIban),l(4),y(i.kpi().conIban),l(),S("card-active",i.currentFiltri().conReferente),l(4),y(i.kpi().conReferente),l(),S("card-active",i.currentFiltri().configurato===!0),l(4),y(i.configuredCardCount),l(8),U("ngModel",i.searchTerm),l(6),c("value",i.currentFiltri().esito),l(6),c("ngForOf",i.esitiTipi),l(6),c("value",i.currentFiltri().sortDir),l(11),c("value",i.currentFiltri().provincia),l(4),c("ngForOf",i.province()),l(10),y(i.filteredCount),l(),S("dropdown-open",i.dropdownAnyOpen()),l(21),c("ngForOf",i.filteredRows())("ngForTrackBy",i.trackById),l(),c("ngIf",!i.loading()&&!i.error()&&i.filteredRows().length===0),l(),c("ngIf",!i.error()&&i.hasMore()),l(),c("ngIf",i.error()),l(),c("open",i.showEsito)("soggettoId",i.selectedId)("tipo","cliente"))},dependencies:[X,J,G,Q,ft,ct,st,lt,rt,ot,at,pt,tt,_t],styles:['.actions-dropdown[_ngcontent-%COMP%]{position:relative;display:inline-flex}.actions-dropdown[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;width:200px;z-index:1000;border:1px solid var(--smoke-color-1);border-radius:12px;box-shadow:0 8px 24px var(--shadow);background:var(--background);animation:_ngcontent-%COMP%_slideDown .2s ease-out}.actions-dropdown.open.centered[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{position:fixed!important;top:50%!important;left:50%!important;transform:translate(-50%,-50%)!important;width:min(90vw,420px)!important;max-height:80vh!important;overflow-y:auto!important;right:auto!important;z-index:1202!important;border-radius:16px!important;box-shadow:0 30px 80px #00000059!important}.actions-dropdown.open.centered[_ngcontent-%COMP%] ~ .mobile-dropdown-backdrop[_ngcontent-%COMP%], .actions-dropdown.open.centered[_ngcontent-%COMP%]   .mobile-dropdown-backdrop[_ngcontent-%COMP%]{display:block!important;z-index:1201!important}.actions-dropdown.open.centered[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]{padding:.5rem 0!important}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}.dropdown-item[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;gap:var(--gutter-sm);padding:.75rem 1rem;border:none;background:transparent;color:var(--text-color);cursor:pointer;transition:background .15s ease;font-size:var(--fs-sm);text-align:left;border-bottom:1px solid var(--smoke-color-1)}.dropdown-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.dropdown-item[_ngcontent-%COMP%]:hover{background:var(--smoke-color-2)}.dropdown-item[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.dropdown-item[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:1.1rem;width:20px}.dropdown-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:transparent;z-index:999;display:none}.actions-dropdown.open[_ngcontent-%COMP%] ~ .dropdown-overlay[_ngcontent-%COMP%]{display:block}@container (max-width: 768px){.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.actions-dropdown){display:none}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-dropdown[_ngcontent-%COMP%]   .dropdown-item[style*="display: none"][_ngcontent-%COMP%]{display:flex!important}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-dropdown.open[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{position:fixed!important;inset:50% auto auto 50%!important;transform:translate(-50%,-50%)!important;width:min(90vw,300px)!important;max-height:70vh!important;overflow-y:auto!important;z-index:1001!important;border-radius:16px!important;box-shadow:0 20px 40px var(--shadow)!important}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-dropdown[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{width:3rem!important;height:3rem!important;font-size:1.3rem!important}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]{justify-content:center!important;padding:var(--gutter-sm) 0}}@container (min-width: 769px){.actions-dropdown[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{min-width:180px}.actions-dropdown.left[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{right:auto;left:0}.actions-dropdown.top[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{top:auto;bottom:100%}}.table-container[_ngcontent-%COMP%]{overflow-x:auto;position:relative}body.dropdown-open[_ngcontent-%COMP%]{overflow:hidden}.mobile-dropdown-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:color-mix(in srgb,var(--text-color) 20%,transparent);-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px);z-index:998;display:none}.actions-dropdown.open[_ngcontent-%COMP%] ~ .mobile-dropdown-backdrop[_ngcontent-%COMP%]{display:block}']})};export{vt as ListaClienti};
