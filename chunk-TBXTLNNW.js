import{a as ot}from"./chunk-7KQFHNMH.js";import{b as X,d as Y,f as Z,n as $,o as tt,p as et,s as it,u as at}from"./chunk-JKQMCFLO.js";import{b as nt}from"./chunk-4VPSVKZE.js";import"./chunk-AQO4YHIS.js";import"./chunk-UNZMF5LD.js";import{c as H,d as q,e as U,h as G,k as J,n as K,p as Q}from"./chunk-T73ZBVQL.js";import{Aa as E,Ab as b,Bb as C,Db as R,Ga as F,La as k,Va as A,Wa as m,X as g,Xa as i,Y as _,Ya as e,Za as P,bb as O,cb as V,eb as x,hb as p,ib as c,jb as L,kb as j,lb as M,mb as I,nb as r,ob as w,pb as u,qb as D,rb as f,sb as T,ta as N,tb as S,ua as s,wb as z}from"./chunk-54AF7LZE.js";import"./chunk-X5YLR3NI.js";import{a as W,c as B,i as h}from"./chunk-ODN5LVDJ.js";var lt=()=>[1,2,3,4,5],dt=()=>["da_fare","in_lavorazione","completato"],ct=()=>[];function mt(l,a){if(l&1&&(i(0,"div",14)(1,"p",15),r(2),e()()),l&2){let t=c();s(2),u("ID: ",t.macroTask.id)}}function gt(l,a){if(l&1){let t=x();i(0,"div",16)(1,"button",17),p("click",function(){g(t);let n=c();return _(n.router.navigate(["/task"]))}),i(2,"i",18),r(3,"arrow_back"),e(),i(4,"span",19),r(5,"Lista"),e()(),i(6,"button",20),p("click",function(){g(t);let n=c();return _(n.eliminaMacroTask())}),i(7,"i",18),r(8,"delete_forever"),e(),i(9,"span",19),r(10,"Elimina"),e()(),i(11,"button",21),p("click",function(){g(t);let n=c();return _(n.salvaComeTemplate())}),i(12,"i",18),r(13,"content_copy"),e(),i(14,"span",19),r(15,"Template"),e()(),i(16,"button",22),p("click",function(){g(t);let n=c();return _(n.salvaMacroTask())}),i(17,"i",18),r(18,"save"),e(),i(19,"span",19),r(20),e()()()}if(l&2){let t=c();s(6),m("disabled",t.loading),s(5),m("disabled",t.loading),s(5),m("disabled",t.loading),s(),M("spin",t.loading),s(3),w(t.loading?"Salva...":"Salva")}}function _t(l,a){l&1&&(i(0,"div",23),P(1,"div",24),i(2,"p"),r(3,"Caricamento task..."),e()())}function pt(l,a){if(l&1&&(i(0,"div",25)(1,"i",18),r(2,"warning"),e(),r(3),e()),l&2){let t=c();s(3),u(" ",t.error," ")}}function ut(l,a){if(l&1&&(i(0,"option",39),r(1),e()),l&2){let t=a.$implicit;m("value",t.id),s(),u(" ",t.ragione_sociale," ")}}function vt(l,a){if(l&1&&(i(0,"option",39),r(1),e()),l&2){let t=a.$implicit,o=c(2);m("value",t),s(),D(" P",t," - ",o.taskService.getNomePriorita(t)," ")}}function kt(l,a){if(l&1){let t=x();i(0,"div",61)(1,"button",62),p("click",function(){g(t);let n=c(2);return _(n.salvaMacroTask())}),i(2,"i",18),r(3,"save"),e(),r(4," Crea Macro Task "),e()()}if(l&2){let t=c(2);s(),m("disabled",t.loading),s(),M("spin",t.loading)}}function xt(l,a){l&1&&(i(0,"div",68)(1,"i",18),r(2,"layers"),e(),i(3,"h4"),r(4,"Nessuna sotto task"),e(),i(5,"p"),r(6,"Crea la prima sotto task per suddividere il lavoro"),e()())}function ft(l,a){if(l&1&&(i(0,"span",91)(1,"i",18),r(2,"checklist"),e(),r(3),e()),l&2){let t=c().$implicit;s(3),u(" ",t.task_dettaglio.length," dettagli ")}}function Tt(l,a){if(l&1){let t=x();i(0,"li")(1,"a",86),p("click",function(){let n=g(t).$implicit,d=c(2).$implicit,v=c(4);return v.cambiaStatoSottoTask(d,n),_(v.closeDropdown())}),r(2),e()()}if(l&2){let t=a.$implicit,o=c(6);s(2),u(" ",o.getStatoTesto(t)," ")}}function St(l,a){l&1&&(O(0),i(1,"li")(2,"h6",92),r(3,"Cambia Stato"),e()(),k(4,Tt,3,1,"li",93),i(5,"li"),P(6,"hr",94),e(),V()),l&2&&(s(4),m("ngForOf",z(1,dt)))}function ht(l,a){l&1&&(i(0,"div",95)(1,"i",18),r(2,"android"),e()())}function wt(l,a){if(l&1){let t=x();i(0,"p",107),p("click",function(){g(t);let n=c().$implicit,d=c(2).$implicit,v=c(4);return _(v.apriDettaglio(n,d))}),r(1),e()}if(l&2){let t=c().$implicit;s(),u(" ",t.descrizione," ")}}function Mt(l,a){if(l&1){let t=x();i(0,"div",98)(1,"div",99)(2,"input",100),p("change",function(){let n=g(t).$implicit,d=c(2).$implicit,v=c(4);return _(v.toggleDettaglioCompletato(n,d))}),e(),i(3,"div",101)(4,"div",102)(5,"strong"),r(6),e(),i(7,"span",15)(8,"i",18),r(9,"schedule"),e(),r(10),b(11,"date"),e(),i(12,"div",103),p("click",function(n){return g(t),_(n.stopPropagation())}),i(13,"button",104),p("click",function(n){let d=g(t).$implicit,v=c(2).$implicit,y=c(4);return n.stopPropagation(),_(y.apriDettaglio(d,v))}),i(14,"i",18),r(15,"edit"),e()(),i(16,"button",105),p("click",function(n){let d=g(t).$implicit,v=c(2).$implicit,y=c(4);return n.stopPropagation(),_(y.eliminaDettaglio(d,v))}),i(17,"i",18),r(18,"delete_forever"),e()()()(),k(19,wt,2,1,"p",106),e()()()}if(l&2){let t=a.$implicit;s(2),m("checked",t.completato),s(3),M("completed",t.completato),s(),w(t.nome),s(4),u(" ",C(11,6,t.data_scadenza_prevista,"dd/MM/yyyy")," "),s(9),m("ngIf",t.descrizione)}}function bt(l,a){if(l&1&&(i(0,"div",96),k(1,Mt,20,9,"div",97),e()),l&2){let t=c().$implicit,o=c(4);s(),m("ngForOf",t.task_dettaglio)("ngForTrackBy",o.trackByDettaglio)}}function Ct(l,a){if(l&1){let t=x();i(0,"div",68)(1,"i",18),r(2,"info"),e(),r(3," Nessun dettaglio aggiunto. "),i(4,"a",108),p("click",function(){g(t);let n=c().$implicit,d=c(4);return _(d.apriModal("dettaglio",n))}),r(5,"Aggiungi il primo dettaglio"),e()()}}function yt(l,a){if(l&1){let t=x();i(0,"div",71)(1,"div",72),p("click",function(){let n=g(t).$implicit,d=c(4);return _(d.toggleSottoTaskEspansa(n.id))}),i(2,"div",73)(3,"button",74),p("click",function(n){let d=g(t).$implicit,v=c(4);return n.stopPropagation(),_(v.toggleSottoTaskEspansa(d.id))}),i(4,"i",18),r(5),e()(),i(6,"div",75)(7,"h4",76),r(8),e(),i(9,"div",77)(10,"span",78),r(11),e(),i(12,"span",78),r(13),e(),i(14,"span",15)(15,"i",18),r(16,"calendar_today"),e(),r(17),b(18,"date"),e(),k(19,ft,4,1,"span",79),e()()(),i(20,"div",80),p("click",function(n){return g(t),_(n.stopPropagation())}),i(21,"button",81),p("click",function(){let n=g(t).$implicit,d=c(4);return _(d.apriModal("modificaSottoTask",n))}),i(22,"i",18),r(23,"edit"),e()(),i(24,"div",82)(25,"button",83),p("click",function(n){let d=g(t).$implicit,v=c(4);return _(v.toggleDropdown(d.id,n))}),i(26,"i",18),r(27,"more_vert"),e()(),i(28,"ul",84),p("click",function(n){return g(t),_(n.stopPropagation())}),k(29,St,7,2,"ng-container",85),i(30,"li")(31,"a",86),p("click",function(){let n=g(t).$implicit,d=c(4);return d.apriModal("dettaglio",n),_(d.closeDropdown())}),i(32,"i",18),r(33,"add"),e(),r(34," Aggiungi Dettaglio "),e()()()(),k(35,ht,3,0,"div",87),e()(),i(36,"div",88),k(37,bt,2,2,"div",89)(38,Ct,6,0,"div",90),e()()}if(l&2){let t=a.$implicit,o=c(4);M("expanded",o.isSottoTaskEspansa(t.id))("dropdown-open",o.isDropdownOpen(t.id)),s(3),m("title",o.isSottoTaskEspansa(t.id)?"Riduci dettagli":"Espandi dettagli"),A("aria-expanded",o.isSottoTaskEspansa(t.id)),s(2),u(" ",o.isSottoTaskEspansa(t.id)?"expand_less":"expand_more"," "),s(3),u(" ",t.nome," "),s(2),I(o.getPrioritaBadgeClass(t.priorita)),s(),u(" P",t.priorita," "),s(),I(o.getStatoBadgeClass(t.stato)),s(),u(" ",o.getStatoTesto(t.stato)," "),s(4),u(" ",C(18,24,t.created_at,"dd/MM/yyyy")," "),s(2),m("ngIf",t.task_dettaglio&&t.task_dettaglio.length>0),s(9),M("show",o.isDropdownOpen(t.id)),s(),m("ngIf",o.puoiModificareSottoTask(t)),s(6),m("ngIf",!o.puoiModificareSottoTask(t)),s(),M("show",o.isSottoTaskEspansa(t.id)),s(),m("ngIf",t.task_dettaglio&&t.task_dettaglio.length>0),s(),m("ngIf",!t.task_dettaglio||t.task_dettaglio.length===0)}}function Et(l,a){if(l&1&&(i(0,"div",69),k(1,yt,39,27,"div",70),e()),l&2){let t=c(3);s(),m("ngForOf",t.macroTask.sotto_tasks)("ngForTrackBy",t.trackBySottoTask)}}function Pt(l,a){if(l&1){let t=x();i(0,"div",2)(1,"div",3)(2,"h3",5)(3,"i",18),r(4,"layers"),e(),r(5," Sotto Tasks "),i(6,"span",63),r(7),e()(),i(8,"div",64)(9,"button",65),p("click",function(){g(t);let n=c(2);return _(n.toggleEspandiTutti())}),i(10,"i",18),r(11),e(),i(12,"span",19),r(13),e()(),i(14,"button",66),p("click",function(){g(t);let n=c(2);return _(n.apriModal("sottoTask"))}),i(15,"i",18),r(16,"add"),e(),i(17,"span",19),r(18,"Nuova"),e()()()(),k(19,xt,7,0,"ng-template",null,0,R)(21,Et,2,2,"div",67),e()}if(l&2){let t=L(20),o=c(2);s(7),w((o.macroTask.sotto_tasks==null?null:o.macroTask.sotto_tasks.length)||0),s(2),m("title",o.espandiTutti?"Riduci tutte":"Espandi tutte"),s(2),u(" ",o.espandiTutti?"unfold_less":"unfold_more"," "),s(2),w(o.espandiTutti?"Riduci":"Espandi"),s(8),m("ngIf",o.macroTask.sotto_tasks&&o.macroTask.sotto_tasks.length>0)("ngIfElse",t)}}function zt(l,a){if(l&1){let t=x();i(0,"div",26)(1,"div",27)(2,"div",2)(3,"h3",5),r(4,"Informazioni Principali"),e(),i(5,"div",28)(6,"div",29)(7,"label",30),r(8,"Nome Task *"),e(),i(9,"input",31),S("ngModelChange",function(n){g(t);let d=c();return T(d.macroTask.nome,n)||(d.macroTask.nome=n),_(n)}),e()(),i(10,"div",32)(11,"label",33),r(12,"Data Scadenza"),e(),i(13,"input",34),S("ngModelChange",function(n){g(t);let d=c();return T(d.macroTask.data_scadenza,n)||(d.macroTask.data_scadenza=n),_(n)}),e()(),i(14,"div",32)(15,"label",35),r(16,"Stato"),e(),P(17,"input",36),e()(),i(18,"div",32)(19,"label",37),r(20,"Cliente"),e(),i(21,"select",38),S("ngModelChange",function(n){g(t);let d=c();return T(d.macroTask.cliente_id,n)||(d.macroTask.cliente_id=n),_(n)}),i(22,"option",39),r(23,"Nessun cliente"),e(),k(24,ut,2,2,"option",40),e()(),i(25,"div",32)(26,"label",41),r(27,"Priorit\xE0"),e(),i(28,"select",42),S("ngModelChange",function(n){g(t);let d=c();return T(d.macroTask.priorita_globale,n)||(d.macroTask.priorita_globale=n),_(n)}),k(29,vt,2,3,"option",40),e()(),i(30,"div",32)(31,"label",43),r(32,"Modulo *"),e(),i(33,"select",44),S("ngModelChange",function(n){g(t);let d=c();return T(d.macroTask.assegnazione_id,n)||(d.macroTask.assegnazione_id=n),_(n)}),i(34,"option",39),r(35,"Seleziona Modulo"),e(),i(36,"option",45),r(37,"Immagine"),e(),i(38,"option",46),r(39,"Digitalizzazione"),e(),i(40,"option",47),r(41,"Contabilit\xE0"),e(),i(42,"option",48),r(43,"Ottimizzazione"),e()()(),i(44,"div",32)(45,"label",49),r(46,"Note"),e(),i(47,"textarea",50),S("ngModelChange",function(n){g(t);let d=c();return T(d.macroTask.note,n)||(d.macroTask.note=n),_(n)}),e()(),k(48,kt,5,3,"div",51),e(),k(49,Pt,22,6,"div",52),e(),i(50,"div",53)(51,"div",54)(52,"h4"),r(53,"Riepilogo Task"),e(),i(54,"div",55)(55,"div",56)(56,"label"),r(57,"Stato:"),e(),i(58,"span",57),r(59),e()(),i(60,"div",56)(61,"label"),r(62,"Priorit\xE0:"),e(),i(63,"span",57),r(64),e()(),i(65,"div",56)(66,"label"),r(67,"Progresso:"),e(),i(68,"div",58)(69,"div",59)(70,"span",60),r(71),e()()()(),i(72,"div",56)(73,"label"),r(74,"Cliente:"),e(),i(75,"span"),r(76),e()(),i(77,"div",56)(78,"label"),r(79,"Modulo:"),e(),i(80,"span"),r(81),e()(),i(82,"div",56)(83,"label"),r(84,"Scadenza:"),e(),i(85,"span"),r(86),b(87,"date"),e()(),i(88,"div",56)(89,"label"),r(90,"Creato il:"),e(),i(91,"span"),r(92),b(93,"date"),e()(),i(94,"div",56)(95,"label"),r(96,"Aggiornato il:"),e(),i(97,"span"),r(98),b(99,"date"),e()()()()()()}if(l&2){let t=c();s(9),f("ngModel",t.macroTask.nome),s(4),f("ngModel",t.macroTask.data_scadenza),s(4),m("value",t.taskService.getStatoTesto(t.macroTask.stato)),s(4),f("ngModel",t.macroTask.cliente_id),s(),m("value",null),s(2),m("ngForOf",t.clienti),s(4),f("ngModel",t.macroTask.priorita_globale),s(),m("ngForOf",z(39,lt)),s(4),f("ngModel",t.macroTask.assegnazione_id),s(),m("value",null),s(13),f("ngModel",t.macroTask.note),s(),m("ngIf",!t.macroTask.id),s(),m("ngIf",t.macroTask.id),s(9),m("ngClass",t.taskService.getStatoBadgeClass(t.macroTask.stato)),s(),u(" ",t.taskService.getStatoTesto(t.macroTask.stato)," "),s(4),m("ngClass",t.taskService.getPrioritaBadgeClass(t.macroTask.priorita_globale)),s(),u(" P",t.macroTask.priorita_globale," "),s(5),j("width",t.macroTask.progresso,"%"),m("ngClass",t.taskService.getStatoBadgeClass(t.macroTask.stato)),s(2),u("",t.macroTask.progresso,"%"),s(5),w(t.getNomeCliente(t.macroTask.cliente_id)),s(5),w(t.taskService.getModuloName(t.macroTask.assegnazione_id||null)),s(4),M("text-danger",t.taskService.isScaduta(t.macroTask.data_scadenza))("text-warning",t.taskService.isScadenzaImminente(t.macroTask.data_scadenza)),s(),u(" ",C(87,30,t.macroTask.data_scadenza,"dd/MM/yyyy")," "),s(6),w(C(93,33,t.macroTask.created_at,"dd/MM/yyyy HH:mm")),s(6),w(C(99,36,t.macroTask.updated_at,"dd/MM/yyyy HH:mm"))}}function Ot(l,a){if(l&1){let t=x();i(0,"div",109),p("click",function(){g(t);let n=c();return _(n.chiudiModal("sottoTask"))}),e()}}function Vt(l,a){if(l&1){let t=x();i(0,"div",110)(1,"div",111)(2,"div",112)(3,"div",113)(4,"h5",114)(5,"i",18),r(6,"layers"),e(),r(7," Nuova Sotto Task "),e(),i(8,"button",115),p("click",function(){g(t);let n=c();return _(n.chiudiModal("sottoTask"))}),e()(),i(9,"div",116)(10,"div",32)(11,"label",117),r(12,"Nome *"),e(),i(13,"input",118),S("ngModelChange",function(n){g(t);let d=c();return T(d.nuovaSottoTask.nome,n)||(d.nuovaSottoTask.nome=n),_(n)}),e()(),i(14,"div",32)(15,"label",119),r(16,"Priorit\xE0"),e(),i(17,"select",120),S("ngModelChange",function(n){g(t);let d=c();return T(d.nuovaSottoTask.priorita,n)||(d.nuovaSottoTask.priorita=n),_(n)}),i(18,"option",39),r(19,"1 - Minima"),e(),i(20,"option",39),r(21,"2 - Bassa"),e(),i(22,"option",39),r(23,"3 - Media"),e(),i(24,"option",39),r(25,"4 - Alta"),e(),i(26,"option",39),r(27,"5 - Critica"),e()()()(),i(28,"div",121)(29,"button",122),p("click",function(){g(t);let n=c();return _(n.chiudiModal("sottoTask"))}),r(30,"Annulla"),e(),i(31,"button",123),p("click",function(){g(t);let n=c();return _(n.creaSottoTask())}),r(32,"Crea"),e()()()()()}if(l&2){let t=c();s(13),f("ngModel",t.nuovaSottoTask.nome),s(4),f("ngModel",t.nuovaSottoTask.priorita),s(),m("value",1),s(2),m("value",2),s(2),m("value",3),s(2),m("value",4),s(2),m("value",5)}}function It(l,a){if(l&1){let t=x();i(0,"div",109),p("click",function(){g(t);let n=c();return _(n.chiudiModal("modificaSottoTask"))}),e()}}function Dt(l,a){if(l&1){let t=x();i(0,"div",110)(1,"div",111)(2,"div",112)(3,"div",113)(4,"h5",114)(5,"i",18),r(6,"edit"),e(),r(7," Modifica Sotto Task "),e(),i(8,"button",115),p("click",function(){g(t);let n=c();return _(n.chiudiModal("modificaSottoTask"))}),e()(),i(9,"div",116)(10,"div",32)(11,"label",124),r(12,"Nome *"),e(),i(13,"input",125),S("ngModelChange",function(n){g(t);let d=c();return T(d.sottoTaskModificata.nome,n)||(d.sottoTaskModificata.nome=n),_(n)}),e()(),i(14,"div",32)(15,"label",126),r(16,"Priorit\xE0"),e(),i(17,"select",127),S("ngModelChange",function(n){g(t);let d=c();return T(d.sottoTaskModificata.priorita,n)||(d.sottoTaskModificata.priorita=n),_(n)}),i(18,"option",128),r(19,"1 - Minima"),e(),i(20,"option",129),r(21,"2 - Bassa"),e(),i(22,"option",130),r(23,"3 - Media"),e(),i(24,"option",131),r(25,"4 - Alta"),e(),i(26,"option",132),r(27,"5 - Critica"),e()()(),i(28,"div",32)(29,"label",133),r(30,"Stato"),e(),i(31,"select",134),S("ngModelChange",function(n){g(t);let d=c();return T(d.sottoTaskModificata.stato,n)||(d.sottoTaskModificata.stato=n),_(n)}),i(32,"option",135),r(33,"Da Fare"),e(),i(34,"option",136),r(35,"In Lavorazione"),e(),i(36,"option",137),r(37,"Completato"),e()()()(),i(38,"div",121)(39,"button",122),p("click",function(){g(t);let n=c();return _(n.chiudiModal("modificaSottoTask"))}),r(40,"Annulla"),e(),i(41,"button",123),p("click",function(){g(t);let n=c();return _(n.salvaModificaSottoTask())}),r(42,"Salva Modifiche"),e()()()()()}if(l&2){let t=c();s(13),f("ngModel",t.sottoTaskModificata.nome),s(4),f("ngModel",t.sottoTaskModificata.priorita),s(14),f("ngModel",t.sottoTaskModificata.stato)}}function Wt(l,a){if(l&1){let t=x();i(0,"div",109),p("click",function(){g(t);let n=c();return _(n.chiudiModal("dettaglio"))}),e()}}function Bt(l,a){if(l&1){let t=x();i(0,"div",110)(1,"div",111)(2,"div",112)(3,"div",113)(4,"h5",114)(5,"i",18),r(6,"task"),e(),r(7),e(),i(8,"button",115),p("click",function(){g(t);let n=c();return _(n.chiudiModal("dettaglio"))}),e()(),i(9,"div",116)(10,"div",32)(11,"label",138),r(12,"Nome *"),e(),i(13,"input",139),S("ngModelChange",function(n){g(t);let d=c();return T(d.dettaglioModal.nome,n)||(d.dettaglioModal.nome=n),_(n)}),e()(),i(14,"div",32)(15,"label",140),r(16,"Descrizione"),e(),i(17,"textarea",141),S("ngModelChange",function(n){g(t);let d=c();return T(d.dettaglioModal.descrizione,n)||(d.dettaglioModal.descrizione=n),_(n)}),e()(),i(18,"div",32)(19,"label",142),r(20,"Data Scadenza Prevista"),e(),i(21,"input",143),S("ngModelChange",function(n){g(t);let d=c();return T(d.dettaglioModal.data_scadenza_prevista,n)||(d.dettaglioModal.data_scadenza_prevista=n),_(n)}),e()()(),i(22,"div",121)(23,"button",122),p("click",function(){g(t);let n=c();return _(n.chiudiModal("dettaglio"))}),r(24,"Annulla"),e(),i(25,"button",144),p("click",function(){g(t);let n=c();return _(n.salvaDettaglio())}),i(26,"i",18),r(27),e(),r(28),e()()()()()}if(l&2){let t=c();s(7),u(" ",t.modalDettaglioMode==="create"?"Nuovo Task di Dettaglio":"Modifica Dettaglio"," "),s(6),f("ngModel",t.dettaglioModal.nome),s(4),f("ngModel",t.dettaglioModal.descrizione),s(4),f("ngModel",t.dettaglioModal.data_scadenza_prevista),s(4),m("disabled",t.loading),s(2),w(t.modalDettaglioMode==="create"?"save":"edit"),s(),u(" ",t.modalDettaglioMode==="create"?"Crea Dettaglio":"Salva Modifiche"," ")}}function Nt(l,a){if(l&1){let t=x();i(0,"div",109),p("click",function(){g(t);let n=c();return _(n.chiudiTemplateModal())}),e()}}function Ft(l,a){if(l&1&&(i(0,"li")(1,"strong"),r(2),e(),r(3),e()),l&2){let t=a.$implicit;s(2),w(t.nome),s(),u(" - ",t.descrizione," ")}}function At(l,a){if(l&1&&(i(0,"ul"),k(1,Ft,4,2,"li",93),e()),l&2){let t=c().$implicit;s(),m("ngForOf",t.task_dettaglio)}}function Lt(l,a){if(l&1&&(i(0,"div",153)(1,"strong"),r(2),e(),r(3),k(4,At,2,1,"ul",85),e()),l&2){let t=a.$implicit,o=a.index;s(2),D("",o+1,". ",t.nome),s(),u(" (Priorit\xE0: ",t.priorita,") "),s(),m("ngIf",t.task_dettaglio&&t.task_dettaglio.length>0)}}function jt(l,a){if(l&1){let t=x();i(0,"div",110)(1,"div",111)(2,"div",112)(3,"div",113)(4,"h5",114)(5,"i",18),r(6,"content_copy"),e(),r(7," Salva come Template "),e(),i(8,"button",145),p("click",function(){g(t);let n=c();return _(n.chiudiTemplateModal())}),e()(),i(9,"div",116)(10,"div",32)(11,"label",146),r(12,"Nome Template *"),e(),i(13,"input",147),S("ngModelChange",function(n){g(t);let d=c();return T(d.nomeTemplate,n)||(d.nomeTemplate=n),_(n)}),e()(),i(14,"div",32)(15,"label",148),r(16,"Descrizione"),e(),i(17,"textarea",149),S("ngModelChange",function(n){g(t);let d=c();return T(d.descrizioneTemplate,n)||(d.descrizioneTemplate=n),_(n)}),e()(),i(18,"div",32)(19,"label",150),r(20,"Anteprima Struttura"),e(),i(21,"div",151),k(22,Lt,5,4,"div",152),e()()(),i(23,"div",121)(24,"button",122),p("click",function(){g(t);let n=c();return _(n.chiudiTemplateModal())}),r(25,"Annulla"),e(),i(26,"button",144),p("click",function(){g(t);let n=c();return _(n.confermaCreaTemplate())}),i(27,"i",18),r(28,"save"),e(),r(29),e()()()()()}if(l&2){let t=c();s(13),f("ngModel",t.nomeTemplate),s(4),f("ngModel",t.descrizioneTemplate),s(5),m("ngForOf",(t.macroTask==null?null:t.macroTask.sotto_tasks)||z(7,ct)),s(4),m("disabled",!t.nomeTemplate.trim()||t.loading),s(),M("fa-spin",t.loading),s(2),u(" ",t.loading?"Salvataggio...":"Crea Template"," ")}}function Rt(l,a){if(l&1){let t=x();i(0,"div",109),p("click",function(){g(t);let n=c();return _(n.chiudiModal("leggiDettaglio"))}),e()}}function Ht(l,a){if(l&1&&(i(0,"div",32)(1,"label",150),r(2,"Scadenza prevista"),e(),i(3,"div"),r(4),b(5,"date"),e()()),l&2){let t=c().ngIf;s(4),w(C(5,1,t.data_scadenza_prevista,"dd/MM/yyyy"))}}function qt(l,a){if(l&1&&(i(0,"div",32)(1,"label",150),r(2,"Descrizione completa"),e(),i(3,"div",155),r(4),e()()),l&2){let t=c().ngIf;s(4),w(t.descrizione)}}function Ut(l,a){if(l&1&&(O(0),i(1,"div",32)(2,"label",150),r(3,"Nome"),e(),i(4,"div"),r(5),e()(),k(6,Ht,6,4,"div",154)(7,qt,5,1,"div",154),V()),l&2){let t=a.ngIf;s(5),w(t.nome),s(),m("ngIf",t.data_scadenza_prevista),s(),m("ngIf",t.descrizione)}}function Gt(l,a){if(l&1){let t=x();i(0,"div",110)(1,"div",111)(2,"div",112)(3,"div",113)(4,"h5",114)(5,"i",18),r(6,"description"),e(),r(7," Dettaglio "),e(),i(8,"button",115),p("click",function(){g(t);let n=c();return _(n.chiudiModal("leggiDettaglio"))}),e()(),i(9,"div",116),k(10,Ut,8,3,"ng-container",85),e(),i(11,"div",121)(12,"button",122),p("click",function(){g(t);let n=c();return _(n.chiudiModal("leggiDettaglio"))}),r(13,"Chiudi"),e()()()()()}if(l&2){let t=c();s(10),m("ngIf",t.selectedDettaglioView)}}var rt=class l{constructor(a,t,o,n){this.router=a;this.route=t;this.taskService=o;this.soggettiService=n}macroTask=null;clienti=[];loading=!1;error="";activeDropdownId=null;selectedDettaglioView=null;modals={sottoTask:!1,dettaglio:!1,modificaSottoTask:!1,leggiDettaglio:!1};modalDettaglioMode="create";dettaglioModal={id:void 0,nome:"",descrizione:"",data_scadenza_prevista:new Date().toISOString().split("T")[0],sotto_task_id:""};sottoTaskStati=["da_fare","in_lavorazione","completato"];showTemplateModal=!1;nomeTemplate="";descrizioneTemplate="";nuovaSottoTask={nome:"",priorita:3,macro_task_id:""};nuovoDettaglio={nome:"",descrizione:"",data_scadenza_prevista:new Date().toISOString().split("T")[0],sotto_task_id:""};sottoTaskModificata={};sottoTaskDaModificare=null;selectedSottoTask=null;sottoTaskEspanse=new Set;espandiTutti=!1;ngOnInit(){return h(this,null,function*(){let a=this.route.snapshot.paramMap.get("id");a==="nuova"?this.inizializzaNuovaTask():a?yield this.caricaTask(a):this.inizializzaNuovaTask(),yield this.caricaDatiSupporto()})}inizializzaNuovaTask(){this.macroTask={id:"",nome:"",data_scadenza:new Date().toISOString().split("T")[0],cliente_id:"",assegnazione_id:null,note:"",stato:"da_fare",priorita_globale:1,progresso:0,created_at:"",updated_at:"",sotto_tasks:[],extra_data:{}}}caricaTask(a){return h(this,null,function*(){this.loading=!0;try{let t=yield this.taskService.getMacroTaskById(a);t.error?this.error="Errore: "+t.error.message:(this.macroTask=t.data,this.espandiTutti&&this.macroTask?.sotto_tasks?this.macroTask.sotto_tasks.forEach(o=>{this.sottoTaskEspanse.add(o.id)}):this.sottoTaskEspanse.clear())}catch(t){this.error="Errore: "+t.message}finally{this.loading=!1}})}caricaDatiSupporto(){return h(this,null,function*(){try{let a=yield this.soggettiService.getSoggettiByTipo("cliente");this.clienti=a.data||[]}catch(a){console.error("Errore caricamento clienti:",a)}})}apriModal(a,t){if(this.modals[a]=!0,a==="sottoTask"){let o=this.macroTask?.id;o&&(this.nuovaSottoTask.macro_task_id=o)}a==="dettaglio"&&t&&(this.selectedSottoTask=t,this.modalDettaglioMode="create",this.dettaglioModal={id:void 0,nome:"",descrizione:"",data_scadenza_prevista:new Date().toISOString().split("T")[0],sotto_task_id:t.id}),a==="modificaSottoTask"&&t&&(this.sottoTaskDaModificare=t,this.sottoTaskModificata=W({},t))}chiudiModal(a){this.modals[a]=!1,a==="sottoTask"&&(this.nuovaSottoTask={nome:"",priorita:3,macro_task_id:""}),a==="dettaglio"&&(this.modalDettaglioMode="create",this.dettaglioModal={id:void 0,nome:"",descrizione:"",data_scadenza_prevista:new Date().toISOString().split("T")[0],sotto_task_id:this.selectedSottoTask?.id??""},this.selectedSottoTask=null),a==="modificaSottoTask"&&(this.sottoTaskDaModificare=null,this.sottoTaskModificata={})}salvaDettaglio(){return h(this,null,function*(){if(!this.dettaglioModal.nome.trim()){this.error="Il nome del dettaglio \xE8 obbligatorio";return}if(!this.dettaglioModal.sotto_task_id){this.error="Seleziona una sotto-task valida";return}try{let a;if(this.modalDettaglioMode==="create"){let t={nome:this.dettaglioModal.nome,descrizione:this.dettaglioModal.descrizione,data_scadenza_prevista:this.dettaglioModal.data_scadenza_prevista,sotto_task_id:this.dettaglioModal.sotto_task_id};a=yield this.taskService.createTaskDettaglio(t)}else{if(!this.dettaglioModal.id)return;a=yield this.taskService.updateTaskDettaglio(this.dettaglioModal.id,{nome:this.dettaglioModal.nome,descrizione:this.dettaglioModal.descrizione,data_scadenza_prevista:this.dettaglioModal.data_scadenza_prevista})}a?.error?this.error="Errore: "+a.error.message:(yield this.aggiornaTask(),this.chiudiModal("dettaglio"))}catch(a){this.error="Errore: "+a.message}})}salvaMacroTask(){return h(this,null,function*(){if(!(!this.macroTask||!this.validazioneTask())){this.loading=!0,this.error="";try{let t;if(this.macroTask.id){let a=this.macroTask,{cliente:o,sotto_tasks:n}=a,d=B(a,["cliente","sotto_tasks"]),v={nome:d.nome,data_scadenza:d.data_scadenza,note:d.note||"",stato:d.stato,priorita_globale:d.priorita_globale,progresso:d.progresso};d.cliente_id&&this.isValidUUID(d.cliente_id)&&(v.cliente_id=d.cliente_id),d.assegnazione_id&&(v.assegnazione_id=d.assegnazione_id),t=yield this.taskService.updateMacroTask(this.macroTask.id,v)}else{let o={nome:this.macroTask.nome,data_scadenza:this.macroTask.data_scadenza,note:this.macroTask.note||"",stato:"da_fare"};this.macroTask.cliente_id&&this.isValidUUID(this.macroTask.cliente_id)&&(o.cliente_id=this.macroTask.cliente_id),this.macroTask.assegnazione_id&&(o.assegnazione_id=this.macroTask.assegnazione_id),t=yield this.taskService.createMacroTask(o)}t.error?this.error="Errore: "+t.error.message:this.router.navigate(["/task"])}catch(t){this.error="Errore: "+t.message}finally{this.loading=!1}}})}isValidUUID(a){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}validazioneTask(){return this.macroTask.nome.trim()?this.macroTask.assegnazione_id?!0:(this.error="Seleziona un modulo per assegnare la task",!1):(this.error="Il nome della task \xE8 obbligatorio",!1)}creaSottoTask(){return h(this,null,function*(){if(!this.nuovaSottoTask.nome.trim()){this.error="Il nome della sotto-task \xE8 obbligatorio";return}try{let a=yield this.taskService.createSottoTask(this.nuovaSottoTask);a.error?this.error="Errore: "+a.error.message:yield this.aggiornaTask(),this.chiudiModal("sottoTask")}catch(a){this.error="Errore: "+a.message}})}creaTaskDettaglio(){return h(this,null,function*(){if(!this.nuovoDettaglio.nome.trim()){this.error="Il nome del dettaglio \xE8 obbligatorio";return}try{let a=yield this.taskService.createTaskDettaglio(this.nuovoDettaglio);a.error?this.error="Errore: "+a.error.message:yield this.aggiornaTask(),this.chiudiModal("dettaglio")}catch(a){this.error="Errore: "+a.message}})}salvaModificaSottoTask(){return h(this,null,function*(){if(!this.sottoTaskDaModificare||!this.sottoTaskModificata.nome?.trim()){this.error="Il nome della sotto-task \xE8 obbligatorio";return}try{let a=yield this.taskService.updateSottoTask(this.sottoTaskDaModificare.id,this.sottoTaskModificata);a.error?this.error="Errore: "+a.error.message:yield this.aggiornaTask(),this.chiudiModal("modificaSottoTask")}catch(a){this.error="Errore: "+a.message}})}toggleDettaglioCompletato(a,t){return h(this,null,function*(){try{(yield this.taskService.toggleTaskDettaglioCompletato(a.id,!a.completato)).error||(a.completato=!a.completato,a.data_completamento=a.completato?new Date().toISOString():null,yield this.aggiornaStatoSottoTaskAutomatico(t),yield this.aggiornaTask())}catch(o){this.error="Errore: "+o.message}})}aggiornaStatoSottoTaskAutomatico(a){return h(this,null,function*(){if(!a.task_dettaglio?.length)return;let t=a.task_dettaglio.every(d=>d.completato),o=a.task_dettaglio.every(d=>!d.completato),n=a.stato;t?n="completato":o?n="da_fare":n="in_lavorazione",n!==a.stato&&(yield this.taskService.updateSottoTask(a.id,{stato:n}))})}aggiornaTask(){return h(this,null,function*(){let a=this.macroTask?.id;a&&(yield this.caricaTask(a))})}toggleDropdown(a,t){t?.stopPropagation(),this.activeDropdownId=this.activeDropdownId===a?null:a}isDropdownOpen(a){return this.activeDropdownId===a}closeDropdown(){this.activeDropdownId=null}puoiModificareSottoTask(a){return!a.task_dettaglio||a.task_dettaglio.length===0}getNomeCliente(a){return this.clienti.find(t=>t.id===a)?.ragione_sociale||"Non assegnato"}trackBySottoTask(a,t){return t.id}trackByDettaglio(a,t){return t.id}eliminaMacroTask(){return h(this,null,function*(){let a=this.macroTask?.id;if(!(!a||!confirm("Sei sicuro di voler eliminare questa macro task e tutti i contenuti collegati?"))){this.loading=!0,this.error="";try{let o=yield this.taskService.deleteMacroTaskCascade(a);if(o.error){this.error="Errore eliminazione: "+o.error.message;return}this.router.navigate(["/task"])}catch(o){this.error="Errore: "+o.message}finally{this.loading=!1}}})}eliminaDettaglio(a,t){return h(this,null,function*(){if(confirm("Sei sicuro di eliminare questo dettaglio?"))try{let o=yield this.taskService.deleteTaskDettaglio(a.id);if(o.error){this.error="Errore: "+o.error.message;return}t.task_dettaglio&&(t.task_dettaglio=t.task_dettaglio.filter(d=>d.id!==a.id)),yield this.aggiornaStatoSottoTaskAutomatico(t);let n=this.macroTask?.id;n&&(yield this.caricaTask(n))}catch(o){this.error="Errore: "+o.message}})}cambiaStatoSottoTask(a,t){return h(this,null,function*(){if(!this.puoiModificareSottoTask(a)){this.error="Impossibile modificare lo stato: questa sotto-task ha dettagli e lo stato viene gestito automaticamente";return}try{let o=yield this.taskService.updateSottoTask(a.id,{stato:t});o.error?this.error="Errore: "+o.error.message:(a.stato=t,this.macroTask&&(yield this.caricaTask(this.macroTask.id)))}catch(o){this.error="Errore: "+o.message}})}getPrioritaBadgeClass(a){return this.taskService.getPrioritaBadgeClass(a)}getStatoBadgeClass(a){return this.taskService.getStatoBadgeClass(a)}getStatoTesto(a){return this.taskService.getStatoTesto(a)}getModuloName(a){return this.taskService.getModuloName(a.assegnazione_id||null)}isScaduta(a){return this.taskService.isScaduta(a)}isScadenzaImminente(a){return this.taskService.isScadenzaImminente(a)}salvaComeTemplate(){if(!this.macroTask){this.error="Nessuna task da salvare come template";return}this.nomeTemplate=this.macroTask.nome+" - Template",this.descrizioneTemplate=this.macroTask.note||"",this.showTemplateModal=!0}chiudiTemplateModal(){this.showTemplateModal=!1,this.nomeTemplate="",this.descrizioneTemplate=""}confermaCreaTemplate(){return h(this,null,function*(){if(!this.macroTask||!this.nomeTemplate.trim()){this.error="Il nome del template \xE8 obbligatorio";return}this.loading=!0;try{let a={sotto_tasks:[]};if(this.macroTask.sotto_tasks)for(let n of this.macroTask.sotto_tasks){let d={nome:n.nome,priorita:n.priorita,task_dettaglio:[]};if(n.task_dettaglio)for(let v of n.task_dettaglio){let y=this.calcolaOffsetGiorni(v.data_scadenza_prevista,this.macroTask.created_at),st={nome:v.nome,descrizione:v.descrizione||"",data_scadenza_prevista_offset:y};d.task_dettaglio.push(st)}a.sotto_tasks.push(d)}let t={nome:this.nomeTemplate,descrizione:this.descrizioneTemplate||null,modulo:this.macroTask.assegnazione_id||"immagine",priorita_globale:this.macroTask.priorita_globale,data_scadenza_default:30,struttura_template:a},o=yield this.taskService.createMacroTaskTemplate(t);o.error?this.error="Errore nel salvataggio del template: "+o.error.message:(this.chiudiTemplateModal(),alert("Template salvato con successo!"))}catch(a){this.error="Errore: "+a.message}finally{this.loading=!1}})}calcolaOffsetGiorni(a,t){let o=new Date(a),n=new Date(t),d=o.getTime()-n.getTime();return Math.ceil(d/(1e3*60*60*24))}apriDettaglio(a,t){this.selectedSottoTask=t,this.modalDettaglioMode="edit",this.dettaglioModal={id:a.id,nome:a.nome,descrizione:a.descrizione??"",data_scadenza_prevista:a.data_scadenza_prevista?a.data_scadenza_prevista.split("T")[0]:new Date().toISOString().split("T")[0],sotto_task_id:t.id},this.modals.dettaglio=!0}toggleSottoTaskEspansa(a){requestAnimationFrame(()=>{this.sottoTaskEspanse.has(a)?this.sottoTaskEspanse.delete(a):this.sottoTaskEspanse.add(a)})}isSottoTaskEspansa(a){return this.sottoTaskEspanse.has(a)}toggleEspandiTutti(){this.espandiTutti=!this.espandiTutti,requestAnimationFrame(()=>{this.espandiTutti&&this.macroTask?.sotto_tasks?this.macroTask.sotto_tasks.forEach(a=>{this.sottoTaskEspanse.add(a.id)}):this.sottoTaskEspanse.clear()})}static \u0275fac=function(t){return new(t||l)(E(Q),E(K),E(ot),E(nt))};static \u0275cmp=F({type:l,selectors:[["app-task-singola"]],hostBindings:function(t,o){t&1&&p("click",function(){return o.closeDropdown()},N)},decls:23,vars:16,consts:[["tplNessunaSottoTask",""],[1,"task-detail-container"],[1,"form-section"],[1,"section-header"],[1,"section-titles"],[1,"section-title"],[1,"material-icons","header-icon"],["class","table-section",4,"ngIf"],["class","header-actions",4,"ngIf"],["class","status-message loading",4,"ngIf"],["class","status-message error",4,"ngIf"],["class","task-content marcotaskform",4,"ngIf"],["class","modal-backdrop show",3,"click",4,"ngIf"],["class","modal show d-block","tabindex","-1",4,"ngIf"],[1,"table-section"],[1,"text-muted"],[1,"header-actions"],[1,"promethea-button","secondary",3,"click"],[1,"material-icons"],[1,"btn-text"],[1,"promethea-button","delete",3,"click","disabled"],[1,"promethea-button","edit",3,"click","disabled"],[1,"promethea-button","primary",3,"click","disabled"],[1,"status-message","loading"],["role","status",1,"loading-spinner"],[1,"status-message","error"],[1,"task-content","marcotaskform"],[1,"main-section"],[1,"grid-form"],[1,"form-field","full-width"],["for","nome",1,"form-label"],["type","text","id","nome","placeholder","Inserisci il nome della task",3,"ngModelChange","ngModel"],[1,"form-field"],["for","data_scadenza",1,"form-label"],["type","date","id","data_scadenza",3,"ngModelChange","ngModel"],["for","stato",1,"form-label"],["type","text","id","stato","disabled","",3,"value"],["for","cliente_id",1,"form-label"],["id","cliente_id",3,"ngModelChange","ngModel"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["for","priorita",1,"form-label"],["id","priorita",3,"ngModelChange","ngModel"],["for","assegnazione_id",1,"form-label"],["id","assegnazione_id","required","",3,"ngModelChange","ngModel"],["value","immagine"],["value","digitalizzazione"],["value","contabilita"],["value","ottimizzazione"],["for","note",1,"form-label"],["id","note","rows","4","placeholder","Aggiungi note o descrizione...",3,"ngModelChange","ngModel"],["class","form-actions",4,"ngIf"],["class","form-section",4,"ngIf"],[1,"form-section","riepilogo"],[1,"card","info-card"],[1,"info-grid"],[1,"info-item"],[1,"badge",3,"ngClass"],[1,"progress","flex-1"],[1,"progress-bar",3,"ngClass"],[1,"progress-text"],[1,"form-actions"],[1,"promethea-button",3,"click","disabled"],[1,"card-number",2,"font-size","var(--fs-md)"],[1,"header-actions",2,"max-width","280px","padding","var(--gutter-lg)"],[1,"promethea-button","outline",3,"click","title"],[1,"promethea-button","outline",3,"click"],["class","contenitore-sottotask",4,"ngIf","ngIfElse"],[1,"empty-state"],[1,"contenitore-sottotask"],["class","card sotto-task-card",3,"expanded","dropdown-open",4,"ngFor","ngForOf","ngForTrackBy"],[1,"card","sotto-task-card"],[1,"sotto-task-header",3,"click"],[1,"sotto-task-info"],[1,"icon-btn","expand",3,"click","title"],[1,"sotto-task-content"],[1,"sotto-task-title"],[1,"sotto-task-meta"],[1,"badge"],["class","dettaglio-counter",4,"ngIf"],[1,"sotto-task-actions",3,"click"],["title","Modifica sotto-task",1,"icon-btn",3,"click"],[1,"dropdown"],["type","button","aria-label","Azioni sotto-task",1,"icon-btn",3,"click"],[1,"dropdown-menu",3,"click"],[4,"ngIf"],[1,"dropdown-item",3,"click"],["class","icon-btn","style","cursor: auto;","title","Stato gestito automaticamente dai dettagli",4,"ngIf"],[1,"dettaglio-container"],["class","dettaglio-list",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"dettaglio-counter"],[1,"dropdown-header"],[4,"ngFor","ngForOf"],[1,"dropdown-divider"],["title","Stato gestito automaticamente dai dettagli",1,"icon-btn",2,"cursor","auto"],[1,"dettaglio-list"],["class","dettaglio-item",4,"ngFor","ngForOf","ngForTrackBy"],[1,"dettaglio-item"],[1,"dettaglio-content"],["type","checkbox",3,"change","checked"],[1,"dettaglio-info"],[1,"dettaglio-header"],[1,"dettaglio-actions",3,"click"],["title","Modifica dettaglio",1,"icon-btn",3,"click"],["title","Elimina dettaglio",1,"icon-btn","danger",3,"click"],["class","dettaglio-descrizione text-muted",3,"click",4,"ngIf"],[1,"dettaglio-descrizione","text-muted",3,"click"],[3,"click"],[1,"modal-backdrop","show",3,"click"],["tabindex","-1",1,"modal","show","d-block"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Chiudi",1,"icon-btn","close",3,"click"],[1,"modal-body"],["for","stNome",1,"form-label"],["id","stNome","type","text","placeholder","Inserisci nome sotto-task",3,"ngModelChange","ngModel"],["for","stPriorita",1,"form-label"],["id","stPriorita",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button",1,"promethea-button","secondary",3,"click"],["type","button",1,"promethea-button",3,"click"],["for","modificaNome",1,"form-label"],["type","text","id","modificaNome","placeholder","Inserisci il nome della sotto task",3,"ngModelChange","ngModel"],["for","modificaPriorita",1,"form-label"],["id","modificaPriorita",3,"ngModelChange","ngModel"],["value","1"],["value","2"],["value","3"],["value","4"],["value","5"],["for","modificaStato",1,"form-label"],["id","modificaStato",3,"ngModelChange","ngModel"],["value","da_fare"],["value","in_lavorazione"],["value","completato"],["for","dettaglioNome",1,"form-label"],["type","text","id","dettaglioNome","placeholder","Inserisci il nome del dettaglio",3,"ngModelChange","ngModel"],["for","dettaglioDescrizione",1,"form-label"],["id","dettaglioDescrizione","rows","3","placeholder","Aggiungi una descrizione...",3,"ngModelChange","ngModel"],["for","dettaglioScadenza",1,"form-label"],["type","date","id","dettaglioScadenza",3,"ngModelChange","ngModel"],["type","button",1,"promethea-button",3,"click","disabled"],["type","button",1,"icon-btn",3,"click"],["for","nomeTemplate",1,"form-label"],["type","text","id","nomeTemplate","placeholder","Inserisci un nome per il template",3,"ngModelChange","ngModel"],["for","descrizioneTemplate",1,"form-label"],["id","descrizioneTemplate","rows","3","placeholder","Aggiungi una descrizione...",3,"ngModelChange","ngModel"],[1,"form-label"],[1,"template-preview"],["class","sotto-task-preview",4,"ngFor","ngForOf"],[1,"sotto-task-preview"],["class","form-field",4,"ngIf"],[2,"white-space","pre-wrap"]],template:function(t,o){t&1&&(i(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h1",5)(5,"i",6),r(6,"task"),e(),r(7),e(),k(8,mt,3,1,"div",7),e(),k(9,gt,21,6,"div",8),e()(),k(10,_t,4,0,"div",9)(11,pt,4,1,"div",10)(12,zt,100,40,"div",11)(13,Ot,1,0,"div",12)(14,Vt,33,7,"div",13)(15,It,1,0,"div",12)(16,Dt,43,3,"div",13)(17,Wt,1,0,"div",12)(18,Bt,29,7,"div",13)(19,Nt,1,0,"div",12)(20,jt,30,8,"div",13)(21,Rt,1,0,"div",12)(22,Gt,14,1,"div",13),e()),t&2&&(s(7),u(" ",o.macroTask!=null&&o.macroTask.id?"Modifica Task":"Nuova Macro Task"," "),s(),m("ngIf",o.macroTask==null?null:o.macroTask.id),s(),m("ngIf",o.macroTask==null?null:o.macroTask.id),s(),m("ngIf",o.loading&&!o.macroTask),s(),m("ngIf",o.error),s(),m("ngIf",o.macroTask),s(),m("ngIf",o.modals.sottoTask),s(),m("ngIf",o.modals.sottoTask),s(),m("ngIf",o.modals.modificaSottoTask),s(),m("ngIf",o.modals.modificaSottoTask),s(),m("ngIf",o.modals.dettaglio),s(),m("ngIf",o.modals.dettaglio),s(),m("ngIf",o.showTemplateModal),s(),m("ngIf",o.showTemplateModal),s(),m("ngIf",o.modals.leggiDettaglio),s(),m("ngIf",o.modals.leggiDettaglio))},dependencies:[J,H,q,U,at,tt,et,X,$,Y,it,Z,G],styles:[".section-title[_ngcontent-%COMP%]{margin:0}.header-actions[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:var(--gutter-sm);width:100%;max-width:320px;container-type:inline-size}@container (max-width: 300px){.header-actions[_ngcontent-%COMP%]{grid-template-columns:1fr;max-width:100%}}@container (min-width: 301px) and (max-width: 500px){.header-actions[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr;max-width:280px}}@container (min-width: 501px){.header-actions[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr;max-width:320px}}.section-header[_ngcontent-%COMP%]{align-items:flex-start;justify-content:space-between;container-type:inline-size}.task-detail-container[_ngcontent-%COMP%]{padding:var(--gutter-lg);background:var(--background);min-height:100vh}.task-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:minmax(0,1fr) minmax(260px,350px);gap:var(--gutter-lg);align-items:flex-start}@container (max-width: 600px){.section-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:var(--gutter-md)}.header-actions[_ngcontent-%COMP%]{max-width:100%;justify-self:center}}.header-actions[_ngcontent-%COMP%]   .promethea-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:var(--gutter-sm);padding:var(--gutter-sm) var(--gutter-md);font-size:var(--fs-sm);min-height:2.5rem;white-space:nowrap}@container (max-width: 160px){.header-actions[_ngcontent-%COMP%]   .promethea-button[_ngcontent-%COMP%]   .btn-text[_ngcontent-%COMP%]{display:none}.header-actions[_ngcontent-%COMP%]   .promethea-button[_ngcontent-%COMP%]{padding:var(--gutter-md);min-width:2.5rem}}.main-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-md);min-width:0}.task-card[_ngcontent-%COMP%]{border-left:4px solid var(--primary);padding:var(--gutter-lg);gap:var(--gutter-md);border-radius:18px;display:flex;flex-direction:column;justify-content:space-between;height:100%}.task-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-md)}.task-card.scaduta[_ngcontent-%COMP%]{border-left-color:#ef4444;background:linear-gradient(135deg,var(--background) 0%,color-mix(in srgb,#ef4444 8%,transparent) 100%)}.task-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:var(--gutter-sm);margin-bottom:var(--gutter-sm);flex-wrap:wrap}.task-main-info[_ngcontent-%COMP%]{flex:1;min-width:0}.task-title[_ngcontent-%COMP%]{cursor:pointer;margin-bottom:var(--gutter-sm)}.task-meta-compact[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.meta-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);color:color-mix(in srgb,var(--text-color) 60%,transparent)}.task-header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);flex-shrink:0;margin-left:auto}.priority-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;min-width:5rem;height:var(--fs-md);padding:0 var(--gutter-sm);border-radius:6px;font-weight:700;border:1px solid var(--smoke-color-1);background:color-mix(in srgb,var(--text-color) 10%,transparent);text-transform:uppercase;letter-spacing:.5px}.progress-section[_ngcontent-%COMP%]{margin:var(--gutter-sm) 0}.progress-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm)}.progress-stats[_ngcontent-%COMP%]{flex-shrink:0}.scadenza-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);padding:var(--gutter-sm);background:var(--smoke-color-2);border-radius:8px;margin:var(--gutter-sm) 0;border:1px solid var(--smoke-color-1);flex-wrap:wrap;justify-content:space-between;row-gap:var(--gutter-sm)}.scadenza-section[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{margin-left:auto;white-space:nowrap}.scadenza-section.scaduta[_ngcontent-%COMP%]{background:color-mix(in srgb,#ef4444 12%,transparent);border-color:color-mix(in srgb,#ef4444 30%,transparent)}.scadenza-section.scadenza-imminente[_ngcontent-%COMP%]{background:color-mix(in srgb,#f59e0b 12%,transparent);border-color:color-mix(in srgb,#f59e0b 30%,transparent)}.task-counts-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-sm);margin:var(--gutter-sm) 0}.count-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:var(--gutter-sm);background:var(--smoke-color-2);border-radius:8px;border:1px solid var(--smoke-color-1)}.count-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:var(--fs-md);height:var(--fs-md);padding:var(--gutter-sm);border-radius:50%;font-weight:700;color:#fff}.count-badge.da-fare[_ngcontent-%COMP%]{background:#42464d}.count-badge.in-lavorazione[_ngcontent-%COMP%]{background:var(--secondary)}.count-badge.completate[_ngcontent-%COMP%]{background:#10b981}.count-label[_ngcontent-%COMP%]{margin-top:4px;text-align:center;color:color-mix(in srgb,var(--text-color) 70%,transparent);text-transform:uppercase;letter-spacing:.5px}.task-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-top:var(--gutter-sm);border-top:1px solid var(--smoke-color-1);margin-top:auto}.sotto-task-card[_ngcontent-%COMP%]{border-left:4px solid var(--primary);display:flex;flex-direction:column;height:100%;container-type:inline-size;min-width:0;position:relative;overflow:visible}.sotto-task-card.expanded[_ngcontent-%COMP%]{box-shadow:0 8px 24px var(--shadow2);border-color:var(--primary)}.sotto-task-card[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]{z-index:50}.sotto-task-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:var(--gutter-sm);margin-bottom:var(--gutter-sm);flex-wrap:wrap;cursor:pointer}.sotto-task-info[_ngcontent-%COMP%]{flex:1 1 auto;min-width:0;display:flex;align-items:flex-start;gap:var(--gutter-sm)}.sotto-task-content[_ngcontent-%COMP%]{flex:1;min-width:0}.sotto-task-meta[_ngcontent-%COMP%]{display:flex;gap:var(--gutter-sm);align-items:center;flex-wrap:wrap;margin-top:.25rem}.sotto-task-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);margin-left:auto;flex:1 1 auto;justify-content:flex-end;flex-wrap:wrap;min-width:0;max-width:100%;position:relative;z-index:2}.dettaglio-container[_ngcontent-%COMP%]{max-height:0;overflow:hidden;opacity:0;transition:max-height .5s cubic-bezier(.4,0,.2,1),opacity .3s ease .1s}.dettaglio-container.show[_ngcontent-%COMP%]{max-height:5000px;opacity:1;transition:max-height .8s cubic-bezier(.4,0,.2,1),opacity .4s ease .1s}.dettaglio-list[_ngcontent-%COMP%]{border-top:1px solid var(--smoke-color-1);padding-top:var(--gutter-sm);display:flex;flex-direction:column;gap:var(--gutter-sm)}.dettaglio-item[_ngcontent-%COMP%]{padding:var(--gutter-sm);background:var(--background);border-radius:10px;border:1px solid var(--smoke-color-1);transition:all .2s ease}.dettaglio-item[_ngcontent-%COMP%]:hover{border-color:var(--primary);background:var(--smoke-color-2)}.dettaglio-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;align-items:start;column-gap:var(--gutter-sm);align-items:center;justify-content:center}.dettaglio-descrizione[_ngcontent-%COMP%]{padding:var(--gutter-sm) 0}.dettaglio-header[_ngcontent-%COMP%]{display:grid;grid-template-columns:minmax(0,1fr) auto auto;align-items:center;gap:var(--gutter-sm)}.dettaglio-header[_ngcontent-%COMP%]   strong.completed[_ngcontent-%COMP%]{text-decoration:line-through;color:color-mix(in srgb,var(--text-color) 50%,transparent)}.dettaglio-counter[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem;font-size:.75rem;color:color-mix(in srgb,var(--text-color) 60%,transparent);background:var(--smoke-color-2);padding:.125rem .5rem;border-radius:12px;border:1px solid var(--smoke-color-1)}.sotto-task-card[_ngcontent-%COMP%]:not(.expanded)   .dettaglio-counter[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--primary) 15%,transparent);color:var(--primary);border-color:color-mix(in srgb,var(--primary) 30%,transparent)}.form-section.riepilogo[_ngcontent-%COMP%]{padding:0;background:transparent;border:none;box-shadow:none;align-self:flex-start;position:sticky;top:var(--gutter-lg)}.contenitore-sottotask[_ngcontent-%COMP%]{gap:var(--gutter-md);display:flex;flex-direction:column}.marcotaskform[_ngcontent-%COMP%]{margin-top:var(--gutter-lg)!important}.info-card[_ngcontent-%COMP%]{background:var(--background);border:1px solid var(--smoke-color-1);border-radius:16px;padding:var(--gutter-lg);box-shadow:0 4px 12px var(--shadow);position:sticky;top:var(--gutter-lg);z-index:10}.info-card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:var(--text-color);margin-bottom:var(--gutter-sm);font-weight:600;border-bottom:2px solid var(--primary);padding-bottom:var(--gutter-sm)}.info-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:var(--gutter-sm);padding:var(--gutter-sm) 0;border-bottom:1px solid color-mix(in srgb,var(--text-color) 15%,transparent)}.info-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.info-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;color:var(--text-color);margin:0}.info-item[_ngcontent-%COMP%]   span.scaduta[_ngcontent-%COMP%]{color:#e74c3c;font-weight:500}.info-item[_ngcontent-%COMP%]   span.imminente[_ngcontent-%COMP%]{color:#f39c12;font-weight:500}.form-section.riepilogo[_ngcontent-%COMP%]{padding:0;background:transparent;border:none;box-shadow:none;align-self:flex-start;position:sticky;top:var(--gutter-lg);z-index:10}.sotto-task-actions[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%], .sotto-task-actions[_ngcontent-%COMP%]   .dropdown[_ngcontent-%COMP%]{flex:0 0 auto}.dropdown[_ngcontent-%COMP%]{position:relative;display:inline-block}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;display:none;min-width:180px;padding:8px 0;margin:4px 0 0;background:var(--background);border:1px solid var(--smoke-color-1);border-radius:8px;box-shadow:0 4px 12px var(--shadow);list-style:none;z-index:10000}.dropdown-menu.show[_ngcontent-%COMP%]{display:block}.dropdown-header[_ngcontent-%COMP%]{padding:var(--gutter-sm);font-weight:800;background:color-mix(in srgb,var(--text-color) 10%,transparent);text-transform:uppercase;border-bottom:1px solid color-mix(in srgb,var(--text-color) 30%,transparent)}.dropdown-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;width:100%;padding:8px 16px;background:transparent;border:none;color:var(--text-color);text-align:left;text-decoration:none;cursor:pointer;transition:all .2s ease;font-size:.85em}.dropdown-item[_ngcontent-%COMP%]:hover{background:var(--smoke-color-2);color:var(--primary)}.dropdown-divider[_ngcontent-%COMP%]{height:1px;background:var(--smoke-color-1);margin:8px 0;border:none}.sotto-task-card.dropdown-open[_ngcontent-%COMP%]{z-index:200}.dettaglio-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm)}.grid-responsive[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(380px,1fr))}@media (max-width: 1024px){.task-content[_ngcontent-%COMP%]{grid-template-columns:1fr}.form-section.riepilogo[_ngcontent-%COMP%]{position:static;order:-1}}@media (max-width: 768px){.section-header[_ngcontent-%COMP%]{display:flex;flex-direction:column}.contenitore-bottoni[_ngcontent-%COMP%]{display:flex;justify-content:center}.section-title[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center}.sotto-task-header[_ngcontent-%COMP%], .task-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.sotto-task-actions[_ngcontent-%COMP%], .task-header-actions[_ngcontent-%COMP%]{margin-left:0;justify-content:flex-start}.dettaglio-header[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:var(--gutter-sm)}.sotto-tasks-counts[_ngcontent-%COMP%]{grid-template-columns:1fr}.sotto-task-global-actions[_ngcontent-%COMP%]{flex-direction:column;width:100%;margin-top:var(--gutter-sm)}}"]})};export{rt as TaskSingola};
