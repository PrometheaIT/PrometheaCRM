import{a as gt}from"./chunk-7ZWGKFQ2.js";import{a as mt}from"./chunk-FE3ARP73.js";import{a as ct}from"./chunk-DFDHLCS7.js";import{b as et,d as it,f as at,n as nt,o as ot,p as rt,s as st,u as lt}from"./chunk-EXOBR4AO.js";import{b as dt}from"./chunk-JUOMJRR2.js";import{a as tt}from"./chunk-Y2XJCRVM.js";import{c as Z}from"./chunk-3ZXX2K2L.js";import{c as $,d as G,e as Q,h as J,k as K,n as X,p as Y}from"./chunk-3DLJ4ULO.js";import{Aa as M,Ab as h,Eb as I,Ga as L,Jb as E,Kb as P,La as k,Mb as H,Wa as R,X as g,Xa as m,Y as _,Ya as n,Za as a,_a as z,cb as N,db as W,fb as f,ib as p,jb as c,qb as V,rb as q,sb as y,ta as j,tb as B,ua as s,ub as r,vb as w,wb as v,xb as A,yb as T,zb as S}from"./chunk-6W5NKFNP.js";import"./chunk-X5YLR3NI.js";import{a as F,c as U,i as x}from"./chunk-ODN5LVDJ.js";var ut=()=>[1,2,3,4,5],vt=()=>["da_fare","in_lavorazione","completato"],kt=()=>[];function ft(l,e){if(l&1&&(n(0,"div",15)(1,"p",16),r(2),a()()),l&2){let t=c();s(2),v("ID: ",t.macroTask.id)}}function xt(l,e){if(l&1){let t=f();n(0,"button",24),p("click",function(){g(t);let i=c(2);return _(i.eliminaMacroTask())}),n(1,"i",19),r(2,"delete_forever"),a(),n(3,"span",20),r(4,"Elimina"),a()()}if(l&2){let t=c(2);m("disabled",t.loading)}}function Tt(l,e){if(l&1){let t=f();n(0,"button",25),p("click",function(){g(t);let i=c(2);return _(i.salvaComeTemplate())}),n(1,"i",19),r(2,"content_copy"),a(),n(3,"span",20),r(4,"Template"),a()()}if(l&2){let t=c(2);m("disabled",t.loading)}}function St(l,e){if(l&1){let t=f();n(0,"div",17)(1,"button",18),p("click",function(){g(t);let i=c();return _(i.router.navigate(["/task"]))}),n(2,"i",19),r(3,"arrow_back"),a(),n(4,"span",20),r(5,"Lista"),a()(),k(6,xt,5,1,"button",21)(7,Tt,5,1,"button",22),n(8,"button",23),p("click",function(){g(t);let i=c();return _(i.salvaMacroTask())}),n(9,"i",19),r(10,"save"),a(),n(11,"span",20),r(12),a()()()}if(l&2){let t=c();s(6),m("ngIf",t.currentUser==null?null:t.currentUser.is_admin),s(),m("ngIf",t.currentUser==null?null:t.currentUser.is_admin),s(),m("disabled",t.loading),s(),y("spin",t.loading),s(3),w(t.loading?"Salva...":"Salva")}}function ht(l,e){l&1&&(n(0,"div",26),z(1,"div",27),n(2,"p"),r(3,"Caricamento task..."),a()())}function wt(l,e){if(l&1&&(n(0,"div",28)(1,"i",19),r(2,"warning"),a(),r(3),a()),l&2){let t=c();s(3),v(" ",t.error," ")}}function bt(l,e){if(l&1&&(n(0,"option",42),r(1),a()),l&2){let t=e.$implicit;m("value",t.id),s(),v(" ",t.ragione_sociale," ")}}function Mt(l,e){if(l&1&&(n(0,"option",66),r(1),a()),l&2){let t=e.$implicit,o=c(2);m("ngValue",t),s(),A(" P",t," - ",o.taskService.getNomePriorita(t)," ")}}function yt(l,e){if(l&1){let t=f();n(0,"div",67)(1,"button",68),p("click",function(){g(t);let i=c(2);return _(i.salvaMacroTask())}),n(2,"i",19),r(3,"save"),a(),r(4," Crea Macro Task "),a()()}if(l&2){let t=c(2);s(),m("disabled",t.loading),s(),y("spin",t.loading)}}function Ct(l,e){l&1&&(n(0,"div",74)(1,"i",19),r(2,"layers"),a(),n(3,"h4"),r(4,"Nessuna sotto task"),a(),n(5,"p"),r(6,"Crea la prima sotto task per suddividere il lavoro"),a()())}function Et(l,e){if(l&1&&(n(0,"span",96)(1,"i",19),r(2,"checklist"),a(),r(3),a()),l&2){let t=c().$implicit;s(3),v(" ",t.task_dettaglio.length," dettagli ")}}function Pt(l,e){if(l&1){let t=f();n(0,"li")(1,"a",91),p("click",function(){let i=g(t).$implicit,d=c(2).$implicit,u=V(25);return c(4).cambiaStatoSottoTask(d,i),_(u.close())}),r(2),a()()}if(l&2){let t=e.$implicit,o=c(6);s(2),v(" ",o.getStatoTesto(t)," ")}}function zt(l,e){l&1&&(N(0),n(1,"li")(2,"h6",97),r(3,"Cambia Stato"),a()(),k(4,Pt,3,1,"li",98),n(5,"li"),z(6,"hr",99),a(),W()),l&2&&(s(4),m("ngForOf",I(1,vt)))}function Vt(l,e){l&1&&(n(0,"div",100)(1,"i",19),r(2,"android"),a()())}function It(l,e){if(l&1){let t=f();n(0,"p",112),p("click",function(){g(t);let i=c().$implicit,d=c(2).$implicit,u=c(4);return _(u.apriDettaglio(i,d))}),r(1),a()}if(l&2){let t=c().$implicit;s(),v(" ",t.descrizione," ")}}function Ot(l,e){if(l&1){let t=f();n(0,"div",103)(1,"div",104)(2,"input",105),p("change",function(){let i=g(t).$implicit,d=c(2).$implicit,u=c(4);return _(u.toggleDettaglioCompletato(i,d))})("click",function(i){return g(t),_(i.stopPropagation())})("mousedown",function(i){return g(t),_(i.stopPropagation())}),a(),n(3,"div",106)(4,"div",107)(5,"strong"),r(6),a(),n(7,"span",16)(8,"i",19),r(9,"schedule"),a(),r(10),E(11,"date"),a(),n(12,"div",108),p("click",function(i){return g(t),_(i.stopPropagation())}),n(13,"button",109),p("click",function(i){let d=g(t).$implicit,u=c(2).$implicit,b=c(4);return i.stopPropagation(),_(b.apriDettaglio(d,u))}),n(14,"i",19),r(15,"edit"),a()(),n(16,"button",110),p("click",function(i){let d=g(t).$implicit,u=c(2).$implicit,b=c(4);return i.stopPropagation(),_(b.eliminaDettaglio(d,u))}),n(17,"i",19),r(18,"delete_forever"),a()()()(),k(19,It,2,1,"p",111),a()()()}if(l&2){let t=e.$implicit;s(2),m("checked",t.completato),s(3),y("completed",t.completato),s(),w(t.nome),s(4),v(" ",P(11,6,t.data_scadenza_prevista,"dd/MM/yyyy")," "),s(9),m("ngIf",t.descrizione)}}function Dt(l,e){if(l&1&&(n(0,"div",101),k(1,Ot,20,9,"div",102),a()),l&2){let t=c().$implicit,o=c(4);s(),m("ngForOf",t.task_dettaglio)("ngForTrackBy",o.trackByDettaglio)}}function Nt(l,e){if(l&1){let t=f();n(0,"div",74)(1,"i",19),r(2,"info"),a(),r(3," Nessun dettaglio aggiunto. "),n(4,"a",113),p("click",function(){g(t);let i=c().$implicit,d=c(4);return _(d.apriModal("dettaglio",i))}),r(5,"Aggiungi il primo dettaglio"),a()()}}function Wt(l,e){if(l&1){let t=f();n(0,"div",77)(1,"div",78),p("click",function(){let i=g(t).$implicit,d=c(4);return _(d.toggleSottoTaskEspansa(i.id))}),n(2,"div",79)(3,"button",80),p("click",function(i){let d=g(t).$implicit,u=c(4);return i.stopPropagation(),_(u.toggleSottoTaskEspansa(d.id))}),n(4,"i",19),r(5),a()(),n(6,"div",81)(7,"h4",82),r(8),a(),n(9,"div",83)(10,"span",84),r(11),a(),n(12,"span",84),r(13),a(),n(14,"span",16)(15,"i",19),r(16,"calendar_today"),a(),r(17),E(18,"date"),a(),k(19,Et,4,1,"span",85),a()()(),n(20,"div",86),p("click",function(i){return g(t),_(i.stopPropagation())}),n(21,"button",87),p("click",function(){let i=g(t).$implicit,d=c(4);return _(d.apriModal("modificaSottoTask",i))}),n(22,"i",19),r(23,"edit"),a()(),n(24,"app-action-dropdown",88,1),p("action",function(i){let d=g(t).$implicit,u=c(4);return _(u.handleSottoTaskAction(i,d))}),n(26,"div",89),p("click",function(i){return g(t),_(i.stopPropagation())}),k(27,zt,7,2,"ng-container",90),n(28,"li")(29,"a",91),p("click",function(){let i=g(t).$implicit,d=V(25);return c(4).apriModal("dettaglio",i),_(d.close())}),n(30,"i",19),r(31,"add"),a(),r(32," Aggiungi Dettaglio "),a()()()(),k(33,Vt,3,0,"div",92),a()(),n(34,"div",93),k(35,Dt,2,2,"div",94)(36,Nt,6,0,"div",95),a()()}if(l&2){let t=e.$implicit,o=c(4);y("expanded",o.isSottoTaskEspansa(t.id))("dropdown-open",o.isDropdownOpen(t.id)),s(3),m("title",o.isSottoTaskEspansa(t.id)?"Riduci dettagli":"Espandi dettagli"),R("aria-expanded",o.isSottoTaskEspansa(t.id)),s(2),v(" ",o.isSottoTaskEspansa(t.id)?"expand_less":"expand_more"," "),s(3),v(" ",t.nome," "),s(2),B(o.getPrioritaBadgeClass(t.priorita)),s(),v(" P",t.priorita," "),s(),B(o.getStatoBadgeClass(t.stato)),s(),v(" ",o.getStatoTesto(t.stato)," "),s(4),v(" ",P(18,23,t.created_at,"dd/MM/yyyy")," "),s(2),m("ngIf",t.task_dettaglio&&t.task_dettaglio.length>0),s(5),m("row",t),s(3),m("ngIf",o.puoiModificareSottoTask(t)),s(6),m("ngIf",!o.puoiModificareSottoTask(t)),s(),y("show",o.isSottoTaskEspansa(t.id)),s(),m("ngIf",t.task_dettaglio&&t.task_dettaglio.length>0),s(),m("ngIf",!t.task_dettaglio||t.task_dettaglio.length===0)}}function Bt(l,e){if(l&1&&(n(0,"div",75),k(1,Wt,37,26,"div",76),a()),l&2){let t=c(3);s(),m("ngForOf",t.macroTask.sotto_tasks)("ngForTrackBy",t.trackBySottoTask)}}function At(l,e){if(l&1){let t=f();n(0,"div",3)(1,"div",4)(2,"h3",6)(3,"i",19),r(4,"layers"),a(),r(5," Sotto Tasks "),n(6,"span",69),r(7),a()(),n(8,"div",70)(9,"button",71),p("click",function(){g(t);let i=c(2);return _(i.toggleEspandiTutti())}),n(10,"i",19),r(11),a(),n(12,"span",20),r(13),a()(),n(14,"button",72),p("click",function(){g(t);let i=c(2);return _(i.apriModal("sottoTask"))}),n(15,"i",19),r(16,"add"),a(),n(17,"span",20),r(18,"Nuova"),a()()()(),k(19,Ct,7,0,"ng-template",null,0,H)(21,Bt,2,2,"div",73),a()}if(l&2){let t=V(20),o=c(2);s(7),w((o.macroTask.sotto_tasks==null?null:o.macroTask.sotto_tasks.length)||0),s(2),m("title",o.espandiTutti?"Riduci tutte":"Espandi tutte"),s(2),v(" ",o.espandiTutti?"unfold_less":"unfold_more"," "),s(2),w(o.espandiTutti?"Riduci":"Espandi"),s(8),m("ngIf",o.macroTask.sotto_tasks&&o.macroTask.sotto_tasks.length>0)("ngIfElse",t)}}function Ft(l,e){if(l&1){let t=f();n(0,"div",29)(1,"div",30)(2,"div",3)(3,"h3",6),r(4,"Informazioni Principali"),a(),n(5,"div",31)(6,"div",32)(7,"label",33),r(8,"Nome Task *"),a(),n(9,"input",34),h("ngModelChange",function(i){g(t);let d=c();return S(d.macroTask.nome,i)||(d.macroTask.nome=i),_(i)}),a()(),n(10,"div",35)(11,"label",36),r(12,"Data Scadenza"),a(),n(13,"input",37),h("ngModelChange",function(i){g(t);let d=c();return S(d.macroTask.data_scadenza,i)||(d.macroTask.data_scadenza=i),_(i)}),a()(),n(14,"div",35)(15,"label",38),r(16,"Stato"),a(),z(17,"input",39),a()(),n(18,"div",35)(19,"label",40),r(20,"Cliente"),a(),n(21,"select",41),h("ngModelChange",function(i){g(t);let d=c();return S(d.macroTask.cliente_id,i)||(d.macroTask.cliente_id=i),_(i)}),n(22,"option",42),r(23,"Nessun cliente"),a(),k(24,bt,2,2,"option",43),a()(),n(25,"div",35)(26,"label",44),r(27,"Priorit\xE0"),a(),n(28,"select",45),h("ngModelChange",function(i){g(t);let d=c();return S(d.macroTask.priorita_globale,i)||(d.macroTask.priorita_globale=i),_(i)}),k(29,Mt,2,3,"option",46),a()(),n(30,"div",35)(31,"label",47),r(32,"Modulo *"),a(),n(33,"select",48),h("ngModelChange",function(i){g(t);let d=c();return S(d.macroTask.assegnazione_id,i)||(d.macroTask.assegnazione_id=i),_(i)}),n(34,"option",42),r(35,"Seleziona Modulo"),a(),n(36,"option",49),r(37,"Immagine"),a(),n(38,"option",50),r(39,"Digitalizzazione"),a(),n(40,"option",51),r(41,"Contabilit\xE0"),a(),n(42,"option",52),r(43,"Ottimizzazione"),a(),n(44,"option",53),r(45,"Tutti i moduli"),a()()(),n(46,"div",35)(47,"label",54),r(48,"Note"),a(),n(49,"textarea",55),h("ngModelChange",function(i){g(t);let d=c();return S(d.macroTask.note,i)||(d.macroTask.note=i),_(i)}),a()(),k(50,yt,5,3,"div",56),a(),k(51,At,22,6,"div",57),a(),n(52,"div",58)(53,"div",59)(54,"h4"),r(55,"Riepilogo Task"),a(),n(56,"div",60)(57,"div",61)(58,"label"),r(59,"Stato:"),a(),n(60,"span",62),r(61),a()(),n(62,"div",61)(63,"label"),r(64,"Priorit\xE0:"),a(),n(65,"span",62),r(66),a()(),n(67,"div",61)(68,"label"),r(69,"Progresso:"),a(),n(70,"div",63)(71,"div",64)(72,"span",65),r(73),a()()()(),n(74,"div",61)(75,"label"),r(76,"Cliente:"),a(),n(77,"span"),r(78),a()(),n(79,"div",61)(80,"label"),r(81,"Modulo:"),a(),n(82,"span"),r(83),a()(),n(84,"div",61)(85,"label"),r(86,"Scadenza:"),a(),n(87,"span"),r(88),E(89,"date"),a()(),n(90,"div",61)(91,"label"),r(92,"Creato il:"),a(),n(93,"span"),r(94),E(95,"date"),a()(),n(96,"div",61)(97,"label"),r(98,"Aggiornato il:"),a(),n(99,"span"),r(100),E(101,"date"),a()()()()()()}if(l&2){let t=c();s(9),T("ngModel",t.macroTask.nome),s(4),T("ngModel",t.macroTask.data_scadenza),s(4),m("value",t.taskService.getStatoTesto(t.macroTask.stato)),s(4),T("ngModel",t.macroTask.cliente_id),s(),m("value",null),s(2),m("ngForOf",t.clienti),s(4),T("ngModel",t.macroTask.priorita_globale),s(),m("ngForOf",I(39,ut)),s(4),T("ngModel",t.macroTask.assegnazione_id),s(),m("value",null),s(15),T("ngModel",t.macroTask.note),s(),m("ngIf",!t.macroTask.id),s(),m("ngIf",t.macroTask.id),s(9),m("ngClass",t.taskService.getStatoBadgeClass(t.macroTask.stato)),s(),v(" ",t.taskService.getStatoTesto(t.macroTask.stato)," "),s(4),m("ngClass",t.taskService.getPrioritaBadgeClass(t.macroTask.priorita_globale)),s(),v(" P",t.macroTask.priorita_globale," "),s(5),q("width",t.macroTask.progresso,"%"),m("ngClass",t.taskService.getStatoBadgeClass(t.macroTask.stato)),s(2),v("",t.macroTask.progresso,"%"),s(5),w(t.getNomeCliente(t.macroTask.cliente_id)),s(5),w(t.taskService.getModuloName(t.macroTask.assegnazione_id||null)),s(4),y("text-danger",t.taskService.isScaduta(t.macroTask.data_scadenza))("text-warning",t.taskService.isScadenzaImminente(t.macroTask.data_scadenza)),s(),v(" ",P(89,30,t.macroTask.data_scadenza,"dd/MM/yyyy")," "),s(6),w(P(95,33,t.macroTask.created_at,"dd/MM/yyyy HH:mm")),s(6),w(P(101,36,t.macroTask.updated_at,"dd/MM/yyyy HH:mm"))}}function Ut(l,e){if(l&1){let t=f();n(0,"div",114),p("click",function(){g(t);let i=c();return _(i.chiudiModal("sottoTask"))}),a()}}function jt(l,e){if(l&1){let t=f();n(0,"div",115)(1,"div",116)(2,"div",117)(3,"div",118)(4,"h5",119)(5,"i",19),r(6,"layers"),a(),r(7," Nuova Sotto Task "),a(),n(8,"button",120),p("click",function(){g(t);let i=c();return _(i.chiudiModal("sottoTask"))}),a()(),n(9,"div",121)(10,"div",35)(11,"label",122),r(12,"Nome *"),a(),n(13,"input",123),h("ngModelChange",function(i){g(t);let d=c();return S(d.nuovaSottoTask.nome,i)||(d.nuovaSottoTask.nome=i),_(i)}),a()(),n(14,"div",35)(15,"label",124),r(16,"Priorit\xE0"),a(),n(17,"select",125),h("ngModelChange",function(i){g(t);let d=c();return S(d.nuovaSottoTask.priorita,i)||(d.nuovaSottoTask.priorita=i),_(i)}),n(18,"option",66),r(19,"1 - Minima"),a(),n(20,"option",66),r(21,"2 - Bassa"),a(),n(22,"option",66),r(23,"3 - Media"),a(),n(24,"option",66),r(25,"4 - Alta"),a(),n(26,"option",66),r(27,"5 - Critica"),a()()()(),n(28,"div",126)(29,"button",127),p("click",function(){g(t);let i=c();return _(i.chiudiModal("sottoTask"))}),r(30,"Annulla"),a(),n(31,"button",128),p("click",function(){g(t);let i=c();return _(i.creaSottoTask())}),r(32,"Crea"),a()()()()()}if(l&2){let t=c();s(13),T("ngModel",t.nuovaSottoTask.nome),s(4),T("ngModel",t.nuovaSottoTask.priorita),s(),m("ngValue",1),s(2),m("ngValue",2),s(2),m("ngValue",3),s(2),m("ngValue",4),s(2),m("ngValue",5)}}function Lt(l,e){if(l&1){let t=f();n(0,"div",114),p("click",function(){g(t);let i=c();return _(i.chiudiModal("modificaSottoTask"))}),a()}}function Rt(l,e){if(l&1){let t=f();n(0,"div",115)(1,"div",116)(2,"div",117)(3,"div",118)(4,"h5",119)(5,"i",19),r(6,"edit"),a(),r(7," Modifica Sotto Task "),a(),n(8,"button",120),p("click",function(){g(t);let i=c();return _(i.chiudiModal("modificaSottoTask"))}),a()(),n(9,"div",121)(10,"div",35)(11,"label",129),r(12,"Nome *"),a(),n(13,"input",130),h("ngModelChange",function(i){g(t);let d=c();return S(d.sottoTaskModificata.nome,i)||(d.sottoTaskModificata.nome=i),_(i)}),a()(),n(14,"div",35)(15,"label",131),r(16,"Priorit\xE0"),a(),n(17,"select",132),h("ngModelChange",function(i){g(t);let d=c();return S(d.sottoTaskModificata.priorita,i)||(d.sottoTaskModificata.priorita=i),_(i)}),n(18,"option",133),r(19,"1 - Minima"),a(),n(20,"option",134),r(21,"2 - Bassa"),a(),n(22,"option",135),r(23,"3 - Media"),a(),n(24,"option",136),r(25,"4 - Alta"),a(),n(26,"option",137),r(27,"5 - Critica"),a()()(),n(28,"div",35)(29,"label",138),r(30,"Stato"),a(),n(31,"select",139),h("ngModelChange",function(i){g(t);let d=c();return S(d.sottoTaskModificata.stato,i)||(d.sottoTaskModificata.stato=i),_(i)}),n(32,"option",140),r(33,"Da Fare"),a(),n(34,"option",141),r(35,"In Lavorazione"),a(),n(36,"option",142),r(37,"Completato"),a()()()(),n(38,"div",126)(39,"button",127),p("click",function(){g(t);let i=c();return _(i.chiudiModal("modificaSottoTask"))}),r(40,"Annulla"),a(),n(41,"button",128),p("click",function(){g(t);let i=c();return _(i.salvaModificaSottoTask())}),r(42,"Salva Modifiche"),a()()()()()}if(l&2){let t=c();s(13),T("ngModel",t.sottoTaskModificata.nome),s(4),T("ngModel",t.sottoTaskModificata.priorita),s(14),T("ngModel",t.sottoTaskModificata.stato)}}function qt(l,e){if(l&1){let t=f();n(0,"div",114),p("click",function(){g(t);let i=c();return _(i.chiudiModal("dettaglio"))}),a()}}function Ht(l,e){if(l&1){let t=f();n(0,"div",115)(1,"div",116)(2,"div",117)(3,"div",118)(4,"h5",119)(5,"i",19),r(6,"task"),a(),r(7),a(),n(8,"button",120),p("click",function(){g(t);let i=c();return _(i.chiudiModal("dettaglio"))}),a()(),n(9,"div",121)(10,"div",35)(11,"label",143),r(12,"Nome *"),a(),n(13,"input",144),h("ngModelChange",function(i){g(t);let d=c();return S(d.dettaglioModal.nome,i)||(d.dettaglioModal.nome=i),_(i)}),a()(),n(14,"div",35)(15,"label",145),r(16,"Descrizione"),a(),n(17,"textarea",146),h("ngModelChange",function(i){g(t);let d=c();return S(d.dettaglioModal.descrizione,i)||(d.dettaglioModal.descrizione=i),_(i)}),a()(),n(18,"div",35)(19,"label",147),r(20,"Data Scadenza Prevista"),a(),n(21,"input",148),h("ngModelChange",function(i){g(t);let d=c();return S(d.dettaglioModal.data_scadenza_prevista,i)||(d.dettaglioModal.data_scadenza_prevista=i),_(i)}),a()()(),n(22,"div",126)(23,"button",127),p("click",function(){g(t);let i=c();return _(i.chiudiModal("dettaglio"))}),r(24,"Annulla"),a(),n(25,"button",149),p("click",function(){g(t);let i=c();return _(i.salvaDettaglio())}),n(26,"i",19),r(27),a(),r(28),a()()()()()}if(l&2){let t=c();s(7),v(" ",t.modalDettaglioMode==="create"?"Nuovo Task di Dettaglio":"Modifica Dettaglio"," "),s(6),T("ngModel",t.dettaglioModal.nome),s(4),T("ngModel",t.dettaglioModal.descrizione),s(4),T("ngModel",t.dettaglioModal.data_scadenza_prevista),s(4),m("disabled",t.loading),s(2),w(t.modalDettaglioMode==="create"?"save":"edit"),s(),v(" ",t.modalDettaglioMode==="create"?"Crea Dettaglio":"Salva Modifiche"," ")}}function $t(l,e){if(l&1){let t=f();n(0,"div",114),p("click",function(){g(t);let i=c();return _(i.chiudiTemplateModal())}),a()}}function Gt(l,e){if(l&1&&(n(0,"li")(1,"strong"),r(2),a(),r(3),a()),l&2){let t=e.$implicit;s(2),w(t.nome),s(),v(" - ",t.descrizione," ")}}function Qt(l,e){if(l&1&&(n(0,"ul"),k(1,Gt,4,2,"li",98),a()),l&2){let t=c().$implicit;s(),m("ngForOf",t.task_dettaglio)}}function Jt(l,e){if(l&1&&(n(0,"div",158)(1,"strong"),r(2),a(),r(3),k(4,Qt,2,1,"ul",90),a()),l&2){let t=e.$implicit,o=e.index;s(2),A("",o+1,". ",t.nome),s(),v(" (Priorit\xE0: ",t.priorita,") "),s(),m("ngIf",t.task_dettaglio&&t.task_dettaglio.length>0)}}function Kt(l,e){if(l&1){let t=f();n(0,"div",115)(1,"div",116)(2,"div",117)(3,"div",118)(4,"h5",119)(5,"i",19),r(6,"content_copy"),a(),r(7," Salva come Template "),a(),n(8,"button",150),p("click",function(){g(t);let i=c();return _(i.chiudiTemplateModal())}),a()(),n(9,"div",121)(10,"div",35)(11,"label",151),r(12,"Nome Template *"),a(),n(13,"input",152),h("ngModelChange",function(i){g(t);let d=c();return S(d.nomeTemplate,i)||(d.nomeTemplate=i),_(i)}),a()(),n(14,"div",35)(15,"label",153),r(16,"Descrizione"),a(),n(17,"textarea",154),h("ngModelChange",function(i){g(t);let d=c();return S(d.descrizioneTemplate,i)||(d.descrizioneTemplate=i),_(i)}),a()(),n(18,"div",35)(19,"label",155),r(20,"Anteprima Struttura"),a(),n(21,"div",156),k(22,Jt,5,4,"div",157),a()()(),n(23,"div",126)(24,"button",127),p("click",function(){g(t);let i=c();return _(i.chiudiTemplateModal())}),r(25,"Annulla"),a(),n(26,"button",149),p("click",function(){g(t);let i=c();return _(i.confermaCreaTemplate())}),n(27,"i",19),r(28,"save"),a(),r(29),a()()()()()}if(l&2){let t=c();s(13),T("ngModel",t.nomeTemplate),s(4),T("ngModel",t.descrizioneTemplate),s(5),m("ngForOf",(t.macroTask==null?null:t.macroTask.sotto_tasks)||I(7,kt)),s(4),m("disabled",!t.nomeTemplate.trim()||t.loading),s(),y("fa-spin",t.loading),s(2),v(" ",t.loading?"Salvataggio...":"Crea Template"," ")}}function Xt(l,e){if(l&1){let t=f();n(0,"div",114),p("click",function(){g(t);let i=c();return _(i.chiudiModal("leggiDettaglio"))}),a()}}function Yt(l,e){if(l&1&&(n(0,"div",35)(1,"label",155),r(2,"Scadenza prevista"),a(),n(3,"div"),r(4),E(5,"date"),a()()),l&2){let t=c().ngIf;s(4),w(P(5,1,t.data_scadenza_prevista,"dd/MM/yyyy"))}}function Zt(l,e){if(l&1&&(n(0,"div",35)(1,"label",155),r(2,"Descrizione completa"),a(),n(3,"div",160),r(4),a()()),l&2){let t=c().ngIf;s(4),w(t.descrizione)}}function te(l,e){if(l&1&&(N(0),n(1,"div",35)(2,"label",155),r(3,"Nome"),a(),n(4,"div"),r(5),a()(),k(6,Yt,6,4,"div",159)(7,Zt,5,1,"div",159),W()),l&2){let t=e.ngIf;s(5),w(t.nome),s(),m("ngIf",t.data_scadenza_prevista),s(),m("ngIf",t.descrizione)}}function ee(l,e){if(l&1){let t=f();n(0,"div",115)(1,"div",116)(2,"div",117)(3,"div",118)(4,"h5",119)(5,"i",19),r(6,"description"),a(),r(7," Dettaglio "),a(),n(8,"button",120),p("click",function(){g(t);let i=c();return _(i.chiudiModal("leggiDettaglio"))}),a()(),n(9,"div",121),k(10,te,8,3,"ng-container",90),a(),n(11,"div",126)(12,"button",127),p("click",function(){g(t);let i=c();return _(i.chiudiModal("leggiDettaglio"))}),r(13,"Chiudi"),a()()()()()}if(l&2){let t=c();s(10),m("ngIf",t.selectedDettaglioView)}}var _t=class l{constructor(e,t,o,i,d,u,b){this.router=e;this.route=t;this.taskService=o;this.soggettiService=i;this.userService=d;this.authService=u;this.emailService=b}currentUser=null;macroTask=null;clienti=[];loading=!1;error="";activeDropdownId=null;selectedDettaglioView=null;modals={sottoTask:!1,dettaglio:!1,modificaSottoTask:!1,leggiDettaglio:!1};modalDettaglioMode="create";dettaglioModal={id:void 0,nome:"",descrizione:"",data_scadenza_prevista:new Date().toISOString().split("T")[0],sotto_task_id:""};sottoTaskStati=["da_fare","in_lavorazione","completato"];showTemplateModal=!1;nomeTemplate="";descrizioneTemplate="";nuovaSottoTask={nome:"",priorita:3,macro_task_id:""};nuovoDettaglio={nome:"",descrizione:"",data_scadenza_prevista:new Date().toISOString().split("T")[0],sotto_task_id:""};sottoTaskModificata={};sottoTaskDaModificare=null;selectedSottoTask=null;sottoTaskEspanse=new Set;espandiTutti=!1;ngOnInit(){return x(this,null,function*(){try{let t=this.authService.user();if(t&&t.id){let o=yield this.userService.getUserById(t.id);this.currentUser=o.data??null}else this.currentUser=null;this.userService.refreshAdminStatus&&(yield this.userService.refreshAdminStatus())}catch(t){console.warn("Impossibile recuperare utente corrente",t),this.currentUser=null}let e=this.route.snapshot.paramMap.get("id");e==="nuova"?this.inizializzaNuovaTask():e?yield this.caricaTask(e):this.inizializzaNuovaTask();try{yield this.caricaDatiSupporto()}catch(t){console.warn("Errore caricamento dati di supporto",t)}})}inizializzaNuovaTask(){this.macroTask={id:"",nome:"",data_scadenza:new Date().toISOString().split("T")[0],cliente_id:"",assegnazione_id:null,note:"",stato:"da_fare",priorita_globale:1,progresso:0,created_at:"",updated_at:"",sotto_tasks:[],extra_data:{}}}caricaTask(e){return x(this,null,function*(){this.loading=!0;try{let t=yield this.taskService.getMacroTaskById(e);if(t.error)this.error="Errore: "+t.error.message;else{this.macroTask=t.data;let o=new Set((this.macroTask?.sotto_tasks||[]).map(i=>i.id));this.sottoTaskEspanse.forEach(i=>{o.has(i)||this.sottoTaskEspanse.delete(i)}),this.espandiTutti&&(this.macroTask?.sotto_tasks||[]).forEach(i=>this.sottoTaskEspanse.add(i.id))}}catch(t){this.error="Errore: "+t.message}finally{this.loading=!1}})}caricaDatiSupporto(){return x(this,null,function*(){try{let e=yield this.soggettiService.getSoggettiByTipo("cliente");this.clienti=e.data||[]}catch(e){console.error("Errore caricamento clienti:",e)}})}apriModal(e,t){if(this.modals[e]=!0,e==="sottoTask"){let o=this.macroTask?.id;o&&(this.nuovaSottoTask.macro_task_id=o)}e==="dettaglio"&&t&&(this.selectedSottoTask=t,this.modalDettaglioMode="create",this.dettaglioModal={id:void 0,nome:"",descrizione:"",data_scadenza_prevista:new Date().toISOString().split("T")[0],sotto_task_id:t.id}),e==="modificaSottoTask"&&t&&(this.sottoTaskDaModificare=t,this.sottoTaskModificata={id:t.id,nome:t.nome,descrizione:t.descrizione??void 0,priorita:t.priorita,stato:t.stato})}chiudiModal(e){this.modals[e]=!1,e==="sottoTask"&&(this.nuovaSottoTask={nome:"",priorita:3,macro_task_id:""}),e==="dettaglio"&&(this.modalDettaglioMode="create",this.dettaglioModal={id:void 0,nome:"",descrizione:"",data_scadenza_prevista:new Date().toISOString().split("T")[0],sotto_task_id:this.selectedSottoTask?.id??""},this.selectedSottoTask=null),e==="modificaSottoTask"&&(this.sottoTaskDaModificare=null,this.sottoTaskModificata={})}salvaDettaglio(){return x(this,null,function*(){if(!this.dettaglioModal.nome.trim()){this.error="Il nome del dettaglio \xE8 obbligatorio";return}if(!this.dettaglioModal.sotto_task_id){this.error="Seleziona una sotto-task valida";return}try{let e;if(this.modalDettaglioMode==="create"){let t={nome:this.dettaglioModal.nome,descrizione:this.dettaglioModal.descrizione,data_scadenza_prevista:this.dettaglioModal.data_scadenza_prevista,sotto_task_id:this.dettaglioModal.sotto_task_id};e=yield this.taskService.createTaskDettaglio(t)}else{if(!this.dettaglioModal.id)return;e=yield this.taskService.updateTaskDettaglio(this.dettaglioModal.id,{nome:this.dettaglioModal.nome,descrizione:this.dettaglioModal.descrizione,data_scadenza_prevista:this.dettaglioModal.data_scadenza_prevista})}e?.error?this.error="Errore: "+e.error.message:(yield this.aggiornaTask(),this.chiudiModal("dettaglio"))}catch(e){this.error="Errore: "+e.message}})}salvaMacroTask(){return x(this,null,function*(){if(!(!this.macroTask||!this.validazioneTask())){this.loading=!0,this.error="";try{let t;if(this.macroTask.id){let e=this.macroTask,{cliente:o,sotto_tasks:i}=e,d=U(e,["cliente","sotto_tasks"]),u={nome:d.nome,data_scadenza:d.data_scadenza,note:d.note||"",stato:d.stato,priorita_globale:Number(d.priorita_globale)||1,progresso:d.progresso};d.cliente_id&&this.isValidUUID(d.cliente_id)&&(u.cliente_id=d.cliente_id),d.assegnazione_id&&(u.assegnazione_id=d.assegnazione_id),console.log("Aggiorno MacroTask:",this.macroTask.id,u),t=yield this.taskService.updateMacroTask(this.macroTask.id,u)}else{let o={nome:this.macroTask.nome,data_scadenza:this.macroTask.data_scadenza,note:this.macroTask.note||"",stato:"da_fare"};this.macroTask.cliente_id&&this.isValidUUID(this.macroTask.cliente_id)&&(o.cliente_id=this.macroTask.cliente_id),this.macroTask.assegnazione_id&&(o.assegnazione_id=this.macroTask.assegnazione_id),t=yield this.taskService.createMacroTask(o)}t.error?this.error="Errore: "+t.error.message:this.router.navigate(["/task"])}catch(t){this.error="Errore: "+t.message}finally{this.loading=!1}}})}isValidUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}validazioneTask(){return this.macroTask.nome.trim()?this.macroTask.assegnazione_id?!0:(this.error="Seleziona un modulo per assegnare la task",!1):(this.error="Il nome della task \xE8 obbligatorio",!1)}creaSottoTask(){return x(this,null,function*(){if(!this.nuovaSottoTask.nome.trim()){this.error="Il nome della sotto-task \xE8 obbligatorio";return}try{let e=yield this.taskService.createSottoTask(this.nuovaSottoTask);e.error?this.error="Errore: "+e.error.message:yield this.aggiornaTask(),this.chiudiModal("sottoTask")}catch(e){this.error="Errore: "+e.message}})}creaTaskDettaglio(){return x(this,null,function*(){if(!this.nuovoDettaglio.nome.trim()){this.error="Il nome del dettaglio \xE8 obbligatorio";return}try{let e=yield this.taskService.createTaskDettaglio(this.nuovoDettaglio);e.error?this.error="Errore: "+e.error.message:yield this.aggiornaTask(),this.chiudiModal("dettaglio")}catch(e){this.error="Errore: "+e.message}})}salvaModificaSottoTask(){return x(this,null,function*(){if(!this.sottoTaskDaModificare||!this.sottoTaskModificata.nome?.trim()){this.error="Il nome della sotto-task \xE8 obbligatorio";return}try{let e=F({nome:this.sottoTaskModificata.nome,priorita:Number(this.sottoTaskModificata.priorita)||this.sottoTaskDaModificare.priorita},this.sottoTaskModificata.stato?{stato:this.sottoTaskModificata.stato}:{}),t=yield this.taskService.updateSottoTask(this.sottoTaskDaModificare.id,e);t.error?this.error="Errore: "+t.error.message:yield this.aggiornaTask(),this.chiudiModal("modificaSottoTask")}catch(e){this.error="Errore: "+e.message}})}toggleDettaglioCompletato(e,t){return x(this,null,function*(){try{(yield this.taskService.toggleTaskDettaglioCompletato(e.id,!e.completato)).error||(e.completato=!e.completato,e.data_completamento=e.completato?new Date().toISOString():null,yield this.aggiornaStatoSottoTaskAutomatico(t),yield this.aggiornaTask())}catch(o){this.error="Errore: "+o.message}})}aggiornaStatoSottoTaskAutomatico(e){return x(this,null,function*(){if(!e.task_dettaglio?.length)return;let t=e.task_dettaglio.every(d=>d.completato),o=e.task_dettaglio.every(d=>!d.completato),i=e.stato;if(t?i="completato":o?i="da_fare":i="in_lavorazione",i!==e.stato){let d=e.stato;try{yield this.taskService.updateSottoTask(e.id,{stato:i}),e.stato=i,d!=="completato"&&i==="completato"&&(console.log("Sotto-task completata, verifica invio email...",e),this.maybeAskAndSendCompletionEmail(e).catch(u=>{console.warn("Invio email completamento sotto-task fallito:",u)}))}catch(u){console.error("Errore aggiornamento stato sotto-task:",u)}yield this.aggiornaTask()}})}aggiornaTask(){return x(this,null,function*(){let e=this.macroTask?.id;e&&(yield this.caricaTask(e))})}toggleDropdown(e,t){t?.stopPropagation(),this.activeDropdownId=this.activeDropdownId===e?null:e}isDropdownOpen(e){return this.activeDropdownId===e}closeDropdown(){this.activeDropdownId=null}puoiModificareSottoTask(e){return!e.task_dettaglio||e.task_dettaglio.length===0}getNomeCliente(e){return this.clienti.find(t=>t.id===e)?.ragione_sociale||"Non assegnato"}trackBySottoTask(e,t){return t.id}trackByDettaglio(e,t){return t.id}eliminaMacroTask(){return x(this,null,function*(){if(!this.currentUser?.is_admin){this.error="Non autorizzato";return}let e=this.macroTask?.id;if(!(!e||!confirm("Sei sicuro di voler eliminare questa macro task e tutti i contenuti collegati?"))){this.loading=!0,this.error="";try{let o=yield this.taskService.deleteMacroTaskCascade(e);if(o.error){this.error="Errore eliminazione: "+o.error.message;return}this.router.navigate(["/task"])}catch(o){this.error="Errore: "+o.message}finally{this.loading=!1}}})}eliminaDettaglio(e,t){return x(this,null,function*(){if(confirm("Sei sicuro di eliminare questo dettaglio?"))try{let o=yield this.taskService.deleteTaskDettaglio(e.id);if(o.error){this.error="Errore: "+o.error.message;return}t.task_dettaglio&&(t.task_dettaglio=t.task_dettaglio.filter(d=>d.id!==e.id)),yield this.aggiornaStatoSottoTaskAutomatico(t);let i=this.macroTask?.id;i&&(yield this.caricaTask(i))}catch(o){this.error="Errore: "+o.message}})}cambiaStatoSottoTask(e,t){return x(this,null,function*(){if(!this.puoiModificareSottoTask(e)){this.error="Impossibile modificare lo stato: questa sotto-task ha dettagli e lo stato viene gestito automaticamente";return}try{let o=yield this.taskService.updateSottoTask(e.id,{stato:t});o.error?this.error="Errore: "+o.error.message:(e.stato=t,this.macroTask&&(yield this.caricaTask(this.macroTask.id)))}catch(o){this.error="Errore: "+o.message}})}getPrioritaBadgeClass(e){return this.taskService.getPrioritaBadgeClass(e)}getStatoBadgeClass(e){return this.taskService.getStatoBadgeClass(e)}getStatoTesto(e){return this.taskService.getStatoTesto(e)}getModuloName(e){return this.taskService.getModuloName(e.assegnazione_id||null)}isScaduta(e){return this.taskService.isScaduta(e)}isScadenzaImminente(e){return this.taskService.isScadenzaImminente(e)}salvaComeTemplate(){if(!this.currentUser?.is_admin){this.error="Non autorizzato";return}if(!this.macroTask){this.error="Nessuna task da salvare come template";return}this.nomeTemplate=this.macroTask.nome+" - Template",this.descrizioneTemplate=this.macroTask.note||"",this.showTemplateModal=!0}chiudiTemplateModal(){this.showTemplateModal=!1,this.nomeTemplate="",this.descrizioneTemplate=""}confermaCreaTemplate(){return x(this,null,function*(){if(!this.macroTask||!this.nomeTemplate.trim()){this.error="Il nome del template \xE8 obbligatorio";return}this.loading=!0;try{let e={sotto_tasks:[]};if(this.macroTask.sotto_tasks)for(let i of this.macroTask.sotto_tasks){let d={nome:i.nome,priorita:i.priorita,task_dettaglio:[]};if(i.task_dettaglio)for(let u of i.task_dettaglio){let b=this.calcolaOffsetGiorni(u.data_scadenza_prevista,this.macroTask.created_at),O={nome:u.nome,descrizione:u.descrizione||"",data_scadenza_prevista_offset:b};d.task_dettaglio.push(O)}e.sotto_tasks.push(d)}let t={nome:this.nomeTemplate,descrizione:this.descrizioneTemplate||null,modulo:this.macroTask.assegnazione_id||"immagine",priorita_globale:this.macroTask.priorita_globale,data_scadenza_default:30,struttura_template:e},o=yield this.taskService.createMacroTaskTemplate(t);o.error?this.error="Errore nel salvataggio del template: "+o.error.message:(this.chiudiTemplateModal(),alert("Template salvato con successo!"))}catch(e){this.error="Errore: "+e.message}finally{this.loading=!1}})}calcolaOffsetGiorni(e,t){let o=new Date(e),i=new Date(t),d=o.getTime()-i.getTime();return Math.ceil(d/(1e3*60*60*24))}apriDettaglio(e,t){this.selectedSottoTask=t,this.modalDettaglioMode="edit",this.dettaglioModal={id:e.id,nome:e.nome,descrizione:e.descrizione??"",data_scadenza_prevista:e.data_scadenza_prevista?e.data_scadenza_prevista.split("T")[0]:new Date().toISOString().split("T")[0],sotto_task_id:t.id},this.modals.dettaglio=!0}toggleSottoTaskEspansa(e){requestAnimationFrame(()=>{this.sottoTaskEspanse.has(e)?this.sottoTaskEspanse.delete(e):this.sottoTaskEspanse.add(e)})}isSottoTaskEspansa(e){return this.sottoTaskEspanse.has(e)}toggleEspandiTutti(){this.espandiTutti=!this.espandiTutti,requestAnimationFrame(()=>{this.espandiTutti&&this.macroTask?.sotto_tasks?this.macroTask.sotto_tasks.forEach(e=>{this.sottoTaskEspanse.add(e.id)}):this.sottoTaskEspanse.clear()})}canEditTask(){return this.taskService.canModifyTask(this.currentUser,this.macroTask??null)}maybeAskAndSendCompletionEmail(e){return x(this,null,function*(){try{if(!this.currentUser?.is_admin){console.log("Utente non admin: invio email disabilitato per completamento sotto-task",e.id);return}let t=this.macroTask?.cliente_id;if(!t){console.warn("Nessun cliente associato alla macro task");return}let o=this.clienti.find(C=>C.id===t);if(!o){console.warn("Cliente non trovato");return}let i=o.email||o?.referente_email||o?.contatto_email||o?.mail;if(!i||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)){console.warn("Email cliente non valida o assente:",i);return}if(!confirm(`La sotto-task "${e.nome}" \xE8 stata completata.

Inviare una email di notifica al cliente?
Destinatario: ${i}`))return;let u=(e.task_dettaglio||[]).filter(C=>C.completato).map(C=>({nome:C.nome,data:C.data_scadenza_prevista?new Date(C.data_scadenza_prevista).toLocaleDateString("it-IT"):"N/D"}));if(u.length===0){alert("Nessun dettaglio completato trovato nella sotto-task");return}let b=`Completamento attivit\xE0: ${e.nome}`,O=this.generateEmailText(o,e.nome,u),pt=this.emailService.generateSottoTaskCompletionHtml(o,e.nome,u);console.log("\u{1F4E4} Invio email tramite servizio Aruba...");let D=yield this.emailService.sendEmail({to:i,subject:b,message:O,html:pt});D.success?alert("Email inviata con successo al cliente!"):(this.error="Invio email fallito: "+(D.error||"Errore sconosciuto"),console.error("Errore invio email:",D.error))}catch(t){console.error("Errore durante l'invio dell'email:",t),this.error="Errore invio email: "+(t?.message||String(t))}})}generateEmailText(e,t,o){return`
Gentile ${e.referente||e.ragione_sociale||"Cliente"},

la informiamo che la sotto-task "${t}" \xE8 stata completata.

DETTAGLI COMPLETATI:
${o.map(d=>`\u2022 ${d.nome}${d.data?` (Scadenza: ${d.data})`:""}`).join(`
`)}

Cordiali saluti,
Il Team di Promethea S.r.l.

[Questo messaggio \xE8 stato generato automaticamente]
  `.trim()}handleSottoTaskAction(e,t){switch(e){case"edit":this.apriModal("modificaSottoTask",t);break;case"delete":confirm("Eliminare questa sotto-task?")&&console.log("delete requested",t.id);break;case"add-product":console.log("add-product per",t);break;default:console.log("Azione non gestita dall'action-dropdown:",e,t)}}static \u0275fac=function(t){return new(t||l)(M(Y),M(X),M(mt),M(dt),M(tt),M(Z),M(gt))};static \u0275cmp=L({type:l,selectors:[["app-task-singola"]],hostBindings:function(t,o){t&1&&p("click",function(){return o.closeDropdown()},j)},decls:23,vars:16,consts:[["tplNessunaSottoTask",""],["ad",""],[1,"task-detail-container"],[1,"form-section"],[1,"section-header"],[1,"section-titles"],[1,"section-title"],[1,"material-icons","header-icon"],["class","table-section",4,"ngIf"],["class","header-actions",4,"ngIf"],["class","status-message loading",4,"ngIf"],["class","status-message error",4,"ngIf"],["class","task-content marcotaskform",4,"ngIf"],["class","modal-backdrop show",3,"click",4,"ngIf"],["class","modal show d-block","tabindex","-1",4,"ngIf"],[1,"table-section"],[1,"text-muted"],[1,"header-actions"],[1,"promethea-button","secondary",3,"click"],[1,"material-icons"],[1,"btn-text"],["class","promethea-button delete",3,"disabled","click",4,"ngIf"],["class","promethea-button edit",3,"disabled","click",4,"ngIf"],[1,"promethea-button","primary",3,"click","disabled"],[1,"promethea-button","delete",3,"click","disabled"],[1,"promethea-button","edit",3,"click","disabled"],[1,"status-message","loading"],["role","status",1,"loading-spinner"],[1,"status-message","error"],[1,"task-content","marcotaskform"],[1,"main-section"],[1,"grid-form"],[1,"form-field","full-width"],["for","nome",1,"form-label"],["type","text","id","nome","placeholder","Inserisci il nome della task",3,"ngModelChange","ngModel"],[1,"form-field"],["for","data_scadenza",1,"form-label"],["type","date","id","data_scadenza",3,"ngModelChange","ngModel"],["for","stato",1,"form-label"],["type","text","id","stato","disabled","",3,"value"],["for","cliente_id",1,"form-label"],["id","cliente_id",3,"ngModelChange","ngModel"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["for","priorita",1,"form-label"],["id","priorita",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],["for","assegnazione_id",1,"form-label"],["id","assegnazione_id","required","",3,"ngModelChange","ngModel"],["value","immagine"],["value","digitalizzazione"],["value","contabilita"],["value","ottimizzazione"],["value","tutti"],["for","note",1,"form-label"],["id","note","rows","4","placeholder","Aggiungi note o descrizione...",3,"ngModelChange","ngModel"],["class","form-actions",4,"ngIf"],["class","form-section",4,"ngIf"],[1,"form-section","riepilogo"],[1,"card","info-card"],[1,"info-grid"],[1,"info-item"],[1,"badge",3,"ngClass"],[1,"progress","flex-1"],[1,"progress-bar",3,"ngClass"],[1,"progress-text"],[3,"ngValue"],[1,"form-actions"],[1,"promethea-button",2,"margin-top","var(--gutter-lg)",3,"click","disabled"],[1,"card-number",2,"font-size","var(--fs-md)"],[1,"header-actions",2,"max-width","280px","padding","var(--gutter-lg)"],[1,"promethea-button","outline",3,"click","title"],[1,"promethea-button","outline",3,"click"],["class","contenitore-sottotask",4,"ngIf","ngIfElse"],[1,"empty-state"],[1,"contenitore-sottotask"],["class","card sotto-task-card",3,"expanded","dropdown-open",4,"ngFor","ngForOf","ngForTrackBy"],[1,"card","sotto-task-card"],[1,"sotto-task-header",3,"click"],[1,"sotto-task-info"],[1,"icon-btn","expand",3,"click","title"],[1,"sotto-task-content"],[1,"sotto-task-title"],[1,"sotto-task-meta"],[1,"badge"],["class","dettaglio-counter",4,"ngIf"],[1,"sotto-task-actions",3,"click"],["title","Modifica sotto-task",1,"action-btn",3,"click"],["mode","modal",3,"action","row"],["dropdown-items","",3,"click"],[4,"ngIf"],[1,"dropdown-item",3,"click"],["class","action-btn","style","cursor: auto;","title","Stato gestito automaticamente dai dettagli",4,"ngIf"],[1,"dettaglio-container"],["class","dettaglio-list",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"dettaglio-counter"],[1,"dropdown-header"],[4,"ngFor","ngForOf"],[1,"dropdown-divider"],["title","Stato gestito automaticamente dai dettagli",1,"action-btn",2,"cursor","auto"],[1,"dettaglio-list"],["class","dettaglio-item",4,"ngFor","ngForOf","ngForTrackBy"],[1,"dettaglio-item"],[1,"dettaglio-content"],["type","checkbox",3,"change","click","mousedown","checked"],[1,"dettaglio-info"],[1,"dettaglio-header"],[1,"dettaglio-actions",3,"click"],["title","Modifica dettaglio",1,"icon-btn",3,"click"],["title","Elimina dettaglio",1,"icon-btn","danger",3,"click"],["class","dettaglio-descrizione text-muted",3,"click",4,"ngIf"],[1,"dettaglio-descrizione","text-muted",3,"click"],[3,"click"],[1,"modal-backdrop","show",3,"click"],["tabindex","-1",1,"modal","show","d-block"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Chiudi",1,"icon-btn","close",3,"click"],[1,"modal-body"],["for","stNome",1,"form-label"],["id","stNome","type","text","placeholder","Inserisci nome sotto-task",3,"ngModelChange","ngModel"],["for","stPriorita",1,"form-label"],["id","stPriorita",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button",1,"promethea-button","secondary",3,"click"],["type","button",1,"promethea-button",3,"click"],["for","modificaNome",1,"form-label"],["type","text","id","modificaNome","placeholder","Inserisci il nome della sotto task",3,"ngModelChange","ngModel"],["for","modificaPriorita",1,"form-label"],["id","modificaPriorita",3,"ngModelChange","ngModel"],["value","1"],["value","2"],["value","3"],["value","4"],["value","5"],["for","modificaStato",1,"form-label"],["id","modificaStato",3,"ngModelChange","ngModel"],["value","da_fare"],["value","in_lavorazione"],["value","completato"],["for","dettaglioNome",1,"form-label"],["type","text","id","dettaglioNome","placeholder","Inserisci il nome del dettaglio",3,"ngModelChange","ngModel"],["for","dettaglioDescrizione",1,"form-label"],["id","dettaglioDescrizione","rows","3","placeholder","Aggiungi una descrizione...",3,"ngModelChange","ngModel"],["for","dettaglioScadenza",1,"form-label"],["type","date","id","dettaglioScadenza",3,"ngModelChange","ngModel"],["type","button",1,"promethea-button",3,"click","disabled"],["type","button",1,"icon-btn",3,"click"],["for","nomeTemplate",1,"form-label"],["type","text","id","nomeTemplate","placeholder","Inserisci un nome per il template",3,"ngModelChange","ngModel"],["for","descrizioneTemplate",1,"form-label"],["id","descrizioneTemplate","rows","3","placeholder","Aggiungi una descrizione...",3,"ngModelChange","ngModel"],[1,"form-label"],[1,"template-preview"],["class","sotto-task-preview",4,"ngFor","ngForOf"],[1,"sotto-task-preview"],["class","form-field",4,"ngIf"],[2,"white-space","pre-wrap"]],template:function(t,o){t&1&&(n(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"h1",6)(5,"i",7),r(6,"task"),a(),r(7),a(),k(8,ft,3,1,"div",8),a(),k(9,St,13,6,"div",9),a()(),k(10,ht,4,0,"div",10)(11,wt,4,1,"div",11)(12,Ft,102,40,"div",12)(13,Ut,1,0,"div",13)(14,jt,33,7,"div",14)(15,Lt,1,0,"div",13)(16,Rt,43,3,"div",14)(17,qt,1,0,"div",13)(18,Ht,29,7,"div",14)(19,$t,1,0,"div",13)(20,Kt,30,8,"div",14)(21,Xt,1,0,"div",13)(22,ee,14,1,"div",14),a()),t&2&&(s(7),v(" ",o.macroTask!=null&&o.macroTask.id?"Modifica Task":"Nuova Macro Task"," "),s(),m("ngIf",o.macroTask==null?null:o.macroTask.id),s(),m("ngIf",o.macroTask==null?null:o.macroTask.id),s(),m("ngIf",o.loading&&!o.macroTask),s(),m("ngIf",o.error),s(),m("ngIf",o.macroTask),s(),m("ngIf",o.modals.sottoTask),s(),m("ngIf",o.modals.sottoTask),s(),m("ngIf",o.modals.modificaSottoTask),s(),m("ngIf",o.modals.modificaSottoTask),s(),m("ngIf",o.modals.dettaglio),s(),m("ngIf",o.modals.dettaglio),s(),m("ngIf",o.showTemplateModal),s(),m("ngIf",o.showTemplateModal),s(),m("ngIf",o.modals.leggiDettaglio),s(),m("ngIf",o.modals.leggiDettaglio))},dependencies:[K,$,G,Q,lt,ot,rt,et,nt,it,st,at,ct,J],styles:['.section-title[_ngcontent-%COMP%]{margin:0}.header-actions[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:var(--gutter-sm);width:100%;max-width:320px;container-type:inline-size;padding:var(--gutter-md)}@container (max-width: 300px){.header-actions[_ngcontent-%COMP%]{grid-template-columns:1fr;max-width:100%}}@container (min-width: 301px) and (max-width: 500px){.header-actions[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr;max-width:280px}}@container (min-width: 501px){.header-actions[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr;max-width:320px}}.section-header[_ngcontent-%COMP%]{align-items:flex-start;justify-content:space-between;container-type:inline-size;margin:0}.task-detail-container[_ngcontent-%COMP%]{padding:var(--gutter-lg);background:var(--background);min-height:100vh}.task-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:minmax(0,1fr) minmax(260px,350px);gap:var(--gutter-lg);align-items:flex-start}@container (max-width: 600px){.section-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:var(--gutter-md)}.header-actions[_ngcontent-%COMP%]{max-width:100%;justify-self:center}}.header-actions[_ngcontent-%COMP%]   .promethea-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:var(--gutter-sm);padding:var(--gutter-sm) var(--gutter-md);font-size:var(--fs-sm);min-height:2.5rem;white-space:nowrap}@container (max-width: 160px){.header-actions[_ngcontent-%COMP%]   .promethea-button[_ngcontent-%COMP%]   .btn-text[_ngcontent-%COMP%]{display:none}.header-actions[_ngcontent-%COMP%]   .promethea-button[_ngcontent-%COMP%]{padding:var(--gutter-md);min-width:2.5rem}}.main-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-md);min-width:0}.task-card[_ngcontent-%COMP%]{position:relative;border-left:4px solid var(--primary);padding:var(--gutter-lg);gap:var(--gutter-sm);border-radius:18px;display:flex;flex-direction:column;justify-content:space-between;height:100%}.task-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-sm)}.task-card.scaduta[_ngcontent-%COMP%]{border-left-color:#ef4444;background:linear-gradient(135deg,var(--background) 0%,color-mix(in srgb,#ef4444 8%,transparent) 100%)}.task-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:var(--gutter-sm);margin-bottom:var(--gutter-sm);flex-wrap:wrap}.task-main-info[_ngcontent-%COMP%]{flex:1;min-width:0}.task-title[_ngcontent-%COMP%]{cursor:pointer;margin-bottom:var(--gutter-sm)}.task-meta-compact[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.meta-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);color:color-mix(in srgb,var(--text-color) 60%,transparent)}.task-header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);flex-shrink:0;margin-left:auto}.priority-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;min-width:5rem;height:var(--fs-md);padding:0 var(--gutter-sm);border-radius:6px;font-weight:700;border:1px solid var(--smoke-color-1);background:color-mix(in srgb,var(--text-color) 10%,transparent);text-transform:uppercase;letter-spacing:.5px}.priority-badge[data-priority="5"][_ngcontent-%COMP%]{background:linear-gradient(90deg,#6b0218,#a50b1f);color:#fff;border:1px solid rgba(0,0,0,.12);box-shadow:0 6px 16px #a50b1f1f}.priority-badge[data-priority="4"][_ngcontent-%COMP%]{background:linear-gradient(90deg,#ef4444,#c53030);color:#fff;border:1px solid rgba(0,0,0,.08)}.priority-badge[data-priority="3"][_ngcontent-%COMP%]{background:linear-gradient(90deg,#f59e0b,#d97706);color:#1a1a1a;border:1px solid rgba(0,0,0,.06)}.priority-badge[data-priority="2"][_ngcontent-%COMP%]{background:linear-gradient(90deg,#10b981,#059669);color:#fff;border:1px solid rgba(0,0,0,.06)}.priority-badge[data-priority="1"][_ngcontent-%COMP%], .priority-badge[data-priority="0"][_ngcontent-%COMP%], .priority-badge[_ngcontent-%COMP%]:not([data-priority]){background:color-mix(in srgb,var(--text-color) 6%,transparent);color:var(--text-color);border:1px solid var(--smoke-color-1)}.progress-section[_ngcontent-%COMP%]{margin:var(--gutter-sm) 0}.progress-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm)}.progress-stats[_ngcontent-%COMP%]{flex-shrink:0}.scadenza-date[_ngcontent-%COMP%]{font-weight:700}.task-counts-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-sm);margin:var(--gutter-sm) 0}.count-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:var(--gutter-sm);background:var(--smoke-color-2);border-radius:8px;border:1px solid var(--smoke-color-1)}.count-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:var(--fs-md);height:var(--fs-md);padding:var(--gutter-sm);border-radius:50%;font-weight:700;color:#fff}.count-badge.da-fare[_ngcontent-%COMP%]{background:#42464d}.count-badge.in-lavorazione[_ngcontent-%COMP%]{background:var(--secondary)}.count-badge.completate[_ngcontent-%COMP%]{background:#10b981}.count-label[_ngcontent-%COMP%]{margin-top:4px;text-align:center;color:color-mix(in srgb,var(--text-color) 70%,transparent);text-transform:uppercase;letter-spacing:.5px}.task-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-top:var(--gutter-sm);border-top:1px solid var(--smoke-color-1);margin-top:auto}.sotto-task-card[_ngcontent-%COMP%]{border-left:4px solid var(--primary);display:flex;flex-direction:column;height:100%;container-type:inline-size;min-width:0;position:relative;overflow:visible}.sotto-task-card.expanded[_ngcontent-%COMP%]{box-shadow:0 8px 24px var(--shadow2);border-color:var(--primary)}.sotto-task-card[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]{z-index:50}.sotto-task-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:var(--gutter-sm);margin-bottom:var(--gutter-sm);flex-wrap:wrap;cursor:pointer}.sotto-task-info[_ngcontent-%COMP%]{flex:1 1 auto;min-width:0;display:flex;align-items:flex-start;gap:var(--gutter-sm)}.sotto-task-content[_ngcontent-%COMP%]{flex:1;min-width:0}.sotto-task-meta[_ngcontent-%COMP%]{display:flex;gap:var(--gutter-sm);align-items:center;flex-wrap:wrap;margin-top:.25rem}.sotto-task-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);margin-left:auto;flex:1 1 auto;justify-content:flex-end;flex-wrap:wrap;min-width:0;max-width:100%;position:relative;z-index:2}.dettaglio-container[_ngcontent-%COMP%]{max-height:0;overflow:hidden;opacity:0;transition:max-height .5s cubic-bezier(.4,0,.2,1),opacity .3s ease .1s}.dettaglio-container.show[_ngcontent-%COMP%]{max-height:5000px;opacity:1;transition:max-height .8s cubic-bezier(.4,0,.2,1),opacity .4s ease .1s}.dettaglio-list[_ngcontent-%COMP%]{border-top:1px solid var(--smoke-color-1);padding-top:var(--gutter-sm);display:flex;flex-direction:column;gap:var(--gutter-sm)}.dettaglio-item[_ngcontent-%COMP%]{padding:var(--gutter-sm);background:var(--background);border-radius:10px;border:1px solid var(--smoke-color-1);transition:all .2s ease}.dettaglio-item[_ngcontent-%COMP%]:hover{border-color:var(--primary);background:var(--smoke-color-2)}.dettaglio-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;column-gap:var(--gutter-sm);justify-content:center;align-items:first baseline}.dettaglio-descrizione[_ngcontent-%COMP%]{padding:var(--gutter-sm) 0}.dettaglio-header[_ngcontent-%COMP%]{display:grid;grid-template-columns:minmax(0,1fr) auto auto;align-items:center;gap:var(--gutter-sm)}.dettaglio-header[_ngcontent-%COMP%]   strong.completed[_ngcontent-%COMP%]{text-decoration:line-through;color:color-mix(in srgb,var(--text-color) 50%,transparent)}.dettaglio-counter[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem;font-size:.75rem;color:color-mix(in srgb,var(--text-color) 60%,transparent);background:var(--smoke-color-2);padding:.125rem .5rem;border-radius:12px;border:1px solid var(--smoke-color-1)}.sotto-task-card[_ngcontent-%COMP%]:not(.expanded)   .dettaglio-counter[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--primary) 15%,transparent);color:var(--primary);border-color:color-mix(in srgb,var(--primary) 30%,transparent)}.form-section.riepilogo[_ngcontent-%COMP%]{padding:0;background:transparent;border:none;box-shadow:none;align-self:flex-start;position:sticky;top:var(--gutter-lg)}.contenitore-sottotask[_ngcontent-%COMP%]{gap:var(--gutter-md);display:flex;flex-direction:column}.marcotaskform[_ngcontent-%COMP%]{margin-top:var(--gutter-lg)!important}.info-card[_ngcontent-%COMP%]{background:var(--background);border:1px solid var(--smoke-color-1);border-radius:16px;padding:var(--gutter-lg);box-shadow:0 4px 12px var(--shadow);position:sticky;top:var(--gutter-lg);z-index:10}.info-card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:var(--text-color);margin-bottom:var(--gutter-sm);font-weight:600;border-bottom:2px solid var(--primary);padding-bottom:var(--gutter-sm)}.info-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:var(--gutter-sm);padding:var(--gutter-sm) 0;border-bottom:1px solid color-mix(in srgb,var(--text-color) 15%,transparent)}.info-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.info-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;color:var(--text-color);margin:0}.info-item[_ngcontent-%COMP%]   span.scaduta[_ngcontent-%COMP%]{color:#e74c3c;font-weight:500}.info-item[_ngcontent-%COMP%]   span.imminente[_ngcontent-%COMP%]{color:#f39c12;font-weight:500}.form-section.riepilogo[_ngcontent-%COMP%]{padding:0;background:transparent;border:none;box-shadow:none;align-self:flex-start;position:sticky;top:var(--gutter-lg);z-index:10}.sotto-task-actions[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%], .sotto-task-actions[_ngcontent-%COMP%]   .dropdown[_ngcontent-%COMP%]{flex:0 0 auto}.dropdown[_ngcontent-%COMP%]{position:relative;display:inline-block}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;display:none;min-width:180px;padding:8px 0;margin:4px 0 0;background:var(--background);border:1px solid var(--smoke-color-1);border-radius:8px;box-shadow:0 4px 12px var(--shadow);list-style:none;z-index:10000}.dropdown-menu.show[_ngcontent-%COMP%]{display:block}.dropdown-header[_ngcontent-%COMP%]{padding:var(--gutter-sm);font-weight:800;background:color-mix(in srgb,var(--text-color) 10%,transparent);text-transform:uppercase;border-bottom:1px solid color-mix(in srgb,var(--text-color) 30%,transparent)}.dropdown-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;width:100%;padding:8px 16px;background:transparent;border:none;color:var(--text-color);text-align:left;text-decoration:none;cursor:pointer;transition:all .2s ease;font-size:.85em}.dropdown-item[_ngcontent-%COMP%]:hover{background:var(--smoke-color-2);color:var(--primary)}.dropdown-divider[_ngcontent-%COMP%]{height:1px;background:var(--smoke-color-1);margin:8px 0;border:none}.sotto-task-card.dropdown-open[_ngcontent-%COMP%]{z-index:200}.dettaglio-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm)}.grid-responsive[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(380px,1fr))}@media (max-width: 1024px){.task-content[_ngcontent-%COMP%]{grid-template-columns:1fr}.form-section.riepilogo[_ngcontent-%COMP%]{position:static;order:-1}}@media (max-width: 768px){.section-header[_ngcontent-%COMP%]{display:flex;flex-direction:column}.contenitore-bottoni[_ngcontent-%COMP%]{display:flex;justify-content:center}.section-title[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center}.sotto-task-header[_ngcontent-%COMP%], .task-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.sotto-task-actions[_ngcontent-%COMP%], .task-header-actions[_ngcontent-%COMP%]{margin-left:0;justify-content:flex-start}.dettaglio-header[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:var(--gutter-sm)}.sotto-tasks-counts[_ngcontent-%COMP%]{grid-template-columns:1fr}.sotto-task-global-actions[_ngcontent-%COMP%]{flex-direction:column;width:100%;margin-top:var(--gutter-sm)}}']})};export{_t as TaskSingola};
