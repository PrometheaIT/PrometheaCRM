import{a as ht}from"./chunk-QMKOTDWG.js";import{a as ft}from"./chunk-KF64YYTK.js";import{a as vt}from"./chunk-DFDHLCS7.js";import{c as _t}from"./chunk-DS74SF54.js";import{a as ut}from"./chunk-5KN6QFI4.js";import{a as gt}from"./chunk-4Z4MM4C2.js";import{b as at,d as st,f as lt,o as ct,p as dt,u as pt}from"./chunk-EXOBR4AO.js";import{b as mt}from"./chunk-JUOMJRR2.js";import{a as ot}from"./chunk-Y2XJCRVM.js";import{b as nt,c as rt}from"./chunk-3ZXX2K2L.js";import{c as Q,d as X,e as Z,k as tt,p as et,q as it}from"./chunk-3DLJ4ULO.js";import{A as z,Ab as K,Cb as q,Eb as W,Ga as N,Gb as H,Hb as J,I as R,La as _,Mb as G,S as C,Wa as $,X as u,Xa as c,Y as g,Ya as n,Za as r,_a as P,cb as U,db as Y,ea as S,f as O,fb as b,ib as f,jb as p,qb as M,sb as x,ua as s,ub as a,vb as v,wb as w,x as V,yb as B,za as D,zb as j}from"./chunk-6W5NKFNP.js";import"./chunk-X5YLR3NI.js";import{a as A,b as F,i as h}from"./chunk-ODN5LVDJ.js";var xt=()=>["/soggetto","nuovo","cliente"],wt=(o,t,e)=>({promethea:o,yuvi:t,infoTecniche:e}),Pt=(o,t)=>({"product-promethea":o,"product-yuvi":t});function It(o,t){o&1&&(n(0,"a",46)(1,"span",22),a(2,"add_circle"),r()()),o&2&&c("routerLink",W(1,xt))}function Et(o,t){if(o&1&&(n(0,"option",47),a(1),r()),o&2){let e=t.$implicit;c("value",e),s(),v(e)}}function kt(o,t){if(o&1&&(n(0,"option",47),a(1),r()),o&2){let e=t.$implicit;c("value",e),s(),v(e)}}function Tt(o,t){if(o&1&&(n(0,"span"),a(1),r()),o&2){let e=p().$implicit;s(),v(e.comune)}}function Mt(o,t){if(o&1&&(n(0,"span"),a(1),r()),o&2){let e=p().$implicit;s(),w(" (",e.provincia,")")}}function Ot(o,t){o&1&&(n(0,"span",70),a(1," Nessun indirizzo "),r())}function Lt(o,t){if(o&1){let e=b();n(0,"button",75),f("click",function(){u(e);let l=p().$implicit,d=p(2).$implicit,m=p();return g(m.removeSelectedProduct(d,l))}),a(1," \xD7 "),r()}if(o&2){let e=p().$implicit;c("title",q("Rimuovi ",e))}}function At(o,t){if(o&1&&(n(0,"span",73),a(1),_(2,Lt,2,2,"button",74),r()),o&2){let e=t.$implicit,i=p(2).$implicit,l=p();c("ngClass",H(3,Pt,e==="Promethea",e==="YUVI")),s(),w(" ",e," "),s(),c("ngIf",!l.isProdottoAutomatico(e,i))}}function Ft(o,t){if(o&1&&(n(0,"div",71),_(1,At,3,6,"span",72),r()),o&2){let e=p().$implicit,i=p();s(),c("ngForOf",i.getSelectedProducts(e))}}function Vt(o,t){if(o&1&&(n(0,"option",47),a(1),r()),o&2){let e=t.$implicit;c("value",e.nome),s(),w(" ",e.nome," ")}}function zt(o,t){o&1&&(n(0,"div",81),P(1,"span",82),r())}function Rt(o,t){if(o&1){let e=b();n(0,"div",76)(1,"select",77,4),f("change",function(l){u(e);let d=p().$implicit,m=p();return g(m.onProductSelectChange(d,l))}),_(3,Vt,2,2,"option",28),r(),n(4,"div",78)(5,"button",79),f("click",function(){u(e);let l=p(2);return g(l.closeProductPicker())}),a(6,"Chiudi"),r(),_(7,zt,2,0,"div",80),r()()}if(o&2){let e=p().$implicit,i=p();s(),c("value",i.getSelectedProducts(e))("disabled",i.updatingProdottoIds.has(e.id)),s(2),c("ngForOf",i.getManualProducts()),s(4),c("ngIf",i.updatingProdottoIds.has(e.id))}}function Dt(o,t){o&1&&(n(0,"span",83),a(1,"S\xEC"),r())}function Nt(o,t){o&1&&(n(0,"span",84),a(1,"No"),r())}function $t(o,t){if(o&1&&(U(0),n(1,"span"),a(2),r(),Y()),o&2){let e=t.ngIf;s(2),v(e.tipo)}}function Ut(o,t){o&1&&a(0,"\u2014")}function Yt(o,t){if(o&1){let e=b();n(0,"button",85),f("click",function(l){u(e);let d=p().$implicit,m=p();return l.stopPropagation(),g(m.vediConfigurazionePromethea(d))}),P(1,"img",86),r()}}function Bt(o,t){if(o&1){let e=b();n(0,"button",87),f("click",function(l){u(e);let d=p().$implicit,m=p();return l.stopPropagation(),g(m.vediTrattativaYuvi(d))}),P(1,"img",88),r()}}function jt(o,t){if(o&1){let e=b();n(0,"button",89),f("click",function(l){u(e);let d=p().$implicit,m=p();return l.stopPropagation(),g(m.goToInformazioniTecniche(d))}),n(1,"span",22),a(2,"build"),r()()}}function Kt(o,t){if(o&1){let e=b();n(0,"tr",48)(1,"td",49)(2,"div",50)(3,"strong",51),f("click",function(){let l=u(e).$implicit,d=p();return g(d.apriScheda(l))}),a(4),r()()(),n(5,"td",52)(6,"div",50),a(7),r()(),n(8,"td",53)(9,"div",50),a(10),r()(),n(11,"td",54)(12,"div",50),_(13,Tt,2,1,"span",42)(14,Mt,2,1,"span",42)(15,Ot,2,0,"span",55),r()(),n(16,"td",56)(17,"div",50),_(18,Ft,2,1,"div",57)(19,Rt,8,4,"div",58),r()(),n(20,"td",59)(21,"div",50),_(22,Dt,2,0,"span",60)(23,Nt,2,0,"span",61),r()(),n(24,"td",62)(25,"div",50),_(26,$t,3,1,"ng-container",63)(27,Ut,1,0,"ng-template",null,3,G),r()(),n(29,"td",64)(30,"div",65),_(31,Yt,2,0,"button",66)(32,Bt,2,0,"button",67)(33,jt,3,0,"button",68),n(34,"app-action-dropdown",69),f("opened",function(){u(e);let l=p();return g(l.dropdownAnyOpen.set(!0))})("closed",function(){u(e);let l=p();return g(l.dropdownAnyOpen.set(!1))})("action",function(l){let d=u(e).$implicit,m=p();return g(m.handleRowAction(l,d))}),r()()()()}if(o&2){let e=t.$implicit,i=M(28),l=p();$("data-row-id",e.id),s(4),v(e.ragione_sociale),s(3),v(e.referente||"\u2014"),s(3),v(e.telefono||"\u2014"),s(3),c("ngIf",e.comune),s(),c("ngIf",e.provincia),s(),c("ngIf",!e.comune&&!e.provincia),s(3),c("ngIf",l.getSelectedProducts(e).length>0),s(),c("ngIf",l.isProductPickerOpen(e)),s(3),c("ngIf",e.configurato),s(),c("ngIf",!e.configurato),s(3),c("ngIf",e.ultimoEsito)("ngIfElse",i),s(5),c("ngIf",e.hasConfigPromethea),s(),c("ngIf",e.hasTrattativaYuvi),s(),c("ngIf",l.showInformazioniTecniche(e)),s(),c("row",e)("primaryIcons",J(18,wt,e.hasConfigPromethea,e.hasTrattativaYuvi,l.showInformazioniTecniche(e)))}}function qt(o,t){if(o&1&&(n(0,"tr")(1,"td",90),a(2),r()()),o&2){let e=p();s(2),w(" ",e.searchTerm?"Nessun cliente trovato":"Nessun cliente"," ")}}function Wt(o,t){o&1&&(n(0,"span",22),a(1,"unfold_more"),r())}function Ht(o,t){o&1&&(n(0,"span",22),a(1,"hourglass_bottom"),r())}function Jt(o,t){if(o&1){let e=b();n(0,"div",91)(1,"button",92),f("click",function(){u(e);let l=p();return g(l.caricaTutti())}),_(2,Wt,2,0,"span",93)(3,Ht,2,0,"span",93),a(4),r()()}if(o&2){let e=p();s(),c("disabled",e.loading()),s(),c("ngIf",!e.loading()),s(),c("ngIf",e.loading()),s(),w(" ",e.loading()?"Caricamento\u2026":"Carica tutti"," ")}}function Gt(o,t){if(o&1&&(n(0,"div",94),a(1),r()),o&2){let e=p();s(),w(" ",e.error()," ")}}var yt=class o{listaService=C(ft);supabaseService=C(nt);soggettiService=C(mt);kpiService=C(gt);authService=C(rt);router=C(et);userService=C(ot);searchSubject=new O;destroy$=new O;rows=this.listaService.rows;filteredRows=this.listaService.filteredRows;loading=this.listaService.loading;error=this.listaService.error;hasMore=this.listaService.hasMore;currentFiltri=this.listaService.currentFiltri;userModuli=S([]);isUserAdmin=S(!1);_configuredIds=new Set;dropdownAnyOpen=S(!1);configuredCount=0;kpiLoading=S(!1);province=S([]);kpi=S({totale:0,conIban:0,conReferente:0});_openProductPickerForId=null;deletingIds=new Set;showEsito=!1;selectedId=null;updatingProdottoIds=new Set;esitiTipi=_t;searchTerm="";filtroConIban=!1;filtroConReferente=!1;isLoading=S(!0);renderer=C(D);constructor(){this.searchSubject.pipe(R(this.destroy$),V(300),z()).subscribe(t=>{this.onSearchExecuted(t)})}ngOnInit(){return h(this,null,function*(){this.listaService.inizializza({tipo:"cliente",abilitaConfigurazioni:!0,abilitaTrattative:!0});try{yield Promise.all([this.listaService.caricaIniziali(),this.loadProvince(),this.refreshKpi(),this.loadUserData()]),yield this.loadConfiguredCount()}finally{setTimeout(()=>{this.isLoading.set(!1)},300)}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadUserData(){return h(this,null,function*(){try{let t=this.authService.user();if(!t)return;let e=yield this.soggettiService.supabaseService.isAdmin();this.isUserAdmin.set(e);let{data:i}=yield this.soggettiService.supabaseService.getAppUserById(t.id);i&&i.moduli&&this.userModuli.set(i.moduli)}catch(t){console.error("Errore nel caricamento dati utente:",t)}})}caricaTutti(){return h(this,null,function*(){yield this.listaService.caricaTutti()})}allLoaded(){return this.listaService.allLoaded()}onSearchExecuted(t){return h(this,null,function*(){yield this.listaService.cerca(t)})}onSearchChange(t){this.searchTerm=t,this.searchSubject.next(t)}onChangeFiltroEsito(t){this.listaService.applicaFiltri({esito:t,conIban:this.filtroConIban,conReferente:this.filtroConReferente})}onChangeFiltroProvincia(t){this.listaService.applicaFiltri({provincia:t})}onChangeSortDir(t){this.listaService.applicaFiltri({sortDir:t})}onFiltroTotale(){this.filtroConIban=!1,this.filtroConReferente=!1,this.listaService.applicaFiltri({esito:"tutti",provincia:"tutte",conIban:!1,conReferente:!1})}onFiltroConIban(){this.filtroConIban=!0,this.filtroConReferente=!1,this.listaService.applicaFiltri({esito:"tutti",conIban:!0,conReferente:!1})}onFiltroConReferente(){this.filtroConIban=!1,this.filtroConReferente=!0,this.listaService.applicaFiltri({esito:"tutti",conIban:!1,conReferente:!0})}vediConfigurazionePromethea(t){this.router.navigate(["/alchemizzatore"],{queryParams:{prospectId:t.id,step:6},state:{prospect:t,goToStep:6,from:"lista-clienti"}})}vediTrattativaYuvi(t){return h(this,null,function*(){try{let{data:e,error:i}=yield this.soggettiService.supabaseService.supabase.from("trattative_yuvi").select("*").eq("prospect_id",t.id).order("created_at",{ascending:!1}).limit(1).single();if(i)throw i;if(!e){alert("Nessuna trattativa YUVI trovata per questo cliente");return}this.router.navigate(["/yuvi-trattativa"],{queryParams:{clienteId:t.id,trattativaId:e.id},state:{cliente:t,trattativaEsistente:e}})}catch(e){alert("Errore nel caricamento della trattativa: "+e.message)}})}onDelete(t){return h(this,null,function*(){if(!(!t?.id||!confirm(`Eliminare il cliente "${t.ragione_sociale}"?`))){this.deletingIds.add(t.id);try{(yield this.listaService.eliminaSoggetto(t.id))&&(yield this.refreshKpi())}catch(i){console.error("Errore durante l'eliminazione:",i)}finally{this.deletingIds.delete(t.id)}}})}onEdit(t){t?.id&&this.router.navigate(["/soggetto",t.id,"edit"])}openEsito(t){this.selectedId=t.id,this.showEsito=!0}apriScheda(t){t?.id&&this.router.navigate(["/soggetto",t.id])}onPopupClosed(t){return h(this,null,function*(){this.showEsito=!1,this.selectedId=null,t.saved&&(yield Promise.all([this.listaService.caricaTutti(),this.refreshKpi()]))})}onChangeProdotto(t,e){return h(this,null,function*(){if(!t?.id)return;let i=e;if(t.prodotto!==i){this.updatingProdottoIds.add(t.id);try{yield this.listaService.aggiornaProdotto(t.id,i)}catch(l){console.error("Errore durante l'aggiornamento del prodotto:",l)}finally{this.updatingProdottoIds.delete(t.id)}}})}showInformazioniTecniche(t){if(!t.moduliAttivi||t.moduliAttivi.length===0)return!1;if(this.isUserAdmin())return!0;let e=this.userModuli();return t.moduliAttivi.some(i=>e.includes(i))}getModuloDaAprire(t){let e=this.userModuli(),i=t.moduliAttivi||[];return this.isUserAdmin()?i[0]||"social":i.find(d=>e.includes(d))||"social"}goToInformazioniTecniche(t){if(!t.id){console.error("Cliente senza ID:",t);return}console.log("Navigando a informazioni tecniche per cliente:",t.id),this.router.navigate(["/informazioni-tecniche"],{queryParams:{clienteId:t.id}})}isAdmin(){return this.userService.isAdmin()}trackById=(t,e)=>e.id;loadProvince(){return h(this,null,function*(){let{data:t}=yield this.soggettiService.getProvinceByTipo("cliente");t&&this.province.set(t)})}refreshKpi(){return h(this,null,function*(){try{this.kpiLoading.set(!0);let t=yield this.kpiService.getAnagraficaKPI("cliente");this.kpi.set({totale:t.totale,conIban:t.conIban,conReferente:t.conReferente})}catch(t){console.error("Errore nel caricamento KPI:",t)}finally{this.kpiLoading.set(!1)}})}getLastEsito(t){return!Array.isArray(t)||t.length===0?null:t.reduce((e,i)=>{let l=new Date(i.ts).getTime(),d=new Date(e.ts).getTime();return l>d?i:e})}handleRowAction(t,e){switch(t){case"promethea":this.vediConfigurazionePromethea(e);break;case"yuvi":this.vediTrattativaYuvi(e);break;case"info-tecniche":this.goToInformazioniTecniche(e);break;case"edit":this.onEdit(e);break;case"esito":this.openEsito(e);break;case"delete":this.onDelete(e);break;default:console.warn("Azione non gestita",t)}}get filteredCount(){try{let t=this.filteredRows??this.rows;if(typeof t=="function"){let i=t();return Array.isArray(i)?i.length:0}if(Array.isArray(t))return t.length;let e=this.displayRows;if(typeof e=="function"){let i=e();return Array.isArray(i)?i.length:0}return 0}catch{return 0}}resetAllFilters(){try{this.searchTerm="",typeof this.onSearchChange=="function"&&this.onSearchChange("")}catch(t){console.warn("resetAllFilters: onSearchChange failed",t)}try{typeof this.onChangeFiltroEsito=="function"&&this.onChangeFiltroEsito("tutti")}catch{}try{typeof this.onChangeFiltroProvincia=="function"&&this.onChangeFiltroProvincia("tutte")}catch{}try{typeof this.onChangeSortDir=="function"&&this.onChangeSortDir("desc")}catch{}try{let t=typeof this.currentFiltri=="function"?this.currentFiltri():this.currentFiltri??{};t?.conIban&&typeof this.onFiltroConIban=="function"&&this.onFiltroConIban(),t?.conReferente&&typeof this.onFiltroConReferente=="function"&&this.onFiltroConReferente()}catch{}}loadConfiguredCount(){return h(this,null,function*(){try{let t=new Set,{data:e,error:i}=yield this.supabaseService.supabase.from("configurazioni_promethea").select("cliente_id, prospect_id");!i&&Array.isArray(e)&&e.forEach(y=>{let I=y?.cliente_id??null,E=y?.prospect_id??null,k=I?String(I).trim():null,T=E?String(E).trim():null;k&&t.add(k),T&&t.add(T)});let{data:l,error:d}=yield this.supabaseService.supabase.from("trattative_yuvi").select("cliente_id, prospect_id");!d&&Array.isArray(l)&&l.forEach(y=>{let I=y?.cliente_id??null,E=y?.prospect_id??null,k=I?String(I).trim():null,T=E?String(E).trim():null;k&&t.add(k),T&&t.add(T)});let m=Array.from(t);if(this._configuredIds=new Set(m),m.length===0){this.configuredCount=0;return}let{data:L,error:Ct}=yield this.supabaseService.supabase.from("soggetti").select("id").in("id",m).eq("tipo","cliente");if(!Ct&&Array.isArray(L)){this.configuredCount=L.length;return}let bt=typeof this.rows=="function"?this.rows():Array.isArray(this.rows)?this.rows:[],St=new Set((bt||[]).map(y=>String(y.id).trim()));this.configuredCount=m.filter(y=>St.has(y)).length}catch(t){console.error("Errore loadConfiguredCount clienti",t),this.configuredCount=0}})}onFiltroConfigurati(){if(this.listaService&&typeof this.listaService.applicaFiltri=="function"){this.listaService.applicaFiltri({configurato:!0,configuredIds:Array.from(this._configuredIds)});return}this.filtri=F(A({},this.filtri||{}),{configurato:!0}),typeof this.refresh=="function"?this.refresh():typeof this.loadRows=="function"?this.loadRows():console.warn("Impossibile applicare filtro configurato: implementa listaService.applicaFiltri o refresh/loadRows")}getSelectedProducts(t){try{if(Array.isArray(t.prodotti)&&t.prodotti.length)return t.prodotti.map(e=>(e?.nome??e?.product_name??String(e)).toString());if(t.prodotto)return[String(t.prodotto)];if(t.prodotto_nome)return[String(t.prodotto_nome)];if(t.extra_data){if(typeof t.extra_data=="string")try{t.extra_data=JSON.parse(t.extra_data)}catch{}if(t.extra_data?.prodotti){let e=t.extra_data.prodotti;if(Array.isArray(e))return e.map(i=>String(i.nome??i));if(typeof e=="string")return[e]}}for(let e of Object.keys(t||{}))if(/prodotti?|product|prodotto_nome/i.test(e)&&t[e]){let i=t[e];return Array.isArray(i)?i.map(l=>String(l.nome??l)):[String(i)]}}catch(e){console.warn("getSelectedProducts fallback error",e)}return[]}getManualProducts(){return this.manualProducts||[]}isProductPickerOpen(t){return this._openProductPickerForId===t.id}openProductPicker(t){this._openProductPickerForId=t.id,(!this.manualProducts||!this.manualProducts.length)&&this.loadManualProducts?.()}closeProductPicker(){this._openProductPickerForId=null}onProductSelectChange(t,e){return h(this,null,function*(){let i=e.target,l=Array.from(i.selectedOptions).map(d=>d.value);yield this.updateRowProducts(t,l)})}removeSelectedProduct(t,e){return h(this,null,function*(){let l=this.getSelectedProducts(t).filter(d=>d!==e);yield this.updateRowProducts(t,l)})}updateRowProducts(t,e){return h(this,null,function*(){try{this.updatingProdottoIds.add(t.id),this.listaService&&typeof this.listaService.updateProdottiSoggetto=="function"?yield this.listaService.updateProdottiSoggetto(t.id,e):this.soggettiService&&typeof this.soggettiService.updateProdotti=="function"?yield this.soggettiService.updateProdotti(t.id,e):console.warn("Nessun metodo disponibile per aggiornare prodotti: implementa listaService.updateProdottiSoggetto or soggettiService.updateProdotti"),t.prodotti=e.map(i=>({nome:i}))}catch(i){console.error("Errore aggiornamento prodotti",i),alert("Errore aggiornamento prodotti: "+(i?.message||String(i)))}finally{this.updatingProdottoIds.delete(t.id),this.closeProductPicker()}})}isProdottoAutomatico(t,e){if(!t)return!1;let i=String(t).trim().toLowerCase();return["promethea","yuvi"].includes(i)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=N({type:o,selectors:[["app-lista-clienti"]],decls:111,vars:33,consts:[["filtroSel",""],["ordinaSel",""],["provSel",""],["noEsito",""],["sel",""],["title","Caricamento Clienti","subtitle","Stiamo caricando i tuoi clienti...",3,"isLoading"],[1,"form-section"],[1,"section-header"],[1,"material-icons","header-icon"],[1,"section-titles"],[1,"section-title"],[1,"sottotitolo"],[1,"flex-1"],["class","icon-btn","title","Aggiungi cliente","aria-label","Aggiungi cliente",3,"routerLink",4,"ngIf"],[1,"prospect-cards"],[1,"card",3,"click"],[1,"card-title"],[1,"card-number"],[1,"table-section"],[1,"table-tools"],[1,"tool"],["for","search",1,"label"],[1,"material-icons"],["id","search","type","text","placeholder","Nome, telefono, email...",1,"table-inline-input",3,"ngModelChange","ngModel"],["for","filtroEsito",1,"label"],["id","filtroEsito",1,"table-inline-select",3,"change","value"],["value","tutti"],["value","senza-esito"],[3,"value",4,"ngFor","ngForOf"],["for","ordinaPer",1,"label"],["id","ordinaPer",1,"table-inline-select",3,"change","value"],["value","desc"],["value","asc"],["for","filtroProvincia",1,"label"],["id","filtroProvincia",1,"table-inline-select",3,"change","value"],["value","tutte"],["type","button",1,"promethea-button","ghost",3,"click"],[1,"tool",2,"display","flex","align-items","center","gap","var(--gutter-sm)","margin","var(--gutter-sm) 0"],["title","Risultati filtrati",1,"chip",2,"margin","0 var(--gutter-lg)"],[1,"table-container"],[1,"crm-table"],["class","row-clickable",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],["class","load-more-container",4,"ngIf"],["style","text-align:center; color:#ef4444; margin-top:1rem;",4,"ngIf"],[3,"closed","open","soggettoId","tipo"],["title","Aggiungi cliente","aria-label","Aggiungi cliente",1,"icon-btn",3,"routerLink"],[3,"value"],[1,"row-clickable"],["data-label","Ragione Sociale"],[1,"cell-content"],[1,"link",3,"click"],["data-label","Referente"],["data-label","Telefono"],["data-label","Localit\xE0"],["style","color: #6b7280; font-style: italic;",4,"ngIf"],["data-label","Prodotto"],["class","selected-badges",4,"ngIf"],["class","product-picker",4,"ngIf"],["data-label","Configurato"],["class","badge badge-success",4,"ngIf"],["class","badge badge-danger",4,"ngIf"],["data-label","Ultimo Esito"],[4,"ngIf","ngIfElse"],["data-label","Azioni"],[1,"actions-container"],["class","action-btn document","title","Configurazione Promethea",3,"click",4,"ngIf"],["class","action-btn email","title","Trattativa YUVI",3,"click",4,"ngIf"],["class","action-btn info-tecniche","title","Informazioni Tecniche",3,"click",4,"ngIf"],[3,"opened","closed","action","row","primaryIcons"],[2,"color","#6b7280","font-style","italic"],[1,"selected-badges"],["class","product-badge",3,"ngClass",4,"ngFor","ngForOf"],[1,"product-badge",3,"ngClass"],["class","badge-remove","type","button",3,"title","click",4,"ngIf"],["type","button",1,"badge-remove",3,"click","title"],[1,"product-picker"],["multiple","",1,"table-inline-select",3,"change","value","disabled"],[2,"margin-top","0.5rem","display","flex","gap","0.5rem","align-items","center"],[1,"promethea-button","outline",3,"click"],["class","loading-indicator","style","margin-left:0.5rem;",4,"ngIf"],[1,"loading-indicator",2,"margin-left","0.5rem"],[1,"loading-spinner",2,"width","20px","height","20px","border-width","2px"],[1,"badge","badge-success"],[1,"badge","badge-danger"],["title","Configurazione Promethea",1,"action-btn","document",3,"click"],["src","assets/Logo.png","alt","Promethea",1,"icon-img"],["title","Trattativa YUVI",1,"action-btn","email",3,"click"],["src","assets/yuvi.png","alt","YUVI",1,"icon-img"],["title","Informazioni Tecniche",1,"action-btn","info-tecniche",3,"click"],["colspan","8",2,"text-align","center","padding","1.5rem"],[1,"load-more-container"],[1,"promethea-button",3,"click","disabled"],["class","material-icons",4,"ngIf"],[2,"text-align","center","color","#ef4444","margin-top","1rem"]],template:function(e,i){if(e&1){let l=b();P(0,"app-page-loader",5),n(1,"div")(2,"div",6)(3,"div",7)(4,"i",8),a(5,"business"),r(),n(6,"div",9)(7,"h2",10),a(8,"Clienti"),r(),n(9,"p",11),a(10,"Panoramica clienti e filtri rapidi"),r()(),P(11,"div",12),_(12,It,3,2,"a",13),r(),n(13,"div",14)(14,"div",15),f("click",function(){return u(l),g(i.onFiltroTotale())}),n(15,"h3",16),a(16,"Totale"),r(),n(17,"div",17),a(18),r()(),n(19,"div",15),f("click",function(){return u(l),g(i.onFiltroConIban())}),n(20,"h3",16),a(21,"Con IBAN"),r(),n(22,"div",17),a(23),r()(),n(24,"div",15),f("click",function(){return u(l),g(i.onFiltroConReferente())}),n(25,"h3",16),a(26,"Con Referente"),r(),n(27,"div",17),a(28),r()(),n(29,"div",15),f("click",function(){return u(l),g(i.onFiltroConfigurati())}),n(30,"h3",16),a(31,"Configurati"),r(),n(32,"div",17),a(33),r()()()(),n(34,"section",18)(35,"div",19)(36,"div",20)(37,"label",21)(38,"span",22),a(39,"search"),r(),a(40," Cerca "),r(),n(41,"input",23),K("ngModelChange",function(m){return u(l),j(i.searchTerm,m)||(i.searchTerm=m),g(m)}),f("ngModelChange",function(m){return u(l),g(i.onSearchChange(m))}),r()(),n(42,"div",20)(43,"label",24)(44,"span",22),a(45,"filter_list"),r(),a(46," Ultimo esito "),r(),n(47,"select",25,0),f("change",function(){u(l);let m=M(48);return g(i.onChangeFiltroEsito(m.value))}),n(49,"option",26),a(50,"Tutti"),r(),n(51,"option",27),a(52,"Senza esito"),r(),_(53,Et,2,2,"option",28),r()(),n(54,"div",20)(55,"label",29)(56,"span",22),a(57,"sort"),r(),a(58," Ordina per: "),r(),n(59,"select",30,1),f("change",function(){u(l);let m=M(60);return g(i.onChangeSortDir(m.value))}),n(61,"option",31),a(62,"Pi\xF9 recente"),r(),n(63,"option",32),a(64,"Meno recente"),r()()(),n(65,"div",20)(66,"label",33)(67,"span",22),a(68,"place"),r(),a(69," Provincia "),r(),n(70,"select",34,2),f("change",function(){u(l);let m=M(71);return g(i.onChangeFiltroProvincia(m.value))}),n(72,"option",35),a(73,"Tutte"),r(),_(74,kt,2,2,"option",28),r()(),n(75,"div",20)(76,"button",36),f("click",function(){return u(l),g(i.resetAllFilters())}),n(77,"span",22),a(78,"filter_alt_off"),r(),a(79," Azzera filtri "),r()(),n(80,"div",37)(81,"span",38),a(82," Risultati: "),n(83,"strong"),a(84),r()()()(),n(85,"div",39)(86,"table",40)(87,"thead")(88,"tr")(89,"th"),a(90,"Ragione Sociale"),r(),n(91,"th"),a(92,"Referente"),r(),n(93,"th"),a(94,"Telefono"),r(),n(95,"th"),a(96,"Localit\xE0"),r(),n(97,"th"),a(98,"Prodotto"),r(),n(99,"th"),a(100,"Configurato"),r(),n(101,"th"),a(102,"Ultimo Esito"),r(),n(103,"th"),a(104,"Azioni"),r()()(),n(105,"tbody"),_(106,Kt,35,22,"tr",41)(107,qt,3,1,"tr",42),r()()(),_(108,Jt,5,4,"div",43)(109,Gt,2,1,"div",44),r(),n(110,"app-esito-popup",45),f("closed",function(m){return u(l),g(i.onPopupClosed(m))}),r()()}e&2&&(c("isLoading",i.isLoading()),s(),x("hidden",i.isLoading()),s(11),c("ngIf",i.isAdmin()),s(2),x("card-active",i.currentFiltri().esito==="tutti"&&i.currentFiltri().provincia==="tutte"&&!i.currentFiltri().conIban&&!i.currentFiltri().conReferente),s(4),v(i.kpi().totale),s(),x("card-active",i.currentFiltri().conIban),s(4),v(i.kpi().conIban),s(),x("card-active",i.currentFiltri().conReferente),s(4),v(i.kpi().conReferente),s(),x("card-active",i.currentFiltri().configurato===!0),s(4),v(i.configuredCount),s(8),B("ngModel",i.searchTerm),s(6),c("value",i.currentFiltri().esito),s(6),c("ngForOf",i.esitiTipi),s(6),c("value",i.currentFiltri().sortDir),s(11),c("value",i.currentFiltri().provincia),s(4),c("ngForOf",i.province()),s(10),v(i.filteredCount),s(),x("dropdown-open",i.dropdownAnyOpen()),s(21),c("ngForOf",i.filteredRows())("ngForTrackBy",i.trackById),s(),c("ngIf",!i.loading()&&!i.error()&&i.filteredRows().length===0),s(),c("ngIf",!i.error()&&i.hasMore()),s(),c("ngIf",i.error()),s(),c("open",i.showEsito)("soggettoId",i.selectedId)("tipo","cliente"))},dependencies:[tt,Q,X,Z,ht,pt,ct,dt,at,st,lt,ut,it,vt],styles:['.actions-dropdown[_ngcontent-%COMP%]{position:relative;display:inline-flex}.actions-dropdown[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;width:200px;z-index:1000;border:1px solid var(--smoke-color-1);border-radius:12px;box-shadow:0 8px 24px var(--shadow);background:var(--background);animation:_ngcontent-%COMP%_slideDown .2s ease-out}.actions-dropdown.open.centered[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{position:fixed!important;top:50%!important;left:50%!important;transform:translate(-50%,-50%)!important;width:min(90vw,420px)!important;max-height:80vh!important;overflow-y:auto!important;right:auto!important;z-index:1202!important;border-radius:16px!important;box-shadow:0 30px 80px #00000059!important}.actions-dropdown.open.centered[_ngcontent-%COMP%] ~ .mobile-dropdown-backdrop[_ngcontent-%COMP%], .actions-dropdown.open.centered[_ngcontent-%COMP%]   .mobile-dropdown-backdrop[_ngcontent-%COMP%]{display:block!important;z-index:1201!important}.actions-dropdown.open.centered[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]{padding:.5rem 0!important}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}.dropdown-item[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;gap:var(--gutter-sm);padding:.75rem 1rem;border:none;background:transparent;color:var(--text-color);cursor:pointer;transition:background .15s ease;font-size:var(--fs-sm);text-align:left;border-bottom:1px solid var(--smoke-color-1)}.dropdown-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.dropdown-item[_ngcontent-%COMP%]:hover{background:var(--smoke-color-2)}.dropdown-item[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.dropdown-item[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:1.1rem;width:20px}.dropdown-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:transparent;z-index:999;display:none}.actions-dropdown.open[_ngcontent-%COMP%] ~ .dropdown-overlay[_ngcontent-%COMP%]{display:block}@container (max-width: 768px){.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.actions-dropdown){display:none}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-dropdown[_ngcontent-%COMP%]   .dropdown-item[style*="display: none"][_ngcontent-%COMP%]{display:flex!important}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-dropdown.open[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{position:fixed!important;inset:50% auto auto 50%!important;transform:translate(-50%,-50%)!important;width:min(90vw,300px)!important;max-height:70vh!important;overflow-y:auto!important;z-index:1001!important;border-radius:16px!important;box-shadow:0 20px 40px var(--shadow)!important}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-dropdown[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{width:3rem!important;height:3rem!important;font-size:1.3rem!important}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]{justify-content:center!important;padding:var(--gutter-sm) 0}}@container (min-width: 769px){.actions-dropdown[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{min-width:180px}.actions-dropdown.left[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{right:auto;left:0}.actions-dropdown.top[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{top:auto;bottom:100%}}.table-container[_ngcontent-%COMP%]{overflow-x:auto;position:relative}body.dropdown-open[_ngcontent-%COMP%]{overflow:hidden}.mobile-dropdown-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:color-mix(in srgb,var(--text-color) 20%,transparent);-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px);z-index:998;display:none}.actions-dropdown.open[_ngcontent-%COMP%] ~ .mobile-dropdown-backdrop[_ngcontent-%COMP%]{display:block}']})};export{yt as ListaClienti};
