import{a as ee}from"./chunk-LK62RLCC.js";import{a as te}from"./chunk-53N4BCWU.js";import{a as Y}from"./chunk-2QDHCWUP.js";import{a as Z}from"./chunk-6MBYYD52.js";import{b as U,d as W,f as q,o as G,p as J,u as Q}from"./chunk-SRZMZVDW.js";import{a as X}from"./chunk-3WLDIF5C.js";import"./chunk-P5EFXTG7.js";import"./chunk-WMLYL4YD.js";import"./chunk-Q4FMGKSF.js";import{d as $,e as B,j as K,o as j,p as H}from"./chunk-NOCF4HQD.js";import{A as T,Ab as N,Ga as D,I as L,La as _,S as x,Va as R,Wa as d,X as m,Xa as t,Y as f,Ya as i,Za as y,bb as V,cb as P,db as b,ea as E,f as I,gb as u,hb as g,ib as w,kb as S,mb as r,nb as v,ob as F,qb as M,rb as O,sb as z,ta as k,ua as a,ub as A,x as C}from"./chunk-PE6PP35I.js";import"./chunk-X5YLR3NI.js";import{i as h}from"./chunk-ODN5LVDJ.js";var ne=()=>["/soggetti/nuovo","cliente"];function re(l,e){if(l&1&&(t(0,"option",41),r(1),i()),l&2){let o=e.$implicit;d("value",o),a(),v(o)}}function oe(l,e){if(l&1&&(t(0,"option",41),r(1),i()),l&2){let o=e.$implicit;d("value",o),a(),v(o)}}function ae(l,e){if(l&1&&(V(0),t(1,"span"),r(2),i(),P()),l&2){let o=e.ngIf;a(2),v(o.tipo)}}function le(l,e){l&1&&r(0,"\u2014")}function se(l,e){if(l&1){let o=b();t(0,"div",57)(1,"div",58)(2,"button",59),u("click",function(s){m(o);let p=g().$implicit,c=g();return s.stopPropagation(),c.onAddDocument(p),f(c.activeDropdownId=null)}),t(3,"span",13),r(4,"description"),i(),t(5,"span"),r(6,"Documento"),i()(),t(7,"button",60),u("click",function(s){m(o);let p=g().$implicit,c=g();return s.stopPropagation(),c.onDelete(p),f(c.activeDropdownId=null)}),t(8,"span",13),r(9,"delete"),i(),t(10,"span"),r(11,"Elimina"),i()()()()}if(l&2){let o=g().$implicit,n=g();a(7),d("disabled",n.deletingIds.has(o.id))}}function ce(l,e){if(l&1){let o=b();t(0,"tr",42),u("click",function(){let s=m(o).$implicit,p=g();return f(p.apriScheda(s))}),t(1,"td",43)(2,"div",44)(3,"strong"),r(4),i()()(),t(5,"td",45)(6,"div",44),r(7),i()(),t(8,"td",46)(9,"div",44),r(10),i()(),t(11,"td",47)(12,"div",44),r(13),i()(),t(14,"td",48)(15,"div",44),r(16),i()(),t(17,"td",49)(18,"div",44),_(19,ae,3,1,"ng-container",50)(20,le,1,0,"ng-template",null,3,N),i()(),t(22,"td",51)(23,"div",52)(24,"button",53),u("click",function(s){let p=m(o).$implicit,c=g();return s.stopPropagation(),f(c.onEdit(p))}),t(25,"span",13),r(26,"edit"),i()(),t(27,"div",54)(28,"button",55),u("click",function(s){let p=m(o).$implicit,c=g();return s.stopPropagation(),f(c.toggleActionsDropdown(p.id))}),t(29,"span",13),r(30,"more_vert"),i()(),_(31,se,12,1,"div",56),i()()()()}if(l&2){let o=e.$implicit,n=w(21),s=g();R("data-row-id",o.id),a(4),v(o.ragione_sociale),a(3),v(o.referente||"\u2014"),a(3),v(o.telefono||"\u2014"),a(3),v(o.email||"\u2014"),a(3),v(o.metodo_pagamento||"\u2014"),a(3),d("ngIf",o.ultimoEsito)("ngIfElse",n),a(8),S("open",s.activeDropdownId===o.id),a(4),d("ngIf",s.activeDropdownId===o.id)}}function de(l,e){if(l&1&&(t(0,"tr")(1,"td",61),r(2),i()()),l&2){let o=g();a(2),F(" ",o.searchTerm?"Nessun fornitore trovato":"Nessun fornitore"," ")}}function pe(l,e){l&1&&(t(0,"span",13),r(1,"unfold_more"),i())}function me(l,e){l&1&&(t(0,"span",13),r(1,"hourglass_bottom"),i())}function fe(l,e){if(l&1){let o=b();t(0,"div",62)(1,"button",63),u("click",function(){m(o);let s=g();return f(s.caricaTutti())}),_(2,pe,2,0,"span",64)(3,me,2,0,"span",64),r(4),i()()}if(l&2){let o=g();a(),d("disabled",o.loading()),a(),d("ngIf",!o.loading()),a(),d("ngIf",o.loading()),a(),F(" ",o.loading()?"Caricamento\u2026":"Carica tutti"," ")}}function ue(l,e){if(l&1&&(t(0,"div",65),r(1),i()),l&2){let o=g();a(),F(" ",o.error()," ")}}var ie=class l{listaService=x(ee);soggettiService=x(X);kpiService=x(Z);router=x(j);searchSubject=new I;destroy$=new I;rows=this.listaService.rows;filteredRows=this.listaService.filteredRows;loading=this.listaService.loading;error=this.listaService.error;hasMore=this.listaService.hasMore;currentFiltri=this.listaService.currentFiltri;allLoaded=this.listaService.allLoaded;province=E([]);kpi=E({totale:0,conIban:0,conReferente:0});deletingIds=new Set;activeDropdownId=null;esitiTipi=te;searchTerm="";filtroConIban=!1;filtroConReferente=!1;isLoading=E(!0);constructor(){this.searchSubject.pipe(L(this.destroy$),C(300),T()).subscribe(e=>{this.onSearchExecuted(e)})}ngOnInit(){return h(this,null,function*(){console.log("\u{1F680} Lista Fornitori - START"),this.isLoading.set(!0);try{this.listaService.inizializza({tipo:"fornitore",abilitaConfigurazioni:!1,abilitaTrattative:!1}),console.log("\u2699\uFE0F Servizio fornitori inizializzato"),yield Promise.all([this.listaService.caricaIniziali(),this.loadProvince(),this.refreshKpi()]);let e=this.rows();console.log("\u{1F4C4} Fornitori caricati:",{totalRows:e.length,firstRow:e[0]?.ragione_sociale||"N/A"}),console.log("\u2705 Init fornitori completato")}catch(e){console.error("\u274C Errore caricamento fornitori:",e)}finally{setTimeout(()=>{this.isLoading.set(!1)},300)}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}caricaTutti(){return h(this,null,function*(){yield this.listaService.caricaTutti()})}allLoadedFn(){return this.allLoaded()}onSearchExecuted(e){return h(this,null,function*(){yield this.listaService.cerca(e)})}onSearchChange(e){this.searchTerm=e,this.searchSubject.next(e)}onChangeFiltroEsito(e){this.listaService.applicaFiltri({esito:e,conIban:this.filtroConIban,conReferente:this.filtroConReferente})}onChangeFiltroProvincia(e){this.listaService.applicaFiltri({provincia:e})}onChangeSortDir(e){this.listaService.applicaFiltri({sortDir:e})}onFiltroTotale(){this.filtroConIban=!1,this.filtroConReferente=!1,this.listaService.applicaFiltri({esito:"tutti",provincia:"tutte",conIban:!1,conReferente:!1})}onFiltroConIban(){this.filtroConIban=!0,this.filtroConReferente=!1,this.listaService.applicaFiltri({esito:"tutti",conIban:!0,conReferente:!1})}onFiltroConReferente(){this.filtroConIban=!1,this.filtroConReferente=!0,this.listaService.applicaFiltri({esito:"tutti",conIban:!1,conReferente:!0})}onDelete(e){return h(this,null,function*(){if(!(!e?.id||!confirm(`Eliminare il fornitore "${e.ragione_sociale}"?`))){this.deletingIds.add(e.id);try{(yield this.listaService.eliminaSoggetto(e.id))&&(yield this.refreshKpi())}catch(n){console.error("Errore durante l'eliminazione:",n)}finally{this.deletingIds.delete(e.id)}}})}onEdit(e){e?.id&&this.router.navigate(["/soggetti/modifica",e.id])}onAddDocument(e){console.log("Aggiungi documento per:",e.ragione_sociale)}trackById=(e,o)=>o.id;toggleActionsDropdown(e){let o=this.activeDropdownId===e;this.activeDropdownId=o?null:e;let n=document.querySelector(".table-container");n&&(this.activeDropdownId?n.classList.add("dropdown-open"):n.classList.remove("dropdown-open"))}closeDropdown(e){e.target.closest(".actions-dropdown")||(this.activeDropdownId=null)}loadProvince(){return h(this,null,function*(){let{data:e}=yield this.soggettiService.getProvinceByTipo("fornitore");e&&this.province.set(e)})}refreshKpi(){return h(this,null,function*(){try{let e=yield this.kpiService.getAnagraficaKPI("fornitore");this.kpi.set({totale:e.totale,conIban:e.conIban,conReferente:e.conReferente})}catch(e){console.error("Errore nel caricamento KPI:",e)}})}apriScheda(e){e?.id&&this.router.navigate(["/soggetti",e.tipo??"cliente",e.id])}static \u0275fac=function(o){return new(o||l)};static \u0275cmp=D({type:l,selectors:[["app-lista-fornitori"]],hostBindings:function(o,n){o&1&&u("click",function(p){return n.closeDropdown(p)},k)},decls:95,vars:25,consts:[["filtroSel",""],["ordinaSel",""],["provSel",""],["noEsito",""],["title","Caricamento Fornitori","subtitle","Stiamo caricando i tuoi fornitori...",3,"isLoading"],[1,"form-section"],[1,"section-header"],[1,"material-icons","header-icon"],[1,"section-titles"],[1,"section-title"],[1,"sottotitolo"],[1,"flex-1"],["title","Aggiungi cliente","aria-label","Aggiungi cliente",1,"icon-btn",3,"routerLink"],[1,"material-icons"],[1,"prospect-cards"],[1,"card",3,"click"],[1,"card-title"],[1,"card-number"],[1,"table-section"],[1,"table-tools"],[1,"tool"],["for","search",1,"label"],["id","search","type","text","placeholder","Ragione sociale, telefono, email\u2026",1,"table-inline-input",3,"ngModelChange","ngModel"],["for","filtroEsito",1,"label"],["id","filtroEsito",1,"table-inline-select",3,"change","value"],["value","tutti"],["value","senza-esito"],[3,"value",4,"ngFor","ngForOf"],["for","ordinaPer",1,"label"],["id","ordinaPer",1,"table-inline-select",3,"change","value"],["value","desc"],["value","asc"],["for","filtroProvincia",1,"label"],["id","filtroProvincia",1,"table-inline-select",3,"change","value"],["value","tutte"],[1,"table-container"],[1,"crm-table"],["class","row-clickable",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],["class","load-more-container",4,"ngIf"],["style","text-align:center; color:#ef4444; margin-top:1rem;",4,"ngIf"],[3,"value"],[1,"row-clickable",3,"click"],["data-label","Ragione Sociale"],[1,"cell-content"],["data-label","Referente"],["data-label","Telefono"],["data-label","Email"],["data-label","Metodo Pagamento"],["data-label","Ultimo Esito"],[4,"ngIf","ngIfElse"],["data-label","Azioni"],[1,"actions-container"],["title","Modifica",1,"action-btn","edit",3,"click"],[1,"actions-dropdown"],["title","Altre azioni",1,"action-btn",3,"click"],["class","modal","style",`position: absolute; top: calc(100% + 8px); right: 0; 
                            width: 180px; transform: none; left: auto; 
                            max-height: none; overflow: visible;`,4,"ngIf"],[1,"modal",2,"position","absolute","top","calc(100% + 8px)","right","0","width","180px","transform","none","left","auto","max-height","none","overflow","visible"],[1,"modal-body",2,"padding","0"],[1,"dropdown-item",3,"click"],[1,"dropdown-item",2,"color","#ef4444",3,"click","disabled"],["colspan","7",2,"text-align","center","padding","1.5rem"],[1,"load-more-container"],[1,"promethea-button",3,"click","disabled"],["class","material-icons",4,"ngIf"],[2,"text-align","center","color","#ef4444","margin-top","1rem"]],template:function(o,n){if(o&1){let s=b();y(0,"app-page-loader",4),t(1,"div")(2,"div",5)(3,"div",6)(4,"i",7),r(5,"local_shipping"),i(),t(6,"div",8)(7,"h2",9),r(8,"Fornitori"),i(),t(9,"p",10),r(10,"Panoramica fornitori e KPI"),i()(),y(11,"div",11),t(12,"a",12)(13,"span",13),r(14,"add_circle"),i()()(),t(15,"div",14)(16,"div",15),u("click",function(){return m(s),f(n.onFiltroTotale())}),t(17,"h3",16),r(18,"Totale Fornitori"),i(),t(19,"div",17),r(20),i()(),t(21,"div",15),u("click",function(){return m(s),f(n.onFiltroConIban())}),t(22,"h3",16),r(23,"Con IBAN"),i(),t(24,"div",17),r(25),i()(),t(26,"div",15),u("click",function(){return m(s),f(n.onFiltroConReferente())}),t(27,"h3",16),r(28,"Con Referente"),i(),t(29,"div",17),r(30),i()()()(),t(31,"section",18)(32,"div",19)(33,"div",20)(34,"label",21)(35,"span",13),r(36,"search"),i(),r(37," Cerca "),i(),t(38,"input",22),z("ngModelChange",function(c){return m(s),O(n.searchTerm,c)||(n.searchTerm=c),f(c)}),u("ngModelChange",function(c){return m(s),f(n.onSearchChange(c))}),i()(),t(39,"div",20)(40,"label",23)(41,"span",13),r(42,"filter_list"),i(),r(43," Ultimo esito "),i(),t(44,"select",24,0),u("change",function(){m(s);let c=w(45);return f(n.onChangeFiltroEsito(c.value))}),t(46,"option",25),r(47,"Tutti"),i(),t(48,"option",26),r(49,"Senza esito"),i(),_(50,re,2,2,"option",27),i()(),t(51,"div",20)(52,"label",28)(53,"span",13),r(54,"sort"),i(),r(55," Ordina per: "),i(),t(56,"select",29,1),u("change",function(){m(s);let c=w(57);return f(n.onChangeSortDir(c.value))}),t(58,"option",30),r(59,"Pi\xF9 recente"),i(),t(60,"option",31),r(61,"Meno recente"),i()()(),t(62,"div",20)(63,"label",32)(64,"span",13),r(65,"place"),i(),r(66," Provincia "),i(),t(67,"select",33,2),u("change",function(){m(s);let c=w(68);return f(n.onChangeFiltroProvincia(c.value))}),t(69,"option",34),r(70,"Tutte"),i(),_(71,oe,2,2,"option",27),i()()(),t(72,"div",35)(73,"table",36)(74,"thead")(75,"tr")(76,"th"),r(77,"Ragione Sociale"),i(),t(78,"th"),r(79,"Referente"),i(),t(80,"th"),r(81,"Telefono"),i(),t(82,"th"),r(83,"Email"),i(),t(84,"th"),r(85,"Metodo Pagamento"),i(),t(86,"th"),r(87,"Ultimo Esito"),i(),t(88,"th"),r(89,"Azioni"),i()()(),t(90,"tbody"),_(91,ce,32,11,"tr",37)(92,de,3,1,"tr",38),i()()(),_(93,fe,5,4,"div",39)(94,ue,2,1,"div",40),i()()}o&2&&(d("isLoading",n.isLoading()),a(),S("hidden",n.isLoading()),a(11),d("routerLink",A(24,ne)),a(4),S("card-active",n.currentFiltri().esito==="tutti"&&n.currentFiltri().provincia==="tutte"&&!n.currentFiltri().conIban&&!n.currentFiltri().conReferente),a(4),v(n.kpi().totale),a(),S("card-active",n.currentFiltri().conIban),a(4),v(n.kpi().conIban),a(),S("card-active",n.currentFiltri().conReferente),a(4),v(n.kpi().conReferente),a(8),M("ngModel",n.searchTerm),a(6),d("value",n.currentFiltri().esito),a(6),d("ngForOf",n.esitiTipi),a(6),d("value",n.currentFiltri().sortDir),a(11),d("value",n.currentFiltri().provincia),a(4),d("ngForOf",n.province()),a(20),d("ngForOf",n.filteredRows())("ngForTrackBy",n.trackById),a(),d("ngIf",!n.loading()&&!n.error()&&n.filteredRows().length===0),a(),d("ngIf",!n.error()&&n.hasMore()),a(),d("ngIf",n.error()))},dependencies:[K,$,B,Q,G,J,U,W,q,Y,H],encapsulation:2})};export{ie as ListaFornitori};
