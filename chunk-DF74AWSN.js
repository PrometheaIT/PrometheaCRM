import{a as gt}from"./chunk-M2R2PQAR.js";import{a as _t}from"./chunk-IXRGBZTQ.js";import{a as ft}from"./chunk-IZICGKZ5.js";import{c as ut}from"./chunk-HZQUGBKA.js";import{a as pt}from"./chunk-TKSIP4W4.js";import{b as rt,d as ot,f as at,p as lt,q as st,v as ct}from"./chunk-DK6BTRCD.js";import{a as mt}from"./chunk-YXXNVQRW.js";import{b as dt}from"./chunk-3M63M74O.js";import{a as nt}from"./chunk-ERQHX2OH.js";import{a as it}from"./chunk-SJ4NRQ5G.js";import{f as Z,g as tt}from"./chunk-NWP7JNX6.js";import{b as et}from"./chunk-7K4EWSAC.js";import{i as J,j as G,k as Q,r as X}from"./chunk-XADZCZ3D.js";import{A as F,Fa as s,Gb as I,I as V,Ib as S,Ka as z,Kb as l,Lb as y,Mb as w,Ob as Y,Pb as j,Qb as B,Ra as R,S as b,Sb as O,Ub as K,Wa as v,Wb as q,X as u,Xb as W,Y as g,ac as H,ea as C,eb as D,f as M,fb as N,lb as d,mb as n,nb as r,ob as P,sb as $,tb as U,vb as x,x as L,yb as f,zb as p}from"./chunk-QBO2HR3F.js";import"./chunk-X5YLR3NI.js";import{i as _}from"./chunk-ODN5LVDJ.js";var ht=()=>["/soggetto","nuovo","cliente"],yt=(o,t,e)=>({promethea:o,yuvi:t,infoTecniche:e}),bt=(o,t)=>({"product-promethea":o,"product-yuvi":t});function Ct(o,t){o&1&&(n(0,"a",49)(1,"span",23),l(2,"add_circle"),r()()),o&2&&d("routerLink",K(1,ht))}function xt(o,t){if(o&1&&(n(0,"option",50),l(1),r()),o&2){let e=t.$implicit;d("value",e),s(),y(e)}}function St(o,t){if(o&1&&(n(0,"option",50),l(1),r()),o&2){let e=t.$implicit;d("value",e),s(),y(e)}}function wt(o,t){if(o&1&&(n(0,"option",50),l(1),r()),o&2){let e=t.$implicit;d("value",e),s(),y(e)}}function Pt(o,t){if(o&1&&(n(0,"span"),l(1),r()),o&2){let e=p().$implicit;s(),y(e.comune)}}function It(o,t){if(o&1&&(n(0,"span"),l(1),r()),o&2){let e=p().$implicit;s(),w(" (",e.provincia,")")}}function Et(o,t){o&1&&(n(0,"span",73),l(1," Nessun indirizzo "),r())}function kt(o,t){if(o&1){let e=x();n(0,"button",78),f("click",function(a){u(e);let c=p().$implicit,m=p(2).$implicit,A=p();return a.stopPropagation(),g(A.confirmRemoveProduct(m,c))}),n(1,"span",79),l(2,"close"),r()()}if(o&2){let e=p().$implicit;d("title",O("Rimuovi ",e)),D("aria-label",O("Rimuovi ",e))}}function Tt(o,t){if(o&1&&(n(0,"span",76),l(1),v(2,kt,3,4,"button",77),r()),o&2){let e=t.$implicit,i=p(2).$implicit,a=p();d("ngClass",q(3,bt,e==="Promethea",e==="YUVI")),s(),w(" ",e," "),s(),d("ngIf",!a.isProdottoAutomatico(e,i))}}function At(o,t){if(o&1&&(n(0,"div",74),v(1,Tt,3,6,"span",75),r()),o&2){let e=p().$implicit,i=p();s(),d("ngForOf",i.getSelectedProducts(e))}}function Mt(o,t){if(o&1&&(n(0,"option",50),l(1),r()),o&2){let e=t.$implicit;d("value",e.nome),s(),w(" ",e.nome," ")}}function Ot(o,t){o&1&&(n(0,"div",85),P(1,"span",86),r())}function Lt(o,t){if(o&1){let e=x();n(0,"div",80)(1,"select",81,5),f("change",function(a){u(e);let c=p().$implicit,m=p();return g(m.onProductSelectChange(c,a))}),v(3,Mt,2,2,"option",29),r(),n(4,"div",82)(5,"button",83),f("click",function(){u(e);let a=p(2);return g(a.closeProductPicker())}),l(6,"Chiudi"),r(),v(7,Ot,2,0,"div",84),r()()}if(o&2){let e=p().$implicit,i=p();s(),d("value",i.getSelectedProducts(e))("disabled",i.updatingProdottoIds.has(e.id)),s(2),d("ngForOf",i.getManualProducts()),s(4),d("ngIf",i.updatingProdottoIds.has(e.id))}}function Ft(o,t){o&1&&(n(0,"span",87),l(1,"S\xEC"),r())}function Vt(o,t){o&1&&(n(0,"span",88),l(1,"No"),r())}function zt(o,t){if(o&1&&($(0),n(1,"span"),l(2),r(),U()),o&2){let e=t.ngIf;s(2),y(e.tipo)}}function Rt(o,t){o&1&&l(0,"\u2014")}function Dt(o,t){if(o&1){let e=x();n(0,"button",89),f("click",function(a){u(e);let c=p().$implicit,m=p();return a.stopPropagation(),g(m.vediConfigurazionePromethea(c))}),P(1,"img",90),r()}}function Nt(o,t){if(o&1){let e=x();n(0,"button",91),f("click",function(a){u(e);let c=p().$implicit,m=p();return a.stopPropagation(),g(m.vediTrattativaYuvi(c))}),P(1,"img",92),r()}}function $t(o,t){if(o&1){let e=x();n(0,"button",93),f("click",function(a){u(e);let c=p().$implicit,m=p();return a.stopPropagation(),g(m.goToInformazioniTecniche(c))}),n(1,"span",23),l(2,"build"),r()()}}function Ut(o,t){if(o&1){let e=x();n(0,"tr",51)(1,"td",52)(2,"div",53)(3,"strong",54),f("click",function(){let a=u(e).$implicit,c=p();return g(c.apriScheda(a))}),l(4),r()()(),n(5,"td",55)(6,"div",53),l(7),r()(),n(8,"td",56)(9,"div",53),l(10),r()(),n(11,"td",57)(12,"div",53),v(13,Pt,2,1,"span",45)(14,It,2,1,"span",45)(15,Et,2,0,"span",58),r()(),n(16,"td",59)(17,"div",53),v(18,At,2,1,"div",60)(19,Lt,8,4,"div",61),r()(),n(20,"td",62)(21,"div",53),v(22,Ft,2,0,"span",63)(23,Vt,2,0,"span",64),r()(),n(24,"td",65)(25,"div",53),v(26,zt,3,1,"ng-container",66)(27,Rt,1,0,"ng-template",null,4,H),r()(),n(29,"td",67)(30,"div",68),v(31,Dt,2,0,"button",69)(32,Nt,2,0,"button",70)(33,$t,3,0,"button",71),n(34,"app-action-dropdown",72),f("opened",function(){u(e);let a=p();return g(a.dropdownAnyOpen.set(!0))})("closed",function(){u(e);let a=p();return g(a.dropdownAnyOpen.set(!1))})("action",function(a){let c=u(e).$implicit,m=p();return g(m.handleRowAction(a,c))}),r()()()()}if(o&2){let e=t.$implicit,i=I(28),a=p();N("data-row-id",e.id),s(4),y(e.ragione_sociale),s(3),y(e.referente||"\u2014"),s(3),y(e.telefono||"\u2014"),s(3),d("ngIf",e.comune),s(),d("ngIf",e.provincia),s(),d("ngIf",!e.comune&&!e.provincia),s(3),d("ngIf",a.getSelectedProducts(e).length>0),s(),d("ngIf",a.isProductPickerOpen(e)),s(3),d("ngIf",e.configurato),s(),d("ngIf",!e.configurato),s(3),d("ngIf",e.ultimoEsito)("ngIfElse",i),s(5),d("ngIf",e.hasConfigPromethea),s(),d("ngIf",e.hasTrattativaYuvi),s(),d("ngIf",a.showInformazioniTecniche(e)),s(),d("row",e)("hideAddProduct",a.dropdownAnyOpen())("showPromethea",!1)("primaryIcons",W(20,yt,e.hasConfigPromethea,e.hasTrattativaYuvi,a.showInformazioniTecniche(e)))}}function Yt(o,t){if(o&1&&(n(0,"tr")(1,"td",94),l(2),r()()),o&2){let e=p();s(2),w(" ",e.searchTerm?"Nessun cliente trovato":"Nessun cliente"," ")}}function jt(o,t){o&1&&(n(0,"span",23),l(1,"unfold_more"),r())}function Bt(o,t){o&1&&(n(0,"span",23),l(1,"hourglass_bottom"),r())}function Kt(o,t){if(o&1){let e=x();n(0,"div",95)(1,"button",96),f("click",function(){u(e);let a=p();return g(a.caricaTutti())}),v(2,jt,2,0,"span",97)(3,Bt,2,0,"span",97),l(4),r()()}if(o&2){let e=p();s(),d("disabled",e.loading()),s(),d("ngIf",!e.loading()),s(),d("ngIf",e.loading()),s(),w(" ",e.loading()?"Caricamento\u2026":"Carica tutti"," ")}}function qt(o,t){if(o&1&&(n(0,"div",98),l(1),r()),o&2){let e=p();s(),w(" ",e.error()," ")}}var vt=class o{listaService=b(gt);supabaseService=b(et);soggettiService=b(dt);kpiService=b(mt);authService=b(it);router=b(Z);userService=b(nt);searchSubject=new M;destroy$=new M;rows=this.listaService.rows;filteredRows=this.listaService.filteredRows;loading=this.listaService.loading;error=this.listaService.error;hasMore=this.listaService.hasMore;currentFiltri=this.listaService.currentFiltri;userModuli=C([]);isUserAdmin=C(!1);_configuredIds=new Set;dropdownAnyOpen=C(!1);_configuredCount=C(-1);get configuredCount(){let t=this._configuredCount();if(t>=0)return t;try{let e=this.rows,i=typeof e=="function"?e():Array.isArray(e)?e:[];return Array.isArray(i)?i.filter(a=>!!a.configurato).length:0}catch{return 0}}get configuredCardCount(){try{let t=this.rows,e=typeof t=="function"?t():Array.isArray(t)?t:[];return Array.isArray(e)?e.filter(i=>i?.configurato===!0&&(i?.tipo==="cliente"||!i?.tipo)).length:0}catch{return 0}}kpiLoading=C(!1);province=C([]);kpi=C({totale:0,conIban:0,conReferente:0});_openProductPickerForId=null;deletingIds=new Set;showEsito=!1;selectedId=null;updatingProdottoIds=new Set;esitiTipi=ut;searchTerm="";filtroConIban=!1;filtroConReferente=!1;isLoading=C(!0);renderer=b(z);constructor(){this.searchSubject.pipe(V(this.destroy$),L(300),F()).subscribe(t=>{this.onSearchExecuted(t)})}ngOnInit(){return _(this,null,function*(){this.listaService.inizializza({tipo:"cliente",abilitaConfigurazioni:!0,abilitaTrattative:!0});try{yield Promise.all([this.listaService.caricaIniziali(),this.loadProvince(),this.refreshKpi(),this.loadUserData()]),yield this.loadConfiguredCount()}finally{setTimeout(()=>{this.isLoading.set(!1)},300)}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadUserData(){return _(this,null,function*(){try{let t=this.authService.user();if(!t)return;let e=yield this.soggettiService.supabaseService.isAdmin();this.isUserAdmin.set(e);let{data:i}=yield this.soggettiService.supabaseService.getAppUserById(t.id);i&&i.moduli&&this.userModuli.set(i.moduli)}catch(t){console.error("Errore nel caricamento dati utente:",t)}})}caricaTutti(){return _(this,null,function*(){yield this.listaService.caricaTutti()})}allLoaded(){return this.listaService.allLoaded()}onSearchExecuted(t){return _(this,null,function*(){yield this.listaService.cerca(t)})}onSearchChange(t){this.searchTerm=t,this.searchSubject.next(t)}onChangeFiltroEsito(t){this.listaService.applicaFiltri({esito:t,conIban:this.filtroConIban,conReferente:this.filtroConReferente})}onChangeFiltroProvincia(t){this.listaService.applicaFiltri({provincia:t})}onChangeSortDir(t){this.listaService.applicaFiltri({sortDir:t})}onFiltroTotale(){return _(this,null,function*(){this.filtroConIban=!1,this.filtroConReferente=!1,this.listaService.applicaFiltri({esito:"tutti",provincia:"tutte",conIban:!1,conReferente:!1}),yield this.listaService.caricaIniziali()})}onFiltroConIban(){this.filtroConIban=!0,this.filtroConReferente=!1,this.listaService.applicaFiltri({esito:"tutti",conIban:!0,conReferente:!1})}onFiltroConReferente(){this.filtroConIban=!1,this.filtroConReferente=!0,this.listaService.applicaFiltri({esito:"tutti",conIban:!1,conReferente:!0})}vediConfigurazionePromethea(t){this.router.navigate(["/alchemizzatore"],{queryParams:{prospectId:t.id,step:6},state:{prospect:t,goToStep:6,from:"lista-clienti"}})}vediTrattativaYuvi(t){return _(this,null,function*(){try{let{data:e,error:i}=yield this.soggettiService.supabaseService.supabase.from("trattative_yuvi").select("*").eq("prospect_id",t.id).order("created_at",{ascending:!1}).limit(1).single();if(i)throw i;if(!e){alert("Nessuna trattativa YUVI trovata per questo cliente");return}this.router.navigate(["/yuvi-trattativa"],{queryParams:{clienteId:t.id,trattativaId:e.id},state:{cliente:t,trattativaEsistente:e}})}catch(e){alert("Errore nel caricamento della trattativa: "+e.message)}})}onDelete(t){return _(this,null,function*(){if(!(!t?.id||!confirm(`Eliminare il cliente "${t.ragione_sociale}"?`))){this.deletingIds.add(t.id);try{(yield this.listaService.eliminaSoggetto(t.id))&&(yield this.refreshKpi())}catch(i){console.error("Errore durante l'eliminazione:",i)}finally{this.deletingIds.delete(t.id)}}})}onEdit(t){t?.id&&this.router.navigate(["/soggetto",t.id,"edit"])}openEsito(t){this.selectedId=t.id,this.showEsito=!0}apriScheda(t){t?.id&&this.router.navigate(["/soggetto",t.id])}onPopupClosed(t){return _(this,null,function*(){this.showEsito=!1,this.selectedId=null,t.saved&&(yield Promise.all([this.listaService.caricaTutti(),this.refreshKpi()]))})}onChangeProdotto(t,e){return _(this,null,function*(){if(!t?.id)return;let i=e;if(t.prodotto!==i){this.updatingProdottoIds.add(t.id);try{yield this.listaService.aggiornaProdotto(t.id,i)}catch(a){console.error("Errore durante l'aggiornamento del prodotto:",a)}finally{this.updatingProdottoIds.delete(t.id)}}})}showInformazioniTecniche(t){if(!t.moduliAttivi||t.moduliAttivi.length===0)return!1;if(this.isUserAdmin())return!0;let e=this.userModuli();return t.moduliAttivi.some(i=>e.includes(i))}getModuloDaAprire(t){let e=this.userModuli(),i=t.moduliAttivi||[];return this.isUserAdmin()?i[0]||"social":i.find(c=>e.includes(c))||"social"}goToInformazioniTecniche(t){if(!t.id){console.error("Cliente senza ID:",t);return}console.log("Navigando a informazioni tecniche per cliente:",t.id),this.router.navigate(["/informazioni-tecniche"],{queryParams:{clienteId:t.id}})}isAdmin(){return this.userService.isAdmin()}trackById=(t,e)=>e.id;loadProvince(){return _(this,null,function*(){let{data:t}=yield this.soggettiService.getProvinceByTipo("cliente");t&&this.province.set(t)})}refreshKpi(){return _(this,null,function*(){try{this.kpiLoading.set(!0);let t=yield this.kpiService.getAnagraficaKPI("cliente");this.kpi.set({totale:t.totale,conIban:t.conIban,conReferente:t.conReferente})}catch(t){console.error("Errore nel caricamento KPI:",t)}finally{this.kpiLoading.set(!1)}})}getLastEsito(t){return!Array.isArray(t)||t.length===0?null:t.reduce((e,i)=>{let a=new Date(i.ts).getTime(),c=new Date(e.ts).getTime();return a>c?i:e})}handleRowAction(t,e){switch(t){case"promethea":this.vediConfigurazionePromethea(e);break;case"yuvi":this.vediTrattativaYuvi(e);break;case"info-tecniche":this.goToInformazioniTecniche(e);break;case"edit":this.onEdit(e);break;case"esito":this.openEsito(e);break;case"delete":this.onDelete(e);break;default:console.warn("Azione non gestita",t)}}get filteredCount(){try{let t=this.filteredRows??this.rows;if(typeof t=="function"){let i=t();return Array.isArray(i)?i.length:0}if(Array.isArray(t))return t.length;let e=this.displayRows;if(typeof e=="function"){let i=e();return Array.isArray(i)?i.length:0}return 0}catch{return 0}}resetAllFilters(){return _(this,null,function*(){this.searchTerm="",this.filtroConIban=!1,this.filtroConReferente=!1,this.listaService.applicaFiltri({provincia:"tutte",searchTerm:"",esito:"tutti",sortDir:"desc",configurato:null,conIban:!1,conReferente:!1,prodotto:"tutti",categoria_ateco:"tutte"});try{yield this.listaService.caricaIniziali(),yield this.refreshKpi()}catch(t){console.error("Errore reset filtri:",t)}})}loadConfiguredCount(){return _(this,null,function*(){try{let t=new Set,[e,i]=yield Promise.all([this.supabaseService.supabase.from("configurazioni_promethea").select("cliente_id, prospect_id"),this.supabaseService.supabase.from("trattative_yuvi").select("cliente_id, prospect_id")]);!e.error&&Array.isArray(e.data)&&e.data.forEach(h=>{h?.cliente_id&&t.add(String(h.cliente_id).trim()),h?.prospect_id&&t.add(String(h.prospect_id).trim())}),!i.error&&Array.isArray(i.data)&&i.data.forEach(h=>{h?.cliente_id&&t.add(String(h.cliente_id).trim()),h?.prospect_id&&t.add(String(h.prospect_id).trim())});let a=Array.from(t).filter(Boolean);if(this._configuredIds=new Set(a),a.length===0){this._configuredCount.set(0);return}let c=(h,E=100)=>{let k=[];for(let T=0;T<h.length;T+=E)k.push(h.slice(T,T+E));return k},m=0,A=c(a,100);for(let h of A){let{data:E,error:k}=yield this.supabaseService.supabase.from("soggetti").select("id").in("id",h).eq("tipo","cliente");if(k){console.warn("Partial soggetti fetch error (configured count chunk):",k);continue}Array.isArray(E)&&(m+=E.length)}this._configuredCount.set(m);return}catch(t){console.error("Errore loadConfiguredCount clienti",t),this._configuredCount.set(0)}})}onFiltroConfigurati(){return _(this,null,function*(){try{yield this.listaService.caricaTutti(),this.listaService.applicaFiltri({configurato:!0,configuredIds:Array.from(this._configuredIds)})}catch(t){console.error("Errore applicazione filtro configurati:",t),this.listaService.applicaFiltri({configurato:!0,configuredIds:Array.from(this._configuredIds)})}})}getSelectedProducts(t){try{if(Array.isArray(t.prodotti)&&t.prodotti.length)return t.prodotti.map(e=>(e?.nome??e?.product_name??String(e)).toString());if(t.prodotto)return[String(t.prodotto)];if(t.prodotto_nome)return[String(t.prodotto_nome)];if(t.extra_data){if(typeof t.extra_data=="string")try{t.extra_data=JSON.parse(t.extra_data)}catch{}if(t.extra_data?.prodotti){let e=t.extra_data.prodotti;if(Array.isArray(e))return e.map(i=>String(i.nome??i));if(typeof e=="string")return[e]}}for(let e of Object.keys(t||{}))if(/prodotti?|product|prodotto_nome/i.test(e)&&t[e]){let i=t[e];return Array.isArray(i)?i.map(a=>String(a.nome??a)):[String(i)]}}catch(e){console.warn("getSelectedProducts fallback error",e)}return[]}getManualProducts(){return this.manualProducts||[]}isProductPickerOpen(t){return this._openProductPickerForId===t.id}openProductPicker(t){this._openProductPickerForId=t.id,(!this.manualProducts||!this.manualProducts.length)&&this.loadManualProducts?.()}closeProductPicker(){this._openProductPickerForId=null}onProductSelectChange(t,e){return _(this,null,function*(){let i=e.target,a=Array.from(i.selectedOptions).map(c=>c.value);yield this.updateRowProducts(t,a)})}removeSelectedProduct(t,e){return _(this,null,function*(){let a=this.getSelectedProducts(t).filter(c=>c!==e);yield this.updateRowProducts(t,a)})}updateRowProducts(t,e){return _(this,null,function*(){try{this.updatingProdottoIds.add(t.id);let i=Array.isArray(e)?e.join(", "):String(e||""),a=yield this.soggettiService.updateProdotto(t.id,i);if(a&&!a.error)t.prodotto=i,t.prodotti=(e||[]).map(c=>({nome:c}));else throw console.error("Errore aggiornamento prodotti:",a?.error||a),a?.error||new Error("Aggiornamento prodotti fallito")}catch(i){console.error("Errore aggiornamento prodotti",i),alert("Errore aggiornamento prodotti: "+(i?.message||String(i)))}finally{this.updatingProdottoIds.delete(t.id),this.closeProductPicker()}})}isProdottoAutomatico(t,e){if(!t)return!1;let i=String(t).trim().toLowerCase();return["promethea","yuvi"].includes(i)}onDropdownOpened(){this.dropdownAnyOpen.set(!0)}onDropdownClosed(){this.dropdownAnyOpen.set(!1)}getActionItemsForRow(t,e){return Array.isArray(e)?this.dropdownAnyOpen()?e.filter(i=>{let a=i&&i.key?String(i.key).toLowerCase():"",c=i&&i.label?String(i.label).toLowerCase():"";return a!=="aggiungi-prodotto"&&c!=="aggiungi prodotto"}):e:[]}confirmRemoveProduct(t,e){return _(this,null,function*(){let i=t?.ragione_sociale||t?.referente||"il soggetto";if(confirm(`Rimuovere il prodotto "${e}" da ${i}?`))try{let c=this.removeSelectedProduct(t,e);c&&typeof c.then=="function"&&(yield c)}catch(c){console.error("Errore rimozione prodotto",c),alert("Si \xE8 verificato un errore durante la rimozione del prodotto.")}})}get prodottoOptions(){try{let t=this.rows,e=typeof t=="function"?t():Array.isArray(t)?t:[],i=new Set;return(e||[]).forEach(a=>{let c=(a?.prodotto??"").toString().trim();c&&i.add(c)}),Array.from(i).sort()}catch{return[]}}onChangeFiltroProdotto(t){this.listaService.applicaFiltri({prodotto:t??"tutti"})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=R({type:o,selectors:[["app-lista-clienti"]],decls:121,vars:35,consts:[["filtroSel",""],["ordinaSel",""],["provSel",""],["prodSel",""],["noEsito",""],["sel",""],["title","Caricamento Clienti","subtitle","Stiamo caricando i tuoi clienti...",3,"isLoading"],[1,"form-section"],[1,"section-header"],[1,"material-icons","header-icon"],[1,"section-titles"],[1,"section-title"],[1,"sottotitolo"],[1,"flex-1"],["class","icon-btn","title","Aggiungi cliente","aria-label","Aggiungi cliente",3,"routerLink",4,"ngIf"],[1,"prospect-cards"],[1,"card",3,"click"],[1,"card-title"],[1,"card-number"],[1,"table-section"],[1,"table-tools"],[1,"tool"],["for","search",1,"label"],[1,"material-icons"],["id","search","type","text","placeholder","Nome, telefono, email...",1,"table-inline-input",3,"ngModelChange","ngModel"],["for","filtroEsito",1,"label"],["id","filtroEsito",1,"table-inline-select",3,"change","value"],["value","tutti"],["value","senza-esito"],[3,"value",4,"ngFor","ngForOf"],["for","ordinaPer",1,"label"],["id","ordinaPer",1,"table-inline-select",3,"change","value"],["value","desc"],["value","asc"],["for","filtroProvincia",1,"label"],["id","filtroProvincia",1,"table-inline-select",3,"change","value"],["value","tutte"],["for","filtroProdotto",1,"label"],["id","filtroProdotto",1,"table-inline-select",3,"change","value"],["type","button",1,"promethea-button","ghost",3,"click"],[1,"tool",2,"display","flex","align-items","center","gap","var(--gutter-sm)","margin","var(--gutter-sm) 0"],["title","Risultati filtrati",1,"chip",2,"margin","0 var(--gutter-lg)"],[1,"table-container"],[1,"crm-table"],["class","row-clickable",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],["class","load-more-container",4,"ngIf"],["style","text-align:center; color:#ef4444; margin-top:1rem;",4,"ngIf"],[3,"closed","open","soggettoId","tipo"],["title","Aggiungi cliente","aria-label","Aggiungi cliente",1,"icon-btn",3,"routerLink"],[3,"value"],[1,"row-clickable"],["data-label","Ragione Sociale"],[1,"cell-content"],[1,"link",3,"click"],["data-label","Referente"],["data-label","Telefono"],["data-label","Localit\xE0"],["style","color: #6b7280; font-style: italic;",4,"ngIf"],["data-label","Prodotto"],["class","selected-badges",4,"ngIf"],["class","product-picker",4,"ngIf"],["data-label","Configurato"],["class","badge badge-success",4,"ngIf"],["class","badge badge-danger",4,"ngIf"],["data-label","Ultimo Esito"],[4,"ngIf","ngIfElse"],["data-label","Azioni"],[1,"actions-container"],["class","action-btn document","title","Configurazione Promethea",3,"click",4,"ngIf"],["class","action-btn email","title","Trattativa YUVI",3,"click",4,"ngIf"],["class","action-btn info-tecniche","title","Informazioni Tecniche",3,"click",4,"ngIf"],[3,"opened","closed","action","row","hideAddProduct","showPromethea","primaryIcons"],[2,"color","#6b7280","font-style","italic"],[1,"selected-badges"],["class","product-badge",3,"ngClass",4,"ngFor","ngForOf"],[1,"product-badge",3,"ngClass"],["class","badge-remove","type","button",3,"title","aria-label","click",4,"ngIf"],["type","button",1,"badge-remove",3,"click","title","aria-label"],["aria-hidden","true",1,"material-icons"],[1,"product-picker"],["multiple","",1,"table-inline-select",3,"change","value","disabled"],[2,"margin-top","0.5rem","display","flex","gap","0.5rem","align-items","center"],[1,"promethea-button","outline",3,"click"],["class","loading-indicator","style","margin-left:0.5rem;",4,"ngIf"],[1,"loading-indicator",2,"margin-left","0.5rem"],[1,"loading-spinner",2,"width","20px","height","20px","border-width","2px"],[1,"badge","badge-success"],[1,"badge","badge-danger"],["title","Configurazione Promethea",1,"action-btn","document",3,"click"],["src","assets/Logo.png","alt","Promethea",1,"icon-img"],["title","Trattativa YUVI",1,"action-btn","email",3,"click"],["src","assets/yuvi.png","alt","YUVI",1,"icon-img"],["title","Informazioni Tecniche",1,"action-btn","info-tecniche",3,"click"],["colspan","8",2,"text-align","center","padding","1.5rem"],[1,"load-more-container"],[1,"promethea-button",3,"click","disabled"],["class","material-icons",4,"ngIf"],[2,"text-align","center","color","#ef4444","margin-top","1rem"]],template:function(e,i){if(e&1){let a=x();P(0,"app-page-loader",6),n(1,"div")(2,"div",7)(3,"div",8)(4,"i",9),l(5,"business"),r(),n(6,"div",10)(7,"h2",11),l(8,"Clienti"),r(),n(9,"p",12),l(10,"Panoramica clienti e filtri rapidi"),r()(),P(11,"div",13),v(12,Ct,3,2,"a",14),r(),n(13,"div",15)(14,"div",16),f("click",function(){return u(a),g(i.resetAllFilters())}),n(15,"h3",17),l(16,"Totale"),r(),n(17,"div",18),l(18),r()(),n(19,"div",16),f("click",function(){return u(a),g(i.onFiltroConIban())}),n(20,"h3",17),l(21,"Con IBAN"),r(),n(22,"div",18),l(23),r()(),n(24,"div",16),f("click",function(){return u(a),g(i.onFiltroConReferente())}),n(25,"h3",17),l(26,"Con Referente"),r(),n(27,"div",18),l(28),r()(),n(29,"div",16),f("click",function(){return u(a),g(i.onFiltroConfigurati())}),n(30,"h3",17),l(31,"Configurati"),r(),n(32,"div",18),l(33),r()()()(),n(34,"section",19)(35,"div",20)(36,"div",21)(37,"label",22)(38,"span",23),l(39,"search"),r(),l(40," Cerca "),r(),n(41,"input",24),B("ngModelChange",function(m){return u(a),j(i.searchTerm,m)||(i.searchTerm=m),g(m)}),f("ngModelChange",function(m){return u(a),g(i.onSearchChange(m))}),r()(),n(42,"div",21)(43,"label",25)(44,"span",23),l(45,"filter_list"),r(),l(46," Ultimo esito "),r(),n(47,"select",26,0),f("change",function(){u(a);let m=I(48);return g(i.onChangeFiltroEsito(m.value))}),n(49,"option",27),l(50,"Tutti"),r(),n(51,"option",28),l(52,"Senza esito"),r(),v(53,xt,2,2,"option",29),r()(),n(54,"div",21)(55,"label",30)(56,"span",23),l(57,"sort"),r(),l(58," Ordina per: "),r(),n(59,"select",31,1),f("change",function(){u(a);let m=I(60);return g(i.onChangeSortDir(m.value))}),n(61,"option",32),l(62,"Pi\xF9 recente"),r(),n(63,"option",33),l(64,"Meno recente"),r()()(),n(65,"div",21)(66,"label",34)(67,"span",23),l(68,"place"),r(),l(69," Provincia "),r(),n(70,"select",35,2),f("change",function(){u(a);let m=I(71);return g(i.onChangeFiltroProvincia(m.value))}),n(72,"option",36),l(73,"Tutte"),r(),v(74,St,2,2,"option",29),r()(),n(75,"div",21)(76,"label",37)(77,"span",23),l(78,"inventory_2"),r(),l(79," Prodotto "),r(),n(80,"select",38,3),f("change",function(){u(a);let m=I(81);return g(i.onChangeFiltroProdotto(m.value))}),n(82,"option",27),l(83,"Tutti"),r(),v(84,wt,2,2,"option",29),r()(),n(85,"div",21)(86,"button",39),f("click",function(){return u(a),g(i.resetAllFilters())}),n(87,"span",23),l(88,"filter_alt_off"),r(),l(89," Azzera filtri "),r()(),n(90,"div",40)(91,"span",41),l(92," Risultati: "),n(93,"strong"),l(94),r()()()(),n(95,"div",42)(96,"table",43)(97,"thead")(98,"tr")(99,"th"),l(100,"Ragione Sociale"),r(),n(101,"th"),l(102,"Referente"),r(),n(103,"th"),l(104,"Telefono"),r(),n(105,"th"),l(106,"Localit\xE0"),r(),n(107,"th"),l(108,"Prodotto"),r(),n(109,"th"),l(110,"Configurato"),r(),n(111,"th"),l(112,"Ultimo Esito"),r(),n(113,"th"),l(114,"Azioni"),r()()(),n(115,"tbody"),v(116,Ut,35,24,"tr",44)(117,Yt,3,1,"tr",45),r()()(),v(118,Kt,5,4,"div",46)(119,qt,2,1,"div",47),r(),n(120,"app-esito-popup",48),f("closed",function(m){return u(a),g(i.onPopupClosed(m))}),r()()}e&2&&(d("isLoading",i.isLoading()),s(),S("hidden",i.isLoading()),s(11),d("ngIf",i.isAdmin()),s(2),S("card-active",i.currentFiltri().esito==="tutti"&&i.currentFiltri().provincia==="tutte"&&!i.currentFiltri().conIban&&!i.currentFiltri().conReferente),s(4),y(i.kpi().totale),s(),S("card-active",i.currentFiltri().conIban),s(4),y(i.kpi().conIban),s(),S("card-active",i.currentFiltri().conReferente),s(4),y(i.kpi().conReferente),s(),S("card-active",i.currentFiltri().configurato===!0),s(4),y(i.configuredCardCount),s(8),Y("ngModel",i.searchTerm),s(6),d("value",i.currentFiltri().esito),s(6),d("ngForOf",i.esitiTipi),s(6),d("value",i.currentFiltri().sortDir),s(11),d("value",i.currentFiltri().provincia),s(4),d("ngForOf",i.province()),s(6),d("value",i.currentFiltri().prodotto??"tutti"),s(4),d("ngForOf",i.prodottoOptions),s(10),y(i.filteredCount),s(),S("dropdown-open",i.dropdownAnyOpen()),s(21),d("ngForOf",i.filteredRows())("ngForTrackBy",i.trackById),s(),d("ngIf",!i.loading()&&!i.error()&&i.filteredRows().length===0),s(),d("ngIf",!i.error()&&i.hasMore()),s(),d("ngIf",i.error()),s(),d("open",i.showEsito)("soggettoId",i.selectedId)("tipo","cliente"))},dependencies:[X,J,G,Q,ft,ct,lt,st,rt,ot,at,pt,tt,_t],styles:['.badge-remove[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;margin-left:6px;padding:0;border-radius:50%;border:none;background:transparent;color:var(--text-muted, #6b7280);cursor:pointer;line-height:1;vertical-align:middle;transition:background-color .12s ease,color .12s ease}.badge-remove[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:16px;line-height:1;pointer-events:none}.badge-remove[_ngcontent-%COMP%]:hover, .badge-remove[_ngcontent-%COMP%]:focus{background:#0b5cff14;color:var(--primary, #0b5cff);outline:none}.badge-remove[_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 3px #0b5cff1f}.product-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px}.actions-dropdown[_ngcontent-%COMP%]{position:relative;display:inline-flex}.actions-dropdown[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;width:200px;z-index:1000;border:1px solid var(--smoke-color-1);border-radius:12px;box-shadow:0 8px 24px var(--shadow);background:var(--background);animation:_ngcontent-%COMP%_slideDown .2s ease-out}.actions-dropdown.open.centered[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{position:fixed!important;top:50%!important;left:50%!important;transform:translate(-50%,-50%)!important;width:min(90vw,420px)!important;max-height:80vh!important;overflow-y:auto!important;right:auto!important;z-index:1202!important;border-radius:16px!important;box-shadow:0 30px 80px #00000059!important}.actions-dropdown.open.centered[_ngcontent-%COMP%] ~ .mobile-dropdown-backdrop[_ngcontent-%COMP%], .actions-dropdown.open.centered[_ngcontent-%COMP%]   .mobile-dropdown-backdrop[_ngcontent-%COMP%]{display:block!important;z-index:1201!important}.actions-dropdown.open.centered[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]{padding:.5rem 0!important}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}.dropdown-item[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;gap:var(--gutter-sm);padding:.75rem 1rem;border:none;background:transparent;color:var(--text-color);cursor:pointer;transition:background .15s ease;font-size:var(--fs-sm);text-align:left;border-bottom:1px solid var(--smoke-color-1)}.dropdown-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.dropdown-item[_ngcontent-%COMP%]:hover{background:var(--smoke-color-2)}.dropdown-item[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.dropdown-item[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:1.1rem;width:20px}.dropdown-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:transparent;z-index:999;display:none}.actions-dropdown.open[_ngcontent-%COMP%] ~ .dropdown-overlay[_ngcontent-%COMP%]{display:block}@container (max-width: 768px){.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.actions-dropdown){display:none}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-dropdown[_ngcontent-%COMP%]   .dropdown-item[style*="display: none"][_ngcontent-%COMP%]{display:flex!important}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-dropdown.open[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{position:fixed!important;inset:50% auto auto 50%!important;transform:translate(-50%,-50%)!important;width:min(90vw,300px)!important;max-height:70vh!important;overflow-y:auto!important;z-index:1001!important;border-radius:16px!important;box-shadow:0 20px 40px var(--shadow)!important}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-dropdown[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{width:3rem!important;height:3rem!important;font-size:1.3rem!important}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]{justify-content:center!important;padding:var(--gutter-sm) 0}}@container (min-width: 769px){.actions-dropdown[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{min-width:180px}.actions-dropdown.left[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{right:auto;left:0}.actions-dropdown.top[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{top:auto;bottom:100%}}.table-container[_ngcontent-%COMP%]{overflow-x:auto;position:relative}body.dropdown-open[_ngcontent-%COMP%]{overflow:hidden}.mobile-dropdown-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:color-mix(in srgb,var(--text-color) 20%,transparent);-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px);z-index:998;display:none}.actions-dropdown.open[_ngcontent-%COMP%] ~ .mobile-dropdown-backdrop[_ngcontent-%COMP%]{display:block}']})};export{vt as ListaClienti};
