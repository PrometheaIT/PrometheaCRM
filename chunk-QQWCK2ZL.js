import{v as u,w as o}from"./chunk-VUYFDMJB.js";import{N as c,S as a,g as n}from"./chunk-CVFHM34U.js";import{i as s}from"./chunk-ODN5LVDJ.js";var d=class i{supabaseService=a(u);authService=a(o);isAdminSubject=new n(!1);currentRoleSubject=new n("user");isAdmin$=this.isAdminSubject.asObservable();currentRole$=this.currentRoleSubject.asObservable();constructor(){this.authService.user$.subscribe(t=>{t?this.checkAdminStatus(t.id):(this.isAdminSubject.next(!1),this.currentRoleSubject.next("user"))})}checkAdminStatus(t){return s(this,null,function*(){try{let{data:e}=yield this.supabaseService.getAppUserById(t),r=e?.is_admin===!0||Array.isArray(e?.ruoli)&&e.ruoli.includes("admin");this.isAdminSubject.next(!!r),this.currentRoleSubject.next(r?"admin":"user")}catch(e){console.error("Error checking admin status:",e),this.isAdminSubject.next(!1),this.currentRoleSubject.next("user")}})}isAdmin(){return this.isAdminSubject.value}refreshAdminStatus(){return s(this,null,function*(){try{let t=this.authService.user();if(!t)return this.isAdminSubject.next(!1),this.currentRoleSubject.next("user"),!1;let{data:e}=yield this.supabaseService.getAppUserById(t.id),r=!!e&&e.is_active&&(e.is_admin===!0||Array.isArray(e.ruoli)&&e.ruoli.includes("admin"));return this.isAdminSubject.next(r),this.currentRoleSubject.next(r?"admin":"user"),r}catch(t){return console.error("Error refreshing admin status:",t),this.isAdminSubject.next(!1),this.currentRoleSubject.next("user"),!1}})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"})};export{d as a};
