import{a as me}from"./chunk-O7PKPPU5.js";import{a as q,b as L,c as P,d as H,e as K,g as Y,h as J,k as X,l as Q,m as W,n as Z,o as ee,p as te,q as ie,r as ne,s as oe,t as re,u as ae,w as le}from"./chunk-DITEEB7V.js";import{a as B}from"./chunk-23T6KXZP.js";import{a as $}from"./chunk-6TYR3BRN.js";import{d as G,j as R}from"./chunk-KPVFMQJV.js";import{b as U}from"./chunk-7SDV3Z56.js";import{j as k,k as V,n as j,r as D}from"./chunk-G7C3XVRV.js";import{$b as w,Ab as s,Ga as l,Ib as F,Lb as i,Ma as C,Mb as I,Nb as g,Ob as z,Sa as O,Va as A,X as u,Xa as h,Y as f,_b as N,mb as p,nb as n,ob as e,pb as m,wb as b,zb as v}from"./chunk-S7YZFXYO.js";import"./chunk-X5YLR3NI.js";import{a as E,b as y,i as S}from"./chunk-ODN5LVDJ.js";function se(a,o){if(a&1&&(n(0,"span",14),i(1),e()),a&2){let t=s();l(),g("Cliente: ",t.clienteId)}}function pe(a,o){a&1&&(n(0,"span",15),i(1,"Visualizzazione Admin - Tutti i moduli"),e())}function ue(a,o){if(a&1&&(n(0,"div",16),i(1),e()),a&2){let t=s();l(),g(" ",t.error," ")}}function fe(a,o){if(a&1){let t=b();n(0,"div",67)(1,"div",68)(2,"div",23)(3,"label",24),i(4,"Obiettivo:"),e(),m(5,"input",69),e(),n(6,"div",23)(7,"label",24),i(8,"Target:"),e(),m(9,"input",70),e(),n(10,"div",23)(11,"label",24),i(12,"Scadenza:"),e(),m(13,"input",71),e(),n(14,"div",23)(15,"button",72),v("click",function(){let c=u(t).index,d=s(3);return f(d.removeObjective(c))}),n(16,"span",19),i(17,"delete"),e()()()()()}if(a&2){let t=o.index;p("formGroupName",t)}}function ve(a,o){if(a&1){let t=b();n(0,"div",73)(1,"div",74)(2,"div",23)(3,"label",24),i(4,"Nome:"),e(),m(5,"input",75),e(),n(6,"div",23)(7,"label",24),i(8,"Codice:"),e(),m(9,"input",76),e(),n(10,"div",23)(11,"label",24),i(12,"Priorit\xE0:"),e(),m(13,"input",77),e(),n(14,"div",23)(15,"button",78),v("click",function(){let c=u(t).index,d=s(3);return f(d.removeColor(c))}),n(16,"span",19),i(17,"delete"),e()()()()()}if(a&2){let t=o.index;p("formGroupName",t)}}function ge(a,o){if(a&1){let t=b();n(0,"div",79)(1,"div",80)(2,"div",23)(3,"label",24),i(4,"Nome Font:"),e(),m(5,"input",81),e(),n(6,"div",23)(7,"label",24),i(8,"Priorit\xE0:"),e(),m(9,"input",77),e(),n(10,"div",23)(11,"button",82),v("click",function(){let c=u(t).index,d=s(3);return f(d.removeFont(c))}),n(12,"span",19),i(13,"delete"),e()()()()()}if(a&2){let t=o.index;p("formGroupName",t)}}function _e(a,o){if(a&1){let t=b();n(0,"div",33)(1,"div",2)(2,"h4",6)(3,"span",19),i(4,"share"),e(),i(5," Social Media "),e(),n(6,"div",22)(7,"div",23)(8,"label",24),i(9,"Tipo Profilo:"),e(),m(10,"input",34),e(),n(11,"div",23)(12,"label",24),i(13,"Piattaforma:"),e(),m(14,"input",35),e(),n(15,"div",36)(16,"label",24),i(17,"Buyer Personas:"),e(),m(18,"textarea",37),e(),n(19,"div",36)(20,"label",24),i(21,"Obiettivi Intervista:"),e(),m(22,"textarea",38),e(),n(23,"div",36)(24,"label",24),i(25,"Strategia Contenuti:"),e(),m(26,"textarea",39),e()()(),n(27,"div",2)(28,"h4",6)(29,"span",19),i(30,"flag"),e(),i(31," Tabella Obiettivi "),e(),n(32,"div",40),h(33,fe,18,1,"div",41),n(34,"button",42),v("click",function(){u(t);let c=s(2);return f(c.addObjective())}),n(35,"span",19),i(36,"add"),e(),i(37," Aggiungi Obiettivo "),e()()(),n(38,"div",2)(39,"h4",6)(40,"span",19),i(41,"palette"),e(),i(42," Servizi Creativi "),e(),n(43,"div",43)(44,"div",23)(45,"label",24),i(46,"Software:"),e(),m(47,"input",44),e(),n(48,"div",23)(49,"label",24),i(50,"Formato File:"),e(),m(51,"input",45),e(),n(52,"div",36)(53,"label",24),i(54,"Percorso Salvataggio:"),e(),m(55,"input",46),e()()(),n(56,"div",2)(57,"h4",6)(58,"span",19),i(59,"aspect_ratio"),e(),i(60," Dimensioni "),e(),n(61,"div",47)(62,"div",23)(63,"label",24),i(64,"Larghezza:"),e(),m(65,"input",48),e(),n(66,"div",23)(67,"label",24),i(68,"Unit\xE0:"),e(),n(69,"select",49)(70,"option",50),i(71,"px"),e(),n(72,"option",51),i(73,"cm"),e(),n(74,"option",52),i(75,"in"),e(),n(76,"option",53),i(77,"%"),e()()(),n(78,"div",23)(79,"label",24),i(80,"Altezza:"),e(),m(81,"input",54),e(),n(82,"div",23)(83,"label",24),i(84,"Unit\xE0:"),e(),n(85,"select",55)(86,"option",50),i(87,"px"),e(),n(88,"option",51),i(89,"cm"),e(),n(90,"option",52),i(91,"in"),e(),n(92,"option",53),i(93,"%"),e()()(),n(94,"div",23)(95,"label",24),i(96,"Risoluzione:"),e(),m(97,"input",56),e(),n(98,"div",23)(99,"label",24),i(100,"Unit\xE0:"),e(),n(101,"select",57)(102,"option",58),i(103,"PPI"),e(),n(104,"option",59),i(105,"DPI"),e()()()()(),n(106,"div",2)(107,"h4",6)(108,"span",19),i(109,"color_lens"),e(),i(110," Colori "),e(),n(111,"div",60),h(112,ve,18,1,"div",61),n(113,"button",42),v("click",function(){u(t);let c=s(2);return f(c.addColor())}),n(114,"span",19),i(115,"add"),e(),i(116," Aggiungi Colore "),e()()(),n(117,"div",2)(118,"h4",6)(119,"span",19),i(120,"record_voice_over"),e(),i(121," Tone of Voice "),e(),n(122,"div",62)(123,"div",36)(124,"label",24),i(125,"Preso dall'intervista:"),e(),m(126,"textarea",63),e(),n(127,"div",23)(128,"label",24),i(129,"Stile:"),e(),m(130,"input",64),e()()(),n(131,"div",2)(132,"h4",6)(133,"span",19),i(134,"text_fields"),e(),i(135," Fonts "),e(),n(136,"div",65),h(137,ge,14,1,"div",66),n(138,"button",42),v("click",function(){u(t);let c=s(2);return f(c.addFont())}),n(139,"span",19),i(140,"add"),e(),i(141," Aggiungi Font "),e()()()()}if(a&2){let t=s(2);l(33),p("ngForOf",t.objectivesArray.controls),l(79),p("ngForOf",t.colorsArray.controls),l(25),p("ngForOf",t.fontsArray.controls)}}function he(a,o){a&1&&(n(0,"div",2)(1,"h4",83),i(2,"Dominio"),e(),n(3,"div",84)(4,"div",23)(5,"label",24),i(6,"Nome Dominio:"),e(),m(7,"input",85),e(),n(8,"div",23)(9,"label",24),i(10,"Username:"),e(),m(11,"input",86),e(),n(12,"div",23)(13,"label",24),i(14,"Password:"),e(),m(15,"input",87),e()(),n(16,"h4",83),i(17,"Hosting"),e(),n(18,"div",88)(19,"div",23)(20,"label",24),i(21,"Provider:"),e(),m(22,"input",89),e(),n(23,"div",23)(24,"label",24),i(25,"Piano:"),e(),m(26,"input",90),e(),n(27,"div",23)(28,"label",24),i(29,"Username:"),e(),m(30,"input",86),e(),n(31,"div",23)(32,"label",24),i(33,"Password:"),e(),m(34,"input",87),e()(),n(35,"h4",83),i(36,"Database"),e(),n(37,"div",91)(38,"div",23)(39,"label",24),i(40,"Tipo Database:"),e(),m(41,"input",92),e(),n(42,"div",23)(43,"label",24),i(44,"Versione:"),e(),m(45,"input",93),e(),n(46,"div",23)(47,"label",24),i(48,"Email:"),e(),m(49,"input",94),e(),n(50,"div",23)(51,"label",24),i(52,"Password:"),e(),m(53,"input",87),e()(),n(54,"h4",83),i(55,"Server"),e(),n(56,"div",95)(57,"div",23)(58,"label",24),i(59,"Tipo Server:"),e(),m(60,"input",92),e(),n(61,"div",23)(62,"label",24),i(63,"Email:"),e(),m(64,"input",94),e(),n(65,"div",23)(66,"label",24),i(67,"Password:"),e(),m(68,"input",87),e()(),n(69,"h4",83),i(70,"Repository"),e(),n(71,"div",96)(72,"div",23)(73,"label",24),i(74,"Sistema di Versionamento:"),e(),m(75,"input",97),e(),n(76,"div",23)(77,"label",24),i(78,"Pubblicato:"),e(),m(79,"input",98),e(),n(80,"div",23)(81,"label",24),i(82,"Data Pubblicazione:"),e(),m(83,"input",99),e(),n(84,"div",23)(85,"label",24),i(86,"Sviluppatore:"),e(),m(87,"input",100),e()()())}function xe(a,o){a&1&&(n(0,"div",33)(1,"div",2)(2,"h4",6)(3,"span",19),i(4,"account_balance"),e(),i(5," Contabilit\xE0 "),e(),n(6,"div",22)(7,"div",23)(8,"label",24),i(9,"Autonomia Cliente (1-5):"),e(),m(10,"input",101),n(11,"div",102),i(12,"Valuta da 1 (bassa) a 5 (alta)"),e()(),n(13,"div",23)(14,"label",24),i(15,"Livello Digitalizzazione (1-5):"),e(),m(16,"input",103),n(17,"div",102),i(18,"Valuta da 1 (basso) a 5 (alto)"),e()(),n(19,"div",23)(20,"label",24),i(21,"Responsabile Interno:"),e(),m(22,"input",104),e(),n(23,"div",23)(24,"label",24),i(25,"Complessit\xE0 Strutturale (1-5):"),e(),m(26,"input",105),n(27,"div",102),i(28,"Valuta da 1 (semplice) a 5 (complessa)"),e()(),n(29,"div",36)(30,"label",24),i(31,"Software Utilizzato:"),e(),m(32,"input",106),e()()()())}function be(a,o){a&1&&(n(0,"div",33)(1,"div",2)(2,"h4",6)(3,"span",19),i(4,"school"),e(),i(5," Formazione "),e(),n(6,"div",107)(7,"div",36)(8,"label",24),i(9,"Obiettivo Formazione:"),e(),m(10,"textarea",108),e(),n(11,"div",23)(12,"label",24),i(13,"Totale Dipendenti:"),e(),m(14,"input",109),e(),n(15,"div",23)(16,"label",24),i(17,"Dipendenti da Formare:"),e(),m(18,"input",110),e(),n(19,"div",23)(20,"label",24),i(21,"Ore Totali:"),e(),m(22,"input",111),e(),n(23,"div",23)(24,"label",24),i(25,"Ore Rimanenti:"),e(),m(26,"input",112),e(),n(27,"div",23)(28,"label",24),i(29,"Responsabile:"),e(),m(30,"input",104),e()()()())}function Ee(a,o){if(a&1){let t=b();n(0,"div",17)(1,"div",18)(2,"h3",6)(3,"span",19),i(4),e(),i(5),e(),n(6,"button",20),v("click",function(){u(t);let c=s();return f(c.cancelEdit())}),e()(),n(7,"form",21),v("ngSubmit",function(){u(t);let c=s();return f(c.onSave())}),n(8,"div",2)(9,"h4",6)(10,"span",19),i(11,"info"),e(),i(12," Informazioni Base "),e(),n(13,"div",22)(14,"div",23)(15,"label",24)(16,"span",19),i(17,"badge"),e(),i(18," Numero Progetto* "),e(),m(19,"input",25),e(),n(20,"div",23)(21,"label",24)(22,"span",19),i(23,"title"),e(),i(24," Nome Progetto* "),e(),m(25,"input",26),e()()(),h(26,_e,142,3,"div",27)(27,he,88,0,"div",28)(28,xe,33,0,"div",27)(29,be,31,0,"div",27),n(30,"div",29)(31,"div",30)(32,"button",31),v("click",function(){u(t);let c=s();return f(c.cancelEdit())}),n(33,"span",19),i(34,"cancel"),e(),i(35," Annulla "),e(),n(36,"button",32)(37,"span",19),i(38),e(),i(39),e()()()()()}if(a&2){let t=s();l(4),I(t.currentInfo?"edit":"add"),l(),z(" ",t.currentInfo?"Modifica":"Nuova"," Informazione Tecnica - ",t.getModuleName(t.currentEditingModule)," "),l(2),p("formGroup",t.technicalForm),l(19),p("ngIf",t.currentEditingModule==="immagine"),l(),p("ngIf",t.currentEditingModule==="digital"),l(),p("ngIf",t.currentEditingModule==="accounting"),l(),p("ngIf",t.currentEditingModule==="optimization"),l(7),p("disabled",!t.technicalForm.valid),l(2),I(t.currentInfo?"save":"add"),l(),g(" ",t.currentInfo?"Aggiorna":"Salva"," ")}}function ye(a,o){a&1&&(n(0,"p",119),i(1,"Nessuna configurazione trovata per questo cliente."),e())}function Se(a,o){a&1&&(n(0,"p",119),i(1," Nessun modulo attivo per questo cliente nella configurazione Promethea. "),e())}function Ie(a,o){if(a&1&&(n(0,"div",116)(1,"div",117),i(2,"\u{1F4CA}"),e(),h(3,ye,2,0,"p",118)(4,Se,2,0,"p",118),e()),a&2){let t=s(2);l(3),p("ngIf",!t.clienteConfig),l(),p("ngIf",t.clienteConfig&&t.modules.length===0)}}function Ce(a,o){if(a&1){let t=b();n(0,"div",116)(1,"div",117),i(2,"\u{1F4DD}"),e(),n(3,"p",119),i(4,"Nessuna informazione tecnica disponibile per questo modulo."),e(),n(5,"button",124),v("click",function(){u(t);let c=s().$implicit,d=s(2);return f(d.addNew(c))}),n(6,"span",19),i(7,"add"),e(),i(8," Crea la prima informazione "),e()()}}function ze(a,o){if(a&1&&(n(0,"div",136),i(1),e()),a&2){let t=s(2).$implicit;l(),I(t.profileType)}}function Te(a,o){if(a&1&&(n(0,"div",136),i(1),e()),a&2){let t=s(2).$implicit;l(),I(t.platform)}}function Fe(a,o){if(a&1&&(n(0,"p",119),i(1),N(2,"truncate"),e()),a&2){let t=s(2).$implicit;l(),I(w(2,1,t.buyerPersonas,100))}}function Ne(a,o){if(a&1&&(n(0,"div",134),h(1,ze,2,1,"div",135)(2,Te,2,1,"div",135)(3,Fe,3,4,"p",118),e()),a&2){let t=s().$implicit;l(),p("ngIf",t.profileType),l(),p("ngIf",t.platform),l(),p("ngIf",t.buyerPersonas)}}function we(a,o){if(a&1&&(n(0,"div",136),i(1),e()),a&2){let t=s(2).$implicit;l(),g("Dominio: ",t.domain.name)}}function Pe(a,o){if(a&1&&(n(0,"div",136),i(1),e()),a&2){let t=s(2).$implicit;l(),g("Hosting: ",t.hosting.provider)}}function Me(a,o){if(a&1&&(n(0,"div",136),i(1),e()),a&2){let t=s(2).$implicit;l(),g("DB: ",t.database.type)}}function Oe(a,o){if(a&1&&(n(0,"div",134),h(1,we,2,1,"div",135)(2,Pe,2,1,"div",135)(3,Me,2,1,"div",135),e()),a&2){let t=s().$implicit;l(),p("ngIf",t.domain==null?null:t.domain.name),l(),p("ngIf",t.hosting==null?null:t.hosting.provider),l(),p("ngIf",t.database==null?null:t.database.type)}}function Ae(a,o){if(a&1&&(n(0,"div",134)(1,"div",137)(2,"label"),i(3),e(),n(4,"div",138),m(5,"div",139),e()(),n(6,"div",137)(7,"label"),i(8),e(),n(9,"div",138),m(10,"div",139),e()(),n(11,"p")(12,"strong"),i(13,"Responsabile:"),e(),i(14),e(),n(15,"p")(16,"strong"),i(17,"Software:"),e(),i(18),e()()),a&2){let t=s().$implicit;l(3),g("Autonomia: ",t.clientAutonomy,"/5"),l(2),F("width",t.clientAutonomy/5*100+"%"),l(3),g("Digitalizzazione: ",t.digitalizationLevel,"/5"),l(2),F("width",t.digitalizationLevel/5*100+"%"),l(4),g(" ",t.internalManager),l(4),g(" ",t.softwareUsed)}}function ke(a,o){if(a&1&&(n(0,"div",134)(1,"p")(2,"strong"),i(3,"Obiettivo:"),e(),i(4),e(),n(5,"div",140)(6,"div",141)(7,"div",142),i(8),e(),n(9,"div",143),i(10,"Dipendenti"),e()(),n(11,"div",141)(12,"div",142),i(13),e(),n(14,"div",143),i(15,"Ore"),e()()()()),a&2){let t=s().$implicit;l(4),g(" ",t.training.objective),l(4),z("",t.training.employeesToTrain,"/",t.training.totalEmployees),l(5),z("",t.training.remainingHours,"/",t.training.totalHours)}}function Ve(a,o){if(a&1){let t=b();n(0,"div",125),v("click",function(){let c=u(t),d=c.$implicit,_=c.index,x=s().$implicit,T=s(2);return f(T.editInfo(d,_,x))}),n(1,"div",126)(2,"h4",83),i(3),e(),n(4,"div",127)(5,"button",128),v("click",function(c){let d=u(t),_=d.$implicit,x=d.index,T=s().$implicit,de=s(2);return c.stopPropagation(),f(de.editInfo(_,x,T))}),n(6,"span",19),i(7,"edit"),e()(),n(8,"button",129),v("click",function(c){let d=u(t).$implicit,_=s().$implicit,x=s(2);return c.stopPropagation(),f(x.onDelete(d.id,_))}),n(9,"span",19),i(10,"delete"),e()()()(),n(11,"div",130)(12,"p")(13,"strong"),i(14,"Progetto:"),e(),i(15),e(),n(16,"div",131),h(17,Ne,4,3,"div",132)(18,Oe,4,3,"div",132)(19,Ae,19,8,"div",132)(20,ke,16,5,"div",132),e()(),n(21,"div",133)(22,"small",119)(23,"span",19),i(24,"update"),e(),i(25),N(26,"date"),e()()()}if(a&2){let t=o.$implicit,r=s().$implicit;l(3),g(" ",t.projectName||"Informazione Tecnica"," "),l(12),z(" ",t.projectNumber," - ",t.projectName),l(2),p("ngIf",r==="immagine"),l(),p("ngIf",r==="digital"),l(),p("ngIf",r==="accounting"),l(),p("ngIf",r==="optimization"&&t.training),l(5),g(" Aggiornato il: ",w(26,8,t.updated_at,"dd/MM/yyyy")," ")}}function je(a,o){if(a&1){let t=b();n(0,"div",120)(1,"div",3)(2,"h3",6)(3,"span",19),i(4),e(),i(5),e(),n(6,"button",121),v("click",function(){let c=u(t).$implicit,d=s(2);return f(d.addNew(c))}),n(7,"span",19),i(8,"add"),e(),i(9," Nuova Informazione "),e()(),n(10,"div",122),h(11,Ce,9,0,"div",114)(12,Ve,27,11,"div",123),e()()}if(a&2){let t=o.$implicit,r=s(2);l(4),I(r.getModuleIcon(t)),l(),g(" ",r.getModuleName(t)," "),l(),p("disabled",r.showForm),l(5),p("ngIf",r.getTechnicalInfoByModule(t).length===0),l(),p("ngForOf",r.getTechnicalInfoByModule(t))}}function De(a,o){if(a&1&&(n(0,"div",113),h(1,Ie,5,2,"div",114)(2,je,13,5,"div",115),e()),a&2){let t=s();l(),p("ngIf",t.modules.length===0),l(),p("ngForOf",t.modules)}}var M=class a{transform(o,t=100){return o?o.length>t?o.substring(0,t)+"...":o:""}static \u0275fac=function(t){return new(t||a)};static \u0275pipe=A({name:"truncate",type:a,pure:!0})},ce=class a{constructor(o,t,r,c,d){this.fb=o;this.route=t;this.supabaseService=r;this.authService=c;this.userService=d;this.technicalForm=this.createForm("immagine")}modules=[];isAdmin=!1;clienteId=null;currentEditingModule=null;clienteConfig=null;currentModule=null;technicalInfo={};loading=!1;error="";editingIndex=-1;showForm=!1;currentInfo=null;technicalForm;ngOnInit(){return S(this,null,function*(){this.route.queryParams.subscribe(o=>S(this,null,function*(){this.clienteId=o.clienteId||null,console.log("Cliente ID:",this.clienteId),yield this.loadUserData(),yield this.loadTechnicalInformation()}))})}extractModulesFromConfig(){if(!this.clienteConfig||typeof this.clienteConfig!="object")return[];let o={immagine_marketing:"immagine",digitalizzazione_automatismi:"digital",contabilita_fiscalita:"accounting",ottimizzazione_management:"optimization"},t=[];return Object.entries(o).forEach(([r,c])=>{let d=this.clienteConfig[r];if(!d||typeof d!="object")return;let _=Number(d.totale??d.totale_modulo??0),x=Array.isArray(d.servizi_selezionati)?d.servizi_selezionati:Array.isArray(d.servizi)?d.servizi:[];(Number.isFinite(_)&&_>0||x.length>0)&&t.push(c)}),t}loadUserData(){return S(this,null,function*(){try{let o=this.authService.user();if(!o){this.error="Utente non autenticato";return}this.isAdmin=yield this.userService.isAdmin();let t=[];if(this.isAdmin?t=["immagine","digital","accounting","optimization"]:t=(yield this.supabaseService.getAppUserById(o.id)).data?.moduli||[],this.clienteId){let d=yield this.supabaseService.getConfigurazioniPromethea(this.clienteId);d?.data&&d.data.length>0?this.clienteConfig=d.data[0].dettagli:this.clienteConfig=null}let r={immagine_marketing:"immagine",digitalizzazione_automatismi:"digital",contabilita_fiscalita:"accounting",ottimizzazione_management:"optimization"},c=this.extractModulesFromConfig();this.isAdmin?this.modules=c.length?c:t:this.modules=c.length?t.filter(d=>c.includes(d)):t,this.modules.forEach(d=>{this.technicalInfo[d]=[]}),this.clienteConfig&&typeof this.clienteConfig=="object"&&Object.keys(this.clienteConfig).forEach(d=>{let _=this.clienteConfig[d];if(_&&_.totale_modulo>0&&Array.isArray(_.servizi_selezionati)&&_.servizi_selezionati.length>0){let x=r[d];x&&c.push(x)}}),this.isAdmin?this.modules=c.length>0?c:t:c.length>0?this.modules=t.filter(d=>c.includes(d)):this.modules=t,this.modules.forEach(d=>{this.technicalInfo[d]=[]})}catch(o){console.error("Errore caricamento dati utente:",o),this.error="Errore nel caricamento dei dati utente"}})}filterModulesByConfig(o){return this.clienteConfig?o.filter(t=>{let r=this.getConfigKeyForModule(t);if(!r)return!0;let c=this.clienteConfig[r];return c&&c.totale_modulo>0&&c.servizi_selezionati.length>0}):o}getConfigKeyForModule(o){return{immagine:"immagine_marketing",accounting:"contabilita_fiscalita",optimization:"ottimizzazione_management",digital:"digitalizzazione_automatismi"}[o]||null}loadTechnicalInformation(){return S(this,null,function*(){if(!this.clienteId){this.error="Nessun cliente selezionato";return}this.loading=!0,this.error="";try{for(let o of this.modules){let t=yield this.supabaseService.getInformazioniTecniche(this.clienteId,o);t.data?this.technicalInfo[o]=t.data.map(r=>y(E({id:r.id},r.dati),{created_at:r.created_at,updated_at:r.updated_at})):this.technicalInfo[o]=[]}}catch(o){console.error("Errore caricamento informazioni tecniche:",o),this.error="Errore nel caricamento delle informazioni tecniche"}finally{this.loading=!1}})}createForm(o){let t=this.fb.group({projectNumber:["",P.required],projectName:["",P.required],module:[o]});switch(o){case"immagine":return this.fb.group(y(E({},t.controls),{profileType:[""],buyerPersonas:[""],interviewObjectives:[""],platform:[""],contentStrategy:[""],objectivesTable:this.fb.array([]),graphicInfo:this.fb.group({projectName:[""],software:[""],fileFormat:[""],savePath:[""]}),dimensions:this.fb.group({width:[0],height:[0],resolution:[0],widthUnit:["px"],heightUnit:["px"],resolutionUnit:["ppi"]}),usage:["digital"],elementType:["static"],colors:this.fb.array([]),toneOfVoice:this.fb.group({fromInterview:[""],style:[""]}),fonts:this.fb.array([])}));case"digital":return this.fb.group(y(E({},t.controls),{domain:this.fb.group({name:[""],username:[""],password:[""]}),hosting:this.fb.group({provider:[""],username:[""],password:[""],plan:[""]}),database:this.fb.group({type:[""],email:[""],password:[""],version:[""]}),server:this.fb.group({type:[""],email:[""],password:[""]}),repository:this.fb.group({sistema_versionamento:[""],pubblicato:[!1],data_pubblicazione:[""],sviluppatore:[""]})}));case"accounting":return this.fb.group(y(E({},t.controls),{clientAutonomy:[0],digitalizationLevel:[0],internalManager:[""],structuralComplexity:[0],softwareUsed:[""],deadlines:this.fb.array([]),sectorInfo:this.fb.array([])}));case"optimization":return this.fb.group(y(E({},t.controls),{training:this.fb.group({objective:[""],totalEmployees:[0],employeesToTrain:[0],totalHours:[0],remainingHours:[0],internalManager:[""]}),financial:this.fb.group({currentRatio:this.createFinancialMetric(),debtToEquity:this.createFinancialMetric(),roe:this.createFinancialMetric(),revenueGrowth:this.createFinancialMetric()})}));default:return t}}createFinancialMetric(){return this.fb.group({value:[0],calculation:this.fb.group({numerator:[0],denominator:[0]})})}getModuleName(o){return{immagine:"Immagine e Marketing",digital:"Digitalizzazione",accounting:"Contabilit\xE0",optimization:"Ottimizzazione"}[o]||o}addNew(o){this.currentEditingModule=o,this.editingIndex=-1,this.currentInfo=null,this.technicalForm=this.createForm(o),this.showForm=!0}editInfo(o,t,r){this.currentEditingModule=r,this.editingIndex=t,this.currentInfo=o,this.technicalForm=this.createForm(r),this.patchFormValue(o),this.showForm=!0}patchFormValue(o){if(this.technicalForm.patchValue(o),o.colors&&this.technicalForm.get("colors")){let t=this.technicalForm.get("colors");t.clear(),o.colors.forEach(r=>{t.push(this.fb.group({name:[r.name],code:[r.code],priority:[r.priority]}))})}if(o.fonts&&this.technicalForm.get("fonts")){let t=this.technicalForm.get("fonts");t.clear(),o.fonts.forEach(r=>{t.push(this.fb.group({name:[r.name],priority:[r.priority]}))})}if(o.objectivesTable&&this.technicalForm.get("objectivesTable")){let t=this.technicalForm.get("objectivesTable");t.clear(),o.objectivesTable.forEach(r=>{t.push(this.fb.group({objective:[r.objective],target:[r.target],deadline:[r.deadline]}))})}if(o.deadlines&&this.technicalForm.get("deadlines")){let t=this.technicalForm.get("deadlines");t.clear(),o.deadlines.forEach(r=>{t.push(this.fb.group({name:[r.name],scadenza:[r.scadenza],tipologia:[r.tipologia],importo:[r.importo]}))})}if(o.sectorInfo&&this.technicalForm.get("sectorInfo")){let t=this.technicalForm.get("sectorInfo");t.clear(),o.sectorInfo.forEach(r=>{t.push(this.fb.group({nome:[r.nome],descrizione:[r.descrizione],categorie:[r.categorie]}))})}}onSave(){return S(this,null,function*(){if(this.technicalForm.valid&&this.currentEditingModule&&this.clienteId)try{let o=y(E({},this.technicalForm.value),{updatedAt:new Date,createdAt:this.currentInfo?.createdAt||new Date}),t={cliente_id:this.clienteId,modulo:this.currentEditingModule,dati:o};this.currentInfo?.id&&(t.id=this.currentInfo.id);let r=yield this.supabaseService.upsertInformazioniTecniche(t);if(r.error){console.error("Errore salvataggio:",r.error),this.error="Errore durante il salvataggio";return}let c=y(E({id:r.data.id},o),{created_at:r.data.created_at,updated_at:r.data.updated_at});this.currentInfo?.id?this.technicalInfo[this.currentEditingModule][this.editingIndex]=c:this.technicalInfo[this.currentEditingModule].push(c),this.cancelEdit(),console.log("Dati salvati con successo:",c)}catch(o){console.error("Errore durante il salvataggio:",o),this.error="Errore durante il salvataggio"}else console.log("Form non valido o dati mancanti")})}onDelete(o,t){return S(this,null,function*(){if(confirm("Sei sicuro di voler eliminare queste informazioni?"))try{let r=yield this.supabaseService.deleteInformazioniTecniche(o);if(r.error){console.error("Errore eliminazione:",r.error),this.error="Errore durante l'eliminazione";return}this.technicalInfo[t]=this.technicalInfo[t].filter(c=>c.id!==o)}catch(r){console.error("Errore durante l'eliminazione:",r),this.error="Errore durante l'eliminazione"}})}cancelEdit(){this.showForm=!1,this.editingIndex=-1,this.currentInfo=null,this.currentEditingModule=null,this.technicalForm=this.createForm("immagine")}getTechnicalInfoByModule(o){return this.technicalInfo[o]||[]}addColor(){this.technicalForm.get("colors").push(this.fb.group({name:[""],code:[""],priority:[1]}))}removeColor(o){this.technicalForm.get("colors").removeAt(o)}get colorsArray(){return this.technicalForm.get("colors")}addFont(){this.technicalForm.get("fonts").push(this.fb.group({name:[""],priority:[1]}))}removeFont(o){this.technicalForm.get("fonts").removeAt(o)}get fontsArray(){return this.technicalForm.get("fonts")}addObjective(){this.technicalForm.get("objectivesTable").push(this.fb.group({objective:[""],target:[""],deadline:[""]}))}removeObjective(o){this.technicalForm.get("objectivesTable").removeAt(o)}get objectivesArray(){return this.technicalForm.get("objectivesTable")}calculateCurrentRatio(){let o=this.technicalForm.get("financial.currentRatio.calculation.numerator")?.value||0,t=this.technicalForm.get("financial.currentRatio.calculation.denominator")?.value||1,r=o/t;this.technicalForm.get("financial.currentRatio.value")?.setValue(r)}calculateROE(){let o=this.technicalForm.get("financial.roe.calculation.numerator")?.value||0,t=this.technicalForm.get("financial.roe.calculation.denominator")?.value||1,r=o/t*100;this.technicalForm.get("financial.roe.value")?.setValue(r)}getModuleIcon(o){return{immagine:"image",digital:"computer",accounting:"calculate",optimization:"tune"}[o]||"folder"}static \u0275fac=function(t){return new(t||a)(C(ae),C(G),C(U),C($),C(B))};static \u0275cmp=O({type:a,selectors:[["app-informazioni-tecniche"]],decls:18,vars:6,consts:[["title","Caricamento informazioni tecniche...","subtitle","Stiamo caricando le informazioni tecniche...",3,"isLoading"],[1,"technical-info-container"],[1,"form-section"],[1,"section-header"],[1,"material-icons","header-icon"],[1,"section-titles"],[1,"section-title"],[1,"sottotitolo"],[1,"actions",2,"align-items","flex-start"],["class","badge badge-info",4,"ngIf"],["class","badge badge-warning",4,"ngIf"],["class","status-message error",4,"ngIf"],["class","form-container",4,"ngIf"],["class","modules-container",4,"ngIf"],[1,"badge","badge-info"],[1,"badge","badge-warning"],[1,"status-message","error"],[1,"form-container"],[1,"form-header","section-header"],[1,"material-icons"],[1,"icon-btn","close",3,"click"],[1,"form-vertical",3,"ngSubmit","formGroup"],[1,"grid-form"],[1,"form-field"],[1,"form-label"],["type","text","formControlName","projectNumber","required","",1,"form-control"],["type","text","formControlName","projectName","required","",1,"form-control"],["class","form-module-content",4,"ngIf"],["class","form-section",4,"ngIf"],[1,"form-actions"],[1,"actions-container"],["type","button",1,"promethea-button","ghost",3,"click"],["type","submit",1,"promethea-button",3,"disabled"],[1,"form-module-content"],["type","text","formControlName","profileType","placeholder","Es: Business, Personale...",1,"form-control"],["type","text","formControlName","platform","placeholder","Es: Instagram, Facebook...",1,"form-control"],[1,"form-field","form-field-col-span"],["formControlName","buyerPersonas","rows","3","placeholder","Descrivi le buyer personas...",1,"form-control"],["formControlName","interviewObjectives","rows","3","placeholder","Obiettivi dell'intervista...",1,"form-control"],["formControlName","contentStrategy","rows","3","placeholder","Strategia dei contenuti...",1,"form-control"],["formArrayName","objectivesTable",1,"objectives-container"],["class","objective-row",3,"formGroupName",4,"ngFor","ngForOf"],["type","button",1,"promethea-button","secondary",3,"click"],["formGroupName","graphicInfo",1,"grid-form"],["type","text","formControlName","software","placeholder","Es: Photoshop, Illustrator...",1,"form-control"],["type","text","formControlName","fileFormat","placeholder","Es: JPG, PNG, PDF...",1,"form-control"],["type","text","formControlName","savePath","placeholder","Percorso di salvataggio file...",1,"form-control"],["formGroupName","dimensions",1,"grid-form"],["type","number","formControlName","width","placeholder","0",1,"form-control"],["formControlName","widthUnit",1,"form-control"],["value","px"],["value","cm"],["value","in"],["value","%"],["type","number","formControlName","height","placeholder","0",1,"form-control"],["formControlName","heightUnit",1,"form-control"],["type","number","formControlName","resolution","placeholder","0",1,"form-control"],["formControlName","resolutionUnit",1,"form-control"],["value","ppi"],["value","dpi"],["formArrayName","colors",1,"colors-container"],["class","color-row",3,"formGroupName",4,"ngFor","ngForOf"],["formGroupName","toneOfVoice",1,"grid-form"],["formControlName","fromInterview","rows","2","placeholder","Note dall'intervista...",1,"form-control"],["type","text","formControlName","style","placeholder","Es: Formale, Informale...",1,"form-control"],["formArrayName","fonts",1,"fonts-container"],["class","font-row",3,"formGroupName",4,"ngFor","ngForOf"],[1,"objective-row",3,"formGroupName"],[1,"objective-fields"],["type","text","formControlName","objective","placeholder","Descrizione obiettivo",1,"form-control"],["type","text","formControlName","target","placeholder","Target specifico",1,"form-control"],["type","date","formControlName","deadline",1,"form-control"],["type","button","title","Rimuovi obiettivo",1,"action-btn","delete",3,"click"],[1,"color-row",3,"formGroupName"],[1,"color-fields"],["type","text","formControlName","name","placeholder","Nome colore",1,"form-control"],["type","text","formControlName","code","placeholder","#HEX o RGB",1,"form-control"],["type","number","formControlName","priority","min","1","max","10","placeholder","1-10",1,"form-control"],["type","button","title","Rimuovi colore",1,"action-btn","delete",3,"click"],[1,"font-row",3,"formGroupName"],[1,"font-fields"],["type","text","formControlName","name","placeholder","Nome del font",1,"form-control"],["type","button","title","Rimuovi font",1,"action-btn","delete",3,"click"],[1,"card-title"],["formGroupName","domain",1,"grid-form"],["type","text","formControlName","name",1,"form-control"],["type","text","formControlName","username",1,"form-control"],["type","password","formControlName","password",1,"form-control"],["formGroupName","hosting",1,"grid-form"],["type","text","formControlName","provider",1,"form-control"],["type","text","formControlName","plan",1,"form-control"],["formGroupName","database",1,"grid-form"],["type","text","formControlName","type",1,"form-control"],["type","text","formControlName","version",1,"form-control"],["type","email","formControlName","email",1,"form-control"],["formGroupName","server",1,"grid-form"],["formGroupName","repository",1,"grid-form"],["type","text","formControlName","sistema_versionamento",1,"form-control"],["type","checkbox","formControlName","pubblicato",1,"form-check"],["type","date","formControlName","data_pubblicazione",1,"form-control"],["type","text","formControlName","sviluppatore",1,"form-control"],["type","number","formControlName","clientAutonomy","min","1","max","5",1,"form-control"],[1,"hint"],["type","number","formControlName","digitalizationLevel","min","1","max","5",1,"form-control"],["type","text","formControlName","internalManager","placeholder","Nome responsabile",1,"form-control"],["type","number","formControlName","structuralComplexity","min","1","max","5",1,"form-control"],["type","text","formControlName","softwareUsed","placeholder","Software contabilit\xE0",1,"form-control"],["formGroupName","training",1,"grid-form"],["formControlName","objective","rows","3","placeholder","Obiettivi formativi...",1,"form-control"],["type","number","formControlName","totalEmployees","placeholder","0",1,"form-control"],["type","number","formControlName","employeesToTrain","placeholder","0",1,"form-control"],["type","number","formControlName","totalHours","placeholder","0",1,"form-control"],["type","number","formControlName","remainingHours","placeholder","0",1,"form-control"],[1,"modules-container"],["class","empty-state",4,"ngIf"],["class","module-section",4,"ngFor","ngForOf"],[1,"empty-state"],[1,"empty-icon"],["class","text-muted",4,"ngIf"],[1,"text-muted"],[1,"module-section"],[1,"promethea-button",3,"click","disabled"],[1,"grid-cards"],["class","card clickable",3,"click",4,"ngFor","ngForOf"],[1,"promethea-button",3,"click"],[1,"card","clickable",3,"click"],[1,"card-header"],[1,"table-actions"],["title","Modifica",1,"action-btn","edit",3,"click"],["title","Elimina",1,"action-btn","delete",3,"click"],[1,"card-content"],[1,"module-specific-content"],["class","grid-responsive",4,"ngIf"],[1,"card-footer"],[1,"grid-responsive"],["class","chip",4,"ngIf"],[1,"chip"],[1,"progress-container"],[1,"progress"],[1,"progress-bar"],[1,"stats-container"],[1,"stat-card"],[1,"stat-value"],[1,"stat-label"]],template:function(t,r){t&1&&(m(0,"app-page-loader",0),n(1,"div")(2,"div",1)(3,"div",2)(4,"div",3)(5,"i",4),i(6,"settings"),e(),n(7,"div",5)(8,"h2",6),i(9,"Informazioni Tecniche"),e(),n(10,"p",7),i(11,"Dati tecnici e configurazioni per il cliente"),e(),n(12,"div",8),h(13,se,2,1,"span",9)(14,pe,2,0,"span",10),e()()()(),h(15,ue,2,1,"div",11)(16,Ee,40,11,"div",12)(17,De,3,2,"div",13),e()()),t&2&&(p("isLoading",r.loading),l(13),p("ngIf",r.clienteId),l(),p("ngIf",r.isAdmin),l(),p("ngIf",r.error),l(),p("ngIf",r.showForm),l(),p("ngIf",!r.loading&&!r.showForm))},dependencies:[D,k,V,le,Y,te,ie,L,J,q,ee,H,K,re,oe,ne,X,Z,Q,W,R,me,j,M],styles:['.technical-info-container[_ngcontent-%COMP%]{container-type:inline-size}.modules-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-xl);margin-top:var(--gutter-lg)}.module-section[_ngcontent-%COMP%]{container-type:inline-size;padding:var(--gutter-md);border-radius:12px;border:1px solid var(--smoke-color-1)}.form-vertical[_ngcontent-%COMP%], .form-module-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-lg)}.form-container[_ngcontent-%COMP%]{background:var(--background);border:1px solid var(--smoke-color-1);border-radius:16px;padding:var(--gutter-lg);margin-bottom:var(--gutter-xl);box-shadow:0 4px 12px var(--shadow);animation:slideIn .3s ease-out;container-type:inline-size}.form-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--gutter-lg);border-bottom:1px solid var(--smoke-color-1);padding-bottom:var(--gutter-md);gap:var(--gutter-sm)}.form-section[_ngcontent-%COMP%]{border:1px solid var(--smoke-color-1);border-radius:12px;padding:var(--gutter-lg);background:var(--background);transition:all .3s ease}.form-section[_ngcontent-%COMP%]:hover{border-color:var(--primary);box-shadow:0 2px 8px var(--shadow)}.objectives-container[_ngcontent-%COMP%], .colors-container[_ngcontent-%COMP%], .fonts-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-md)}.objective-row[_ngcontent-%COMP%], .color-row[_ngcontent-%COMP%], .font-row[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--background) 95%,var(--primary));border:1px solid var(--smoke-color-1);border-radius:8px;padding:var(--gutter-md);transition:all .2s ease}.objective-row[_ngcontent-%COMP%]:hover, .color-row[_ngcontent-%COMP%]:hover, .font-row[_ngcontent-%COMP%]:hover{border-color:var(--primary);background:color-mix(in srgb,var(--background) 92%,var(--primary))}.objective-fields[_ngcontent-%COMP%], .color-fields[_ngcontent-%COMP%], .font-fields[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1fr auto;gap:var(--gutter-md);align-items:start}.form-actions[_ngcontent-%COMP%]{margin-top:var(--gutter-xl);padding-top:var(--gutter-lg);border-top:1px solid var(--smoke-color-1)}.module-specific-content[_ngcontent-%COMP%]{margin-top:var(--gutter-sm)}.progress-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.progress-container[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:var(--fs-sm);font-weight:600;color:var(--text-color)}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:var(--gutter-xl);text-align:center;gap:var(--gutter-md)}.empty-icon[_ngcontent-%COMP%]{font-size:3rem;opacity:.5}.stats-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:var(--gutter-sm);margin-top:var(--gutter-sm)}.stat-card[_ngcontent-%COMP%]{background:var(--smoke-color-2);border-radius:12px;padding:var(--gutter-sm);text-align:center;border:1px solid var(--smoke-color-1)}.stat-value[_ngcontent-%COMP%]{font-size:var(--fs-md);font-weight:700;color:var(--primary);line-height:1}.stat-label[_ngcontent-%COMP%]{font-size:var(--fs-sm);color:var(--text-color);opacity:.7;margin-top:.25rem}@container (max-width: 768px){.form-container[_ngcontent-%COMP%]{padding:var(--gutter-md);margin-bottom:var(--gutter-lg)}.form-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:var(--gutter-sm)}.form-section[_ngcontent-%COMP%]{padding:var(--gutter-md)}.objective-fields[_ngcontent-%COMP%], .color-fields[_ngcontent-%COMP%], .font-fields[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:var(--gutter-sm)}.stats-container[_ngcontent-%COMP%]{grid-template-columns:1fr}.section-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:var(--gutter-sm)}.grid-form[_ngcontent-%COMP%]{grid-template-columns:1fr!important}}.form-container[_ngcontent-%COMP%]{scroll-margin-top:var(--gutter-lg)}.hint[_ngcontent-%COMP%]{font-size:.8rem;color:color-mix(in srgb,var(--text-color) 60%,transparent);margin-top:.25rem;font-style:italic}.form-label[required][_ngcontent-%COMP%]:after{content:" *";color:#ef4444}.form-section[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideInUp .4s ease-out}@keyframes _ngcontent-%COMP%_slideInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}']})};export{ce as InformazioniTecniche,M as TruncatePipe};
