import{h as m}from"./chunk-HZQUGBKA.js";import{b as p}from"./chunk-7K4EWSAC.js";import{N as v,S as l}from"./chunk-QBO2HR3F.js";import{a as c,b as u,i}from"./chunk-ODN5LVDJ.js";var I=class o{supabaseService=l(p);getInterviste(){return i(this,null,function*(){return this.supabaseService.select("interviste","*",{},{column:"modulo",ascending:!0})})}getIntervistaById(e){return i(this,null,function*(){return this.supabaseService.select("interviste","*",{id:e},void 0,void 0,!0)})}getIntervisteByModulo(e){return i(this,null,function*(){return this.supabaseService.select("interviste","*",{modulo:e},{column:"nome",ascending:!0})})}createIntervista(e){return i(this,null,function*(){return this.supabaseService.insert("interviste",e)})}updateIntervista(e,t){return i(this,null,function*(){return this.supabaseService.update("interviste",e,t)})}deleteIntervista(e){return i(this,null,function*(){return this.supabaseService.delete("interviste",e)})}getRisposteByCliente(e){return i(this,null,function*(){return this.supabaseService.select("risposte_interviste","*",{cliente_id:e})})}getRispostaByClienteEIntervista(e,t){return i(this,null,function*(){return this.supabaseService.select("risposte_interviste","*",{cliente_id:e,intervista_id:t},void 0,void 0,!0)})}saveRisposta(e){return i(this,null,function*(){let{data:t,error:a}=yield this.supabaseService.supabase.from("risposte_interviste").upsert(u(c({},e),{updated_at:new Date().toISOString()})).select().single();return{data:t,error:a}})}markAsCompleted(e,t){return i(this,null,function*(){let{data:a,error:r}=yield this.supabaseService.supabase.from("risposte_interviste").update({completed:!0,updated_at:new Date().toISOString()}).eq("cliente_id",e).eq("intervista_id",t).select().single();return{data:a,error:r}})}inizializzaIntervisteDefault(){return i(this,null,function*(){let{data:e}=yield this.getInterviste();if(!(e&&e.length>0)){console.log("\u{1F504} Inizializzazione interviste nel database...");for(let t of m)try{let a={nome:t.name??t.nome??"Intervista",modulo:t.module??t.modulo??"Generale",domande:(t.questions??t.domande??[]).map(s=>({id:s.id??s.key??void 0,testo:s.text??s.testo??"",tipo:s.type??s.tipo??"text",obbligatoria:!!(s.required??s.obbligatoria),ordine:Number(s.order??s.ordine??0),max_caratteri:s.maxCharacters??s.max_caratteri,opzioni:s.options??s.opzioni}))},r=yield this.createIntervista(a);r.error?console.error("\u274C Errore creazione intervista:",a.nome,r.error):console.log("\u2705 Intervista creata:",a.nome)}catch(a){console.error("\u274C Errore durante creazione intervista:",t?.name??t?.nome,a)}}})}getIntervisteCompletateByCliente(e){return i(this,null,function*(){let{data:t}=yield this.supabaseService.select("risposte_interviste","intervista_id",{cliente_id:e,completed:!0});return t?.map(a=>a.intervista_id)||[]})}getProgressoIntervista(e,t){return i(this,null,function*(){let{data:a}=yield this.getRispostaByClienteEIntervista(e,t),{data:r}=yield this.getIntervistaById(t);if(!a||!r)return 0;let s=r.domande.filter(d=>d.obbligatoria),g=s.filter(d=>{let n=a.risposte[d.id];return n!=null&&n!==""&&(!Array.isArray(n)||n.length>0)});return s.length>0?Math.round(g.length/s.length*100):0})}static \u0275fac=function(t){return new(t||o)};static \u0275prov=v({token:o,factory:o.\u0275fac,providedIn:"root"})};export{I as a};
