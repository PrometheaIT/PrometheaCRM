import{b as B,c as M,d as q,e as H,g as L,h as K,j as Y,k as J,l as X,m as Q,n as W,o as Z,p as ee,q as te,r as ie,s as ne,t as oe,v as re}from"./chunk-RJG6IVUB.js";import{a as ae}from"./chunk-KESXA3II.js";import{b as U,c as $}from"./chunk-2LFLHQ3L.js";import{d as k,e as j,h as V,k as D,n as G,s as R}from"./chunk-CMIGMSNZ.js";import{Aa as S,Ab as w,Bb as N,Ga as O,Ja as A,La as h,Wa as p,X as u,Xa as n,Y as f,Ya as e,Za as d,eb as b,hb as v,ib as s,kb as F,nb as i,ob as C,pb as g,qb as z,ua as l}from"./chunk-54AF7LZE.js";import"./chunk-X5YLR3NI.js";import{a as y,b as E,i as I}from"./chunk-ODN5LVDJ.js";function me(r,o){if(r&1&&(n(0,"div",13)(1,"span",14),i(2),e()()),r&2){let t=s();l(2),g("Cliente: ",t.clienteId)}}function de(r,o){r&1&&(n(0,"div",15)(1,"span",16),i(2,"Visualizzazione Admin - Tutti i moduli"),e()())}function se(r,o){if(r&1&&(n(0,"div",17),i(1),e()),r&2){let t=s();l(),g(" ",t.error," ")}}function pe(r,o){if(r&1){let t=b();n(0,"div",68)(1,"div",69)(2,"div",25)(3,"label",26),i(4,"Obiettivo:"),e(),d(5,"input",70),e(),n(6,"div",25)(7,"label",26),i(8,"Target:"),e(),d(9,"input",71),e(),n(10,"div",25)(11,"label",26),i(12,"Scadenza:"),e(),d(13,"input",72),e(),n(14,"div",25)(15,"button",73),v("click",function(){let c=u(t).index,m=s(3);return f(m.removeObjective(c))}),n(16,"span",20),i(17,"delete"),e()()()()()}if(r&2){let t=o.index;p("formGroupName",t)}}function ue(r,o){if(r&1){let t=b();n(0,"div",74)(1,"div",75)(2,"div",25)(3,"label",26),i(4,"Nome:"),e(),d(5,"input",76),e(),n(6,"div",25)(7,"label",26),i(8,"Codice:"),e(),d(9,"input",77),e(),n(10,"div",25)(11,"label",26),i(12,"Priorit\xE0:"),e(),d(13,"input",78),e(),n(14,"div",25)(15,"button",79),v("click",function(){let c=u(t).index,m=s(3);return f(m.removeColor(c))}),n(16,"span",20),i(17,"delete"),e()()()()()}if(r&2){let t=o.index;p("formGroupName",t)}}function fe(r,o){if(r&1){let t=b();n(0,"div",80)(1,"div",81)(2,"div",25)(3,"label",26),i(4,"Nome Font:"),e(),d(5,"input",82),e(),n(6,"div",25)(7,"label",26),i(8,"Priorit\xE0:"),e(),d(9,"input",78),e(),n(10,"div",25)(11,"button",83),v("click",function(){let c=u(t).index,m=s(3);return f(m.removeFont(c))}),n(12,"span",20),i(13,"delete"),e()()()()()}if(r&2){let t=o.index;p("formGroupName",t)}}function ve(r,o){if(r&1){let t=b();n(0,"div",34)(1,"div",23)(2,"h4",4)(3,"span",20),i(4,"share"),e(),i(5," Social Media "),e(),n(6,"div",24)(7,"div",25)(8,"label",26),i(9,"Tipo Profilo:"),e(),d(10,"input",35),e(),n(11,"div",25)(12,"label",26),i(13,"Piattaforma:"),e(),d(14,"input",36),e(),n(15,"div",37)(16,"label",26),i(17,"Buyer Personas:"),e(),d(18,"textarea",38),e(),n(19,"div",37)(20,"label",26),i(21,"Obiettivi Intervista:"),e(),d(22,"textarea",39),e(),n(23,"div",37)(24,"label",26),i(25,"Strategia Contenuti:"),e(),d(26,"textarea",40),e()()(),n(27,"div",23)(28,"h4",4)(29,"span",20),i(30,"flag"),e(),i(31," Tabella Obiettivi "),e(),n(32,"div",41),h(33,pe,18,1,"div",42),n(34,"button",43),v("click",function(){u(t);let c=s(2);return f(c.addObjective())}),n(35,"span",20),i(36,"add"),e(),i(37," Aggiungi Obiettivo "),e()()(),n(38,"div",23)(39,"h4",4)(40,"span",20),i(41,"palette"),e(),i(42," Servizi Creativi "),e(),n(43,"div",44)(44,"div",25)(45,"label",26),i(46,"Software:"),e(),d(47,"input",45),e(),n(48,"div",25)(49,"label",26),i(50,"Formato File:"),e(),d(51,"input",46),e(),n(52,"div",37)(53,"label",26),i(54,"Percorso Salvataggio:"),e(),d(55,"input",47),e()()(),n(56,"div",23)(57,"h4",4)(58,"span",20),i(59,"aspect_ratio"),e(),i(60," Dimensioni "),e(),n(61,"div",48)(62,"div",25)(63,"label",26),i(64,"Larghezza:"),e(),d(65,"input",49),e(),n(66,"div",25)(67,"label",26),i(68,"Unit\xE0:"),e(),n(69,"select",50)(70,"option",51),i(71,"px"),e(),n(72,"option",52),i(73,"cm"),e(),n(74,"option",53),i(75,"in"),e(),n(76,"option",54),i(77,"%"),e()()(),n(78,"div",25)(79,"label",26),i(80,"Altezza:"),e(),d(81,"input",55),e(),n(82,"div",25)(83,"label",26),i(84,"Unit\xE0:"),e(),n(85,"select",56)(86,"option",51),i(87,"px"),e(),n(88,"option",52),i(89,"cm"),e(),n(90,"option",53),i(91,"in"),e(),n(92,"option",54),i(93,"%"),e()()(),n(94,"div",25)(95,"label",26),i(96,"Risoluzione:"),e(),d(97,"input",57),e(),n(98,"div",25)(99,"label",26),i(100,"Unit\xE0:"),e(),n(101,"select",58)(102,"option",59),i(103,"PPI"),e(),n(104,"option",60),i(105,"DPI"),e()()()()(),n(106,"div",23)(107,"h4",4)(108,"span",20),i(109,"color_lens"),e(),i(110," Colori "),e(),n(111,"div",61),h(112,ue,18,1,"div",62),n(113,"button",43),v("click",function(){u(t);let c=s(2);return f(c.addColor())}),n(114,"span",20),i(115,"add"),e(),i(116," Aggiungi Colore "),e()()(),n(117,"div",23)(118,"h4",4)(119,"span",20),i(120,"record_voice_over"),e(),i(121," Tone of Voice "),e(),n(122,"div",63)(123,"div",37)(124,"label",26),i(125,"Preso dall'intervista:"),e(),d(126,"textarea",64),e(),n(127,"div",25)(128,"label",26),i(129,"Stile:"),e(),d(130,"input",65),e()()(),n(131,"div",23)(132,"h4",4)(133,"span",20),i(134,"text_fields"),e(),i(135," Fonts "),e(),n(136,"div",66),h(137,fe,14,1,"div",67),n(138,"button",43),v("click",function(){u(t);let c=s(2);return f(c.addFont())}),n(139,"span",20),i(140,"add"),e(),i(141," Aggiungi Font "),e()()()()}if(r&2){let t=s(2);l(33),p("ngForOf",t.objectivesArray.controls),l(79),p("ngForOf",t.colorsArray.controls),l(25),p("ngForOf",t.fontsArray.controls)}}function ge(r,o){r&1&&d(0,"div",34)}function _e(r,o){r&1&&(n(0,"div",34)(1,"div",23)(2,"h4",4)(3,"span",20),i(4,"account_balance"),e(),i(5," Contabilit\xE0 "),e(),n(6,"div",24)(7,"div",25)(8,"label",26),i(9,"Autonomia Cliente (1-5):"),e(),d(10,"input",84),n(11,"div",85),i(12,"Valuta da 1 (bassa) a 5 (alta)"),e()(),n(13,"div",25)(14,"label",26),i(15,"Livello Digitalizzazione (1-5):"),e(),d(16,"input",86),n(17,"div",85),i(18,"Valuta da 1 (basso) a 5 (alto)"),e()(),n(19,"div",25)(20,"label",26),i(21,"Responsabile Interno:"),e(),d(22,"input",87),e(),n(23,"div",25)(24,"label",26),i(25,"Complessit\xE0 Strutturale (1-5):"),e(),d(26,"input",88),n(27,"div",85),i(28,"Valuta da 1 (semplice) a 5 (complessa)"),e()(),n(29,"div",37)(30,"label",26),i(31,"Software Utilizzato:"),e(),d(32,"input",89),e()()()())}function he(r,o){r&1&&(n(0,"div",34)(1,"div",23)(2,"h4",4)(3,"span",20),i(4,"school"),e(),i(5," Formazione "),e(),n(6,"div",90)(7,"div",37)(8,"label",26),i(9,"Obiettivo Formazione:"),e(),d(10,"textarea",91),e(),n(11,"div",25)(12,"label",26),i(13,"Totale Dipendenti:"),e(),d(14,"input",92),e(),n(15,"div",25)(16,"label",26),i(17,"Dipendenti da Formare:"),e(),d(18,"input",93),e(),n(19,"div",25)(20,"label",26),i(21,"Ore Totali:"),e(),d(22,"input",94),e(),n(23,"div",25)(24,"label",26),i(25,"Ore Rimanenti:"),e(),d(26,"input",95),e(),n(27,"div",25)(28,"label",26),i(29,"Responsabile:"),e(),d(30,"input",87),e()()()())}function xe(r,o){if(r&1){let t=b();n(0,"div",18)(1,"div",19)(2,"h3",4)(3,"span",20),i(4),e(),i(5),e(),n(6,"button",21),v("click",function(){u(t);let c=s();return f(c.cancelEdit())}),n(7,"span",20),i(8,"close"),e()()(),n(9,"form",22),v("ngSubmit",function(){u(t);let c=s();return f(c.onSave())}),n(10,"div",23)(11,"h4",4)(12,"span",20),i(13,"info"),e(),i(14," Informazioni Base "),e(),n(15,"div",24)(16,"div",25)(17,"label",26)(18,"span",20),i(19,"badge"),e(),i(20," Numero Progetto* "),e(),d(21,"input",27),e(),n(22,"div",25)(23,"label",26)(24,"span",20),i(25,"title"),e(),i(26," Nome Progetto* "),e(),d(27,"input",28),e()()(),h(28,ve,142,3,"div",29)(29,ge,1,0,"div",29)(30,_e,33,0,"div",29)(31,he,31,0,"div",29),n(32,"div",30)(33,"div",31)(34,"button",32),v("click",function(){u(t);let c=s();return f(c.cancelEdit())}),n(35,"span",20),i(36,"cancel"),e(),i(37," Annulla "),e(),n(38,"button",33)(39,"span",20),i(40),e(),i(41),e()()()()()}if(r&2){let t=s();l(4),C(t.currentInfo?"edit":"add"),l(),z(" ",t.currentInfo?"Modifica":"Nuova"," Informazione Tecnica - ",t.getModuleName(t.currentEditingModule)," "),l(4),p("formGroup",t.technicalForm),l(19),p("ngIf",t.currentEditingModule==="immagine"),l(),p("ngIf",t.currentEditingModule==="digital"),l(),p("ngIf",t.currentEditingModule==="accounting"),l(),p("ngIf",t.currentEditingModule==="optimization"),l(7),p("disabled",!t.technicalForm.valid),l(2),C(t.currentInfo?"save":"add"),l(),g(" ",t.currentInfo?"Aggiorna":"Salva"," ")}}function be(r,o){r&1&&(n(0,"div",96),d(1,"div",97),n(2,"p"),i(3,"Caricamento informazioni tecniche..."),e()())}function ye(r,o){r&1&&(n(0,"p",104),i(1,"Nessuna configurazione trovata per questo cliente."),e())}function Ee(r,o){r&1&&(n(0,"p",104),i(1," Nessun modulo attivo per questo cliente nella configurazione Promethea. "),e())}function Ie(r,o){if(r&1&&(n(0,"div",101)(1,"div",102),i(2,"\u{1F4CA}"),e(),h(3,ye,2,0,"p",103)(4,Ee,2,0,"p",103),e()),r&2){let t=s(2);l(3),p("ngIf",!t.clienteConfig),l(),p("ngIf",t.clienteConfig&&t.modules.length===0)}}function Ce(r,o){if(r&1){let t=b();n(0,"div",101)(1,"div",102),i(2,"\u{1F4DD}"),e(),n(3,"p",104),i(4,"Nessuna informazione tecnica disponibile per questo modulo."),e(),n(5,"button",109),v("click",function(){u(t);let c=s().$implicit,m=s(2);return f(m.addNew(c))}),n(6,"span",20),i(7,"add"),e(),i(8," Crea la prima informazione "),e()()}}function Se(r,o){if(r&1&&(n(0,"div",122),i(1),e()),r&2){let t=s(2).$implicit;l(),C(t.profileType)}}function ze(r,o){if(r&1&&(n(0,"div",122),i(1),e()),r&2){let t=s(2).$implicit;l(),C(t.platform)}}function Te(r,o){if(r&1&&(n(0,"p",104),i(1),w(2,"truncate"),e()),r&2){let t=s(2).$implicit;l(),C(N(2,1,t.buyerPersonas,100))}}function Fe(r,o){if(r&1&&(n(0,"div",120),h(1,Se,2,1,"div",121)(2,ze,2,1,"div",121)(3,Te,3,4,"p",103),e()),r&2){let t=s().$implicit;l(),p("ngIf",t.profileType),l(),p("ngIf",t.platform),l(),p("ngIf",t.buyerPersonas)}}function we(r,o){if(r&1&&(n(0,"div",122),i(1),e()),r&2){let t=s(2).$implicit;l(),g("Dominio: ",t.domain.name)}}function Ne(r,o){if(r&1&&(n(0,"div",122),i(1),e()),r&2){let t=s(2).$implicit;l(),g("Hosting: ",t.hosting.provider)}}function Me(r,o){if(r&1&&(n(0,"div",122),i(1),e()),r&2){let t=s(2).$implicit;l(),g("DB: ",t.database.type)}}function Pe(r,o){if(r&1&&(n(0,"div",120),h(1,we,2,1,"div",121)(2,Ne,2,1,"div",121)(3,Me,2,1,"div",121),e()),r&2){let t=s().$implicit;l(),p("ngIf",t.domain==null?null:t.domain.name),l(),p("ngIf",t.hosting==null?null:t.hosting.provider),l(),p("ngIf",t.database==null?null:t.database.type)}}function Oe(r,o){if(r&1&&(n(0,"div",120)(1,"div",123)(2,"label"),i(3),e(),n(4,"div",124),d(5,"div",125),e()(),n(6,"div",123)(7,"label"),i(8),e(),n(9,"div",124),d(10,"div",125),e()(),n(11,"p")(12,"strong"),i(13,"Responsabile:"),e(),i(14),e(),n(15,"p")(16,"strong"),i(17,"Software:"),e(),i(18),e()()),r&2){let t=s().$implicit;l(3),g("Autonomia: ",t.clientAutonomy,"/5"),l(2),F("width",t.clientAutonomy/5*100+"%"),l(3),g("Digitalizzazione: ",t.digitalizationLevel,"/5"),l(2),F("width",t.digitalizationLevel/5*100+"%"),l(4),g(" ",t.internalManager),l(4),g(" ",t.softwareUsed)}}function Ae(r,o){if(r&1&&(n(0,"div",120)(1,"p")(2,"strong"),i(3,"Obiettivo:"),e(),i(4),e(),n(5,"div",126)(6,"div",127)(7,"div",128),i(8),e(),n(9,"div",129),i(10,"Dipendenti"),e()(),n(11,"div",127)(12,"div",128),i(13),e(),n(14,"div",129),i(15,"Ore"),e()()()()),r&2){let t=s().$implicit;l(4),g(" ",t.training.objective),l(4),z("",t.training.employeesToTrain,"/",t.training.totalEmployees),l(5),z("",t.training.remainingHours,"/",t.training.totalHours)}}function ke(r,o){if(r&1){let t=b();n(0,"div",110),v("click",function(){let c=u(t),m=c.$implicit,_=c.index,x=s().$implicit,T=s(2);return f(T.editInfo(m,_,x))}),n(1,"div",111)(2,"h4",112)(3,"span",20),i(4,"description"),e(),i(5),e(),n(6,"div",113)(7,"button",114),v("click",function(c){let m=u(t),_=m.$implicit,x=m.index,T=s().$implicit,ce=s(2);return c.stopPropagation(),f(ce.editInfo(_,x,T))}),n(8,"span",20),i(9,"edit"),e()(),n(10,"button",115),v("click",function(c){let m=u(t).$implicit,_=s().$implicit,x=s(2);return c.stopPropagation(),f(x.onDelete(m.id,_))}),n(11,"span",20),i(12,"delete"),e()()()(),n(13,"div",116)(14,"p")(15,"strong"),i(16,"Progetto:"),e(),i(17),e(),n(18,"div",117),h(19,Fe,4,3,"div",118)(20,Pe,4,3,"div",118)(21,Oe,19,8,"div",118)(22,Ae,16,5,"div",118),e()(),n(23,"div",119)(24,"small",104)(25,"span",20),i(26,"update"),e(),i(27),w(28,"date"),e()()()}if(r&2){let t=o.$implicit,a=s().$implicit;l(5),g(" ",t.projectName||"Informazione Tecnica"," "),l(12),z(" ",t.projectNumber," - ",t.projectName),l(2),p("ngIf",a==="immagine"),l(),p("ngIf",a==="digital"),l(),p("ngIf",a==="accounting"),l(),p("ngIf",a==="optimization"&&t.training),l(5),g(" Aggiornato il: ",N(28,8,t.updated_at,"dd/MM/yyyy")," ")}}function je(r,o){if(r&1){let t=b();n(0,"div",105)(1,"div",1)(2,"h3",4)(3,"span",20),i(4),e(),i(5),e(),n(6,"button",106),v("click",function(){let c=u(t).$implicit,m=s(2);return f(m.addNew(c))}),n(7,"span",20),i(8,"add"),e(),i(9," Nuova Informazione "),e()(),n(10,"div",107),h(11,Ce,9,0,"div",99)(12,ke,29,11,"div",108),e()()}if(r&2){let t=o.$implicit,a=s(2);l(4),C(a.getModuleIcon(t)),l(),g(" ",a.getModuleName(t)," "),l(),p("disabled",a.showForm),l(5),p("ngIf",a.getTechnicalInfoByModule(t).length===0),l(),p("ngForOf",a.getTechnicalInfoByModule(t))}}function Ve(r,o){if(r&1&&(n(0,"div",98),h(1,Ie,5,2,"div",99)(2,je,13,5,"div",100),e()),r&2){let t=s();l(),p("ngIf",t.modules.length===0),l(),p("ngForOf",t.modules)}}var P=class r{transform(o,t=100){return o?o.length>t?o.substring(0,t)+"...":o:""}static \u0275fac=function(t){return new(t||r)};static \u0275pipe=A({name:"truncate",type:r,pure:!0})},le=class r{constructor(o,t,a,c,m){this.fb=o;this.route=t;this.supabaseService=a;this.authService=c;this.userService=m;this.technicalForm=this.createForm("immagine")}modules=[];isAdmin=!1;clienteId=null;currentEditingModule=null;clienteConfig=null;currentModule=null;technicalInfo={};loading=!1;error="";editingIndex=-1;showForm=!1;currentInfo=null;technicalForm;ngOnInit(){return I(this,null,function*(){this.route.queryParams.subscribe(o=>I(this,null,function*(){this.clienteId=o.clienteId||null,console.log("Cliente ID:",this.clienteId),yield this.loadUserData(),yield this.loadTechnicalInformation()}))})}extractModulesFromConfig(){if(!this.clienteConfig||typeof this.clienteConfig!="object")return[];let o={immagine_marketing:"immagine",digitalizzazione_automatismi:"digital",contabilita_fiscalita:"accounting",ottimizzazione_management:"optimization"},t=[];return Object.entries(o).forEach(([a,c])=>{let m=this.clienteConfig[a];if(!m||typeof m!="object")return;let _=Number(m.totale??m.totale_modulo??0),x=Array.isArray(m.servizi_selezionati)?m.servizi_selezionati:Array.isArray(m.servizi)?m.servizi:[];(Number.isFinite(_)&&_>0||x.length>0)&&t.push(c)}),t}loadUserData(){return I(this,null,function*(){try{let o=this.authService.user();if(!o){this.error="Utente non autenticato";return}this.isAdmin=yield this.userService.isAdmin();let t=[];if(this.isAdmin?t=["immagine","digital","accounting","optimization"]:t=(yield this.supabaseService.getAppUserById(o.id)).data?.moduli||[],this.clienteId){let m=yield this.supabaseService.getConfigurazioniPromethea(this.clienteId);m?.data&&m.data.length>0?this.clienteConfig=m.data[0].dettagli:this.clienteConfig=null}let a={immagine_marketing:"immagine",digitalizzazione_automatismi:"digital",contabilita_fiscalita:"accounting",ottimizzazione_management:"optimization"},c=this.extractModulesFromConfig();this.isAdmin?this.modules=c.length?c:t:this.modules=c.length?t.filter(m=>c.includes(m)):t,this.modules.forEach(m=>{this.technicalInfo[m]=[]}),this.clienteConfig&&typeof this.clienteConfig=="object"&&Object.keys(this.clienteConfig).forEach(m=>{let _=this.clienteConfig[m];if(_&&_.totale_modulo>0&&Array.isArray(_.servizi_selezionati)&&_.servizi_selezionati.length>0){let x=a[m];x&&c.push(x)}}),this.isAdmin?this.modules=c.length>0?c:t:c.length>0?this.modules=t.filter(m=>c.includes(m)):this.modules=t,this.modules.forEach(m=>{this.technicalInfo[m]=[]})}catch(o){console.error("Errore caricamento dati utente:",o),this.error="Errore nel caricamento dei dati utente"}})}filterModulesByConfig(o){return this.clienteConfig?o.filter(t=>{let a=this.getConfigKeyForModule(t);if(!a)return!0;let c=this.clienteConfig[a];return c&&c.totale_modulo>0&&c.servizi_selezionati.length>0}):o}getConfigKeyForModule(o){return{immagine:"immagine_marketing",accounting:"contabilita_fiscalita",optimization:"ottimizzazione_management",digital:"digitalizzazione_automatismi"}[o]||null}loadTechnicalInformation(){return I(this,null,function*(){if(!this.clienteId){this.error="Nessun cliente selezionato";return}this.loading=!0,this.error="";try{for(let o of this.modules){let t=yield this.supabaseService.getInformazioniTecniche(this.clienteId,o);t.data?this.technicalInfo[o]=t.data.map(a=>E(y({id:a.id},a.dati),{created_at:a.created_at,updated_at:a.updated_at})):this.technicalInfo[o]=[]}}catch(o){console.error("Errore caricamento informazioni tecniche:",o),this.error="Errore nel caricamento delle informazioni tecniche"}finally{this.loading=!1}})}createForm(o){let t=this.fb.group({projectNumber:["",M.required],projectName:["",M.required],module:[o]});switch(o){case"immagine":return this.fb.group(E(y({},t.controls),{profileType:[""],buyerPersonas:[""],interviewObjectives:[""],platform:[""],contentStrategy:[""],objectivesTable:this.fb.array([]),graphicInfo:this.fb.group({projectName:[""],software:[""],fileFormat:[""],savePath:[""]}),dimensions:this.fb.group({width:[0],height:[0],resolution:[0],widthUnit:["px"],heightUnit:["px"],resolutionUnit:["ppi"]}),usage:["digital"],elementType:["static"],colors:this.fb.array([]),toneOfVoice:this.fb.group({fromInterview:[""],style:[""]}),fonts:this.fb.array([])}));case"digital":return this.fb.group(E(y({},t.controls),{domain:this.fb.group({name:[""],username:[""],password:[""]}),hosting:this.fb.group({provider:[""],username:[""],password:[""],plan:[""]}),database:this.fb.group({type:[""],email:[""],password:[""],version:[""]}),server:this.fb.group({type:[""],email:[""],password:[""]}),repository:this.fb.group({sistema_versionamento:[""],pubblicato:[!1],data_pubblicazione:[""],sviluppatore:[""]})}));case"accounting":return this.fb.group(E(y({},t.controls),{clientAutonomy:[0],digitalizationLevel:[0],internalManager:[""],structuralComplexity:[0],softwareUsed:[""],deadlines:this.fb.array([]),sectorInfo:this.fb.array([])}));case"optimization":return this.fb.group(E(y({},t.controls),{training:this.fb.group({objective:[""],totalEmployees:[0],employeesToTrain:[0],totalHours:[0],remainingHours:[0],internalManager:[""]}),financial:this.fb.group({currentRatio:this.createFinancialMetric(),debtToEquity:this.createFinancialMetric(),roe:this.createFinancialMetric(),revenueGrowth:this.createFinancialMetric()})}));default:return t}}createFinancialMetric(){return this.fb.group({value:[0],calculation:this.fb.group({numerator:[0],denominator:[0]})})}getModuleName(o){return{immagine:"Immagine e Marketing",digital:"Digitalizzazione",accounting:"Contabilit\xE0",optimization:"Ottimizzazione"}[o]||o}addNew(o){this.currentEditingModule=o,this.editingIndex=-1,this.currentInfo=null,this.technicalForm=this.createForm(o),this.showForm=!0}editInfo(o,t,a){this.currentEditingModule=a,this.editingIndex=t,this.currentInfo=o,this.technicalForm=this.createForm(a),this.patchFormValue(o),this.showForm=!0}patchFormValue(o){if(this.technicalForm.patchValue(o),o.colors&&this.technicalForm.get("colors")){let t=this.technicalForm.get("colors");t.clear(),o.colors.forEach(a=>{t.push(this.fb.group({name:[a.name],code:[a.code],priority:[a.priority]}))})}if(o.fonts&&this.technicalForm.get("fonts")){let t=this.technicalForm.get("fonts");t.clear(),o.fonts.forEach(a=>{t.push(this.fb.group({name:[a.name],priority:[a.priority]}))})}if(o.objectivesTable&&this.technicalForm.get("objectivesTable")){let t=this.technicalForm.get("objectivesTable");t.clear(),o.objectivesTable.forEach(a=>{t.push(this.fb.group({objective:[a.objective],target:[a.target],deadline:[a.deadline]}))})}if(o.deadlines&&this.technicalForm.get("deadlines")){let t=this.technicalForm.get("deadlines");t.clear(),o.deadlines.forEach(a=>{t.push(this.fb.group({name:[a.name],scadenza:[a.scadenza],tipologia:[a.tipologia],importo:[a.importo]}))})}if(o.sectorInfo&&this.technicalForm.get("sectorInfo")){let t=this.technicalForm.get("sectorInfo");t.clear(),o.sectorInfo.forEach(a=>{t.push(this.fb.group({nome:[a.nome],descrizione:[a.descrizione],categorie:[a.categorie]}))})}}onSave(){return I(this,null,function*(){if(this.technicalForm.valid&&this.currentEditingModule&&this.clienteId)try{let o=E(y({},this.technicalForm.value),{updatedAt:new Date,createdAt:this.currentInfo?.createdAt||new Date}),t={cliente_id:this.clienteId,modulo:this.currentEditingModule,dati:o};this.currentInfo?.id&&(t.id=this.currentInfo.id);let a=yield this.supabaseService.upsertInformazioniTecniche(t);if(a.error){console.error("Errore salvataggio:",a.error),this.error="Errore durante il salvataggio";return}let c=E(y({id:a.data.id},o),{created_at:a.data.created_at,updated_at:a.data.updated_at});this.currentInfo?.id?this.technicalInfo[this.currentEditingModule][this.editingIndex]=c:this.technicalInfo[this.currentEditingModule].push(c),this.cancelEdit(),console.log("Dati salvati con successo:",c)}catch(o){console.error("Errore durante il salvataggio:",o),this.error="Errore durante il salvataggio"}else console.log("Form non valido o dati mancanti")})}onDelete(o,t){return I(this,null,function*(){if(confirm("Sei sicuro di voler eliminare queste informazioni?"))try{let a=yield this.supabaseService.deleteInformazioniTecniche(o);if(a.error){console.error("Errore eliminazione:",a.error),this.error="Errore durante l'eliminazione";return}this.technicalInfo[t]=this.technicalInfo[t].filter(c=>c.id!==o)}catch(a){console.error("Errore durante l'eliminazione:",a),this.error="Errore durante l'eliminazione"}})}cancelEdit(){this.showForm=!1,this.editingIndex=-1,this.currentInfo=null,this.currentEditingModule=null,this.technicalForm=this.createForm("immagine")}getTechnicalInfoByModule(o){return this.technicalInfo[o]||[]}addColor(){this.technicalForm.get("colors").push(this.fb.group({name:[""],code:[""],priority:[1]}))}removeColor(o){this.technicalForm.get("colors").removeAt(o)}get colorsArray(){return this.technicalForm.get("colors")}addFont(){this.technicalForm.get("fonts").push(this.fb.group({name:[""],priority:[1]}))}removeFont(o){this.technicalForm.get("fonts").removeAt(o)}get fontsArray(){return this.technicalForm.get("fonts")}addObjective(){this.technicalForm.get("objectivesTable").push(this.fb.group({objective:[""],target:[""],deadline:[""]}))}removeObjective(o){this.technicalForm.get("objectivesTable").removeAt(o)}get objectivesArray(){return this.technicalForm.get("objectivesTable")}calculateCurrentRatio(){let o=this.technicalForm.get("financial.currentRatio.calculation.numerator")?.value||0,t=this.technicalForm.get("financial.currentRatio.calculation.denominator")?.value||1,a=o/t;this.technicalForm.get("financial.currentRatio.value")?.setValue(a)}calculateROE(){let o=this.technicalForm.get("financial.roe.calculation.numerator")?.value||0,t=this.technicalForm.get("financial.roe.calculation.denominator")?.value||1,a=o/t*100;this.technicalForm.get("financial.roe.value")?.setValue(a)}getModuleIcon(o){return{immagine:"palette",digital:"code",accounting:"account_balance",optimization:"school"}[o]||"folder"}static \u0275fac=function(t){return new(t||r)(S(oe),S(G),S(U),S($),S(ae))};static \u0275cmp=O({type:r,selectors:[["app-informazioni-tecniche"]],decls:17,vars:6,consts:[[1,"technical-info-container"],[1,"section-header"],[1,"material-icons","header-icon"],[1,"section-titles"],[1,"section-title"],[1,"sottotitolo",2,"margin-bottom","var(--gutter-sm)"],[2,"display","flex","flex-direction","column","gap","var(--gutter-sm)"],["class","sottotitolo",4,"ngIf"],["class","admin-info",4,"ngIf"],["class","status-message error",4,"ngIf"],["class","form-container",4,"ngIf"],["class","status-message loading",4,"ngIf"],["class","modules-container",4,"ngIf"],[1,"sottotitolo"],[1,"badge","badge-info"],[1,"admin-info"],[1,"badge","badge-warning"],[1,"status-message","error"],[1,"form-container"],[1,"form-header","section-header"],[1,"material-icons"],[1,"icon-btn","close",3,"click"],[1,"form-vertical",3,"ngSubmit","formGroup"],[1,"form-section"],[1,"grid-form"],[1,"form-field"],[1,"form-label"],["type","text","formControlName","projectNumber","required","",1,"form-control"],["type","text","formControlName","projectName","required","",1,"form-control"],["class","form-module-content",4,"ngIf"],[1,"form-actions"],[1,"actions-container"],["type","button",1,"promethea-button","ghost",3,"click"],["type","submit",1,"promethea-button",3,"disabled"],[1,"form-module-content"],["type","text","formControlName","profileType","placeholder","Es: Business, Personale...",1,"form-control"],["type","text","formControlName","platform","placeholder","Es: Instagram, Facebook...",1,"form-control"],[1,"form-field","form-field-col-span"],["formControlName","buyerPersonas","rows","3","placeholder","Descrivi le buyer personas...",1,"form-control"],["formControlName","interviewObjectives","rows","3","placeholder","Obiettivi dell'intervista...",1,"form-control"],["formControlName","contentStrategy","rows","3","placeholder","Strategia dei contenuti...",1,"form-control"],["formArrayName","objectivesTable",1,"objectives-container"],["class","objective-row",3,"formGroupName",4,"ngFor","ngForOf"],["type","button",1,"promethea-button","secondary",3,"click"],["formGroupName","graphicInfo",1,"grid-form"],["type","text","formControlName","software","placeholder","Es: Photoshop, Illustrator...",1,"form-control"],["type","text","formControlName","fileFormat","placeholder","Es: JPG, PNG, PDF...",1,"form-control"],["type","text","formControlName","savePath","placeholder","Percorso di salvataggio file...",1,"form-control"],["formGroupName","dimensions",1,"grid-form"],["type","number","formControlName","width","placeholder","0",1,"form-control"],["formControlName","widthUnit",1,"form-control"],["value","px"],["value","cm"],["value","in"],["value","%"],["type","number","formControlName","height","placeholder","0",1,"form-control"],["formControlName","heightUnit",1,"form-control"],["type","number","formControlName","resolution","placeholder","0",1,"form-control"],["formControlName","resolutionUnit",1,"form-control"],["value","ppi"],["value","dpi"],["formArrayName","colors",1,"colors-container"],["class","color-row",3,"formGroupName",4,"ngFor","ngForOf"],["formGroupName","toneOfVoice",1,"grid-form"],["formControlName","fromInterview","rows","2","placeholder","Note dall'intervista...",1,"form-control"],["type","text","formControlName","style","placeholder","Es: Formale, Informale...",1,"form-control"],["formArrayName","fonts",1,"fonts-container"],["class","font-row",3,"formGroupName",4,"ngFor","ngForOf"],[1,"objective-row",3,"formGroupName"],[1,"objective-fields"],["type","text","formControlName","objective","placeholder","Descrizione obiettivo",1,"form-control"],["type","text","formControlName","target","placeholder","Target specifico",1,"form-control"],["type","date","formControlName","deadline",1,"form-control"],["type","button","title","Rimuovi obiettivo",1,"action-btn","delete",3,"click"],[1,"color-row",3,"formGroupName"],[1,"color-fields"],["type","text","formControlName","name","placeholder","Nome colore",1,"form-control"],["type","text","formControlName","code","placeholder","#HEX o RGB",1,"form-control"],["type","number","formControlName","priority","min","1","max","10","placeholder","1-10",1,"form-control"],["type","button","title","Rimuovi colore",1,"action-btn","delete",3,"click"],[1,"font-row",3,"formGroupName"],[1,"font-fields"],["type","text","formControlName","name","placeholder","Nome del font",1,"form-control"],["type","button","title","Rimuovi font",1,"action-btn","delete",3,"click"],["type","number","formControlName","clientAutonomy","min","1","max","5",1,"form-control"],[1,"hint"],["type","number","formControlName","digitalizationLevel","min","1","max","5",1,"form-control"],["type","text","formControlName","internalManager","placeholder","Nome responsabile",1,"form-control"],["type","number","formControlName","structuralComplexity","min","1","max","5",1,"form-control"],["type","text","formControlName","softwareUsed","placeholder","Software contabilit\xE0",1,"form-control"],["formGroupName","training",1,"grid-form"],["formControlName","objective","rows","3","placeholder","Obiettivi formativi...",1,"form-control"],["type","number","formControlName","totalEmployees","placeholder","0",1,"form-control"],["type","number","formControlName","employeesToTrain","placeholder","0",1,"form-control"],["type","number","formControlName","totalHours","placeholder","0",1,"form-control"],["type","number","formControlName","remainingHours","placeholder","0",1,"form-control"],[1,"status-message","loading"],[1,"loading-spinner"],[1,"modules-container"],["class","empty-state",4,"ngIf"],["class","module-section",4,"ngFor","ngForOf"],[1,"empty-state"],[1,"empty-icon"],["class","text-muted",4,"ngIf"],[1,"text-muted"],[1,"module-section"],[1,"promethea-button",3,"click","disabled"],[1,"grid-cards"],["class","card clickable",3,"click",4,"ngFor","ngForOf"],[1,"promethea-button",3,"click"],[1,"card","clickable",3,"click"],[1,"card-header"],[1,"card-title"],[1,"table-actions"],["title","Modifica",1,"action-btn","edit",3,"click"],["title","Elimina",1,"action-btn","delete",3,"click"],[1,"card-content"],[1,"module-specific-content"],["class","grid-responsive",4,"ngIf"],[1,"card-footer"],[1,"grid-responsive"],["class","chip",4,"ngIf"],[1,"chip"],[1,"progress-container"],[1,"progress"],[1,"progress-bar"],[1,"stats-container"],[1,"stat-card"],[1,"stat-value"],[1,"stat-label"]],template:function(t,a){t&1&&(n(0,"div")(1,"div",0)(2,"div",1)(3,"i",2),i(4,"settings"),e(),n(5,"div",3)(6,"h2",4),i(7,"Informazioni Tecniche"),e(),n(8,"p",5),i(9,"Dati tecnici e configurazioni per il cliente"),e(),n(10,"div",6),h(11,me,3,1,"div",7)(12,de,3,0,"div",8),e()()(),h(13,se,2,1,"div",9)(14,xe,42,11,"div",10)(15,be,4,0,"div",11)(16,Ve,3,2,"div",12),e()()),t&2&&(l(11),p("ngIf",a.clienteId),l(),p("ngIf",a.isAdmin),l(),p("ngIf",a.error),l(),p("ngIf",a.showForm),l(),p("ngIf",a.loading),l(),p("ngIf",!a.loading&&!a.showForm))},dependencies:[D,k,j,re,L,Z,ee,B,K,W,q,H,ne,ie,te,Y,Q,J,X,R,V,P],styles:['.technical-info-container[_ngcontent-%COMP%]{container-type:inline-size}.modules-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-xl)}.module-section[_ngcontent-%COMP%]{container-type:inline-size;padding:var(--gutter-md);border-radius:12px;border:1px solid var(--smoke-color-1)}.form-vertical[_ngcontent-%COMP%], .form-module-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-lg)}.form-container[_ngcontent-%COMP%]{background:var(--background);border:1px solid var(--smoke-color-1);border-radius:16px;padding:var(--gutter-lg);margin-bottom:var(--gutter-xl);box-shadow:0 4px 12px var(--shadow);animation:slideIn .3s ease-out;container-type:inline-size}.form-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--gutter-lg);border-bottom:1px solid var(--smoke-color-1);padding-bottom:var(--gutter-md);gap:var(--gutter-sm)}.form-section[_ngcontent-%COMP%]{border:1px solid var(--smoke-color-1);border-radius:12px;padding:var(--gutter-lg);background:var(--background);transition:all .3s ease}.form-section[_ngcontent-%COMP%]:hover{border-color:var(--primary);box-shadow:0 2px 8px var(--shadow)}.objectives-container[_ngcontent-%COMP%], .colors-container[_ngcontent-%COMP%], .fonts-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-md)}.objective-row[_ngcontent-%COMP%], .color-row[_ngcontent-%COMP%], .font-row[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--background) 95%,var(--primary));border:1px solid var(--smoke-color-1);border-radius:8px;padding:var(--gutter-md);transition:all .2s ease}.objective-row[_ngcontent-%COMP%]:hover, .color-row[_ngcontent-%COMP%]:hover, .font-row[_ngcontent-%COMP%]:hover{border-color:var(--primary);background:color-mix(in srgb,var(--background) 92%,var(--primary))}.objective-fields[_ngcontent-%COMP%], .color-fields[_ngcontent-%COMP%], .font-fields[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1fr auto;gap:var(--gutter-md);align-items:start}.form-actions[_ngcontent-%COMP%]{margin-top:var(--gutter-xl);padding-top:var(--gutter-lg);border-top:1px solid var(--smoke-color-1)}.module-specific-content[_ngcontent-%COMP%]{margin-top:var(--gutter-sm)}.progress-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.progress-container[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:var(--fs-sm);font-weight:600;color:var(--text-color)}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:var(--gutter-xl);text-align:center;gap:var(--gutter-md)}.empty-icon[_ngcontent-%COMP%]{font-size:3rem;opacity:.5}.stats-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:var(--gutter-sm);margin-top:var(--gutter-sm)}.stat-card[_ngcontent-%COMP%]{background:var(--smoke-color-2);border-radius:12px;padding:var(--gutter-sm);text-align:center;border:1px solid var(--smoke-color-1)}.stat-value[_ngcontent-%COMP%]{font-size:var(--fs-md);font-weight:700;color:var(--primary);line-height:1}.stat-label[_ngcontent-%COMP%]{font-size:var(--fs-sm);color:var(--text-color);opacity:.7;margin-top:.25rem}@container (max-width: 768px){.form-container[_ngcontent-%COMP%]{padding:var(--gutter-md);margin-bottom:var(--gutter-lg)}.form-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:var(--gutter-sm)}.form-section[_ngcontent-%COMP%]{padding:var(--gutter-md)}.objective-fields[_ngcontent-%COMP%], .color-fields[_ngcontent-%COMP%], .font-fields[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:var(--gutter-sm)}.stats-container[_ngcontent-%COMP%]{grid-template-columns:1fr}.section-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:var(--gutter-sm)}.grid-form[_ngcontent-%COMP%]{grid-template-columns:1fr!important}}.form-container[_ngcontent-%COMP%]{scroll-margin-top:var(--gutter-lg)}.hint[_ngcontent-%COMP%]{font-size:.8rem;color:color-mix(in srgb,var(--text-color) 60%,transparent);margin-top:.25rem;font-style:italic}.form-label[required][_ngcontent-%COMP%]:after{content:" *";color:#ef4444}.form-section[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideInUp .4s ease-out}@keyframes _ngcontent-%COMP%_slideInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}']})};export{le as InformazioniTecniche,P as TruncatePipe};
