import{a as Ae}from"./chunk-AFMN6PFM.js";import{a as ze,b as ge,d as fe,f as ve,h as he,o as xe,p as Ce,q as be,r as Se,s as ye,v as we}from"./chunk-DK6BTRCD.js";import{a as Pe}from"./chunk-YXXNVQRW.js";import{b as Me}from"./chunk-3M63M74O.js";import{a as pe}from"./chunk-ERQHX2OH.js";import{a as _e}from"./chunk-SJ4NRQ5G.js";import{d as me,f as de}from"./chunk-NWP7JNX6.js";import{b as ue}from"./chunk-7K4EWSAC.js";import{i as ne,j as oe,k as ae,n as re,o as le,q as se,r as ce}from"./chunk-XADZCZ3D.js";import{$b as ie,Fa as c,Gb as W,Ib as A,Kb as l,La as q,Lb as h,Mb as V,N as X,Nb as U,Ob as E,Pb as T,Qb as I,Ra as Z,Ub as ee,Wa as S,Wb as te,X as _,Y as p,Zb as B,_b as j,ac as L,lb as v,mb as n,nb as a,ob as K,sb as D,tb as R,vb as M,yb as f,zb as m}from"./chunk-QBO2HR3F.js";import"./chunk-X5YLR3NI.js";import{a as $,b as J,i as N}from"./chunk-ODN5LVDJ.js";var G=class s{DEFAULT_LIMIT=18;parseItalianNumber(i){if(!i||typeof i!="string")return NaN;let e=i.trim().replace(/\s+/g,"");e.indexOf(".")!==-1&&e.indexOf(",")!==-1?e=e.replace(/\./g,"").replace(",","."):e.indexOf(",")!==-1&&e.indexOf(".")===-1?e=e.replace(",","."):e=e.replace(/[^\d\.]/g,"");let o=parseFloat(e);return isFinite(o)?o:NaN}decideKindFromText(i){let e=(i||"").toLowerCase();return/\bcifra\b|\btotale\b/.test(e)?"cifra":/\bpercento\b|\bpercentuale\b|\b%\b|\bsconto\b/.test(e)?"percent":null}decideTargetFromText(i){let e=(i||"").toLowerCase();return/\b(mensil|mensile|mese|mesi)\b/.test(e)?"mensile":/\buna\b.*\btantum\b|\btantum\b/.test(e)?"una_tantum":/\bentrambi\b|\btutto\b|\btotale\b/.test(e)?"entrambi":null}computeForCifra(i,e){let o=Number(i.una||0),r=Number(i.mensile||0)*12;if(o<=0)return{allowed:!1,reason:"Non ci sono voci una tantum su cui applicare una cifra."};if(e<0)return{allowed:!1,reason:"Valore non valido."};let d=(1-e/o)*100;if(!isFinite(d))return{allowed:!1,reason:"Impossibile calcolare la percentuale richiesta."};if(d<0)return{allowed:!1,reason:"La cifra richiesta \xE8 superiore alla quota una tantum attuale; nessuno sconto necessario."};let z=Math.round((e+r)*100)/100;return d>this.DEFAULT_LIMIT?{allowed:!1,candidatePercent:d,producedTotal:z,reason:"limit"}:{allowed:!0,candidatePercent:d,producedTotal:z}}computeForPercent(i,e,o){let t=Number(i.una||0),d=Number(i.mensile||0)*12,z=t+d;if(e<0||!isFinite(e))return{allowed:!1,reason:"Percentuale non valida"};let g=Math.min(100,Math.max(0,e));if(o==="entrambi"){let C=Math.round(z*(1-g/100)*100)/100;return{allowed:g<=this.DEFAULT_LIMIT,candidatePercent:g,producedTotal:C}}if(o==="una_tantum"){if(t<=0)return{allowed:!1,reason:"Non ci sono voci una tantum."};let C=Math.round((t*(1-g/100)+d)*100)/100;return{allowed:g<=this.DEFAULT_LIMIT,candidatePercent:g,producedTotal:C}}if(d<=0)return{allowed:!1,reason:"Non ci sono voci mensili."};let w=Math.round((t+d*(1-g/100))*100)/100;return{allowed:g<=this.DEFAULT_LIMIT,candidatePercent:g,producedTotal:w}}findPercentForDesired(i,e,o,t=this.DEFAULT_LIMIT){if(!i||e<=0)return null;let r=i.una,d=i.mensile*12,z=r+d;if(z<=0)return null;if(o==="entrambi"){let w=(1-e/z)*100;return this.computeForPercent(i,w,o)}if(o==="una_tantum"){if(r<=0)return null;let w=(1-(e-d)/r)*100;return this.computeForPercent(i,w,o)}if(d<=0)return null;let g=(1-(e-r)/d)*100;return this.computeForPercent(i,g,o)}getResponseDelay(i=1400,e=900){return i+Math.floor(Math.random()*e)}static \u0275fac=function(e){return new(e||s)};static \u0275prov=X({token:s,factory:s.\u0275fac,providedIn:"root"})};var Ne=()=>[],Oe=(s,i)=>({"user-message":s,"assistance-message":i});function Fe(s,i){s&1&&(n(0,"div",30),K(1,"span",31),l(2," Ricerca in corso... "),a())}function qe(s,i){if(s&1&&(n(0,"div",32),l(1),a()),s&2){let e=m(2);c(),h(e.searchError)}}function De(s,i){if(s&1){let e=M();n(0,"div",35),f("click",function(){let t=_(e).$implicit,r=m(3);return p(r.onSelectProspect(t))}),n(1,"div",36)(2,"div",37)(3,"strong"),l(4),a()(),n(5,"div",38),l(6),a()(),n(7,"div",39),l(8,"\u2795"),a()()}if(s&2){let e=i.$implicit;c(4),h(e.ragione_sociale),c(2),U(" ",e.email||"\u2014"," \u2022 ",e.telefono||"\u2014"," ")}}function Re(s,i){if(s&1&&(n(0,"div",33),S(1,De,9,3,"div",34),B(2,"slice"),a()),s&2){let e=m(2);c(),v("ngForOf",ie(2,1,e.searchResults,0,8))}}function We(s,i){if(s&1&&(n(0,"div",40)(1,"i",41),l(2,"check_circle"),a(),l(3," Selezionato: "),n(4,"strong"),l(5),a()()),s&2){let e=m(2);c(5),h(e.selectedProspect.ragione_sociale)}}function Le(s,i){s&1&&(n(0,"div",42)(1,"i",41),l(2,"history"),a(),l(3," Modifica configurazione esistente: le variazioni saranno tracciate in storico. "),a())}function Ue(s,i){if(s&1){let e=M();n(0,"section",14)(1,"div",15)(2,"i",16),l(3,"person_search"),a(),n(4,"div",17)(5,"h2",18),l(6,"Seleziona il Prospect"),a()()(),n(7,"div",19)(8,"label",20),l(9,"Cerca Prospect"),a(),n(10,"div",21)(11,"input",22),I("ngModelChange",function(t){_(e);let r=m();return T(r.queryProspect,t)||(r.queryProspect=t),p(t)}),f("input",function(){_(e);let t=m();return p(t.onSearchProspect(t.queryProspect))}),a(),S(12,Fe,3,0,"div",23)(13,qe,2,1,"div",24)(14,Re,3,5,"div",25),a(),S(15,We,6,1,"div",26)(16,Le,4,0,"div",27),a(),n(17,"div",28)(18,"button",29),f("click",function(){_(e);let t=m();return p(t.avanti())}),l(19," Inizia Configurazione "),a()()()}if(s&2){let e=m();c(11),E("ngModel",e.queryProspect),c(),v("ngIf",e.searchLoading),c(),v("ngIf",e.searchError),c(),v("ngIf",e.searchResults.length),c(),v("ngIf",e.selectedProspect),c(),v("ngIf",e.isModificaConfigurazione),c(),A("blocked",e.searchResults.length),c(),v("disabled",!e.selectedProspect||e.searchLoading)}}function Be(s,i){s&1&&(D(0),l(1," Creazione del Brand "),R())}function $e(s,i){if(s&1&&(D(0),l(1),R()),s&2){let e=m(2).$implicit;c(),V(" ",e.id==="social_2_post"?"Social Media Base":e.id==="social_3_post"?"Social Media Avanzata":e.id==="social_5_post"?"Social Media Premium":e.nome," ")}}function je(s,i){if(s&1&&l(0),s&2){let e=m(2).$implicit;h(e.nome)}}function Ge(s,i){if(s&1&&S(0,$e,2,1,"ng-container",54)(1,je,1,1,"ng-template",null,1,L),s&2){let e=W(2),o=m().$implicit;v("ngIf",o.id.startsWith("social_"))("ngIfElse",e)}}function Qe(s,i){s&1&&(n(0,"div",43),l(1,"(include logo)"),a())}function He(s,i){s&1&&(n(0,"div",43),l(1,"(2 post/settimana)"),a())}function Ye(s,i){s&1&&(n(0,"div",43),l(1,"(3 post/settimana)"),a())}function Je(s,i){s&1&&(n(0,"div",43),l(1,"(5 post/settimana)"),a())}function Xe(s,i){if(s&1&&(n(0,"span",61),l(1),a()),s&2){let e=m().$implicit;c(),h(e.pacchetto)}}function Ze(s,i){if(s&1){let e=M();n(0,"div",62)(1,"label",63),f("click",function(t){return _(e),p(t.stopPropagation())}),n(2,"span"),l(3,"Quantit\xE0"),a(),n(4,"div",64)(5,"button",65),f("click",function(t){_(e);let r=m().$implicit;return m(2).adjustQuantity(r,-1,t),p(t.stopPropagation())}),n(6,"i",41),l(7,"remove"),a()(),n(8,"input",66),I("ngModelChange",function(t){_(e);let r=m().$implicit;return T(r.quantita,t)||(r.quantita=t),p(t)}),f("ngModelChange",function(){_(e);let t=m().$implicit,r=m(2);return p(r.onQtyChange(t))})("click",function(t){return _(e),p(t.stopPropagation())}),a(),n(9,"button",67),f("click",function(t){_(e);let r=m().$implicit;return m(2).adjustQuantity(r,1,t),p(t.stopPropagation())}),n(10,"i",41),l(11,"add"),a()()()()()}if(s&2){let e=m().$implicit;c(8),E("ngModel",e.quantita)}}function Ke(s,i){if(s&1){let e=M();n(0,"div",52),f("click",function(){let t=_(e).$implicit,r=m(2);return p(r.toggleServizio("immagine_marketing",t))}),n(1,"div",53)(2,"h4"),S(3,Be,2,0,"ng-container",54)(4,Ge,3,2,"ng-template",null,0,L),a(),S(6,Qe,2,0,"div",55)(7,He,2,0,"div",55)(8,Ye,2,0,"div",55)(9,Je,2,0,"div",55),n(10,"div",56),l(11),a()(),n(12,"p",57),l(13),a(),S(14,Xe,2,1,"span",58)(15,Ze,12,1,"div",59),n(16,"div",60)(17,"i",41),l(18,"check"),a()()()}if(s&2){let e=i.$implicit,o=W(5),t=m(2);A("selezionato",e.selezionato)("disabled",t.isServizioDisabled("immagine_marketing",e)),c(3),v("ngIf",e.id==="creazione_brand")("ngIfElse",o),c(3),v("ngIf",e.id==="creazione_brand"),c(),v("ngIf",e.id==="social_2_post"),c(),v("ngIf",e.id==="social_3_post"),c(),v("ngIf",e.id==="social_5_post"),c(2),h(t.formatPrezzoServizio(e)),c(2),h(e.descrizione),c(),v("ngIf",e.pacchetto),c(),v("ngIf",e.selezionato),c(),A("attivo",e.selezionato)}}function et(s,i){s&1&&(D(0),l(1," Creazione del Brand "),R())}function tt(s,i){if(s&1&&l(0),s&2){let e=m().$implicit;h(e.nome)}}function it(s,i){s&1&&(n(0,"div",43),l(1,"(Include anche il logo)"),a())}function nt(s,i){if(s&1){let e=M();n(0,"div",62)(1,"label",63),f("click",function(t){return _(e),p(t.stopPropagation())}),n(2,"span"),l(3,"Quantit\xE0"),a(),n(4,"div",64)(5,"button",65),f("click",function(t){_(e);let r=m().$implicit;return m(2).adjustQuantity(r,-1,t),p(t.stopPropagation())}),n(6,"i",41),l(7,"remove"),a()(),n(8,"input",66),I("ngModelChange",function(t){_(e);let r=m().$implicit;return T(r.quantita,t)||(r.quantita=t),p(t)}),f("ngModelChange",function(){_(e);let t=m().$implicit,r=m(2);return p(r.onQtyChange(t))})("click",function(t){return _(e),p(t.stopPropagation())}),a(),n(9,"button",67),f("click",function(t){_(e);let r=m().$implicit;return m(2).adjustQuantity(r,1,t),p(t.stopPropagation())}),n(10,"i",41),l(11,"add"),a()()()()()}if(s&2){let e=m().$implicit;c(8),E("ngModel",e.quantita)}}function ot(s,i){if(s&1&&(n(0,"span",61),l(1),a()),s&2){let e=m().$implicit;c(),h(e.pacchetto)}}function at(s,i){if(s&1){let e=M();n(0,"div",52),f("click",function(){let t=_(e).$implicit,r=m(2);return p(r.toggleServizio("immagine_marketing",t))}),n(1,"div",53)(2,"h4"),S(3,et,2,0,"ng-container",54)(4,tt,1,1,"ng-template",null,2,L),a(),S(6,it,2,0,"div",55),n(7,"div",56),l(8),a()(),n(9,"p",57),l(10),a(),S(11,nt,12,1,"div",59)(12,ot,2,1,"span",58),n(13,"div",60)(14,"i",41),l(15,"check"),a()()()}if(s&2){let e=i.$implicit,o=W(5),t=m(2);A("selezionato",e.selezionato),c(3),v("ngIf",e.id==="creazione_brand")("ngIfElse",o),c(3),v("ngIf",e.id==="creazione_brand"),c(2),h(t.formatPrezzoServizio(e)),c(2),h(e.descrizione),c(),v("ngIf",e.selezionato),c(),v("ngIf",e.pacchetto),c(),A("attivo",e.selezionato)}}function rt(s,i){if(s&1){let e=M();n(0,"section",14)(1,"div",15)(2,"i",16),l(3,"brush"),a(),n(4,"div",17)(5,"h2",18),l(6,"Immagine & Marketing"),a(),n(7,"p",43),l(8,"Configura i servizi di branding e comunicazione"),a()()(),n(9,"h3",44),l(10,"Social Media Manager"),a(),n(11,"div",45),S(12,Ke,19,16,"div",46),a(),n(13,"h3",44),l(14,"Servizi singoli"),a(),n(15,"div",45),S(16,at,16,11,"div",47),a(),n(17,"div",48)(18,"div",49)(19,"div"),l(20),a(),n(21,"div"),l(22),a()()(),n(23,"div",28)(24,"button",50),f("click",function(){_(e);let t=m();return p(t.indietro())}),l(25,"Indietro"),a(),n(26,"button",51),f("click",function(){_(e);let t=m();return p(t.avanti())}),l(27,"Continua"),a()()()}if(s&2){let e=m();c(12),v("ngForOf",e.getServiziPacchetto("immagine_marketing")),c(4),v("ngForOf",e.getServiziSingoli("immagine_marketing")),c(4),V("Totale Modulo Una Tantum: ",e.formatCurrency(e.getTotaliModuloSplit("immagine_marketing").una)),c(2),V("Totale Modulo Mensile: ",e.formatCurrency(e.getTotaliModuloSplit("immagine_marketing").mensile))}}function lt(s,i){if(s&1&&(n(0,"span",61),l(1),a()),s&2){let e=m().$implicit;c(),h(e.pacchetto)}}function st(s,i){if(s&1){let e=M();n(0,"div",62)(1,"label",63),f("click",function(t){return _(e),p(t.stopPropagation())}),n(2,"span"),l(3,"Quantit\xE0"),a(),n(4,"div",64)(5,"button",65),f("click",function(t){_(e);let r=m().$implicit;return m(2).adjustQuantity(r,-1,t),p(t.stopPropagation())}),n(6,"i",41),l(7,"remove"),a()(),n(8,"input",66),I("ngModelChange",function(t){_(e);let r=m().$implicit;return T(r.quantita,t)||(r.quantita=t),p(t)}),f("ngModelChange",function(){_(e);let t=m().$implicit,r=m(2);return p(r.onQtyChange(t))})("click",function(t){return _(e),p(t.stopPropagation())}),a(),n(9,"button",67),f("click",function(t){_(e);let r=m().$implicit;return m(2).adjustQuantity(r,1,t),p(t.stopPropagation())}),n(10,"i",41),l(11,"add"),a()()()()()}if(s&2){let e=m().$implicit;c(8),E("ngModel",e.quantita)}}function ct(s,i){if(s&1){let e=M();n(0,"div",52),f("click",function(){let t=_(e).$implicit,r=m(2);return p(r.toggleServizio("digitalizzazione_automatismi",t))}),n(1,"div",53)(2,"h4"),l(3),a(),n(4,"div",56),l(5),a()(),n(6,"p",57),l(7),a(),S(8,lt,2,1,"span",58)(9,st,12,1,"div",59),n(10,"div",60)(11,"i",41),l(12,"check"),a()()()}if(s&2){let e=i.$implicit,o=m(2);A("selezionato",e.selezionato)("disabled",o.isServizioDisabled("digitalizzazione_automatismi",e)),c(3),h(e.nome),c(2),h(o.formatPrezzoServizio(e)),c(2),h(e.descrizione),c(),v("ngIf",e.pacchetto),c(),v("ngIf",e.selezionato),c(),A("attivo",e.selezionato)}}function mt(s,i){if(s&1){let e=M();n(0,"div",52),f("click",function(){let t=_(e).$implicit,r=m(2);return p(r.toggleServizio("digitalizzazione_automatismi",t))}),n(1,"div",53)(2,"h4"),l(3),a(),n(4,"div",56),l(5),a()(),n(6,"p",57),l(7),a(),n(8,"div",60)(9,"i",41),l(10,"check"),a()()()}if(s&2){let e=i.$implicit,o=m(2);A("selezionato",e.selezionato),c(3),h(e.nome),c(2),h(o.formatPrezzoServizio(e)),c(2),h(e.descrizione),c(),A("attivo",e.selezionato)}}function dt(s,i){if(s&1){let e=M();n(0,"section",14)(1,"div",15)(2,"i",16),l(3,"computer"),a(),n(4,"div",17)(5,"h2",18),l(6,"Digitalizzazione & Automatismi"),a(),n(7,"p",43),l(8,"Configura i servizi digitali e di automazione"),a()()(),n(9,"h3",44),l(10,"Sito"),a(),n(11,"div",45),S(12,ct,13,11,"div",46),a(),n(13,"h3",44),l(14,"Servizi singoli"),a(),n(15,"div",45),S(16,mt,11,7,"div",47),a(),n(17,"div",48)(18,"div",49)(19,"div",68)(20,"span",69),l(21,"Totale Modulo Una Tantum"),a(),n(22,"span",70),l(23),a()(),n(24,"div",68)(25,"span",69),l(26,"Totale Modulo Mensile"),a(),n(27,"span",70),l(28),a()()()(),n(29,"div",28)(30,"button",50),f("click",function(){_(e);let t=m();return p(t.indietro())}),l(31,"Indietro"),a(),n(32,"button",51),f("click",function(){_(e);let t=m();return p(t.avanti())}),l(33,"Continua"),a()()()}if(s&2){let e=m();c(12),v("ngForOf",e.getServiziPacchetto("digitalizzazione_automatismi")),c(4),v("ngForOf",e.getServiziSingoli("digitalizzazione_automatismi")),c(7),h(e.formatCurrency(e.getTotaliModuloSplit("digitalizzazione_automatismi").una)),c(5),h(e.formatCurrency(e.getTotaliModuloSplit("digitalizzazione_automatismi").mensile))}}function ut(s,i){if(s&1){let e=M();n(0,"div",52),f("click",function(){let t=_(e).$implicit,r=m(3);return p(r.isServizioContabilitaAbilitato(t)&&r.toggleServizioContabilita(t))}),n(1,"div",53)(2,"h4",75),l(3),a(),n(4,"div",76),l(5),a()(),n(6,"p",57),l(7),a(),n(8,"div",60)(9,"i",41),l(10,"check"),a()()()}if(s&2){let e=i.$implicit,o=m(3);A("selezionato",e.selezionato)("disabled",!o.isServizioContabilitaAbilitato(e)),c(3),h(e.nome),c(2),V("",e.prezzo," \u20AC"),c(2),h(e.descrizione),c(),A("attivo",e.selezionato)}}function _t(s,i){if(s&1&&(n(0,"div")(1,"div",105),S(2,ut,11,9,"div",106),a()()),s&2){let e=m(2);c(2),v("ngForOf",e.getServiziByCategoria("Costituzione"))}}function pt(s,i){if(s&1&&(n(0,"div",40)(1,"strong"),l(2,"Dettaglio calcolo:"),a(),l(3),a()),s&2){let e=m(2);c(3),V(" ",e.getDescrizioneContabilita(e.configurazioniContabilita.contabilita.tipo)," ")}}function zt(s,i){if(s&1&&(n(0,"div",56),l(1),a()),s&2){let e=m(2);c(),V(" ",e.configurazioniContabilita==null||e.configurazioniContabilita.iva==null?null:e.configurazioniContabilita.iva.prezzoCalcolato," \u20AC ")}}function gt(s,i){if(s&1){let e=M();n(0,"div",109),f("click",function(t){return _(e),p(t.stopPropagation())}),n(1,"label",110)(2,"span"),l(3,"Quantit\xE0"),a(),n(4,"div",64)(5,"button",111),f("click",function(t){_(e);let r=m(5);return r.configurazioniContabilita.altriServizi.modello770Count=r.Math.max(1,(r.configurazioniContabilita.altriServizi.modello770Count||1)-1),r.calcolaTotali(),p(t.stopPropagation())}),n(6,"i",41),l(7,"remove"),a()(),n(8,"input",66),I("ngModelChange",function(t){_(e);let r=m(5);return T(r.configurazioniContabilita.altriServizi.modello770Count,t)||(r.configurazioniContabilita.altriServizi.modello770Count=t),p(t)}),f("ngModelChange",function(){_(e);let t=m(5);return p(t.calcolaTotali())})("click",function(t){return _(e),p(t.stopPropagation())}),a(),n(9,"button",112),f("click",function(t){_(e);let r=m(5);return r.configurazioniContabilita.altriServizi.modello770Count=(r.configurazioniContabilita.altriServizi.modello770Count||1)+1,r.calcolaTotali(),p(t.stopPropagation())}),n(10,"i",41),l(11,"add"),a()()()()()}if(s&2){let e=m(5);c(8),E("ngModel",e.configurazioniContabilita.altriServizi.modello770Count)}}function ft(s,i){if(s&1){let e=M();n(0,"div",109),f("click",function(t){return _(e),p(t.stopPropagation())}),n(1,"label",110)(2,"span"),l(3,"Quantit\xE0"),a(),n(4,"div",64)(5,"button",111),f("click",function(t){_(e);let r=m(5);return r.configurazioniContabilita.altriServizi.imuCount=r.Math.max(1,(r.configurazioniContabilita.altriServizi.imuCount||1)-1),r.calcolaTotali(),p(t.stopPropagation())}),n(6,"i",41),l(7,"remove"),a()(),n(8,"input",66),I("ngModelChange",function(t){_(e);let r=m(5);return T(r.configurazioniContabilita.altriServizi.imuCount,t)||(r.configurazioniContabilita.altriServizi.imuCount=t),p(t)}),f("ngModelChange",function(){_(e);let t=m(5);return p(t.calcolaTotali())})("click",function(t){return _(e),p(t.stopPropagation())}),a(),n(9,"button",112),f("click",function(t){_(e);let r=m(5);return r.configurazioniContabilita.altriServizi.imuCount=(r.configurazioniContabilita.altriServizi.imuCount||1)+1,r.calcolaTotali(),p(t.stopPropagation())}),n(10,"i",41),l(11,"add"),a()()()()()}if(s&2){let e=m(5);c(8),E("ngModel",e.configurazioniContabilita.altriServizi.imuCount)}}function vt(s,i){if(s&1){let e=M();n(0,"div",109),f("click",function(t){return _(e),p(t.stopPropagation())}),n(1,"label",110)(2,"span"),l(3,"Quantit\xE0"),a(),n(4,"div",64)(5,"button",111),f("click",function(t){_(e);let r=m(5);return r.configurazioniContabilita.altriServizi.locazioniCount=r.Math.max(1,(r.configurazioniContabilita.altriServizi.locazioniCount||1)-1),r.calcolaTotali(),p(t.stopPropagation())}),n(6,"i",41),l(7,"remove"),a()(),n(8,"input",66),I("ngModelChange",function(t){_(e);let r=m(5);return T(r.configurazioniContabilita.altriServizi.locazioniCount,t)||(r.configurazioniContabilita.altriServizi.locazioniCount=t),p(t)}),f("ngModelChange",function(){_(e);let t=m(5);return p(t.calcolaTotali())})("click",function(t){return _(e),p(t.stopPropagation())}),a(),n(9,"button",112),f("click",function(t){_(e);let r=m(5);return r.configurazioniContabilita.altriServizi.locazioniCount=(r.configurazioniContabilita.altriServizi.locazioniCount||1)+1,r.calcolaTotali(),p(t.stopPropagation())}),n(10,"i",41),l(11,"add"),a()()()()()}if(s&2){let e=m(5);c(8),E("ngModel",e.configurazioniContabilita.altriServizi.locazioniCount)}}function ht(s,i){if(s&1){let e=M();n(0,"div",109),f("click",function(t){return _(e),p(t.stopPropagation())}),n(1,"label",110)(2,"span"),l(3,"Quantit\xE0"),a(),n(4,"div",64)(5,"button",111),f("click",function(t){_(e);let r=m(5);return r.configurazioniContabilita.altriServizi.smartCardRilascioCount=r.Math.max(1,(r.configurazioniContabilita.altriServizi.smartCardRilascioCount||1)-1),r.calcolaTotali(),p(t.stopPropagation())}),n(6,"i",41),l(7,"remove"),a()(),n(8,"input",66),I("ngModelChange",function(t){_(e);let r=m(5);return T(r.configurazioniContabilita.altriServizi.smartCardRilascioCount,t)||(r.configurazioniContabilita.altriServizi.smartCardRilascioCount=t),p(t)}),f("ngModelChange",function(){_(e);let t=m(5);return p(t.calcolaTotali())})("click",function(t){return _(e),p(t.stopPropagation())}),a(),n(9,"button",112),f("click",function(t){_(e);let r=m(5);return r.configurazioniContabilita.altriServizi.smartCardRilascioCount=(r.configurazioniContabilita.altriServizi.smartCardRilascioCount||1)+1,r.calcolaTotali(),p(t.stopPropagation())}),n(10,"i",41),l(11,"add"),a()()()()()}if(s&2){let e=m(5);c(8),E("ngModel",e.configurazioniContabilita.altriServizi.smartCardRilascioCount)}}function xt(s,i){if(s&1&&(n(0,"div"),S(1,gt,12,1,"div",108)(2,ft,12,1,"div",108)(3,vt,12,1,"div",108)(4,ht,12,1,"div",108),a()),s&2){let e=m().$implicit;c(),v("ngIf",e.id==="altro_modello_770"),c(),v("ngIf",e.id==="altro_imu_dichiarazione"),c(),v("ngIf",e.id==="altro_locazioni"),c(),v("ngIf",e.id==="altro_smart_card_rilascio")}}function Ct(s,i){if(s&1){let e=M();n(0,"div",52),f("click",function(){let t=_(e).$implicit,r=m(3);return p(r.toggleServizioContabilita(t))}),n(1,"div",53)(2,"h4"),l(3),a(),n(4,"div",56),l(5),a()(),n(6,"p",57),l(7),a(),S(8,xt,5,4,"div",77),n(9,"div",60)(10,"i",41),l(11,"check"),a()()()}if(s&2){let e=i.$implicit,o=m(3);A("selezionato",e.selezionato),c(3),h(e.nome),c(2),h(o.formatPrezzoServizio(e)),c(2),h(e.descrizione),c(),v("ngIf",e.selezionato),c(),A("attivo",e.selezionato)}}function bt(s,i){if(s&1&&(n(0,"div",107),S(1,Ct,12,8,"div",47),a()),s&2){let e=m(2);c(),v("ngForOf",e.getServiziByCategoria("Altri Servizi"))}}function St(s,i){if(s&1){let e=M();n(0,"section",14)(1,"div",15)(2,"i",16),l(3,"calculate"),a(),n(4,"div",17)(5,"h2",18),l(6,"Contabilit\xE0 e Fiscalit\xE0"),a(),n(7,"p",43),l(8,"Configura i servizi contabili e fiscali in base alle tue esigenze"),a()()(),n(9,"div",71)(10,"div",72)(11,"div",73)(12,"div",74),f("click",function(){_(e);let t=m();return p(t.toggleServizioContabilita(t.moduli.contabilita_fiscalita.servizi[0]))}),n(13,"div",75)(14,"div",53)(15,"h3",18),l(16,"Costituzione Azienda"),a(),n(17,"div",76),l(18,"Configurabile"),a()()(),n(19,"p",57),l(20,"Servizi di costituzione aziendale - Seleziona per attivare i servizi specifici"),a(),n(21,"div",60)(22,"i",41),l(23,"check"),a()()(),S(24,_t,3,1,"div",77),a()(),n(25,"div",72)(26,"div",19)(27,"div",75)(28,"h3",18),l(29,"Contabilit\xE0"),a(),n(30,"div",56),l(31),a()(),n(32,"div",78)(33,"button",79),f("click",function(t){return _(e),m().toggleService("contabilita_fiscalita","contabilita_principale",!0),p(t.stopPropagation())}),n(34,"i",41),l(35),a()()(),n(36,"div",80)(37,"div",81)(38,"label",20),l(39,"Tipo di Contabilit\xE0:"),a(),n(40,"select",82),I("ngModelChange",function(t){_(e);let r=m();return T(r.configurazioniContabilita.contabilita.tipo,t)||(r.configurazioniContabilita.contabilita.tipo=t),p(t)}),f("change",function(){_(e);let t=m();return p(t.calcolaPrezzoContabilita())}),n(41,"option",83),l(42,"Seleziona"),a(),n(43,"option",84),l(44,"Semplificata"),a(),n(45,"option",85),l(46,"Ordinaria"),a(),n(47,"option",86),l(48,"Mista"),a()()(),n(49,"div",81)(50,"label",20),l(51,"Numero Registrazioni Annuali:"),a(),n(52,"input",87),I("ngModelChange",function(t){_(e);let r=m();return T(r.configurazioniContabilita.contabilita.registrazioni,t)||(r.configurazioniContabilita.contabilita.registrazioni=t),p(t)}),f("change",function(){_(e);let t=m();return p(t.calcolaPrezzoContabilita())}),a()()(),S(53,pt,4,1,"div",26),a()(),n(54,"div",72)(55,"div",19)(56,"div",75)(57,"h3",18),l(58,"Fatturazione"),a(),n(59,"div",56),l(60),a()(),n(61,"div",78)(62,"button",79),f("click",function(t){return _(e),m().toggleService("contabilita_fiscalita","fatturazione_principale",!0),p(t.stopPropagation())}),n(63,"i",41),l(64),a()()(),n(65,"div",80)(66,"div",81)(67,"label",20),l(68,"Tipo di Fatturazione:"),a(),n(69,"select",82),I("ngModelChange",function(t){_(e);let r=m();return T(r.configurazioniContabilita.fatturazione.tipo,t)||(r.configurazioniContabilita.fatturazione.tipo=t),p(t)}),f("change",function(){_(e);let t=m();return p(t.calcolaPrezzoFatturazione())}),n(70,"option",83),l(71,"Seleziona"),a(),n(72,"option",88),l(73,"Emissione da parte nostra (25\u20AC/fattura)"),a(),n(74,"option",89),l(75,"Piattaforma PassCom (4\u20AC/fattura)"),a()()(),n(76,"div",81)(77,"label",20),l(78,"Numero Fatture Annuali:"),a(),n(79,"input",90),I("ngModelChange",function(t){_(e);let r=m();return T(r.configurazioniContabilita.fatturazione.numeroFatture,t)||(r.configurazioniContabilita.fatturazione.numeroFatture=t),p(t)}),f("change",function(){_(e);let t=m();return p(t.calcolaPrezzoFatturazione())}),a()()()()(),n(80,"div",72)(81,"div",19)(82,"div",75)(83,"h3",18),l(84,"IVA"),a(),S(85,zt,2,1,"div",91),a(),n(86,"div",78)(87,"button",79),f("click",function(t){return _(e),m().toggleService("contabilita_fiscalita","iva_principale",!0),p(t.stopPropagation())}),n(88,"i",41),l(89),a()()(),n(90,"div",80)(91,"div",81)(92,"label",20),l(93,"Liquidazione IVA:"),a(),n(94,"select",82),I("ngModelChange",function(t){_(e);let r=m();return T(r.configurazioniContabilita.iva.liquidazione,t)||(r.configurazioniContabilita.iva.liquidazione=t),p(t)}),f("change",function(){_(e);let t=m();return p(t.calcolaPrezzoIVA())}),n(95,"option",83),l(96,"Seleziona"),a(),n(97,"option",92),l(98,"Trimestrale"),a(),n(99,"option",93),l(100,"Mensile"),a()()(),n(101,"div",81)(102,"label",20),l(103,"LIPE:"),a(),n(104,"select",82),I("ngModelChange",function(t){_(e);let r=m();return T(r.configurazioniContabilita.iva.lipe,t)||(r.configurazioniContabilita.iva.lipe=t),p(t)}),f("change",function(){_(e);let t=m();return p(t.calcolaPrezzoIVA())}),n(105,"option",92),l(106,"Trimestrale"),a(),n(107,"option",93),l(108,"Mensile"),a()()(),n(109,"div",81)(110,"label",20),l(111,"Volume d'Affari per Dichiarazione Annuale:"),a(),n(112,"select",82),I("ngModelChange",function(t){_(e);let r=m();return T(r.configurazioniContabilita.iva.volumeAffari,t)||(r.configurazioniContabilita.iva.volumeAffari=t),p(t)}),f("change",function(){_(e);let t=m();return p(t.calcolaPrezzoIVA())}),n(113,"option",94),l(114,"Fino a 75.000\u20AC"),a(),n(115,"option",95),l(116,"75.001-150.000\u20AC"),a(),n(117,"option",96),l(118,"150.001-300.000\u20AC"),a(),n(119,"option",97),l(120,"300.001-500.000\u20AC"),a(),n(121,"option",98),l(122,"500.001-750.000\u20AC"),a(),n(123,"option",99),l(124,"Oltre 750.000\u20AC"),a()()()(),n(125,"div",80)(126,"div",100)(127,"label")(128,"input",101),I("ngModelChange",function(t){_(e);let r=m();return T(r.configurazioniContabilita.iva.vistoConformita,t)||(r.configurazioniContabilita.iva.vistoConformita=t),p(t)}),f("change",function(){_(e);let t=m();return p(t.calcolaPrezzoIVA())}),a(),l(129," Visto di Conformit\xE0 "),a()(),n(130,"div",100)(131,"label")(132,"input",101),I("ngModelChange",function(t){_(e);let r=m();return T(r.configurazioniContabilita.iva.modelloIVATR,t)||(r.configurazioniContabilita.iva.modelloIVATR=t),p(t)}),f("change",function(){_(e);let t=m();return p(t.calcolaPrezzoIVA())}),a(),l(133," Modello IVA TR "),a()(),n(134,"div",100)(135,"label")(136,"input",101),I("ngModelChange",function(t){_(e);let r=m();return T(r.configurazioniContabilita.iva.intrastat,t)||(r.configurazioniContabilita.iva.intrastat=t),p(t)}),f("change",function(){_(e);let t=m();return p(t.calcolaPrezzoIVA())}),a(),l(137," Intrastat "),a()()()()(),n(138,"div",72)(139,"h3",102)(140,"span"),l(141,"Altri Servizi"),a(),n(142,"button",103),f("click",function(t){return _(e),m().toggleAltriServizi(),p(t.stopPropagation())}),n(143,"i",41),l(144),a()()(),S(145,bt,2,1,"div",104),a()(),n(146,"div",48)(147,"div",49)(148,"div",68)(149,"span",69),l(150,"Totale Modulo Una Tantum"),a(),n(151,"span",70),l(152),a()(),n(153,"div",68)(154,"span",69),l(155,"Totale Modulo Mensile"),a(),n(156,"span",70),l(157),a()()()(),n(158,"div",28)(159,"button",50),f("click",function(){_(e);let t=m();return p(t.indietro())}),l(160,"Indietro"),a(),n(161,"button",51),f("click",function(){_(e);let t=m();return p(t.avanti())}),l(162,"Continua"),a()()()}if(s&2){let e=m();c(12),A("active",e.configurazioniContabilita.costituzione.attivo),c(9),A("attivo",e.configurazioniContabilita.costituzione.attivo),c(3),v("ngIf",e.configurazioniContabilita.costituzione.attivo),c(7),V("",e.configurazioniContabilita.contabilita.prezzoCalcolato," \u20AC"),c(2),v("title",e.isServiceSelected("contabilita_fiscalita","contabilita_principale")?"Rimuovi servizio":"Aggiungi servizio"),c(2),V(" ",e.isServiceSelected("contabilita_fiscalita","contabilita_principale")?"remove_circle_outline":"add_circle"," "),c(5),E("ngModel",e.configurazioniContabilita.contabilita.tipo),c(12),E("ngModel",e.configurazioniContabilita.contabilita.registrazioni),c(),v("ngIf",(e.configurazioniContabilita==null||e.configurazioniContabilita.contabilita==null?null:e.configurazioniContabilita.contabilita.prezzoCalcolato)>0&&(e.getServiziSelezionatiModulo("contabilita_fiscalita")||ee(29,Ne)).length>0),c(7),V("",e.configurazioniContabilita.fatturazione.prezzoCalcolato," \u20AC"),c(2),v("title",e.isServiceSelected("contabilita_fiscalita","fatturazione_principale")?"Rimuovi servizio":"Aggiungi servizio"),c(2),V(" ",e.isServiceSelected("contabilita_fiscalita","fatturazione_principale")?"remove_circle_outline":"add_circle"," "),c(5),E("ngModel",e.configurazioniContabilita.fatturazione.tipo),c(10),E("ngModel",e.configurazioniContabilita.fatturazione.numeroFatture),c(6),v("ngIf",(e.configurazioniContabilita==null||e.configurazioniContabilita.iva==null?null:e.configurazioniContabilita.iva.prezzoCalcolato)>0),c(2),v("title",e.isServiceSelected("contabilita_fiscalita","iva_principale")?"Rimuovi servizio":"Aggiungi servizio"),c(2),V(" ",e.isServiceSelected("contabilita_fiscalita","iva_principale")?"remove_circle_outline":"add_circle"," "),c(5),E("ngModel",e.configurazioniContabilita.iva.liquidazione),c(10),E("ngModel",e.configurazioniContabilita.iva.lipe),c(8),E("ngModel",e.configurazioniContabilita.iva.volumeAffari),c(16),E("ngModel",e.configurazioniContabilita.iva.vistoConformita),c(4),E("ngModel",e.configurazioniContabilita.iva.modelloIVATR),c(4),E("ngModel",e.configurazioniContabilita.iva.intrastat),c(8),h(e.showAltriServizi?"expand_less":"expand_more"),c(),v("ngIf",e.showAltriServizi),c(7),h(e.formatCurrency(e.getTotaliModuloSplit("contabilita_fiscalita").una)),c(5),h(e.formatCurrency(e.getTotaliModuloSplit("contabilita_fiscalita").mensile))}}function yt(s,i){if(s&1&&(n(0,"span",61),l(1),a()),s&2){let e=m().$implicit;c(),h(e.pacchetto)}}function wt(s,i){if(s&1){let e=M();n(0,"div",62)(1,"label",63),f("click",function(t){return _(e),p(t.stopPropagation())}),n(2,"span"),l(3,"Quantit\xE0"),a(),n(4,"div",64)(5,"button",65),f("click",function(t){_(e);let r=m().$implicit;return m(2).adjustQuantity(r,-1,t),p(t.stopPropagation())}),n(6,"i",41),l(7,"remove"),a()(),n(8,"input",66),I("ngModelChange",function(t){_(e);let r=m().$implicit;return T(r.quantita,t)||(r.quantita=t),p(t)}),f("ngModelChange",function(){_(e);let t=m().$implicit,r=m(2);return p(r.onQtyChange(t))})("click",function(t){return _(e),p(t.stopPropagation())}),a(),n(9,"button",67),f("click",function(t){_(e);let r=m().$implicit;return m(2).adjustQuantity(r,1,t),p(t.stopPropagation())}),n(10,"i",41),l(11,"add"),a()()()()()}if(s&2){let e=m().$implicit;c(8),E("ngModel",e.quantita)}}function Mt(s,i){if(s&1){let e=M();n(0,"div",52),f("click",function(){let t=_(e).$implicit,r=m(2);return p(r.toggleServizio("ottimizzazione_management",t))}),n(1,"div",53)(2,"h4"),l(3),a(),n(4,"div",56),l(5),a()(),n(6,"p",57),l(7),a(),S(8,yt,2,1,"span",58)(9,wt,12,1,"div",59),n(10,"div",60)(11,"i",41),l(12,"check"),a()()()}if(s&2){let e=i.$implicit,o=m(2);A("selezionato",e.selezionato)("disabled",o.isServizioDisabled("ottimizzazione_management",e)),c(3),h(e.nome),c(2),h(o.formatPrezzoServizio(e)),c(2),h(e.descrizione),c(),v("ngIf",e.pacchetto),c(),v("ngIf",e.selezionato),c(),A("attivo",e.selezionato)}}function Pt(s,i){if(s&1&&(n(0,"span",61),l(1),a()),s&2){let e=m().$implicit;c(),h(e.pacchetto)}}function At(s,i){if(s&1){let e=M();n(0,"div",62)(1,"label",63),f("click",function(t){return _(e),p(t.stopPropagation())}),n(2,"span"),l(3,"Quantit\xE0"),a(),n(4,"div",64)(5,"button",65),f("click",function(t){_(e);let r=m().$implicit;return m(2).adjustQuantity(r,-1,t),p(t.stopPropagation())}),n(6,"i",41),l(7,"remove"),a()(),n(8,"input",66),I("ngModelChange",function(t){_(e);let r=m().$implicit;return T(r.quantita,t)||(r.quantita=t),p(t)}),f("ngModelChange",function(){_(e);let t=m().$implicit,r=m(2);return p(r.onQtyChange(t))})("click",function(t){return _(e),p(t.stopPropagation())}),a(),n(9,"button",67),f("click",function(t){_(e);let r=m().$implicit;return m(2).adjustQuantity(r,1,t),p(t.stopPropagation())}),n(10,"i",41),l(11,"add"),a()()()()()}if(s&2){let e=m().$implicit;c(8),E("ngModel",e.quantita)}}function Et(s,i){if(s&1){let e=M();n(0,"div",52),f("click",function(){let t=_(e).$implicit,r=m(2);return p(r.toggleServizio("ottimizzazione_management",t))}),n(1,"div",53)(2,"h4"),l(3),a(),n(4,"div",56),l(5),a()(),n(6,"p",57),l(7),a(),S(8,Pt,2,1,"span",58)(9,At,12,1,"div",59),n(10,"div",60)(11,"i",41),l(12,"check"),a()()()}if(s&2){let e=i.$implicit,o=m(2);A("selezionato",e.selezionato)("disabled",o.isServizioDisabled("ottimizzazione_management",e)),c(3),h(e.nome),c(2),h(o.formatPrezzoServizio(e)),c(2),h(e.descrizione),c(),v("ngIf",e.pacchetto),c(),v("ngIf",e.selezionato),c(),A("attivo",e.selezionato)}}function Tt(s,i){if(s&1){let e=M();n(0,"div",52),f("click",function(){let t=_(e).$implicit,r=m(2);return p(r.toggleServizio("ottimizzazione_management",t))}),n(1,"div",53)(2,"h4"),l(3),a(),n(4,"div",56),l(5),a()(),n(6,"p",57),l(7),a(),n(8,"div",60)(9,"i",41),l(10,"check"),a()()()}if(s&2){let e=i.$implicit,o=m(2);A("selezionato",e.selezionato),c(3),h(e.nome),c(2),h(o.formatPrezzoServizio(e)),c(2),h(e.descrizione),c(),A("attivo",e.selezionato)}}function It(s,i){if(s&1){let e=M();n(0,"section",14)(1,"div",15)(2,"i",16),l(3,"tune"),a(),n(4,"div",17)(5,"h2",18),l(6,"Ottimizzazione e Management"),a(),n(7,"p",43),l(8,"Configura i servizi di ottimizzazione"),a()()(),n(9,"h3",44),l(10,"Pacchetti \u2014 Consulenze di Impresa"),a(),n(11,"div",45),S(12,Mt,13,11,"div",106),a(),n(13,"h3",44),l(14,"Pacchetti \u2014 Formazione Commerciale"),a(),n(15,"div",45),S(16,Et,13,11,"div",106),a(),n(17,"h3",44),l(18,"Servizi singoli"),a(),n(19,"div",45),S(20,Tt,11,7,"div",47),a(),n(21,"div",48)(22,"div",49)(23,"div",68)(24,"span",69),l(25,"Totale Modulo Una Tantum"),a(),n(26,"span",70),l(27),a()(),n(28,"div",68)(29,"span",69),l(30,"Totale Modulo Mensile"),a(),n(31,"span",70),l(32),a()()()(),n(33,"div",28)(34,"button",50),f("click",function(){_(e);let t=m();return p(t.indietro())}),l(35,"Indietro"),a(),n(36,"button",51),f("click",function(){_(e);let t=m();return p(t.avanti())}),l(37,"Vedi Riepilogo"),a()()()}if(s&2){let e=m();c(12),v("ngForOf",e.getPacchettiConsulenza()),c(4),v("ngForOf",e.getPacchettiFormazione()),c(4),v("ngForOf",e.getServiziSingoli("ottimizzazione_management")),c(7),h(e.formatCurrency(e.getTotaliModuloSplit("ottimizzazione_management").una)),c(5),h(e.formatCurrency(e.getTotaliModuloSplit("ottimizzazione_management").mensile))}}function Vt(s,i){if(s&1&&(n(0,"div",40)(1,"i",41),l(2,"business"),a(),l(3," Prospect: "),n(4,"strong"),l(5),a()()),s&2){let e=m(2);c(5),h(e.selectedProspect.ragione_sociale)}}function kt(s,i){if(s&1&&(n(0,"div",129)(1,"div",130)(2,"span",131),l(3,"\u2713"),a(),n(4,"span",132),l(5),a()(),n(6,"div",133),l(7),a()()),s&2){let e=i.$implicit,o=m(3);c(5),h(e.nome),c(2),h(o.formatPrezzoServizio(e))}}function Nt(s,i){if(s&1&&(n(0,"div",19)(1,"h2",75),l(2,"Immagine & Marketing"),a(),n(3,"div",80),S(4,kt,8,2,"div",127),a(),n(5,"div",49)(6,"div",68)(7,"span",128),l(8,"Totale Modulo Una Tantum"),a(),n(9,"span",70),l(10),a()(),n(11,"div",68)(12,"span",128),l(13,"Totale Modulo Mensile"),a(),n(14,"span",70),l(15),a()()()()),s&2){let e=m(2);c(4),v("ngForOf",e.getServiziSelezionatiModulo("immagine_marketing")),c(6),h(e.formatCurrency(e.getTotaliModuloSplit("immagine_marketing").una)),c(5),h(e.formatCurrency(e.getTotaliModuloSplit("immagine_marketing").mensile))}}function Ot(s,i){if(s&1&&(D(0),l(1),R()),s&2){let e=m().$implicit,o=m(3);c(),V(" ",o.formatCurrency(o.num(e.prezzo||0))," ")}}function Ft(s,i){if(s&1&&l(0),s&2){let e=m().$implicit,o=m(3);V(" ",o.formatPrezzoServizio(e)," ")}}function qt(s,i){if(s&1&&(n(0,"div",129)(1,"div",130)(2,"span",138),l(3,"\u2713"),a(),n(4,"span",132),l(5,"Software Personalizzato Mantenimento"),a()(),n(6,"div",133),l(7),a()()),s&2){let e=m().$implicit,o=m(3);c(7),V(" ",o.formatCurrency(o.num(e.prezzo_mensile??e.prezzoMensile))," /mese ")}}function Dt(s,i){if(s&1&&(n(0,"div",135)(1,"div",129)(2,"div",130)(3,"span",136),l(4,"\u2713"),a(),n(5,"span",132),l(6),a()(),n(7,"div",133),S(8,Ot,2,1,"ng-container",54)(9,Ft,1,1,"ng-template",null,5,L),a()(),S(11,qt,8,1,"div",137),a()),s&2){let e=i.$implicit,o=W(10),t=m(3);c(6),h(e.nome),c(2),v("ngIf",e.id==="software_personalizzato")("ngIfElse",o),c(3),v("ngIf",e.id==="software_personalizzato"&&t.num(e.prezzo_mensile??e.prezzoMensile)>0)}}function Rt(s,i){if(s&1&&(n(0,"div",19)(1,"h2",75),l(2,"Digitalizzazione & Automatismi"),a(),n(3,"div",80),S(4,Dt,12,4,"div",134),a(),n(5,"div",49)(6,"div",68)(7,"span",128),l(8,"Totale Modulo Una Tantum"),a(),n(9,"span",70),l(10),a()(),n(11,"div",68)(12,"span",128),l(13,"Totale Modulo Mensile"),a(),n(14,"span",70),l(15),a()()()()),s&2){let e=m(2);c(4),v("ngForOf",e.getServiziSelezionatiModulo("digitalizzazione_automatismi")),c(6),h(e.formatCurrency(e.getTotaliModuloSplit("digitalizzazione_automatismi").una)),c(5),h(e.formatCurrency(e.getTotaliModuloSplit("digitalizzazione_automatismi").mensile))}}function Wt(s,i){if(s&1&&(D(0),n(1,"span"),l(2),a(),n(3,"span",140),l(4,"\xD7"),a(),n(5,"strong"),l(6),a(),n(7,"span",141),l(8),a(),R()),s&2){let e=m().$implicit,o=m(3);c(2),h(o.formatPrezzoServizio(e)),c(4),h(o.getAltriServiziCountFor(e.id)),c(2),V("= ",o.formatCurrency((e.prezzo||0)*o.getAltriServiziCountFor(e.id)))}}function Lt(s,i){if(s&1&&l(0),s&2){let e=m().$implicit,o=m(3);V(" ",o.formatPrezzoServizio(e)," ")}}function Ut(s,i){if(s&1&&(n(0,"div",129)(1,"div",130)(2,"span",139),l(3,"\u2713"),a(),n(4,"span",132),l(5),a()(),n(6,"div",133),S(7,Wt,9,3,"ng-container",54)(8,Lt,1,1,"ng-template",null,6,L),a()()),s&2){let e=i.$implicit,o=W(9),t=m(3);c(5),h(e.nome),c(2),v("ngIf",t.isAltriServiziCounted(e.id))("ngIfElse",o)}}function Bt(s,i){if(s&1&&(n(0,"div",19)(1,"h2",75),l(2,"Contabilit\xE0 e Fiscalit\xE0"),a(),n(3,"div",80),S(4,Ut,10,3,"div",127),a(),n(5,"div",49)(6,"div",68)(7,"span",128),l(8,"Totale Modulo Una Tantum"),a(),n(9,"span",70),l(10),a()(),n(11,"div",68)(12,"span",128),l(13,"Totale Modulo Mensile"),a(),n(14,"span",70),l(15),a()()()()),s&2){let e=m(2);c(4),v("ngForOf",e.getServiziSelezionatiModulo("contabilita_fiscalita")),c(6),h(e.formatCurrency(e.getTotaliModuloSplit("contabilita_fiscalita").una)),c(5),h(e.formatCurrency(e.getTotaliModuloSplit("contabilita_fiscalita").mensile))}}function $t(s,i){if(s&1&&(n(0,"div",129)(1,"div",130)(2,"span",142),l(3,"\u2713"),a(),n(4,"span",132),l(5),a()(),n(6,"div",133),l(7),a()()),s&2){let e=i.$implicit,o=m(3);c(5),h(e.nome),c(2),h(o.formatPrezzoServizio(e))}}function jt(s,i){if(s&1&&(n(0,"div",19)(1,"h2",75),l(2,"Ottimizzazione e Management"),a(),n(3,"div",80),S(4,$t,8,2,"div",127),a(),n(5,"div",49)(6,"div",68)(7,"span",128),l(8,"Totale Modulo Una Tantum"),a(),n(9,"span",70),l(10),a()(),n(11,"div",68)(12,"span",128),l(13,"Totale Modulo Mensile"),a(),n(14,"span",70),l(15),a()()()()),s&2){let e=m(2);c(4),v("ngForOf",e.getServiziSelezionatiModulo("ottimizzazione_management")),c(6),h(e.formatCurrency(e.getTotaliModuloSplit("ottimizzazione_management").una)),c(5),h(e.formatCurrency(e.getTotaliModuloSplit("ottimizzazione_management").mensile))}}function Gt(s,i){if(s&1&&(D(0),n(1,"span",143),l(2),a(),n(3,"strong",144),l(4),a(),n(5,"span"),l(6,"/mese"),a(),R()),s&2){let e=m(2);c(2),h(e.formatCurrency(e.totaleMensile)),c(2),h(e.formatCurrency(e.totaleMensileScontato))}}function Qt(s,i){if(s&1&&(n(0,"span",145),l(1),a(),n(2,"span"),l(3,"/mese"),a()),s&2){let e=m(2);c(),h(e.formatCurrency(e.totaleMensile))}}function Ht(s,i){if(s&1&&(D(0),n(1,"span",143),l(2),a(),n(3,"strong",144),l(4),a(),R()),s&2){let e=m(2);c(2),h(e.formatCurrency(e.totaleUnaTantum)),c(2),h(e.formatCurrency(e.totaleUnaScontata))}}function Yt(s,i){if(s&1&&(n(0,"span"),l(1),a()),s&2){let e=m(2);c(),h(e.formatCurrency(e.totaleUnaTantum))}}function Jt(s,i){if(s&1&&(D(0),n(1,"div",146)(2,"small",147),l(3),B(4,"number"),a()(),R()),s&2){let e=m(2);c(3),U("(sconto ",j(4,2,e.scontoPercentuale,"1.2-2"),"% \u2014 target: ",e.scontoTarget,")")}}function Xt(s,i){if(s&1){let e=M();n(0,"button",148),f("click",function(){_(e);let t=m(2);return p(t.salvaConfigurazione())}),n(1,"i",41),l(2,"save"),a(),l(3," Salva Configurazione "),a()}}function Zt(s,i){if(s&1&&(n(0,"span",157),l(1),B(2,"number"),a()),s&2){let e=m(3);c(),U(" ",j(2,2,e.scontoPercentuale,"1.2-2"),"% - Risparmio: ",e.formatCurrency(e.totaleGenerale-e.totaleScontato)," ")}}function Kt(s,i){s&1&&(n(0,"span",147),l(1," In attesa di valutazione / da confermare "),a())}function ei(s,i){if(s&1){let e=M();n(0,"button",120),f("click",function(){_(e);let t=m(3);return t.applySconto(0),p(t.salvaConfigurazione())}),n(1,"span",41),l(2,"close"),a(),l(3," Rimuovi Sconto "),a()}}function ti(s,i){if(s&1&&(n(0,"span"),l(1),a()),s&2){let e=m(3);c(),h(e.formatCurrency(e.totaleScontato))}}function ii(s,i){if(s&1&&(n(0,"span"),l(1),a()),s&2){let e=m(3);c(),h(e.formatCurrency(e.totaleGenerale))}}function ni(s,i){if(s&1&&(n(0,"div",81)(1,"label",20),l(2,"Totale non scontato"),a(),n(3,"div",158),l(4),a()()),s&2){let e=m(3);c(4),h(e.formatCurrency(e.totaleGenerale))}}function oi(s,i){if(s&1&&(n(0,"div",8)(1,"h3",18)(2,"span",41),l(3,"local_offer"),a(),l(4," Gestione Sconto "),a(),n(5,"div",80)(6,"div",81)(7,"label",20),l(8,"Sconto Applicato"),a(),n(9,"div",149),S(10,Zt,3,5,"span",150)(11,Kt,2,0,"span",151),a()(),n(12,"div",81)(13,"label",20),l(14,"Azioni"),a(),n(15,"div",152),S(16,ei,4,0,"button",153),a()()(),n(17,"div",154)(18,"div",80)(19,"div",81)(20,"label",20),l(21,"Totale Preventivo"),a(),n(22,"div",155),S(23,ti,2,1,"span",77)(24,ii,2,1,"span",77),a()(),S(25,ni,5,1,"div",156),a()()()),s&2){let e=m(2);c(10),v("ngIf",e.scontoPercentuale>0),c(),v("ngIf",e.scontoPercentuale===0),c(5),v("ngIf",e.scontoPercentuale>0),c(7),v("ngIf",e.scontoPercentuale>0),c(),v("ngIf",e.scontoPercentuale===0),c(),v("ngIf",e.scontoPercentuale>0)}}function ai(s,i){s&1&&(n(0,"span",41),l(1,"support_agent"),a())}function ri(s,i){s&1&&(n(0,"span",41),l(1,"person"),a())}function li(s,i){if(s&1&&(n(0,"div",169)(1,"div",170),S(2,ai,2,0,"span",171)(3,ri,2,0,"span",171),a(),n(4,"div",172)(5,"div",61),l(6),a(),n(7,"div",147),l(8),B(9,"date"),a()()()),s&2){let e=i.$implicit;v("ngClass",te(8,Oe,e.autore==="utente",e.autore==="assistenza")),c(2),v("ngIf",e.autore==="assistenza"),c(),v("ngIf",e.autore==="utente"),c(3),h(e.testo),c(2),h(j(9,5,e.timestamp,"HH:mm"))}}function si(s,i){if(s&1){let e=M();n(0,"div",159)(1,"div",160)(2,"div",161)(3,"h3",162)(4,"span",41),l(5,"support_agent"),a(),l(6),a(),n(7,"button",163),f("click",function(){_(e);let t=m(2);return p(t.chiudiChatSconto())}),a()(),n(8,"div",164)(9,"div",165),S(10,li,10,11,"div",166),a(),n(11,"div",167)(12,"input",168),I("ngModelChange",function(t){_(e);let r=m(2);return T(r.messaggioChat,t)||(r.messaggioChat=t),p(t)}),f("keyup.enter",function(){_(e);let t=m(2);return p(t.inviaMessaggio())}),a(),n(13,"button",29),f("click",function(){_(e);let t=m(2);return p(t.inviaMessaggio())}),n(14,"span",41),l(15,"send"),a()()()()()()}if(s&2){let e=m(2);c(6),V(" Assistenza Preventivo \xB7 ",(e.selectedProspect==null?null:e.selectedProspect.ragione_sociale)||"Cliente"," "),c(4),v("ngForOf",e.messaggiAssistenza),c(2),E("ngModel",e.messaggioChat),c(),v("disabled",!e.messaggioChat.trim())}}function ci(s,i){if(s&1){let e=M();n(0,"section",113)(1,"div",15)(2,"i",16),l(3,"receipt_long"),a(),n(4,"div",17)(5,"h2",18),l(6,"Riepilogo Configurazione"),a()()(),n(7,"div"),S(8,Vt,6,1,"div",26),n(9,"div",45),S(10,Nt,16,3,"div",114)(11,Rt,16,3,"div",114)(12,Bt,16,3,"div",114)(13,jt,16,3,"div",114),a(),n(14,"div",115)(15,"h3",116)(16,"div",117)(17,"div")(18,"span",118),l(19,"Totale mensile:"),a(),S(20,Gt,7,2,"ng-container",54)(21,Qt,4,1,"ng-template",null,3,L),a(),n(23,"div")(24,"span",118),l(25,"Totale una tantum:"),a(),S(26,Ht,5,2,"ng-container",54)(27,Yt,2,1,"ng-template",null,4,L),a()(),S(29,Jt,5,5,"ng-container",77),a()()(),n(30,"div",119)(31,"button",120),f("click",function(){_(e);let t=m();return p(t.indietro())}),n(32,"span",41),l(33,"edit"),a(),l(34,"Modifica "),a(),n(35,"button",121),f("click",function(){_(e);let t=m();return p(t.apriChatSconto())}),n(36,"span",41),l(37,"support_agent"),a(),l(38,"Assistenza "),a(),n(39,"button",122),f("click",function(){_(e);let t=m();return p(t.visualizzaPreventivo())}),n(40,"span",41),l(41,"description"),a(),l(42," Visualizza Preventivo "),a(),S(43,Xt,4,0,"button",123),n(44,"button",124),f("click",function(){_(e);let t=m();return p(t.procediPerFirme())}),n(45,"i",41),l(46,"assignment_turned_in"),a(),l(47),a()(),S(48,oi,26,6,"div",125)(49,si,16,4,"div",126),a()}if(s&2){let e=W(22),o=W(28),t=m();c(8),v("ngIf",t.selectedProspect),c(2),v("ngIf",t.getServiziSelezionatiModulo("immagine_marketing").length>0||t.moduli.immagine_marketing.totale>0),c(),v("ngIf",t.getServiziSelezionatiModulo("digitalizzazione_automatismi").length>0||t.moduli.digitalizzazione_automatismi.totale>0),c(),v("ngIf",t.getServiziSelezionatiModulo("contabilita_fiscalita").length>0||t.moduli.contabilita_fiscalita.totale>0),c(),v("ngIf",t.getServiziSelezionatiModulo("ottimizzazione_management").length>0||t.moduli.ottimizzazione_management.totale>0),c(7),v("ngIf",t.scontoPercentuale>0&&(t.scontoTarget==="mensile"||t.scontoTarget==="entrambi"))("ngIfElse",e),c(6),v("ngIf",t.scontoPercentuale>0&&(t.scontoTarget==="una_tantum"||t.scontoTarget==="entrambi"))("ngIfElse",o),c(3),v("ngIf",t.scontoPercentuale>0),c(14),v("ngIf",!t.isCliente),c(),v("disabled",!t.selectedProspect||t.totaleGenerale===0),c(3),V(" ",t.isProspect?"Procedi per le Firme":"Aggiorna Configurazione"," "),c(),v("ngIf",t.currentStep===6&&(t.mostraChatSconto||t.scontoPercentuale>0)),c(),v("ngIf",t.mostraChatSconto)}}function mi(s,i){if(s&1){let e=M();n(0,"div",129)(1,"div",130)(2,"strong"),l(3),a(),n(4,"div",179),l(5),a()(),n(6,"div",180)(7,"button",181),f("click",function(){let t=_(e).index,r=m(3);return p(r.rimuoviNominativo(t))}),n(8,"i",41),l(9,"delete"),a()()()()}if(s&2){let e=i.$implicit;c(3),h(e.nome),c(2),U(" ",e.telefono||"\u2014"," \u2022 ",e.email||"\u2014"," ")}}function di(s,i){if(s&1&&(n(0,"div",178)(1,"h3",18),l(2),a(),n(3,"div",80),S(4,mi,10,3,"div",127),a()()),s&2){let e=m(2);c(2),V("Nominativi Inseriti (",e.nominativi.length,")"),c(2),v("ngForOf",e.nominativi)}}function ui(s,i){if(s&1){let e=M();n(0,"section",14)(1,"h2"),l(2,"Inserisci i Nominativi Ottenuti"),a(),n(3,"p",43),l(4,"Aggiungi i contatti ottenuti dalla trattativa. Saranno creati come nuovi prospect."),a(),n(5,"div",173)(6,"div",80)(7,"div",81)(8,"label",20),l(9,"Nome completo *"),a(),n(10,"input",174),I("ngModelChange",function(t){_(e);let r=m();return T(r.nuovoNominativo.nome,t)||(r.nuovoNominativo.nome=t),p(t)}),a()(),n(11,"div",81)(12,"label",20),l(13,"Telefono"),a(),n(14,"input",175),I("ngModelChange",function(t){_(e);let r=m();return T(r.nuovoNominativo.telefono,t)||(r.nuovoNominativo.telefono=t),p(t)}),a()(),n(15,"div",81)(16,"label",20),l(17,"Email"),a(),n(18,"input",176),I("ngModelChange",function(t){_(e);let r=m();return T(r.nuovoNominativo.email,t)||(r.nuovoNominativo.email=t),p(t)}),a()()(),n(19,"div",28)(20,"button",51),f("click",function(){_(e);let t=m();return p(t.aggiungiNominativo())}),n(21,"i",41),l(22,"add"),a(),l(23," Aggiungi Nominativo "),a()()(),S(24,di,5,2,"div",177),n(25,"div",28)(26,"button",50),f("click",function(){_(e);let t=m();return t.pendingFirmeProcess=!1,p(t.indietro())}),l(27,"Indietro"),a(),n(28,"button",29),f("click",function(){_(e);let t=m();return p(t.procediPerFirme())}),l(29,"Procedi"),a()()()}if(s&2){let e=m();c(10),E("ngModel",e.nuovoNominativo.nome),c(4),E("ngModel",e.nuovoNominativo.telefono),c(4),E("ngModel",e.nuovoNominativo.email),c(6),v("ngIf",e.nominativi.length>0),c(4),v("disabled",!e.selectedProspect)}}var Ee=class s{constructor(i,e,o,t,r,d,z,g,w){this.soggettiService=i;this.alchemizzatoreService=e;this.router=o;this.route=t;this.kpiService=r;this.authService=d;this.userService=z;this.supabaseService=g;this.assistenzaService=w}currentStep=1;totaleSteps=7;scontoPercentuale=0;scontoTarget="entrambi";mostraChatSconto=!1;messaggioChat="";messaggiAssistenza=[];richiedendoSconto=!1;overrideNextLimitPercent=0;overrideConsumed=!1;baseAssistDelay=1400;assistJitter=900;pendingCifraRequest=null;totaleMensile=0;totaleUnaTantum=0;totaleMensileScontato=0;totaleUnaScontata=0;showContabilitaChildren=!0;showAltriServizi=!1;queryProspect="";searchResults=[];searchLoading=!1;searchError=null;selectedProspect=null;nominativi=[];nuovoNominativo={nome:"",telefono:"",email:""};pendingFirmeProcess=!1;ANNUAL_TO_MONTHLY_IDS=new Set(["contabilita_principale","fatturazione_principale","iva_principale"]);currentConfigurazioneId=null;previousConfigurazione=null;configurazioneCorrenteId=null;moduli={immagine_marketing:{nome:"Immagine & Marketing",servizi:[{id:"creazione_logo",nome:"Creazione del Logo",prezzo:300,selezionato:!1,descrizione:"Design professionale del logo aziendale"},{id:"creazione_brand",nome:"Creazione del Brand",prezzo:800,selezionato:!1,descrizione:"Identit\xE0 visiva completa: logo, palette colori, typography"},{id:"social_2_post",nome:"Gestione Social Media (2 post/settimana)",prezzo:400,selezionato:!1,pacchetto:"base",descrizione:"2 post settimanali su Facebook e Instagram"},{id:"social_3_post",nome:"Gestione Social Media (3 post/settimana)",prezzo:600,selezionato:!1,pacchetto:"avanzato",descrizione:"3 post settimanali su Facebook, Instagram e LinkedIn"},{id:"social_5_post",nome:"Gestione Social Media (5 post/settimana)",prezzo:800,selezionato:!1,pacchetto:"premium",descrizione:"5 post settimanali su tutti i social + stories"},{id:"servizio_fotografico",nome:"Servizio Fotografico",prezzo:500,selezionato:!1,descrizione:"Servizio fotografico professionale per prodotti/azienda"}],totale:0},digitalizzazione_automatismi:{nome:"Digitalizzazione & Automatismi",servizi:[{id:"landing_page",nome:"Landing Page",prezzo:1e3,selezionato:!1,pacchetto:"base",descrizione:"Pagina di destinazione ottimizzata per conversioni"},{id:"sito_completo",nome:"Sito Web Completo",prezzo:2e3,selezionato:!1,pacchetto:"avanzato",descrizione:"Sito web responsive"},{id:"sito_pro",nome:"Sito Web Pro",prezzo:3500,selezionato:!1,pacchetto:"premium",descrizione:"Sito web avanzato con funzionalit\xE0 personalizzate"},{id:"software_personalizzato",nome:"Software Personalizzato",prezzo:0,selezionato:!1,descrizione:"Richiesta di valutazione per software su misura"},{id:"consulenza_digitale",nome:"Consulenza Digitale",prezzo:300,selezionato:!1,descrizione:"Consulenza per mailing list, automazioni e digital strategy"}],totale:0},contabilita_fiscalita:{nome:"Contabilit\xE0 e Fiscalit\xE0",servizi:[{id:"costituzione_principale",nome:"Costituzione Azienda",prezzo:0,selezionato:!1,categoria:"Costituzione",descrizione:"Servizi di costituzione aziendale - Seleziona per attivare i servizi specifici",tipo:"gruppo"},{id:"cost_assic_redazione",nome:"Assistenza redazione atto costitutivo e Statuto",prezzo:150,selezionato:!1,categoria:"Costituzione",descrizione:"Assistenza redazione atto costitutivo e Statuto (oltre costo notaio e spese accessorie notaio)",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_apertura_piva",nome:"Apertura partita IVA",prezzo:100,selezionato:!1,categoria:"Costituzione",descrizione:"Apertura partita IVA",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_cciaa_no_scia",nome:"Pratica CCIAA senza SCIA",prezzo:80,selezionato:!1,categoria:"Costituzione",descrizione:"Pratica CCIAA per comunicazione attivit\xE0 (senza SCIA) - oltre accessorie (30 Euro diritti CCIAA)",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_cciaa_con_scia",nome:"Pratica CCIAA con SCIA",prezzo:200,selezionato:!1,categoria:"Costituzione",descrizione:"Pratica CCIAA per comunicazione attivit\xE0 (con SCIA al Comune) - oltre accessorie (30 Euro diritti CCIAA)",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_cciaa_scia_plus",nome:"Pratica CCIAA con SCIA plus",prezzo:250,selezionato:!1,categoria:"Costituzione",descrizione:"Pratica CCIAA per comunicazione attivit\xE0 (con SCIA al Comune e plus) - oltre accessorie",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_inps_artigiani",nome:"INPS art/comm",prezzo:50,selezionato:!1,categoria:"Costituzione",descrizione:"INPS artigiani commercianti (soci lavoratori) - per ciascuno",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_inps_gest_separata",nome:"INPS gestione separata",prezzo:80,selezionato:!1,categoria:"Costituzione",descrizione:"INPS gestione separata (P.IVA individuale e amministratori) - per ciascuno",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_vidimazione_libri",nome:"Vidimazione libri sociali",prezzo:20,selezionato:!1,categoria:"Costituzione",descrizione:"Vidimazione libri sociali (oltre accessori) - per libro",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"cost_registrazione_verbali",nome:"Registrazione verbali",prezzo:100,selezionato:!1,categoria:"Costituzione",descrizione:"Registrazione verbali - oltre accessori",tipo:"fisso",dipendeDa:"costituzione_principale"},{id:"contabilita_principale",nome:"Servizi di Contabilit\xE0",prezzo:0,selezionato:!1,categoria:"Contabilit\xE0",descrizione:"Seleziona il tipo di contabilit\xE0 e inserisci il numero di registrazioni annuali",tipo:"configurabile"},{id:"fatturazione_principale",nome:"Servizi di Fatturazione",prezzo:0,selezionato:!1,categoria:"Fatturazione",descrizione:"Configura i servizi di fatturazione in base alle tue esigenze",tipo:"configurabile"},{id:"iva_principale",nome:"Servizi IVA",prezzo:0,selezionato:!1,categoria:"IVA",descrizione:"Configura i servizi IVA in base alla tua periodicit\xE0",tipo:"configurabile"},{id:"redditi_principale",nome:"Dichiarazione Redditi",prezzo:0,selezionato:!1,categoria:"Redditi",descrizione:"Configura la dichiarazione redditi in base al tipo di soggetto e volume d'affari",tipo:"configurabile"},{id:"bilancio_principale",nome:"Bilancio",prezzo:0,selezionato:!1,categoria:"Bilancio",descrizione:"Configura il servizio di bilancio in base alle tue esigenze",tipo:"configurabile"},{id:"altro_cu_autonomi",nome:"CU autonomi (fino a 5 percipienti)",prezzo:180,selezionato:!1,categoria:"Altri Servizi",descrizione:"CU per autonomi - fino a 5 percipienti",tipo:"fisso"},{id:"altro_modello_770",nome:"Modello 770",prezzo:100,selezionato:!1,categoria:"Altri Servizi",descrizione:"Modello 770 - autonomi e capitali - una tantum/anno",tipo:"fisso"},{id:"altro_f24_12",nome:"F24 (fino a 12/anno)",prezzo:300,selezionato:!1,categoria:"Altri Servizi",descrizione:"F24 - fino a 12 pagamenti/anno",tipo:"fisso"},{id:"altro_imu_dichiarazione",nome:"Dichiarazione IMU/ILIA",prezzo:60,selezionato:!1,categoria:"Altri Servizi",descrizione:"Dichiarazione IMU/ILIA",tipo:"fisso"},{id:"altro_imu_verifica",nome:"Verifica Esatto/calcolo IMU",prezzo:40,selezionato:!1,categoria:"Altri Servizi",descrizione:"Verifica Esatto/calcolo IMU",tipo:"fisso"},{id:"altro_imu_pagamento",nome:"Pagamento IMU a scadenza",prezzo:25,selezionato:!1,categoria:"Altri Servizi",descrizione:"Pagamento IMU a scadenza",tipo:"fisso"},{id:"altro_avvisi_bonari",nome:"Autotutela avvisi bonari",prezzo:70,selezionato:!1,categoria:"Altri Servizi",descrizione:"Autotutela avvisi bonari",tipo:"fisso"},{id:"altro_locazioni",nome:"Supporto contratti locazione",prezzo:180,selezionato:!1,categoria:"Altri Servizi",descrizione:"Supporto nella predisposizione e registrazione contratti locazione",tipo:"fisso"},{id:"altro_lettere_intento",nome:"Invio lettere d'intento",prezzo:85,selezionato:!1,categoria:"Altri Servizi",descrizione:"Invio lettere d'intento - per ciascuna",tipo:"fisso"},{id:"altro_smart_card_rilascio",nome:"Rilascio Smart Card",prezzo:60,selezionato:!1,categoria:"Altri Servizi",descrizione:"Rilascio Smart Card - per ciascuna",tipo:"fisso"},{id:"altro_smart_card_conservazione",nome:"Conservazione Smart Card",prezzo:30,selezionato:!1,categoria:"Altri Servizi",descrizione:"Conservazione Smart Card - annuale",tipo:"fisso"},{id:"altro_titolare_effettivo",nome:"Invio pratica titolare effettivo",prezzo:130,selezionato:!1,categoria:"Altri Servizi",descrizione:"Invio pratica titolare effettivo - prezzo medio",tipo:"fisso"},{id:"altro_visure_online",nome:"Visura ordinaria",prezzo:20,selezionato:!1,categoria:"Altri Servizi",descrizione:"Visura ordinaria",tipo:"fisso"},{id:"altro_chiamate_consulenza",nome:"Chiamate per consulenza",prezzo:300,selezionato:!1,categoria:"Altri Servizi",descrizione:"Chiamate per consulenza - una tantum",tipo:"fisso"},{id:"altro_gestione_pec",nome:"Gestione PEC mensile",prezzo:16,selezionato:!1,categoria:"Altri Servizi",descrizione:"Gestione mensile PEC",tipo:"fisso"}],totale:0},ottimizzazione_management:{nome:"Ottimizzazione e Management",servizi:[{id:"consulenza_impresa_base",nome:"Consulenza di Impresa Base",prezzo:800,selezionato:!1,pacchetto:"base",descrizione:"Analisi iniziale e piano di miglioramento base"},{id:"consulenza_impresa_avanzata",nome:"Consulenza di Impresa Avanzata",prezzo:1500,selezionato:!1,pacchetto:"avanzato",descrizione:"Consulenza strategica con piano d'azione dettagliato"},{id:"consulenza_impresa_premium",nome:"Consulenza di Impresa Premium",prezzo:2500,selezionato:!1,pacchetto:"premium",descrizione:"Consulenza completa con supporto continuativo"},{id:"formazione_commerciale_base",nome:"Formazione Commerciale Base",prezzo:600,selezionato:!1,pacchetto:"base",descrizione:"Corso base di tecniche di vendita"},{id:"formazione_commerciale_avanzata",nome:"Formazione Commerciale Avanzata",prezzo:1200,selezionato:!1,pacchetto:"avanzato",descrizione:"Formazione avanzata con simulazioni pratiche"},{id:"formazione_commerciale_premium",nome:"Formazione Commerciale Premium",prezzo:2e3,selezionato:!1,pacchetto:"premium",descrizione:"Programma completo con coaching individuale"}],totale:0}};totaleGenerale=0;Math=Math;ngOnInit(){return N(this,null,function*(){let e=this.router.getCurrentNavigation()?.extras?.state||history?.state||{},o=e?.prospect,t=this.route.snapshot.queryParamMap,r=o?.id||t.get("prospectId"),d=Number(e?.goToStep||t.get("step"))||0;if(o?.id)this.selectedProspect=o;else if(r)try{let{data:g,error:w}=yield this.soggettiService.getSoggettoById(r);!w&&g&&(this.selectedProspect=g)}catch{}r&&(yield this.loadConfigurazioneEsistente(r),this.currentStep=d&&d>=1&&d<=this.totaleSteps?d:6);let z=this.route.snapshot.queryParamMap.get("focusConfig");z&&this.openConfigurazioneById(z)})}openConfigurazioneById(i){return N(this,null,function*(){if(i)try{let e=yield this.alchemizzatoreService.getConfigurazioneById(i),o=e.data;if(e.error||!o){console.warn("Configurazione non trovata:",e.error);return}this.configurazioneCorrenteId=o.id??null,this.currentConfigurazioneId=this.configurazioneCorrenteId;let t=o.dettagli??{};this.applyConfigurazioneDettagli(t),this.previousConfigurazione=this.deepClone(t),this.calcolaTotali(),this.updateTotaleGeneraleFromDetails(),this.updateTotaliSplitFromConfig();let r=o.prospect_id??o.prospectId;if(r&&(!this.selectedProspect||this.selectedProspect.id!==r))try{let d=yield this.soggettiService.getSoggettoById(r);!d.error&&d.data&&(this.selectedProspect=d.data,this.queryProspect=this.selectedProspect?.ragione_sociale??"")}catch(d){console.warn("Impossibile caricare prospect per configurazione:",d)}this.currentStep=6}catch(e){console.error("Errore in openConfigurazioneById:",e)}})}loadConfigurazioneEsistente(i){return N(this,null,function*(){let{data:e,error:o}=yield this.alchemizzatoreService.getConfigurazioniByProspect(i);if(o||!Array.isArray(e)||e.length===0)return;let t=[...e].sort((d,z)=>new Date(z.updated_at||z.created_at||z.data_configurazione||0).getTime()-new Date(d.updated_at||d.created_at||d.data_configurazione||0).getTime())[0];this.configurazioneCorrenteId=t.id??null,this.currentConfigurazioneId=this.configurazioneCorrenteId;let r=t?.dettagli||{};this.applyConfigurazioneDettagli(r),this.previousConfigurazione=this.deepClone(r),this.calcolaTotali()})}applyConfigurazioneDettagli(i){if(!i)return;let e=i&&i.meta?i.meta:null;e&&(this.scontoTarget=e.scontoTarget??this.scontoTarget);let o=["immagine_marketing","digitalizzazione_automatismi","contabilita_fiscalita","ottimizzazione_management"],t=0,r=!1;for(let d of o){let z=i[d];if(!z){this.moduli[d].servizi.forEach(x=>x.selezionato=!1),this.moduli[d].totale=0;continue}let g=Array.isArray(z.servizi_selezionati)?z.servizi_selezionati:Array.isArray(z.servizi)?z.servizi:[],w=new Set(g.map(x=>typeof x=="string"?x:x?.id).filter(Boolean));if(d==="contabilita_fiscalita"&&this.configurazioniContabilita){let x={contabilita_principale:"contabilita",fatturazione_principale:"fatturazione",iva_principale:"iva",redditi_principale:"redditi",bilancio_principale:"bilancio"};g.forEach(b=>{let y=typeof b=="string"?b:b?.id;if(!y)return;let P=x[y];if(!P)return;let k=Number(b?.prezzo??0),F=Number(b?.prezzo_mensile??0);k>0?this.configurazioniContabilita[P].prezzoCalcolato=k:F>0&&(this.configurazioniContabilita[P].prezzoCalcolato=Math.round(F*12*100)/100)});let u=this.configurazioniContabilita.altriServizi||{};g.forEach(b=>{let y=b?.id;y&&(y==="altro_modello_770"&&typeof b.quantita<"u"&&(u.modello770Count=Number(b.quantita)||u.modello770Count),y==="altro_imu_dichiarazione"&&typeof b.quantita<"u"&&(u.imuCount=Number(b.quantita)||u.imuCount),y==="altro_locazioni"&&typeof b.quantita<"u"&&(u.locazioniCount=Number(b.quantita)||u.locazioniCount),y==="altro_smart_card_rilascio"&&typeof b.quantita<"u"&&(u.smartCardRilascioCount=Number(b.quantita)||u.smartCardRilascioCount))}),this.configurazioniContabilita.altriServizi=u}if(this.moduli[d].servizi.forEach(x=>{x.selezionato=w.has(x.id);let u=g.find(b=>typeof b=="string"?b===x.id:b?.id===x.id);u&&typeof u.prezzo<"u"&&(x.prezzo=Number(u.prezzo)||0),u&&typeof u.prezzo_mensile<"u"&&(x.prezzo_mensile=Number(u.prezzo_mensile)||0),(typeof x.quantita>"u"||!(Number(x.quantita)>0))&&(x.quantita=1),u&&typeof u.quantita<"u"&&(x.quantita=Number(u.quantita)||1),d==="contabilita_fiscalita"&&(x.aggiuntoManualmente=!!x.selezionato)}),typeof z.totale<"u"&&z.totale!==null){let x=Number(z.totale)||0;this.moduli[d].totale=Math.round(x*100)/100,t+=this.moduli[d].totale,r=!0;continue}if(g.length>0){let x=g.reduce((u,b)=>u+(Number(b?.prezzo)||0),0);if(x>0){this.moduli[d].totale=Math.round(x*100)/100,t+=this.moduli[d].totale;continue}}let C=this.moduli[d].servizi.filter(x=>x.selezionato).reduce((x,u)=>x+(Number(u.prezzo)||0),0);this.moduli[d].totale=Math.round(C*100)/100,this.moduli[d].totale>0&&(t+=this.moduli[d].totale)}if(e){let d=Number(e.totaleOriginale??e.totaleGenerale??t)||0;this.totaleGenerale=Math.round(d*100)/100,this.scontoPercentuale=Number(e.scontoPercentuale??0)||0,t===0&&this.calcolaTotali()}else this.calcolaTotali();this.previousConfigurazione=this.deepClone(i),this.updateTotaliSplitFromConfig()}avanti(){if(this.currentStep===1&&!this.selectedProspect){alert("Seleziona un prospect prima di procedere.");return}this.currentStep<this.totaleSteps&&this.currentStep++}indietro(){this.currentStep>1&&this.currentStep--}vaiAStep(i){if(i>=1&&i<=this.totaleSteps){if(!this.selectedProspect&&i>1){alert("Seleziona un prospect prima di navigare agli altri step.");return}this.currentStep=i}}onSearchProspect(i){return N(this,null,function*(){if(this.searchError=null,!i?.trim()){this.searchResults=[];return}this.searchLoading=!0;try{let[e,o]=yield Promise.all([this.soggettiService.searchSoggetti(i,"prospect"),this.soggettiService.searchSoggetti(i,"cliente")]),t=e.data??[],r=o.data??[],d=Array.from(new Map([...t,...r].map(z=>[z.id,z])).values());this.searchResults=d}catch(e){console.error("Errore durante la ricerca soggetti",e),this.searchError="Errore durante la ricerca"}finally{this.searchLoading=!1}})}get isModificaConfigurazione(){return!!(this.selectedProspect?.tipo==="cliente"&&this.configurazioneCorrenteId)}onSelectProspect(i){return N(this,null,function*(){if(this.searchResults=[],this.queryProspect=i.ragione_sociale??"",!i.tipo){let{data:e}=yield this.soggettiService.getSoggettoById(i.id);e&&(i=e)}if(this.selectedProspect=i,this.queryProspect=i.ragione_sociale??"",this.searchResults=[],i.tipo==="cliente"){let{data:e}=yield this.supabaseService.getUltimaConfigurazionePromethea(i.id);if(e){this.configurazioneCorrenteId=e.id??null,this.currentConfigurazioneId=this.configurazioneCorrenteId,this.applyConfigurazioneDettagli(e.dettagli),this.previousConfigurazione=this.deepClone(e.dettagli??{});return}}this.configurazioneCorrenteId=null,this.currentConfigurazioneId=null,this.previousConfigurazione=null,yield this.loadConfigurazioneEsistente(i.id)})}toggleServizio(i,e){let o=this.moduli[i],t=!e.selezionato;if(i==="digitalizzazione_automatismi"&&t&&["landing_page","sito_completo","sito_pro"].includes(e.id)&&o.servizi.forEach(r=>{["landing_page","sito_completo","sito_pro"].includes(r.id)&&r.id!==e.id&&(r.selezionato=!1)}),i==="ottimizzazione_management"&&t&&e.id.startsWith("consulenza_impresa_")&&o.servizi.forEach(r=>{r.id.startsWith("consulenza_impresa_")&&r.id!==e.id&&(r.selezionato=!1)}),i==="ottimizzazione_management"&&t&&e.id.startsWith("formazione_commerciale_")&&o.servizi.forEach(r=>{r.id.startsWith("formazione_commerciale_")&&r.id!==e.id&&(r.selezionato=!1)}),t&&i==="immagine_marketing"){if(e.id.startsWith("social_")&&o.servizi.forEach(r=>{r.id.startsWith("social_")&&r.id!==e.id&&(r.selezionato=!1)}),e.id==="creazione_brand"){let r=o.servizi.find(d=>d.id==="creazione_logo");r&&(r.selezionato=!1)}else if(e.id==="creazione_logo"){let r=o.servizi.find(d=>d.id==="creazione_brand");r&&(r.selezionato=!1)}}if(t&&e.pacchetto){let r=e.id.split("_"),d=r.length>=2?`${r[0]}_${r[1]}`:r[0];o.servizi.forEach(z=>{if(z.pacchetto===e.pacchetto&&z.id!==e.id){let g=z.id.split("_");(g.length>=2?`${g[0]}_${g[1]}`:g[0])===d&&(z.selezionato=!1)}})}e.selezionato=t,t&&(e.quantita=Number(e.quantita??1)),this.calcolaTotali()}calcolaDifferenze(i,e){let o={},t=["immagine_marketing","digitalizzazione_automatismi","contabilita_fiscalita","ottimizzazione_management"],r=d=>d?(Array.isArray(d.servizi_selezionati)?d.servizi_selezionati:Array.isArray(d.servizi)?d.servizi:[]).map(g=>typeof g=="string"?g:g?.id).filter(g=>!!g):[];return t.forEach(d=>{let z=new Set(r(i?.[d])),g=new Set(r(e?.[d])),w=[...z].filter(x=>!g.has(x)),C=[...g].filter(x=>!z.has(x));(w.length||C.length)&&(o[d]={aggiunti:w,rimossi:C})}),o}isServizioDisabled(i,e){return e.pacchetto?this.moduli[i].servizi.filter(r=>r.pacchetto===e.pacchetto&&r.id!==e.id&&r.selezionato).length>0:!1}buildDettagliConfigurazione(){let i={};return Object.keys(this.moduli).forEach(e=>{let o=this.moduli[e],t=o.servizi.filter(u=>u.selezionato).map(u=>({id:u.id,nome:u.nome,pacchetto:u.pacchetto??null,descrizione:u.descrizione??null,prezzo:Number(u.prezzo??0),prezzo_mensile:typeof u.prezzo_mensile<"u"?Number(u.prezzo_mensile):void 0,quantita:Number(u.quantita??1),prezzo_unitario:typeof u.prezzo_unitario<"u"?Number(u.prezzo_unitario):void 0,note:u.note??void 0})),r=this.previousConfigurazione&&this.previousConfigurazione[e]?Array.isArray(this.previousConfigurazione[e].servizi_selezionati)?this.previousConfigurazione[e].servizi_selezionati:Array.isArray(this.previousConfigurazione[e].servizi)?this.previousConfigurazione[e].servizi:[]:[],d=new Map;t.forEach(u=>d.set(u.id,$({},u))),r.forEach(u=>{let b=(u?.id??"").toString();if(!b||!d.has(b))return;let y=d.get(b)||{},P=J($({},y),{nome:y.nome??u.nome??null,pacchetto:typeof y.pacchetto<"u"?y.pacchetto:typeof u.pacchetto<"u"?u.pacchetto:null,descrizione:y.descrizione??u.descrizione??null,prezzo:typeof y.prezzo<"u"?Number(y.prezzo):Number(u.prezzo??0),prezzo_mensile:typeof y.prezzo_mensile<"u"?y.prezzo_mensile:typeof u.prezzo_mensile<"u"?Number(u.prezzo_mensile):void 0,quantita:typeof y.quantita<"u"?Number(y.quantita):typeof u.quantita<"u"?Number(u.quantita):1,prezzo_unitario:typeof y.prezzo_unitario<"u"?Number(y.prezzo_unitario):typeof u.prezzo_unitario<"u"?Number(u.prezzo_unitario):void 0,note:y.note??u.note??void 0});d.set(b,P)});let z=Array.from(d.values()),g=this.configurazioniContabilita||{},w={contabilita_principale:"contabilita",fatturazione_principale:"fatturazione",iva_principale:"iva",redditi_principale:"redditi",bilancio_principale:"bilancio"},C=["altro_modello_770","altro_imu_dichiarazione","altro_locazioni","altro_smart_card_rilascio"];z.forEach(u=>{if(u.id&&w[u.id]){let y=w[u.id],P=Number(g[y]?.prezzoCalcolato)||0;P>0?(u.prezzo=0,u.prezzo_mensile=this.monthlyPrice(P),u.note=u.note??"prezzo_calcolato_configurazione"):u.prezzo=Number(u.prezzo||0)}if(C.includes(u.id)){let y=this.getAltriServiziCountFor(u.id)||1,P=Number(u.prezzo||0);u.quantita=y,u.prezzo_unitario=P,u.prezzo=Math.round(P*y*100)/100}if(u.id==="software_personalizzato"&&(u.prezzo=Number(u.prezzo||0),typeof u.prezzo_mensile>"u"&&this.previousConfigurazione&&this.previousConfigurazione[e])){let y=(this.previousConfigurazione[e].servizi_selezionati||[]).find(P=>P.id==="software_personalizzato");y&&typeof y.prezzo_mensile<"u"&&(u.prezzo_mensile=Number(y.prezzo_mensile)||0)}let b=Number(u.prezzo_mensile??0);if(b>0&&Number(u.prezzo||0)===0)u.prezzo=0;else{let y=Math.max(1,Number(u.quantita??1)),P=Number(u.prezzo_unitario??0),k=Number(u.prezzo??0);if(!P||P===0)if(y>0&&k>0)P=k/y;else try{let F=this.getService(e,u.id);F&&Number(F.prezzo)>0&&(P=Number(F.prezzo))}catch{}P=Math.round(P*100)/100,P>0&&(u.prezzo_unitario=P),b>0&&Number(u.prezzo)===0||(u.prezzo=Math.round(Number(u.prezzo_unitario||P||k)*y*100)/100)}typeof u.prezzo<"u"&&(u.prezzo=Math.round(Number(u.prezzo||0)*100)/100),typeof u.prezzo_mensile<"u"&&(u.prezzo_mensile=Math.round(Number(u.prezzo_mensile||0)*100)/100),typeof u.prezzo_unitario<"u"&&(u.prezzo_unitario=Math.round(Number(u.prezzo_unitario||0)*100)/100),u.quantita=Math.max(1,Number(u.quantita||1))});let x=z.reduce((u,b)=>{let y=Number(b.prezzo||0);return Number(b.prezzo_mensile||0)>0&&y===0?u:u+y},0);i[e]={nome:o.nome,totale:Math.round(x*100)/100,servizi_selezionati:z}}),i.meta={totaleOriginale:this.totaleGenerale,totaleGenerale:this.totaleGenerale,scontoPercentuale:this.scontoPercentuale||0,scontoTarget:this.scontoTarget||"entrambi",totaleScontato:this.scontoPercentuale>0?this.totaleScontato:this.totaleGenerale,aggiornato_il:new Date().toISOString()},i}salvaConfigurazione(){return N(this,null,function*(){if(!window.confirm("Confermi il salvataggio della configurazione?"))return;if(!this.selectedProspect){console.warn("Nessun prospect selezionato: salvataggio annullato.");return}let e=this.buildDettagliConfigurazione(),o=Number(this.scontoPercentuale>0?this.totaleScontato:this.totaleGenerale)||0;if(this.selectedProspect.tipo==="cliente"&&this.configurazioneCorrenteId&&this.previousConfigurazione)try{let r=this.calcolaDifferenze(e,this.previousConfigurazione);Object.keys(r).length>0&&(yield this.supabaseService.inserisciLogConfigurazione({configurazione_id:this.configurazioneCorrenteId,soggetto_id:this.selectedProspect.id,differenze:r,totale:o}))}catch(r){console.error("Errore durante l'inserimento log configurazione:",r)}let t={prospect_id:this.selectedProspect.id,data_configurazione:new Date().toISOString(),totale:o,dettagli:e};try{let{data:r,error:d}=yield this.alchemizzatoreService.salvaConfigurazione(t,this.configurazioneCorrenteId??void 0);if(d)throw console.error("Errore nel salvataggio configurazione:",d),alert("Errore durante il salvataggio della configurazione. Controlla la console."),d;if(r)if(this.configurazioneCorrenteId=r.id??this.configurazioneCorrenteId??null,this.currentConfigurazioneId=this.configurazioneCorrenteId,r.dettagli){let z=r.dettagli,g=z.meta??{};if(this.applyConfigurazioneDettagli(z),this.scontoPercentuale=Number(g.scontoPercentuale??this.scontoPercentuale??0),this.scontoTarget=g.scontoTarget??this.scontoTarget??"entrambi",this.updateTotaleGeneraleFromDetails(),this.totaleGenerale===0&&(typeof g.totaleOriginale<"u"||typeof r.totale<"u")){let w=Number(g.totaleOriginale??r.totale??0)||0;this.totaleGenerale=Math.round(w*100)/100}this.previousConfigurazione=this.deepClone(z)}else this.previousConfigurazione=this.deepClone(e);else this.configurazioneCorrenteId=this.configurazioneCorrenteId??null,this.previousConfigurazione=this.deepClone(e);return alert("Configurazione salvata con successo."),r??{success:!0,payload:t}}catch(r){throw console.error("salvaConfigurazione - errore finale:",r),r}})}resetConfigurazione(){this.currentStep=1,this.queryProspect="",Object.keys(this.moduli).forEach(i=>{let e=this.moduli[i];e.servizi.forEach(o=>{o.selezionato=!1}),e.totale=0}),this.totaleGenerale=0}getServiziSelezionatiModulo(i){return this.moduli[i].servizi.filter(o=>o.selezionato)}getTotaleModulo(i){return this.moduli[i].totale}getServiziPacchetto(i){return this.moduli[i].servizi.filter(e=>!!e.pacchetto)}getServiziSingoli(i){return this.moduli[i].servizi.filter(e=>!e.pacchetto)}getTuttiServiziSelezionati(){let i=[];return Object.keys(this.moduli).forEach(e=>{let o=this.moduli[e].servizi.filter(t=>t.selezionato);i.push(...o)}),i}procediPerFirme(){return N(this,null,function*(){if(!this.selectedProspect){alert("Seleziona prima un soggetto.");return}if(this.totaleGenerale===0){alert("Configura almeno un servizio.");return}let i=this.isProspect;if(i&&!this.pendingFirmeProcess){this.pendingFirmeProcess=!0,this.currentStep=7;return}if(!confirm(`Sei sicuro di voler procedere con l'operazione?${i?`
Il prospect verr\xE0 convertito in cliente.`:""}`)){console.log("Operazione annullata dall'utente");return}let o=[{percorso:"assets/contratti/privacy-promethea.pdf",nomeBase:"Privacy"},{percorso:"assets/contratti/contratto-promethea.pdf",nomeBase:"Contratto Servizi Promethea"}];this.haServiziDigitaliSelezionati()&&o.push({percorso:"assets/contratti/allegato-digitale.pdf",nomeBase:"Allegato Digitale"}),this.haServiziContabiliSelezionati()&&o.push({percorso:"assets/contratti/allegato-contabile.pdf",nomeBase:"Allegato Contabile"});try{let t=!0;if(i&&(t=yield this.convertiProspectInCliente(),!t)){alert("Errore nella conversione del prospect in cliente.");return}let r=confirm(`Vuoi scaricare i documenti PDF ora?

Clicca "OK" per scaricare i documenti, "Annulla" per procedere senza scaricare.`);r?this.scaricaDocumenti(o):console.log("Download documenti annullato dall'utente");let d=null;try{d=yield this.salvaConfigurazione()}catch(g){throw console.error("Errore nel salvataggio configurazione durante procediPerFirme:",g),g}try{let g=this.authService.getCurrentUserId();if(g||(g=(yield this.authService.getAuthState())?.id??null),g){let w=new Date,{count:C,sumTotal:x}=yield this.kpiService.countContractsForSeller(g,w.getFullYear(),w.getMonth()+1),b=(yield this.userService.getUserById(g))?.data?.provvigioni??{},y=this.kpiService.computeCommission(b,C,x);console.info("Provvigione calcolata",{commission:y,count:C,sumTotal:x}),alert(`Provvigione mese: \u20AC ${Number(y||0).toFixed(2)} (contratti: ${C})`)}}catch(g){console.error("Errore calcolo provvigioni",g)}if(i&&t)try{let g=d&&d.dettagli?d.dettagli:this.previousConfigurazione??this.buildDettagliConfigurazione(),w=this.configurazioneCorrenteId??d?.id??null;this.selectedProspect?.id?yield this.createInvoiceFromConfigurazione(g,this.selectedProspect.id,w??void 0):console.warn("Impossibile creare fattura automatica: soggetto non disponibile dopo conversione.")}catch(g){console.error("Errore creazione fattura automatica:",g)}if(i&&this.nominativi.length>0)try{yield this.creaProspectDaNominativi()}catch(g){console.error("Errore creaProspectDaNominativi",g)}this.pendingFirmeProcess=!1,this.currentStep=i?6:this.currentStep;let z=i?"Operazione completata! Il prospect \xE8 ora cliente."+(r?" Documenti scaricati.":""):"Configurazione aggiornata con successo."+(r?" Documenti scaricati.":"");alert(z)}catch(t){console.error("Errore nel processo procediPerFirme:",t),alert("Errore durante l'operazione: "+(t?.message||"sconosciuto")),this.pendingFirmeProcess=!1}})}convertiProspectInCliente(){return N(this,null,function*(){if(!this.selectedProspect||!this.isProspect)return!0;try{console.log("Conversione prospect in cliente:",this.selectedProspect.id);let i=yield this.soggettiService.convertiProspectInCliente(this.selectedProspect.id);return i.error?(console.error("Errore nella conversione:",i.error),!1):i.data?(this.selectedProspect=i.data,console.log("Prospect convertito in cliente con successo:",this.selectedProspect),!0):!1}catch(i){return console.error("Errore durante la conversione:",i),!1}})}aggiungiNominativo(){if(!this.nuovoNominativo.nome.trim()){alert("Il nome \xE8 obbligatorio");return}if(!this.nuovoNominativo.telefono.trim()&&!this.nuovoNominativo.email.trim()){alert("Inserire almeno il telefono o l'email");return}this.nominativi.push($({},this.nuovoNominativo)),this.nuovoNominativo={nome:"",telefono:"",email:""}}rimuoviNominativo(i){this.nominativi.splice(i,1)}creaProspectDaNominativi(){return N(this,null,function*(){if(!(!this.nominativi||this.nominativi.length===0))for(let i of this.nominativi)try{let e={tipo:"prospect",ragioneSociale:i.nome,telefono:i.telefono||void 0,email:i.email||void 0,note:`Creato da configurazione Promethea - ${this.selectedProspect?.ragione_sociale}`,prodotto:"Promethea",referenzaDaId:this.selectedProspect?.id},o=yield this.soggettiService.createSoggetto(e);(!o||!o.success)&&(yield this.soggettiService.supabase.from("soggetti").insert([{tipo:e.tipo,ragione_sociale:e.ragioneSociale,telefono:e.telefono??null,email:e.email??null,note:e.note??null,prodotto:e.prodotto,referenza_da_id:e.referenzaDaId??null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]))}catch(e){console.error("Errore creazione prospect da nominativo:",e)}})}haServiziDigitaliSelezionati(){let i=this.moduli.digitalizzazione_automatismi.servizi.some(o=>o.selezionato),e=this.moduli.immagine_marketing.servizi.some(o=>o.selezionato&&o.id.startsWith("social_"));return i||e}haServiziContabiliSelezionati(){return this.moduli.contabilita_fiscalita.servizi.some(i=>i.selezionato)}scaricaDocumenti(i){let e=this.sanitizeFileName(this.selectedProspect.ragione_sociale);i.forEach((o,t)=>{setTimeout(()=>{let r=`${o.nomeBase} - ${e}.pdf`;this.scaricaPDF(o.percorso,r)},t*300)})}scaricaPDF(i,e){let o=document.createElement("a");o.href=i,o.download=e,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}sanitizeFileName(i){return i.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g," ").trim()}get isCliente(){return this.selectedProspect?.tipo==="cliente"}get isProspect(){return this.selectedProspect?.tipo==="prospect"}getCategorieContabilita(){let i=this.moduli.contabilita_fiscalita.servizi;return[...new Set(i.map(o=>o.categoria))].filter(o=>o!==void 0).sort()}getServiziByCategoria(i){return this.moduli.contabilita_fiscalita.servizi.filter(e=>e.categoria===i)}configurazioniContabilita={costituzione:{attivo:!1,serviziSelezionati:[]},contabilita:{tipo:"",registrazioni:90,prezzoCalcolato:0},fatturazione:{tipo:"",numeroFatture:40,prezzoCalcolato:0},iva:{liquidazione:"",lipe:"trimestrale",volumeAffari:75e3,vistoConformita:!1,modelloIVATR:!1,intrastat:!1,prezzoCalcolato:0},redditi:{tipoSoggetto:"persone_fisiche",volumeAffari:75e3,numeroPersone:1,vistoConformita:!1,prezzoCalcolato:0},bilancio:{tipo:"attivita",importo:13e4,depositoBilancio:!1,nominaCariche:!1,prezzoCalcolato:0},altriServizi:{cuPercipienti:5,prezzoCU:180,modello770:!1,f24Numero:12,prezzoF24:300,modello770Count:1,imuCount:1,locazioniCount:1,smartCardRilascioCount:1}};calcolaPrezzoContabilita(){let i=this.configurazioniContabilita?.contabilita;if(!i||!i.tipo){i&&(i.prezzoCalcolato=0);let t=this.getService("contabilita_fiscalita","contabilita_principale");t&&(delete t.prezzo_mensile,t.prezzo=Number(t.prezzo||0)),this.calcolaTotali();return}let e=i.registrazioni;switch(i.tipo){case"semplificata":e<=90?i.prezzoCalcolato=1421:e<=180?i.prezzoCalcolato=1811:e<=360?i.prezzoCalcolato=2805:i.prezzoCalcolato=2805+(e-360)*2;break;case"ordinaria":e<=600?i.prezzoCalcolato=3276:(e<=2e3,i.prezzoCalcolato=3276+(e-600)*3.38);break;case"mista":e<=600?i.prezzoCalcolato=2644:(e<=2e3,i.prezzoCalcolato=2644+(e-600)*3.38);break}i.prezzoCalcolato=Math.round(i.prezzoCalcolato*100)/100;let o=this.getService("contabilita_fiscalita","contabilita_principale");o&&(o.prezzo_mensile=this.monthlyPrice(i.prezzoCalcolato),o.prezzo=0),this.calcolaTotali()}calcolaPrezzoFatturazione(){let i=this.configurazioniContabilita.fatturazione;i.tipo==="emissione_noi"?i.prezzoCalcolato=i.numeroFatture*25:i.prezzoCalcolato=i.numeroFatture*4;let e=this.getService("contabilita_fiscalita","fatturazione_principale");e&&(e.prezzo_mensile=this.monthlyPrice(i.prezzoCalcolato),e.prezzo=0),this.calcolaTotali()}calcolaPrezzoIVA(){let i=this.configurazioniContabilita.iva;if(!i||!i.liquidazione){i&&(i.prezzoCalcolato=0);let t=this.getService("contabilita_fiscalita","iva_principale");t&&(delete t.prezzo_mensile,t.prezzo=Number(t.prezzo||0)),this.calcolaTotali();return}let e=0;i.liquidazione==="mensile"?e+=576:e+=280,i.lipe==="mensile"?e+=1038:e+=346,i.volumeAffari<=75e3?e+=277:i.volumeAffari<=15e4?e+=346:i.volumeAffari<=3e5?e+=439:i.volumeAffari<=5e5?e+=550:i.volumeAffari<=75e4?e+=732:e+=1208,i.vistoConformita&&(e+=287.5),i.modelloIVATR&&(e+=72),i.intrastat&&(e+=70),i.prezzoCalcolato=e;let o=this.getService("contabilita_fiscalita","iva_principale");o&&(o.prezzo_mensile=this.monthlyPrice(i.prezzoCalcolato),o.prezzo=0),this.calcolaTotali()}calcolaPrezzoRedditi(){let i=this.configurazioniContabilita.redditi,e=0;i.tipoSoggetto==="persone_fisiche"?i.volumeAffari<=75e3?e=440:i.volumeAffari<=15e4?e=659:i.volumeAffari<=3e5?e=879:i.volumeAffari<=5e5?e=1096.5:i.volumeAffari<=75e4?e=1317:e=1645.5:i.volumeAffari<=3e5?e=916.5:i.volumeAffari<=5e5?e=1372.5:i.volumeAffari<=15e5?e=1830:i.volumeAffari<=3e6?e=2285:i.volumeAffari<=5e6?e=2744:i.volumeAffari<=75e5?e=3201.5:e=4e3,i.tipoSoggetto==="persone_fisiche"&&(e*=i.numeroPersone),i.vistoConformita&&(e+=287.5),i.prezzoCalcolato=e;let o=this.getService("contabilita_fiscalita","redditi_principale");o&&(o.prezzo_mensile=this.monthlyPrice(i.prezzoCalcolato),o.prezzo=0),this.calcolaTotali()}calcolaPrezzoBilancio(){let i=this.configurazioniContabilita.bilancio,e=0;i.tipo==="attivita"?i.importo<=13e4?e=453.5:i.importo<=5e5?e=765.5:i.importo<=13e5?e=1184:i.importo<=26e5?e=1739.5:i.importo<=575e3?e=2435:e=3e3:i.importo<=3e5?e=590:i.importo<=5e5?e=765.5:i.importo<=15e5?e=905:i.importo<=3e6?e=1218:i.importo<=5e6?e=1739.5:i.importo<=75e5?e=2435:e=3e3,i.depositoBilancio&&(e+=350),i.nominaCariche&&(e+=420),i.prezzoCalcolato=e;let o=this.getService("contabilita_fiscalita","bilancio_principale");o&&(o.prezzo_mensile=this.monthlyPrice(i.prezzoCalcolato),o.prezzo=0),this.calcolaTotali()}calcolaPrezzoCU(){let i=this.configurazioniContabilita.altriServizi;i.cuPercipienti<=5?i.prezzoCU=180:i.cuPercipienti<=10?i.prezzoCU=330:i.cuPercipienti<=15?i.prezzoCU=480:i.cuPercipienti<=20?i.prezzoCU=630:i.prezzoCU=630+(i.cuPercipienti-20)*30,i.f24Numero<=12?i.prezzoF24=300:i.f24Numero<=24?i.prezzoF24=600:i.f24Numero<=36?i.prezzoF24=900:i.prezzoF24=900+(i.f24Numero-36)*25,this.calcolaTotali()}monthlyPrice(i){return Math.round(Number(i||0)/12*100)/100}isPriceAlreadyMonthly(i){return!i||!i.id?!1:!!(i.id.startsWith("social_")||i.id==="altro_gestione_pec")}isAnnualToConvert(i){return!i||!i.id?!1:this.ANNUAL_TO_MONTHLY_IDS.has(i.id)}calcolaTotali(){this.totaleMensile=0,this.totaleUnaTantum=0,Object.keys(this.moduli).forEach(i=>{let e=this.moduli[i];if(!(!e||!e.servizi)){if(e.totale=0,e.servizi.forEach(o=>{if(!o.selezionato)return;let t=typeof this.getAltriServiziCountFor=="function"?this.getAltriServiziCountFor(o.id):typeof this.getAltriServiziCount=="function"?this.getAltriServiziCount(o.id):1,r=Number(typeof o.quantita<"u"?o.quantita:t||1),d=Number(o.prezzo??0),z=Number(o.prezzo_mensile??o.prezzoMensile??0),g=Number(o.quantita??0),w=Number(o.prezzo_unitario??0),C=()=>w>0?w:g>0&&d>0?d/g:d;if(z>0){if(this.totaleMensile+=z*r,d>0){let b=C()*r;this.totaleUnaTantum+=b,e.totale+=b}return}if(this.isPriceAlreadyMonthly&&this.isPriceAlreadyMonthly(o)){this.totaleMensile+=d*r;return}if(this.isAnnualToConvert&&this.isAnnualToConvert(o)){let b=C();this.totaleMensile+=this.monthlyPrice(b)*r;return}let u=C()*r;this.totaleUnaTantum+=u,e.totale+=u}),i==="contabilita_fiscalita"&&this.configurazioniContabilita){let o=this.configurazioniContabilita,t=(r,d)=>{let z=Number(r||0);if(z<=0)return;let g=this.getService("contabilita_fiscalita",d);if(g&&g.selezionato||d&&!this.isAddedManually(d))return;let w=this.monthlyPrice(z);this.totaleMensile+=w};t(o?.contabilita?.prezzoCalcolato,"contabilita_principale"),t(o?.fatturazione?.prezzoCalcolato,"fatturazione_principale"),t(o?.iva?.prezzoCalcolato,"iva_principale"),t(o?.redditi?.prezzoCalcolato,"redditi_principale"),t(o?.bilancio?.prezzoCalcolato,"bilancio_principale")}e.totale=Math.round(e.totale*100)/100}}),this.totaleMensile=Math.round(this.totaleMensile*100)/100,this.totaleUnaTantum=Math.round(this.totaleUnaTantum*100)/100,this.totaleGenerale=Math.round((this.totaleUnaTantum+this.totaleMensile*12)*100)/100}toggleServizioContabilita(i){i.tipo==="gruppo"?(i.selezionato=!i.selezionato,i.id==="costituzione_principale"&&(this.configurazioniContabilita.costituzione.attivo=i.selezionato)):i.selezionato=!i.selezionato,this.calcolaTotali()}isServizioContabilitaAbilitato(i){return i.dipendeDa?this.moduli.contabilita_fiscalita.servizi.find(o=>o.id===i.dipendeDa)?.selezionato||!1:!0}deepClone(i){return i==null?i:JSON.parse(JSON.stringify(i))}visualizzaPreventivo(){this.configurazioneCorrenteId?this.router.navigate(["/preventivo",this.configurazioneCorrenteId]):this.salvaConfigurazione().then(()=>{this.configurazioneCorrenteId&&this.router.navigate(["/preventivo",this.configurazioneCorrenteId])}).catch(i=>{console.error("Errore nel salvataggio della configurazione:",i),alert("Errore nel salvataggio. Impossibile generare il preventivo.")})}getResponseDelay(){return this.baseAssistDelay+Math.floor(Math.random()*this.assistJitter)}num(i){let e=Number(i??0);return Math.round(e*100)/100}apriChatSconto(){this.mostraChatSconto=!0,this.messaggiAssistenza=[],this.richiedendoSconto=!1,this.addMessage(`Ciao! Sono l'assistenza Promethea. Dimmi quale sconto desideri richiedere per ${this.selectedProspect?.ragione_sociale||"il cliente"}.`,"assistenza"),setTimeout(()=>{document.getElementById("chat-input")?.focus()},120)}chiudiChatSconto(){this.mostraChatSconto=!1,this.messaggioChat=""}inviaMessaggio(){let i=this.messaggioChat?.trim();i&&(this.addMessage(i,"utente"),this.messaggioChat="",setTimeout(()=>this.handleAssistantReply(i),this.getResponseDelay()))}addMessage(i,e){this.messaggiAssistenza.push({testo:i,autore:e,timestamp:new Date}),setTimeout(()=>this.scrollChatToBottom(),30)}scrollChatToBottom(){let i=document.getElementById("chat-messages")||document.getElementById("modal-body")||document.querySelector(".modal .modal-body");if(i)try{i.scrollTo({top:i.scrollHeight,behavior:"smooth"})}catch{i.scrollTop=i.scrollHeight}}handleAssistantReply(i){return N(this,null,function*(){let e=(i||"").trim();if(/^sconto10072024$/i.test(e)){this.overrideNextLimitPercent=25,this.overrideConsumed=!1,this.addMessage("Deroga segreta attivata: prossimo sconto consentito fino al 25%.","assistenza");return}if(this.pendingCifraRequest&&this.pendingCifraRequest.stage==="awaiting_confirm"){let o=/^\s*(s|si|yes|y)\b/i.test(e),t=/^\s*(n|no|not)\b/i.test(e);if(o){yield this.confirmPendingCifra(!0);return}if(t){yield this.confirmPendingCifra(!1);return}this.addMessage(`Rispondi "si" per confermare l'applicazione dello sconto o "no" per annullare.`,"assistenza");return}this.processDiscountRequest(e)})}confirmPendingCifra(i){return N(this,null,function*(){if(!this.pendingCifraRequest){this.addMessage("Nessuna richiesta in sospeso.","assistenza");return}let e=this.pendingCifraRequest;if(this.pendingCifraRequest=null,!i){this.addMessage("Operazione annullata. Lo sconto non \xE8 stato applicato.","assistenza");return}let o=typeof e.candidatePercent=="number"?e.candidatePercent:typeof e.value=="number"?e.value:null,t=e.target??"entrambi";if(o===null){this.addMessage("Non \xE8 stato possibile determinare la percentuale da applicare.","assistenza");return}this.scontoPercentuale=Math.max(0,Math.min(100,Number(o))),this.scontoTarget=t,e&&e.note==="deroga"&&(this.overrideConsumed=!0,this.overrideNextLimitPercent=0);try{yield this.confermaApplicaSconto()}catch{this.addMessage("Errore durante il salvataggio dello sconto. Riprova.","assistenza")}})}processDiscountRequest(i){if(!this.pendingCifraRequest||!this.pendingCifraRequest.stage){this.pendingCifraRequest={stage:"awaiting_kind"},this.addMessage('Vuoi uno sconto in percentuale o una cifra? (rispondi "percentuale" o "cifra")',"assistenza");return}if(this.pendingCifraRequest.stage==="awaiting_kind"){let e=this.assistenzaService.decideKindFromText(i)??(/\bcifra\b/.test(i)?"cifra":/\bpercent/.test(i)?"percent":null);if(!e){this.addMessage('Non ho capito. Scrivi "percentuale" o "cifra".',"assistenza");return}if(this.pendingCifraRequest.kind=e,e==="cifra"){this.pendingCifraRequest.stage="awaiting_value",this.addMessage('Scrivi la cifra finale desiderata per la quota una-tantum (es. "5000").',"assistenza");return}else{this.pendingCifraRequest.stage="awaiting_value",this.addMessage('Scrivi la percentuale desiderata (es. "10%" oppure "10").',"assistenza");return}}if(this.pendingCifraRequest.stage==="awaiting_value"){let e=this.assistenzaService.parseItalianNumber(i);if(isNaN(e)){this.addMessage('Non ho capito il numero. Inserisci un valore numerico (es. "10%" o "5000").',"assistenza");return}if(this.pendingCifraRequest.kind==="cifra"){let o={una:this.totaleUnaTantum,mensile:this.totaleMensile},t=this.assistenzaService.computeForCifra(o,e);if(!t.allowed){if(t.reason==="limit"){this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:t.candidatePercent,producedTotal:t.producedTotal,value:e,target:"una_tantum"},this.addMessage(`\u274C Richiederebbe uno sconto del ${Number((t.candidatePercent||0).toFixed(2))}%, oltre il limite automatico del ${this.assistenzaService.DEFAULT_LIMIT}%. Vuoi comunque inviare richiesta di approvazione? (si/no)`,"assistenza");return}this.addMessage(t.reason||"Impossibile applicare la cifra richiesta.","assistenza"),this.pendingCifraRequest=null;return}this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:t.candidatePercent,producedTotal:t.producedTotal,value:e,target:"una_tantum"},this.addMessage(`\u2705 Posso applicare la cifra richiesta: quota una\u2011tantum risultante ${this.formatCurrency(e)}. Totale complessivo risultante: ${this.formatCurrency(t.producedTotal||0)}. Vuoi procedere? (si/no)`,"assistenza");return}else{let o=Math.max(0,Math.min(100,e));this.pendingCifraRequest.value=o,this.pendingCifraRequest.stage="awaiting_target",this.addMessage('Dove vuoi applicare la percentuale? Rispondi "mensile", "una tantum" o "entrambi".',"assistenza");return}}if(this.pendingCifraRequest.stage==="awaiting_target"){let e=this.assistenzaService.decideTargetFromText(i);if(!e){this.addMessage('Non ho capito. Rispondi "mensile", "una tantum" o "entrambi".',"assistenza");return}this.pendingCifraRequest.target=e;let o=Number(this.pendingCifraRequest.value??0),t={una:this.totaleUnaTantum,mensile:this.totaleMensile},r=this.assistenzaService.computeForPercent(t,o,e);if(!r.allowed&&typeof r.candidatePercent=="number"&&this.overrideNextLimitPercent>0&&!this.overrideConsumed){let z=Number(r.candidatePercent||o);if(z<=this.overrideNextLimitPercent){this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:z,producedTotal:r.producedTotal,target:e,value:o,note:"deroga"},this.addMessage(`\u26A0\uFE0F Deroga attiva: posso applicare fino a ${z}% per questa richiesta. Vuoi procedere? (si/no)`,"assistenza");return}}if(!r.allowed){if(typeof r.candidatePercent=="number"&&r.candidatePercent>this.assistenzaService.DEFAULT_LIMIT){this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:r.candidatePercent,producedTotal:r.producedTotal,target:e,value:o},this.addMessage(`\u26A0\uFE0F Lo sconto richiesto (${Number(r.candidatePercent.toFixed(2))}%) supera il limite automatico del ${this.assistenzaService.DEFAULT_LIMIT}%. Vuoi inviare richiesta di approvazione? (si/no)`,"assistenza");return}this.addMessage(r.reason||"Impossibile applicare la percentuale richiesta.","assistenza"),this.pendingCifraRequest=null;return}let d=Number((r.candidatePercent??o).toFixed(4));if(e==="mensile"){let z=Math.round(this.totaleMensile*(1-d/100)*100)/100,g=r.producedTotal??Math.round((this.totaleUnaTantum+z*12)*100)/100;this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:r.candidatePercent??d,producedTotal:g,target:e,value:o},this.addMessage(`\u2705 Posso applicare ${d}% sulla quota mensile. Totale mensile risultante: ${this.formatCurrency(z)}/mese \u2014 Totale complessivo risultante: ${this.formatCurrency(g)}. Vuoi procedere? (si/no)`,"assistenza")}else if(e==="una_tantum"){let z=Math.round(this.totaleUnaTantum*(1-d/100)*100)/100,g=r.producedTotal??Math.round((z+this.totaleMensile*12)*100)/100;this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:r.candidatePercent??d,producedTotal:g,target:e,value:o},this.addMessage(`\u2705 Posso applicare ${d}% sulla quota una tantum. Quota una tantum risultante: ${this.formatCurrency(z)} \u2014 Totale complessivo risultante: ${this.formatCurrency(g)}. Vuoi procedere? (si/no)`,"assistenza")}else{let z=r.producedTotal??Math.round((this.totaleUnaTantum+this.totaleMensile*12)*(1-d/100)*100)/100;this.pendingCifraRequest={stage:"awaiting_confirm",candidatePercent:r.candidatePercent??d,producedTotal:z,target:e,value:o},this.addMessage(`\u2705 Posso applicare ${d}% su entrambi. Totale complessivo risultante: ${this.formatCurrency(z)}. Vuoi procedere? (si/no)`,"assistenza")}return}this.addMessage('Scrivi "sconto" per iniziare la procedura guidata.',"assistenza")}get totaleScontato(){let i=Number(this.scontoPercentuale||0)/100;if(this.scontoTarget==="mensile"){let e=this.totaleMensile*(1-i);return Math.round((this.totaleUnaTantum+e*12)*100)/100}else if(this.scontoTarget==="una_tantum"){let e=this.totaleUnaTantum*(1-i);return Math.round((e+this.totaleMensile*12)*100)/100}else{let e=this.totaleUnaTantum+this.totaleMensile*12;return Math.round(e*(1-i)*100)/100}}formatCurrency(i){return`\u20AC ${Number(i||0).toLocaleString("it-IT",{minimumFractionDigits:2,maximumFractionDigits:2})}`}applySconto(i,e){this.scontoPercentuale=Math.max(0,Math.min(100,Math.round(Number(i)*100)/100)),e&&(this.scontoTarget=e)}confermaApplicaSconto(){return N(this,null,function*(){try{yield this.salvaConfigurazione(),this.addMessage(`Sconto del ${this.scontoPercentuale}% applicato e salvato. Totale finale: ${this.formatCurrency(this.totaleScontato)}`,"assistenza"),this.mostraChatSconto=!1}catch(i){console.error("Errore salvataggio sconto:",i),this.addMessage("Errore nel salvataggio dello sconto. Riprova.","assistenza")}})}rimuoviSconto(){this.scontoPercentuale=0}formatPrezzoServizio(i){let e=Math.max(1,Number(i?.quantita??1)),o=Number(i?.prezzo_unitario??i?.prezzo??0),t=Math.round(o*e*100)/100;if(i?.prezzo_mensile>0){let r=Number(i.prezzo_mensile);return e>1?`${e} \xD7 ${this.formatCurrency(r)} = ${this.formatCurrency(r*e)} /mese`:`${this.formatCurrency(r)} /mese`}return e>1?`${e} \xD7 ${this.formatCurrency(o)} = ${this.formatCurrency(t)}`:this.formatCurrency(o)}formatTotaleModulo(i){let e=this.moduli?.[i];if(!e)return"\u2014";let o=e.servizi.filter(u=>u.selezionato).reduce((u,b)=>u+(Number(b.prezzo)||0),0),t=this.previousConfigurazione??null,r=0,d=[];if(t&&t[i]){let u=t[i];d=Array.isArray(u.servizi_selezionati)?u.servizi_selezionati:Array.isArray(u.servizi)?u.servizi:[],typeof u.totale<"u"&&u.totale!==null?r=Number(u.totale)||0:d.length>0&&(r=d.reduce((b,y)=>b+(Number(y?.prezzo)||0),0))}let z=Number(e.totale)||0,g=new Map;e.servizi.filter(u=>u.selezionato).forEach(u=>{u&&u.id&&g.set(u.id,u)}),d.forEach(u=>{let b=typeof u=="string"?u:u?.id;b&&(g.has(b)||g.set(b,{id:b,nome:u?.nome??null,prezzo:Number(u?.prezzo??0),prezzo_mensile:typeof u?.prezzo_mensile<"u"?Number(u.prezzo_mensile):void 0}))});let w=Array.from(g.values()).reduce((u,b)=>u+Number(b.prezzo||0),0),C=Math.max(o,r,z,w);return Array.from(g.values()).some(u=>u?.id==="software_personalizzato"&&(Number(u?.prezzo)||0)===0)?"Valutazione Interna":`\u20AC ${C.toLocaleString("it-IT",{minimumFractionDigits:2,maximumFractionDigits:2})}`}getNumericTotaleModulo(i){let e=this.moduli?.[i];if(!e)return 0;let o=e.servizi.filter(C=>C.selezionato).reduce((C,x)=>C+(Number(x.prezzo)||0),0),t=this.previousConfigurazione??null,r=0,d=[];if(t&&t[i]){let C=t[i];d=Array.isArray(C.servizi_selezionati)?C.servizi_selezionati:Array.isArray(C.servizi)?C.servizi:[],typeof C.totale<"u"&&C.totale!==null?r=Number(C.totale)||0:d.length>0&&(r=d.reduce((x,u)=>x+(Number(u?.prezzo)||0),0))}let z=Number(e.totale)||0,g=new Map;e.servizi.filter(C=>C.selezionato).forEach(C=>{C&&C.id&&g.set(C.id,C)}),d.forEach(C=>{let x=typeof C=="string"?C:C?.id;x&&(g.has(x)||g.set(x,{id:x,prezzo:Number(C?.prezzo??0)}))});let w=Array.from(g.values()).reduce((C,x)=>C+Number(x.prezzo||0),0);return Math.round(Math.max(o,r,z,w)*100)/100}updateTotaleGeneraleFromDetails(){let e=["immagine_marketing","digitalizzazione_automatismi","contabilita_fiscalita","ottimizzazione_management"].reduce((o,t)=>o+this.getNumericTotaleModulo(t),0);this.totaleGenerale=Math.round(e*100)/100}getServizioContabilitaByName(i){let e=this.moduli?.contabilita_fiscalita?.servizi??[];if(!e||e.length===0)return null;let o=e.find(z=>z.id===i);if(o)return o;let r={contabilita:"contabilita_principale",contabilita_principale:"contabilita_principale",fatturazione:"fatturazione_principale",fatturazione_principale:"fatturazione_principale",iva:"iva_principale",iva_principale:"iva_principale",costituzione:"costituzione_principale",costituzione_principale:"costituzione_principale"}[i.toLowerCase()];if(r){let z=e.find(g=>g.id===r);if(z)return z}return e.find(z=>(z.nome??"").toLowerCase().includes(i.toLowerCase()))??e.find(z=>z.tipo==="configurabile")??e[0]??null}toggleAltriServizi(){this.showAltriServizi=!this.showAltriServizi}toggleContabilitaChildren(){this.showContabilitaChildren=!this.showContabilitaChildren}getServiceById(i){return(this.moduli?.contabilita_fiscalita?.servizi??[]).find(o=>o.id===i)??null}toggleServiceById(i){let e=this.getServiceById(i);if(!e){console.warn(`Servizio non trovato: ${i}`);return}this.toggleServizioContabilita(e)}isContabilitaPrincipaleSelezionato(){return this.isServiceSelected("contabilita_fiscalita","contabilita_principale")}toggleContabilitaPrincipale(){this.toggleService("contabilita_fiscalita","contabilita_principale")}getService(i,e){let o=this.moduli[i];if(!o||!Array.isArray(o.servizi))return null;let t=o.servizi.find(z=>z.id===e);if(t)return t;let d={contabilita_principale:"contabilita_principale",contabilita:"contabilita_principale",fatturazione_principale:"fatturazione_principale",fatturazione:"fatturazione_principale",iva_principale:"iva_principale",iva:"iva_principale",costituzione_principale:"costituzione_principale",costituzione:"costituzione_principale"}[e];return d&&(t=o.servizi.find(z=>z.id===d),t)||(t=o.servizi.find(z=>(z.nome||"").toLowerCase().includes((e||"").toLowerCase())),t)?t:o.servizi.find(z=>z.tipo==="configurabile")??o.servizi[0]??null}toggleService(i,e,o=!1){let t=this.getService(i,e);if(!t){console.warn(`[Alchemizzatore] servizio non trovato in ${i}: ${e}`);return}if(i==="contabilita_fiscalita"){this.toggleServizioContabilita(t),o?t.aggiuntoManualmente=!!t.selezionato:t.selezionato||(t.aggiuntoManualmente=!1),this.calcolaTotali();return}this.toggleServizio(i,t),this.calcolaTotali()}isServiceSelected(i,e){let o=this.getService(i,e);return!!(o&&o.selezionato)}getDescrizioneContabilita(i){return{semplificata:"(fino a 90: 1.421\u20AC, 90-180: 1.811\u20AC, 180-360: 2.805\u20AC, oltre 360: 2.805\u20AC + 2\u20AC/registrazione)",ordinaria:"(fino a 600: 3.276\u20AC, oltre 600: 3.276\u20AC + 3.38\u20AC/registrazione)",mista:"(fino a 600: 2.644\u20AC, oltre 600: 2.644\u20AC + 3.38\u20AC/registrazione)"}[(i??"").toLowerCase()]??""}getAltriServiziCount(i){let e=this.configurazioniContabilita?.altriServizi??{};switch(i){case"altro_modello_770":return Number(e.modello770Count)||1;case"altro_imu_dichiarazione":return Number(e.imuCount)||1;case"altro_locazioni":return Number(e.locazioniCount)||1;case"altro_smart_card_rilascio":return Number(e.smartCardRilascioCount)||1;default:return 1}}detectDiscountTargetFromText(i){let e=(i||"").toLowerCase();return/\b(mensil|mensile|mese|mesi)\b/.test(e)?"mensile":/\buna\b.*\btantum\b|\buna_tantum\b|\buna tantum\b|\btantum\b/.test(e)?"una_tantum":(/\bentrambi\b|\btutto\b|\btotale\b|\bambedue\b/.test(e),"entrambi")}isAddedManually(i){let e=this.getService("contabilita_fiscalita",i);return!!(e&&e.aggiuntoManualmente)}getTotaliModuloSplit(i){let e={mensile:0,una:0},o=this.moduli[i];if(!o||!Array.isArray(o.servizi))return e;if(o.servizi.forEach(t=>{if(!t.selezionato)return;let r=typeof this.getAltriServiziCountFor=="function"?this.getAltriServiziCountFor(t.id):typeof this.getAltriServiziCount=="function"?this.getAltriServiziCount(t.id):1,d=Number(typeof t.quantita<"u"?t.quantita:r||1),z=Number(t.prezzo??0),g=Number(t.prezzo_mensile??t.prezzoMensile??0),w=Number(t.quantita??0),C=Number(t.prezzo_unitario??0),x=()=>C>0?C:w>0&&z>0?z/w:z;if(g>0){e.mensile+=g*d,z>0&&(e.una+=x()*d);return}if(this.isPriceAlreadyMonthly&&this.isPriceAlreadyMonthly(t)){z>0&&(e.mensile+=z*d);return}if(this.isAnnualToConvert&&this.isAnnualToConvert(t)){z>0&&(e.mensile+=this.monthlyPrice(x())*d);return}z>0&&(e.una+=x()*d)}),i==="contabilita_fiscalita"&&this.configurazioniContabilita){let t=this.configurazioniContabilita,r=(d,z)=>{let g=Number(d||0);if(g<=0)return;let w=this.getService("contabilita_fiscalita",z);w&&w.selezionato||this.isAddedManually(z)&&(e.mensile+=this.monthlyPrice(g))};r(t?.contabilita?.prezzoCalcolato,"contabilita_principale"),r(t?.fatturazione?.prezzoCalcolato,"fatturazione_principale"),r(t?.iva?.prezzoCalcolato,"iva_principale"),r(t?.redditi?.prezzoCalcolato,"redditi_principale"),r(t?.bilancio?.prezzoCalcolato,"bilancio_principale")}return e.mensile=Math.round(e.mensile*100)/100,e.una=Math.round(e.una*100)/100,e}getAltriServiziCountFor(i){let e=this.configurazioniContabilita&&this.configurazioniContabilita.altriServizi||{};switch(i){case"altro_modello_770":return Number(e.modello770Count||1);case"altro_imu_dichiarazione":return Number(e.imuCount||1);case"altro_locazioni":return Number(e.locazioniCount||1);case"altro_smart_card_rilascio":return Number(e.smartCardRilascioCount||1);default:return 1}}isAltriServiziCounted(i){return["altro_modello_770","altro_imu_dichiarazione","altro_locazioni","altro_smart_card_rilascio"].includes(i)}updateTotaliSplitFromConfig(i=!1){this.calcolaTotali();let e=this.previousConfigurazione&&this.previousConfigurazione.meta?this.previousConfigurazione.meta:this.configurazione?.dettagli?.meta??{},o=Number(e?.scontoPercentuale??0)||0,t=e?.scontoTarget??"entrambi";t==="una"&&(t="una_tantum");let r=t,d=i?o:typeof this.scontoPercentuale=="number"?this.scontoPercentuale:o,z=i?r:this.scontoTarget??r;this.totaleUnaScontata=d>0&&(z==="una_tantum"||z==="entrambi")?Math.round(this.totaleUnaTantum*(1-d/100)*100)/100:this.totaleUnaTantum,this.totaleMensileScontato=d>0&&(z==="mensile"||z==="entrambi")?Math.round(this.totaleMensile*(1-d/100)*100)/100:this.totaleMensile,i&&(this.scontoPercentuale=d,this.scontoTarget=z)}onScontoChange(){this.calcolaTotali(),this.updateTotaliSplitFromConfig(!1)}getPacchettiConsulenza(){return this.getServiziPacchetto("ottimizzazione_management").filter(i=>typeof i.id=="string"&&i.id.startsWith("consulenza_impresa_"))}getPacchettiFormazione(){return this.getServiziPacchetto("ottimizzazione_management").filter(i=>typeof i.id=="string"&&i.id.startsWith("formazione_commerciale_"))}createInvoiceFromConfigurazione(i,e,o){return N(this,null,function*(){if(!(!i||!e))try{let t=new Date().toISOString(),r=[];for(let P of Object.keys(i||{})){let k=i[P],F=Array.isArray(k?.servizi_selezionati)?k.servizi_selezionati:Array.isArray(k?.servizi)?k.servizi:[];for(let O of F){let Te=O?.nome??O?.title??O?.id??"Servizio",Ie=Number(O?.quantita??O?.quantity??1)||1,Q=Number(O?.prezzo??O?.price??0),H=Number(O?.prezzo_mensile??O?.prezzoMensile??0),Y=Q>0?Q:H>0?H:0;Y!==0&&r.push({descrizione:Te,importo:Y,quantita:Ie})}}let d=r.reduce((P,k)=>P+Number(k.importo||0)*Number(k.quantita||1),0),z=new Date(t).getFullYear(),{data:g,error:w}=yield this.supabaseService.supabase.from("fatture").select("numero").not("numero","is",null).gte("data_emissione",`${z}-01-01`).lt("data_emissione",`${z+1}-01-01`);if(w)throw w;let C=0;(g||[]).forEach(P=>{try{let F=String(P.numero||"").split("/")[0].replace(/\D/g,""),O=parseInt(F||"0",10);!isNaN(O)&&O>C&&(C=O)}catch{}});let x=C+1,u=`${String(x).padStart(4,"0")}/${z}`,b={tipo:"attiva",soggetto_id:e,configurazione_id:o??null,numero:u,data_emissione:t,importo:Number(d||0),descrizione:`Fattura generata da configurazione ${o??""}`.trim()||null,quantita:1,dettagli:{items:r},created_by:this.authService.getCurrentUserId?.()??null,created_at:t,updated_at:t,completata:!1},{error:y}=yield this.supabaseService.supabase.from("fatture").insert([b]);if(y){console.error("Errore inserimento fattura automatica:",y);return}console.info("Fattura automatica creata per soggetto",e,"numero",u)}catch(t){throw console.error("createInvoiceFromConfigurazione error",t),t}})}adjustQuantity(i,e,o){o?.stopPropagation(),i.quantita=Math.max(1,(Number(i.quantita)||1)+e),(!i.prezzo_unitario||Number(i.prezzo_unitario)===0)&&(i.prezzo_unitario=Number(i.prezzo||0)),i.prezzo=Math.round(Number(i.prezzo_unitario||0)*Number(i.quantita)*100)/100,this.calcolaTotali()}onQtyChange(i){i.quantita=Math.max(1,Number(i.quantita)||1),(!i.prezzo_unitario||Number(i.prezzo_unitario)===0)&&(i.prezzo_unitario=Number(i.prezzo||0)),i.prezzo=Math.round(Number(i.prezzo_unitario||0)*Number(i.quantita)*100)/100,this.calcolaTotali()}static \u0275fac=function(e){return new(e||s)(q(Me),q(Ae),q(de),q(me),q(Pe),q(_e),q(pe),q(ue),q(G))};static \u0275cmp=Z({type:s,selectors:[["app-alchemizzatore"]],decls:23,vars:19,consts:[["otherTitle",""],["normalTitle",""],["normalTitleSingoli",""],["mensileNoSconto",""],["unaNoSconto",""],["normalService",""],["normalPrice",""],[1,"alchemizzatore-container"],[1,"form-section"],[1,"progress-steps"],[1,"step",3,"click"],[1,"trattativa-section"],["class","form-section form-section",4,"ngIf"],["class","form-section form-section summary-step",4,"ngIf"],[1,"form-section","form-section"],[1,"section-header"],[1,"material-icons","header-icon"],[1,"section-titles"],[1,"section-title"],[1,"card"],[1,"form-label"],[1,"search-input-container"],["type","text","placeholder","Cerca per ragione sociale, P.IVA o referente...",3,"ngModelChange","input","ngModel"],["class","status-message loading",4,"ngIf"],["class","status-message error",4,"ngIf"],["class","search-results","role","listbox",4,"ngIf"],["class","status-message info",4,"ngIf"],["class","status-message warning",4,"ngIf"],[1,"actions-container"],[1,"promethea-button",3,"click","disabled"],[1,"status-message","loading"],[1,"loading-spinner"],[1,"status-message","error"],["role","listbox",1,"search-results"],["class","search-result-item","role","option",3,"click",4,"ngFor","ngForOf"],["role","option",1,"search-result-item",3,"click"],[1,"result-text"],[1,"result-title"],[1,"result-subtitle"],[1,"result-icon"],[1,"status-message","info"],[1,"material-icons"],[1,"status-message","warning"],[1,"sottotitolo"],[1,"section-title","sotto"],[1,"grid-responsive"],["class","card ",3,"selezionato","disabled","click",4,"ngFor","ngForOf"],["class","card ",3,"selezionato","click",4,"ngFor","ngForOf"],[1,"card","totale-modulo"],[1,"card-number","totale"],[1,"promethea-button","secondary",3,"click"],[1,"promethea-button",3,"click"],[1,"card",3,"click"],["aria-hidden","false",1,"card-title"],[4,"ngIf","ngIfElse"],["class","sottotitolo",4,"ngIf"],[1,"card-number"],[1,"servizio-descrizione"],["class","chip",4,"ngIf"],["class","small text-muted",4,"ngIf"],[1,"checkmark"],[1,"chip"],[1,"small","text-muted"],[1,"count-control",2,"margin-top","0.6rem",3,"click"],[1,"count-controls"],["type","button","title","Riduci quantit\xE0",1,"action-btn","delete",3,"click"],["type","number","min","1",1,"count-input",3,"ngModelChange","click","ngModel"],["type","button","title","Aumenta quantit\xE0",1,"action-btn","add",3,"click"],[1,"totale-row"],[1,"totale-label"],[1,"totale-amount"],[1,"categorie-contabilita"],[1,"categoria-contabilita"],[1,"configurazione-gruppo"],[1,"card","card-clickable",3,"click"],[1,"card-title"],[1,"card-number","card-number"],[4,"ngIf"],[1,"card-actions-absolute"],[1,"icon-btn",3,"click","title"],[1,"grid-form"],[1,"form-field"],[1,"table-inline-select",3,"ngModelChange","change","ngModel"],["value",""],["value","semplificata"],["value","ordinaria"],["value","mista"],["type","number","min","1","max","10000",1,"table-inline-input",3,"ngModelChange","change","ngModel"],["value","emissione_noi"],["value","piattaforma_passcom"],["type","number","min","1","max","1000",1,"table-inline-input",3,"ngModelChange","change","ngModel"],["class","card-number",4,"ngIf"],["value","trimestrale"],["value","mensile"],["value","75000"],["value","150000"],["value","300000"],["value","500000"],["value","750000"],["value","1000000"],[1,"form-field","checkbox"],["type","checkbox",3,"ngModelChange","change","ngModel"],[1,"section-title",2,"display","flex","align-items","center","justify-content","space-between"],["type","button","title","Mostra/Nascondi",1,"icon-btn",3,"click"],["class","grid-form alternativa",4,"ngIf"],[1,"grid-form","alternativa2"],["class","card",3,"selezionato","disabled","click",4,"ngFor","ngForOf"],[1,"grid-form","alternativa"],["class","small text-muted","style","margin-top:0.5rem;",3,"click",4,"ngIf"],[1,"small","text-muted",2,"margin-top","0.5rem",3,"click"],[1,"count-control"],["type","button",1,"action-btn","delete",3,"click"],["type","button",1,"action-btn","add",3,"click"],[1,"form-section","form-section","summary-step"],["class","card",4,"ngIf"],[1,"card","text-center"],["role","status","aria-live","polite",1,"totale-generale-wrapper"],[2,"display","flex","flex-direction","column","gap","0.4rem","align-items","center","margin-top","0.3rem"],[1,"totale-normale"],[1,"actions-container",2,"margin","var(--gutter-lg)","justify-content","center"],[1,"promethea-button","ghost",3,"click"],["title","Assistenza",1,"promethea-button","ghost",3,"click"],[1,"promethea-button","outline",3,"click"],["class","promethea-button success",3,"click",4,"ngIf"],[1,"promethea-button","success",3,"click","disabled"],["class","form-section",4,"ngIf"],["class","modal-backdrop",4,"ngIf"],["class","servizio-riepilogo",4,"ngFor","ngForOf"],[1,"totale-label2"],[1,"servizio-riepilogo"],[1,"servizio-left"],[1,"badge","badge-info"],[1,"card-servizio"],[1,"card-number","servizio"],["style","width: 100% ;",4,"ngFor","ngForOf"],[2,"width","100%"],[1,"badge","badge-secondary"],["class","servizio-riepilogo",4,"ngIf"],[1,"badge","badge-secondary",2,"visibility","hidden"],[1,"badge","badge-tertiary"],[2,"margin","0 0.5rem"],[2,"margin-left","0.6rem","color","var(--muted-color)"],[1,"badge","badge-primary"],[1,"totale-originale",2,"margin","0 0.6rem"],[1,"totale-normale",2,"color","var(--primary)"],[2,"margin-left","0.6rem"],[2,"margin-top","0.45rem"],[1,"text-muted"],[1,"promethea-button","success",3,"click"],[1,"sconto-display"],["class","sconto-value",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"actions"],["class","promethea-button ghost",3,"click",4,"ngIf"],[1,"totale-riepilogo"],[1,"totale-value"],["class","form-field",4,"ngIf"],[1,"sconto-value"],[1,"totale-value","text-muted"],[1,"modal-backdrop"],[1,"modal"],[1,"modal-header"],[1,"modal-title"],[1,"icon-btn","close",3,"click"],[1,"modal-body",2,"display","flex","flex-direction","column","height","calc(100% - 120px)"],["id","modal-body",1,"modal-body",2,"flex","1","overflow-y","auto","margin-bottom","var(--gutter-md)"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"form-field",2,"display","flex","gap","var(--gutter-sm)"],["id","form-field","type","text","placeholder","Scrivi il tuo messaggio...",1,"table-inline-input",2,"flex","1",3,"ngModelChange","keyup.enter","ngModel"],[3,"ngClass"],[1,"badge"],["class","material-icons",4,"ngIf"],[1,"message-content"],[1,"card",2,"margin-top","var(--gutter-lg)"],["type","text","placeholder","Nome e cognome",1,"form-input",3,"ngModelChange","ngModel"],["type","tel","placeholder","Telefono",1,"form-input",3,"ngModelChange","ngModel"],["type","email","placeholder","Email",1,"form-input",3,"ngModelChange","ngModel"],["class","card","style","margin-top: var(--gutter-md);",4,"ngIf"],[1,"card",2,"margin-top","var(--gutter-md)"],[1,"text-muted",2,"margin-left","0.6rem"],[1,"actions-container",2,"justify-content","flex-end"],[1,"action-btn","delete",3,"click"]],template:function(e,o){e&1&&(n(0,"div",7)(1,"div",8)(2,"div",9)(3,"button",10),f("click",function(){return o.vaiAStep(1)}),l(4,"1"),a(),n(5,"button",10),f("click",function(){return o.vaiAStep(2)}),l(6,"2"),a(),n(7,"button",10),f("click",function(){return o.vaiAStep(3)}),l(8,"3"),a(),n(9,"button",10),f("click",function(){return o.vaiAStep(4)}),l(10,"4"),a(),n(11,"button",10),f("click",function(){return o.vaiAStep(5)}),l(12,"5"),a(),n(13,"button",10),f("click",function(){return o.vaiAStep(6)}),l(14,"6"),a()()(),n(15,"div",11),S(16,Ue,20,9,"section",12)(17,rt,28,4,"section",12)(18,dt,34,4,"section",12)(19,St,163,30,"section",12)(20,It,38,5,"section",12)(21,ci,50,15,"section",13)(22,ui,30,5,"section",12),a()()),e&2&&(c(3),A("active",o.currentStep===1),c(2),A("active",o.currentStep===2),c(2),A("active",o.currentStep===3),c(2),A("active",o.currentStep===4),c(2),A("active",o.currentStep===5),c(2),A("active",o.currentStep===6),c(3),v("ngIf",o.currentStep===1),c(),v("ngIf",o.currentStep===2),c(),v("ngIf",o.currentStep===3),c(),v("ngIf",o.currentStep===4),c(),v("ngIf",o.currentStep===5),c(),v("ngIf",o.currentStep===6),c(),v("ngIf",o.currentStep===7))},dependencies:[ce,ne,oe,ae,we,Ce,be,ge,he,ze,xe,fe,ye,Se,ve,se,le,re],styles:[".alchemizzatore-container[_ngcontent-%COMP%]{padding:var(--gutter-lg)}.trattativa-section[_ngcontent-%COMP%]{margin:var(--gutter-lg) 0}.section-title.sotto[_ngcontent-%COMP%]{margin-top:var(--gutter-lg);margin-bottom:var(--gutter-md)}.servizio-descrizione[_ngcontent-%COMP%]{color:color-mix(in srgb,var(--text-color) 70%,transparent);font-size:var(--fs-sm);margin:0 0 var(--gutter-sm) 0;line-height:1.4}.checkmark[_ngcontent-%COMP%]{position:absolute;top:var(--gutter-md);right:var(--gutter-md);width:24px;height:24px;border:2px solid var(--smoke-color-1);border-radius:50%;display:grid;place-items:center;color:transparent;transition:all .2s ease;background:transparent}.checkmark.attivo[_ngcontent-%COMP%]{background:var(--primary);border-color:var(--primary);color:#fff}.totale-modulo[_ngcontent-%COMP%]{font-weight:700;text-align:right;color:var(--primary);border-top:1px solid var(--smoke-color-1);padding:var(--gutter-lg);margin-top:var(--gutter-lg);font-size:var(--fs-md)}.promethea-button.success[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669)}.actions-container[_ngcontent-%COMP%]{margin-top:var(--gutter-lg)}.card-number[_ngcontent-%COMP%]{font-size:var(--fs-md)}.card-number.servizio[_ngcontent-%COMP%]{color:var(--text-color);font-size:var(--fs-sm);flex-wrap:wrap}.card-number.totale[_ngcontent-%COMP%]{margin-top:var(--gutter-md);text-align:right;display:flex;flex-direction:column;gap:var(--gutter-sm)}.categoria-contabilita[_ngcontent-%COMP%]{padding:var(--gutter-lg) 0}.grid-responsive[_ngcontent-%COMP%]{margin-top:var(--gutter-sm)}.servizi-elenco[_ngcontent-%COMP%], .card-clickable[_ngcontent-%COMP%]{margin-bottom:var(--gutter-sm);display:flex;flex-direction:column;gap:.5rem}.servizio-riepilogo[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;gap:var(--gutter-sm);width:100%;padding:var(--gutter-sm) 0;min-width:0;border-bottom:1px dashed color-mix(in srgb,var(--text-color) 80%,transparent)}.card-title[_ngcontent-%COMP%]{padding-right:var(--gutter-md)}.servizio-left[_ngcontent-%COMP%]{flex:1 1 0;min-width:0;display:flex;gap:.6rem;align-items:center}.servizio-nome[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;min-width:0}.servizio-price[_ngcontent-%COMP%]{flex:0 0 auto;margin-left:auto;color:var(--primary);font-weight:700;white-space:nowrap;min-width:0}.card-number.totale[_ngcontent-%COMP%], .totale-modulo[_ngcontent-%COMP%], .totale-amount[_ngcontent-%COMP%]{box-sizing:border-box;max-width:100%;word-break:break-word;overflow-wrap:anywhere;white-space:normal;min-width:0}.count-controls[_ngcontent-%COMP%], .count-input[_ngcontent-%COMP%], input[type=number][_ngcontent-%COMP%]{min-width:0;max-width:100%;box-sizing:border-box}.alchemizzatore-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{box-sizing:border-box}@media (min-width: 1100px){.grid-responsive[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}.user-message[_ngcontent-%COMP%]{flex-direction:row-reverse}.assistance-message[_ngcontent-%COMP%]{flex-direction:row}.user-message[_ngcontent-%COMP%]   .message-avatar[_ngcontent-%COMP%]{background:var(--primary);color:var(--background)}.assistance-message[_ngcontent-%COMP%]   .message-avatar[_ngcontent-%COMP%]{background:var(--smoke-color-1);color:var(--text-color)}.message-content[_ngcontent-%COMP%]{max-width:70%;display:flex;flex-direction:column;gap:var(--gutter-sm)}.user-message[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{align-items:flex-end}.assistance-message[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{align-items:flex-start}.message-content[_ngcontent-%COMP%]   .chip[_ngcontent-%COMP%]{border-radius:var(--fs-md);padding:var(--gutter-md)}.user-message[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{background:var(--primary);color:#fff;border-bottom-right-radius:4px}.assistance-message[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{background:var(--smoke-color-1);color:var(--text-color);border-bottom-left-radius:4px}.sconto-display[_ngcontent-%COMP%]{padding:var(--gutter-sm);border-radius:8px;background:color-mix(in srgb,var(--success) 10%,transparent);border:1px solid color-mix(in srgb,var(--success) 30%,transparent)}.sconto-value[_ngcontent-%COMP%]{color:var(--success);font-weight:600}.totale-value.scontato[_ngcontent-%COMP%]{font-size:var(--fs-md)}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--smoke-color-1);border-radius:3px}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.totale-generale-wrapper[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:center;gap:.6rem;flex-wrap:wrap}.totale-generale-wrapper[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-right:.25rem;color:var(--text-muted);font-weight:600}.totale-scontato[_ngcontent-%COMP%]{color:var(--primary);font-weight:800;font-size:1.25rem}.totale-originale[_ngcontent-%COMP%]{text-decoration:line-through;color:var(--text-muted);opacity:.85;margin-left:.4rem}.totale-normale[_ngcontent-%COMP%]{font-weight:700;font-size:var(--fs-md)}@media (max-width:640px){.totale-generale-wrapper[_ngcontent-%COMP%]{flex-direction:column;gap:.2rem;text-align:center}.totale-originale[_ngcontent-%COMP%]{margin-left:0}}.card.text-center[_ngcontent-%COMP%]{margin-top:var(--gutter-lg)}.card-actions-absolute[_ngcontent-%COMP%]{position:absolute;top:var(--gutter-sm);right:var(--gutter-sm);display:flex;gap:.5rem;z-index:10;pointer-events:auto}.card[_ngcontent-%COMP%]   .grid-form[_ngcontent-%COMP%]{gap:var(--gutter-sm);margin-top:var(--gutter-sm)}.alchemizzatore-container[_ngcontent-%COMP%]   .summary-step[_ngcontent-%COMP%]   .grid-responsive[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr);gap:var(--gutter-md);align-items:stretch}@media (max-width: 640px){.alchemizzatore-container[_ngcontent-%COMP%]   .summary-step[_ngcontent-%COMP%]   .grid-responsive[_ngcontent-%COMP%]{grid-template-columns:1fr}}.alchemizzatore-container[_ngcontent-%COMP%]   .summary-step[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.alchemizzatore-container[_ngcontent-%COMP%]   .summary-step[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-number.totale[_ngcontent-%COMP%]{margin-top:auto;align-self:stretch;border-top:1px solid var(--smoke-color-1);padding-top:var(--gutter-md)}.alchemizzatore-container[_ngcontent-%COMP%]   .grid-responsive[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:var(--gutter-md);align-items:start;justify-items:stretch}.alchemizzatore-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{min-width:0;box-sizing:border-box;width:100%;display:flex;flex-direction:column;overflow:hidden}.alchemizzatore-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{overflow:visible}.alchemizzatore-container[_ngcontent-%COMP%]   .search-input-container[_ngcontent-%COMP%]{position:relative}.alchemizzatore-container[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]{position:absolute;z-index:9999;top:calc(100% + var(--gutter-sm))}.alchemizzatore-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .grid-form[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:var(--gutter-sm);align-items:center;min-width:0}.alchemizzatore-container[_ngcontent-%COMP%]   .card-number.servizio[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:0}.count-controls[_ngcontent-%COMP%], .count-input[_ngcontent-%COMP%]{min-width:0;max-width:100%;box-sizing:border-box}.totale-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:var(--gutter-sm);padding:var(--gutter-sm) 0;width:100%;box-sizing:border-box}.totale-label2[_ngcontent-%COMP%]{flex:1 1 0;min-width:0;font-weight:700;color:var(--text-color);font-size:var(--fs-sm);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.totale-amount[_ngcontent-%COMP%]{flex:0 0 auto;margin-left:1rem;font-weight:800;color:var(--primary);font-size:var(--fs-md);white-space:nowrap;min-width:0}.totale-row[_ngcontent-%COMP%] > .totale-amount[_ngcontent-%COMP%]{text-align:right;width:auto}.totale-row[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{min-width:0;box-sizing:border-box}"]})};export{Ee as Alchemizzatore};
