import{a as ve}from"./chunk-HL45SJJW.js";import{a as fe}from"./chunk-6H2VKAM3.js";import{a as he}from"./chunk-OEP5FWN6.js";import{c as _e}from"./chunk-DS74SF54.js";import{a as ue}from"./chunk-OCVT6WLO.js";import{a as ge}from"./chunk-WOMB6SWO.js";import{b as ae,d as se,f as le,o as ce,p as de,u as pe}from"./chunk-3JKT2CHV.js";import{b as me}from"./chunk-3Y2ZP6KK.js";import{a as oe}from"./chunk-3347WCPA.js";import{b as ne,c as re}from"./chunk-2ONBSOVF.js";import{c as Q,d as X,e as Z,k as ee,q as te,r as ie}from"./chunk-233B5766.js";import{A as z,Bb as k,Db as S,Fa as l,Fb as s,Gb as y,Hb as w,I as R,Jb as B,Ka as D,Kb as K,Lb as q,Nb as O,Pb as W,Ra as N,Rb as H,S as b,Sb as J,Wa as v,X as u,Xb as G,Y as g,ea as C,eb as $,f as A,fb as U,gb as d,hb as n,ib as r,jb as P,nb as Y,ob as j,qb as x,tb as f,ub as p,x as V}from"./chunk-R6HFAJZF.js";import"./chunk-X5YLR3NI.js";import{a as L,b as F,i as _}from"./chunk-ODN5LVDJ.js";var be=()=>["/soggetto","nuovo","cliente"],Ce=(o,e,t)=>({promethea:o,yuvi:e,infoTecniche:t}),xe=(o,e)=>({"product-promethea":o,"product-yuvi":e});function Se(o,e){o&1&&(n(0,"a",46)(1,"span",22),s(2,"add_circle"),r()()),o&2&&d("routerLink",W(1,be))}function we(o,e){if(o&1&&(n(0,"option",47),s(1),r()),o&2){let t=e.$implicit;d("value",t),l(),y(t)}}function Pe(o,e){if(o&1&&(n(0,"option",47),s(1),r()),o&2){let t=e.$implicit;d("value",t),l(),y(t)}}function Ie(o,e){if(o&1&&(n(0,"span"),s(1),r()),o&2){let t=p().$implicit;l(),y(t.comune)}}function Ee(o,e){if(o&1&&(n(0,"span"),s(1),r()),o&2){let t=p().$implicit;l(),w(" (",t.provincia,")")}}function ke(o,e){o&1&&(n(0,"span",70),s(1," Nessun indirizzo "),r())}function Te(o,e){if(o&1){let t=x();n(0,"button",75),f("click",function(a){u(t);let c=p().$implicit,m=p(2).$implicit,M=p();return a.stopPropagation(),g(M.confirmRemoveProduct(m,c))}),n(1,"span",76),s(2,"close"),r()()}if(o&2){let t=p().$implicit;d("title",O("Rimuovi ",t)),$("aria-label",O("Rimuovi ",t))}}function Me(o,e){if(o&1&&(n(0,"span",73),s(1),v(2,Te,3,4,"button",74),r()),o&2){let t=e.$implicit,i=p(2).$implicit,a=p();d("ngClass",H(3,xe,t==="Promethea",t==="YUVI")),l(),w(" ",t," "),l(),d("ngIf",!a.isProdottoAutomatico(t,i))}}function Ae(o,e){if(o&1&&(n(0,"div",71),v(1,Me,3,6,"span",72),r()),o&2){let t=p().$implicit,i=p();l(),d("ngForOf",i.getSelectedProducts(t))}}function Oe(o,e){if(o&1&&(n(0,"option",47),s(1),r()),o&2){let t=e.$implicit;d("value",t.nome),l(),w(" ",t.nome," ")}}function Le(o,e){o&1&&(n(0,"div",82),P(1,"span",83),r())}function Fe(o,e){if(o&1){let t=x();n(0,"div",77)(1,"select",78,4),f("change",function(a){u(t);let c=p().$implicit,m=p();return g(m.onProductSelectChange(c,a))}),v(3,Oe,2,2,"option",28),r(),n(4,"div",79)(5,"button",80),f("click",function(){u(t);let a=p(2);return g(a.closeProductPicker())}),s(6,"Chiudi"),r(),v(7,Le,2,0,"div",81),r()()}if(o&2){let t=p().$implicit,i=p();l(),d("value",i.getSelectedProducts(t))("disabled",i.updatingProdottoIds.has(t.id)),l(2),d("ngForOf",i.getManualProducts()),l(4),d("ngIf",i.updatingProdottoIds.has(t.id))}}function Ve(o,e){o&1&&(n(0,"span",84),s(1,"S\xEC"),r())}function ze(o,e){o&1&&(n(0,"span",85),s(1,"No"),r())}function Re(o,e){if(o&1&&(Y(0),n(1,"span"),s(2),r(),j()),o&2){let t=e.ngIf;l(2),y(t.tipo)}}function De(o,e){o&1&&s(0,"\u2014")}function Ne(o,e){if(o&1){let t=x();n(0,"button",86),f("click",function(a){u(t);let c=p().$implicit,m=p();return a.stopPropagation(),g(m.vediConfigurazionePromethea(c))}),P(1,"img",87),r()}}function $e(o,e){if(o&1){let t=x();n(0,"button",88),f("click",function(a){u(t);let c=p().$implicit,m=p();return a.stopPropagation(),g(m.vediTrattativaYuvi(c))}),P(1,"img",89),r()}}function Ue(o,e){if(o&1){let t=x();n(0,"button",90),f("click",function(a){u(t);let c=p().$implicit,m=p();return a.stopPropagation(),g(m.goToInformazioniTecniche(c))}),n(1,"span",22),s(2,"build"),r()()}}function Ye(o,e){if(o&1){let t=x();n(0,"tr",48)(1,"td",49)(2,"div",50)(3,"strong",51),f("click",function(){let a=u(t).$implicit,c=p();return g(c.apriScheda(a))}),s(4),r()()(),n(5,"td",52)(6,"div",50),s(7),r()(),n(8,"td",53)(9,"div",50),s(10),r()(),n(11,"td",54)(12,"div",50),v(13,Ie,2,1,"span",42)(14,Ee,2,1,"span",42)(15,ke,2,0,"span",55),r()(),n(16,"td",56)(17,"div",50),v(18,Ae,2,1,"div",57)(19,Fe,8,4,"div",58),r()(),n(20,"td",59)(21,"div",50),v(22,Ve,2,0,"span",60)(23,ze,2,0,"span",61),r()(),n(24,"td",62)(25,"div",50),v(26,Re,3,1,"ng-container",63)(27,De,1,0,"ng-template",null,3,G),r()(),n(29,"td",64)(30,"div",65),v(31,Ne,2,0,"button",66)(32,$e,2,0,"button",67)(33,Ue,3,0,"button",68),n(34,"app-action-dropdown",69),f("opened",function(){u(t);let a=p();return g(a.dropdownAnyOpen.set(!0))})("closed",function(){u(t);let a=p();return g(a.dropdownAnyOpen.set(!1))})("action",function(a){let c=u(t).$implicit,m=p();return g(m.handleRowAction(a,c))}),r()()()()}if(o&2){let t=e.$implicit,i=k(28),a=p();U("data-row-id",t.id),l(4),y(t.ragione_sociale),l(3),y(t.referente||"\u2014"),l(3),y(t.telefono||"\u2014"),l(3),d("ngIf",t.comune),l(),d("ngIf",t.provincia),l(),d("ngIf",!t.comune&&!t.provincia),l(3),d("ngIf",a.getSelectedProducts(t).length>0),l(),d("ngIf",a.isProductPickerOpen(t)),l(3),d("ngIf",t.configurato),l(),d("ngIf",!t.configurato),l(3),d("ngIf",t.ultimoEsito)("ngIfElse",i),l(5),d("ngIf",t.hasConfigPromethea),l(),d("ngIf",t.hasTrattativaYuvi),l(),d("ngIf",a.showInformazioniTecniche(t)),l(),d("row",t)("hideAddProduct",a.dropdownAnyOpen())("showPromethea",!1)("primaryIcons",J(20,Ce,t.hasConfigPromethea,t.hasTrattativaYuvi,a.showInformazioniTecniche(t)))}}function je(o,e){if(o&1&&(n(0,"tr")(1,"td",91),s(2),r()()),o&2){let t=p();l(2),w(" ",t.searchTerm?"Nessun cliente trovato":"Nessun cliente"," ")}}function Be(o,e){o&1&&(n(0,"span",22),s(1,"unfold_more"),r())}function Ke(o,e){o&1&&(n(0,"span",22),s(1,"hourglass_bottom"),r())}function qe(o,e){if(o&1){let t=x();n(0,"div",92)(1,"button",93),f("click",function(){u(t);let a=p();return g(a.caricaTutti())}),v(2,Be,2,0,"span",94)(3,Ke,2,0,"span",94),s(4),r()()}if(o&2){let t=p();l(),d("disabled",t.loading()),l(),d("ngIf",!t.loading()),l(),d("ngIf",t.loading()),l(),w(" ",t.loading()?"Caricamento\u2026":"Carica tutti"," ")}}function We(o,e){if(o&1&&(n(0,"div",95),s(1),r()),o&2){let t=p();l(),w(" ",t.error()," ")}}var ye=class o{listaService=b(fe);supabaseService=b(ne);soggettiService=b(me);kpiService=b(ge);authService=b(re);router=b(te);userService=b(oe);searchSubject=new A;destroy$=new A;rows=this.listaService.rows;filteredRows=this.listaService.filteredRows;loading=this.listaService.loading;error=this.listaService.error;hasMore=this.listaService.hasMore;currentFiltri=this.listaService.currentFiltri;userModuli=C([]);isUserAdmin=C(!1);_configuredIds=new Set;dropdownAnyOpen=C(!1);_configuredCount=C(-1);get configuredCount(){let e=this._configuredCount();if(e>=0)return e;try{let t=this.rows,i=typeof t=="function"?t():Array.isArray(t)?t:[];return Array.isArray(i)?i.filter(a=>!!a.configurato).length:0}catch{return 0}}get configuredCardCount(){try{let e=this.rows,t=typeof e=="function"?e():Array.isArray(e)?e:[];return Array.isArray(t)?t.filter(i=>i?.configurato===!0&&(i?.tipo==="cliente"||!i?.tipo)).length:0}catch{return 0}}kpiLoading=C(!1);province=C([]);kpi=C({totale:0,conIban:0,conReferente:0});_openProductPickerForId=null;deletingIds=new Set;showEsito=!1;selectedId=null;updatingProdottoIds=new Set;esitiTipi=_e;searchTerm="";filtroConIban=!1;filtroConReferente=!1;isLoading=C(!0);renderer=b(D);constructor(){this.searchSubject.pipe(R(this.destroy$),V(300),z()).subscribe(e=>{this.onSearchExecuted(e)})}ngOnInit(){return _(this,null,function*(){this.listaService.inizializza({tipo:"cliente",abilitaConfigurazioni:!0,abilitaTrattative:!0});try{yield Promise.all([this.listaService.caricaIniziali(),this.loadProvince(),this.refreshKpi(),this.loadUserData()]),yield this.loadConfiguredCount()}finally{setTimeout(()=>{this.isLoading.set(!1)},300)}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadUserData(){return _(this,null,function*(){try{let e=this.authService.user();if(!e)return;let t=yield this.soggettiService.supabaseService.isAdmin();this.isUserAdmin.set(t);let{data:i}=yield this.soggettiService.supabaseService.getAppUserById(e.id);i&&i.moduli&&this.userModuli.set(i.moduli)}catch(e){console.error("Errore nel caricamento dati utente:",e)}})}caricaTutti(){return _(this,null,function*(){yield this.listaService.caricaTutti()})}allLoaded(){return this.listaService.allLoaded()}onSearchExecuted(e){return _(this,null,function*(){yield this.listaService.cerca(e)})}onSearchChange(e){this.searchTerm=e,this.searchSubject.next(e)}onChangeFiltroEsito(e){this.listaService.applicaFiltri({esito:e,conIban:this.filtroConIban,conReferente:this.filtroConReferente})}onChangeFiltroProvincia(e){this.listaService.applicaFiltri({provincia:e})}onChangeSortDir(e){this.listaService.applicaFiltri({sortDir:e})}onFiltroTotale(){return _(this,null,function*(){this.filtroConIban=!1,this.filtroConReferente=!1,this.listaService.applicaFiltri({esito:"tutti",provincia:"tutte",conIban:!1,conReferente:!1}),yield this.listaService.caricaIniziali()})}onFiltroConIban(){this.filtroConIban=!0,this.filtroConReferente=!1,this.listaService.applicaFiltri({esito:"tutti",conIban:!0,conReferente:!1})}onFiltroConReferente(){this.filtroConIban=!1,this.filtroConReferente=!0,this.listaService.applicaFiltri({esito:"tutti",conIban:!1,conReferente:!0})}vediConfigurazionePromethea(e){this.router.navigate(["/alchemizzatore"],{queryParams:{prospectId:e.id,step:6},state:{prospect:e,goToStep:6,from:"lista-clienti"}})}vediTrattativaYuvi(e){return _(this,null,function*(){try{let{data:t,error:i}=yield this.soggettiService.supabaseService.supabase.from("trattative_yuvi").select("*").eq("prospect_id",e.id).order("created_at",{ascending:!1}).limit(1).single();if(i)throw i;if(!t){alert("Nessuna trattativa YUVI trovata per questo cliente");return}this.router.navigate(["/yuvi-trattativa"],{queryParams:{clienteId:e.id,trattativaId:t.id},state:{cliente:e,trattativaEsistente:t}})}catch(t){alert("Errore nel caricamento della trattativa: "+t.message)}})}onDelete(e){return _(this,null,function*(){if(!(!e?.id||!confirm(`Eliminare il cliente "${e.ragione_sociale}"?`))){this.deletingIds.add(e.id);try{(yield this.listaService.eliminaSoggetto(e.id))&&(yield this.refreshKpi())}catch(i){console.error("Errore durante l'eliminazione:",i)}finally{this.deletingIds.delete(e.id)}}})}onEdit(e){e?.id&&this.router.navigate(["/soggetto",e.id,"edit"])}openEsito(e){this.selectedId=e.id,this.showEsito=!0}apriScheda(e){e?.id&&this.router.navigate(["/soggetto",e.id])}onPopupClosed(e){return _(this,null,function*(){this.showEsito=!1,this.selectedId=null,e.saved&&(yield Promise.all([this.listaService.caricaTutti(),this.refreshKpi()]))})}onChangeProdotto(e,t){return _(this,null,function*(){if(!e?.id)return;let i=t;if(e.prodotto!==i){this.updatingProdottoIds.add(e.id);try{yield this.listaService.aggiornaProdotto(e.id,i)}catch(a){console.error("Errore durante l'aggiornamento del prodotto:",a)}finally{this.updatingProdottoIds.delete(e.id)}}})}showInformazioniTecniche(e){if(!e.moduliAttivi||e.moduliAttivi.length===0)return!1;if(this.isUserAdmin())return!0;let t=this.userModuli();return e.moduliAttivi.some(i=>t.includes(i))}getModuloDaAprire(e){let t=this.userModuli(),i=e.moduliAttivi||[];return this.isUserAdmin()?i[0]||"social":i.find(c=>t.includes(c))||"social"}goToInformazioniTecniche(e){if(!e.id){console.error("Cliente senza ID:",e);return}console.log("Navigando a informazioni tecniche per cliente:",e.id),this.router.navigate(["/informazioni-tecniche"],{queryParams:{clienteId:e.id}})}isAdmin(){return this.userService.isAdmin()}trackById=(e,t)=>t.id;loadProvince(){return _(this,null,function*(){let{data:e}=yield this.soggettiService.getProvinceByTipo("cliente");e&&this.province.set(e)})}refreshKpi(){return _(this,null,function*(){try{this.kpiLoading.set(!0);let e=yield this.kpiService.getAnagraficaKPI("cliente");this.kpi.set({totale:e.totale,conIban:e.conIban,conReferente:e.conReferente})}catch(e){console.error("Errore nel caricamento KPI:",e)}finally{this.kpiLoading.set(!1)}})}getLastEsito(e){return!Array.isArray(e)||e.length===0?null:e.reduce((t,i)=>{let a=new Date(i.ts).getTime(),c=new Date(t.ts).getTime();return a>c?i:t})}handleRowAction(e,t){switch(e){case"promethea":this.vediConfigurazionePromethea(t);break;case"yuvi":this.vediTrattativaYuvi(t);break;case"info-tecniche":this.goToInformazioniTecniche(t);break;case"edit":this.onEdit(t);break;case"esito":this.openEsito(t);break;case"delete":this.onDelete(t);break;default:console.warn("Azione non gestita",e)}}get filteredCount(){try{let e=this.filteredRows??this.rows;if(typeof e=="function"){let i=e();return Array.isArray(i)?i.length:0}if(Array.isArray(e))return e.length;let t=this.displayRows;if(typeof t=="function"){let i=t();return Array.isArray(i)?i.length:0}return 0}catch{return 0}}resetAllFilters(){return _(this,null,function*(){this.searchTerm="",this.filtroConIban=!1,this.filtroConReferente=!1,this.listaService.applicaFiltri({provincia:"tutte",searchTerm:"",esito:"tutti",sortDir:"desc",configurato:null,conIban:!1,conReferente:!1,prodotto:"tutti",categoria_ateco:"tutte"});try{yield this.listaService.caricaIniziali(),yield this.refreshKpi()}catch(e){console.error("Errore reset filtri:",e)}})}loadConfiguredCount(){return _(this,null,function*(){try{let e=new Set,[t,i]=yield Promise.all([this.supabaseService.supabase.from("configurazioni_promethea").select("cliente_id, prospect_id"),this.supabaseService.supabase.from("trattative_yuvi").select("cliente_id, prospect_id")]);!t.error&&Array.isArray(t.data)&&t.data.forEach(h=>{h?.cliente_id&&e.add(String(h.cliente_id).trim()),h?.prospect_id&&e.add(String(h.prospect_id).trim())}),!i.error&&Array.isArray(i.data)&&i.data.forEach(h=>{h?.cliente_id&&e.add(String(h.cliente_id).trim()),h?.prospect_id&&e.add(String(h.prospect_id).trim())});let a=Array.from(e).filter(Boolean);if(this._configuredIds=new Set(a),a.length===0){this._configuredCount.set(0);return}let c=(h,I=100)=>{let E=[];for(let T=0;T<h.length;T+=I)E.push(h.slice(T,T+I));return E},m=0,M=c(a,100);for(let h of M){let{data:I,error:E}=yield this.supabaseService.supabase.from("soggetti").select("id").in("id",h).eq("tipo","cliente");if(E){console.warn("Partial soggetti fetch error (configured count chunk):",E);continue}Array.isArray(I)&&(m+=I.length)}this._configuredCount.set(m);return}catch(e){console.error("Errore loadConfiguredCount clienti",e),this._configuredCount.set(0)}})}onFiltroConfigurati(){if(this.listaService&&typeof this.listaService.applicaFiltri=="function"){this.listaService.applicaFiltri({configurato:!0,configuredIds:Array.from(this._configuredIds)});return}this.filtri=F(L({},this.filtri||{}),{configurato:!0}),typeof this.refresh=="function"?this.refresh():typeof this.loadRows=="function"?this.loadRows():console.warn("Impossibile applicare filtro configurato: implementa listaService.applicaFiltri o refresh/loadRows")}getSelectedProducts(e){try{if(Array.isArray(e.prodotti)&&e.prodotti.length)return e.prodotti.map(t=>(t?.nome??t?.product_name??String(t)).toString());if(e.prodotto)return[String(e.prodotto)];if(e.prodotto_nome)return[String(e.prodotto_nome)];if(e.extra_data){if(typeof e.extra_data=="string")try{e.extra_data=JSON.parse(e.extra_data)}catch{}if(e.extra_data?.prodotti){let t=e.extra_data.prodotti;if(Array.isArray(t))return t.map(i=>String(i.nome??i));if(typeof t=="string")return[t]}}for(let t of Object.keys(e||{}))if(/prodotti?|product|prodotto_nome/i.test(t)&&e[t]){let i=e[t];return Array.isArray(i)?i.map(a=>String(a.nome??a)):[String(i)]}}catch(t){console.warn("getSelectedProducts fallback error",t)}return[]}getManualProducts(){return this.manualProducts||[]}isProductPickerOpen(e){return this._openProductPickerForId===e.id}openProductPicker(e){this._openProductPickerForId=e.id,(!this.manualProducts||!this.manualProducts.length)&&this.loadManualProducts?.()}closeProductPicker(){this._openProductPickerForId=null}onProductSelectChange(e,t){return _(this,null,function*(){let i=t.target,a=Array.from(i.selectedOptions).map(c=>c.value);yield this.updateRowProducts(e,a)})}removeSelectedProduct(e,t){return _(this,null,function*(){let a=this.getSelectedProducts(e).filter(c=>c!==t);yield this.updateRowProducts(e,a)})}updateRowProducts(e,t){return _(this,null,function*(){try{this.updatingProdottoIds.add(e.id);let i=Array.isArray(t)?t.join(", "):String(t||""),a=yield this.soggettiService.updateProdotto(e.id,i);if(a&&!a.error)e.prodotto=i,e.prodotti=(t||[]).map(c=>({nome:c}));else throw console.error("Errore aggiornamento prodotti:",a?.error||a),a?.error||new Error("Aggiornamento prodotti fallito")}catch(i){console.error("Errore aggiornamento prodotti",i),alert("Errore aggiornamento prodotti: "+(i?.message||String(i)))}finally{this.updatingProdottoIds.delete(e.id),this.closeProductPicker()}})}isProdottoAutomatico(e,t){if(!e)return!1;let i=String(e).trim().toLowerCase();return["promethea","yuvi"].includes(i)}onDropdownOpened(){this.dropdownAnyOpen.set(!0)}onDropdownClosed(){this.dropdownAnyOpen.set(!1)}getActionItemsForRow(e,t){return Array.isArray(t)?this.dropdownAnyOpen()?t.filter(i=>{let a=i&&i.key?String(i.key).toLowerCase():"",c=i&&i.label?String(i.label).toLowerCase():"";return a!=="aggiungi-prodotto"&&c!=="aggiungi prodotto"}):t:[]}confirmRemoveProduct(e,t){return _(this,null,function*(){let i=e?.ragione_sociale||e?.referente||"il soggetto";if(confirm(`Rimuovere il prodotto "${t}" da ${i}?`))try{let c=this.removeSelectedProduct(e,t);c&&typeof c.then=="function"&&(yield c)}catch(c){console.error("Errore rimozione prodotto",c),alert("Si \xE8 verificato un errore durante la rimozione del prodotto.")}})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=N({type:o,selectors:[["app-lista-clienti"]],decls:111,vars:33,consts:[["filtroSel",""],["ordinaSel",""],["provSel",""],["noEsito",""],["sel",""],["title","Caricamento Clienti","subtitle","Stiamo caricando i tuoi clienti...",3,"isLoading"],[1,"form-section"],[1,"section-header"],[1,"material-icons","header-icon"],[1,"section-titles"],[1,"section-title"],[1,"sottotitolo"],[1,"flex-1"],["class","icon-btn","title","Aggiungi cliente","aria-label","Aggiungi cliente",3,"routerLink",4,"ngIf"],[1,"prospect-cards"],[1,"card",3,"click"],[1,"card-title"],[1,"card-number"],[1,"table-section"],[1,"table-tools"],[1,"tool"],["for","search",1,"label"],[1,"material-icons"],["id","search","type","text","placeholder","Nome, telefono, email...",1,"table-inline-input",3,"ngModelChange","ngModel"],["for","filtroEsito",1,"label"],["id","filtroEsito",1,"table-inline-select",3,"change","value"],["value","tutti"],["value","senza-esito"],[3,"value",4,"ngFor","ngForOf"],["for","ordinaPer",1,"label"],["id","ordinaPer",1,"table-inline-select",3,"change","value"],["value","desc"],["value","asc"],["for","filtroProvincia",1,"label"],["id","filtroProvincia",1,"table-inline-select",3,"change","value"],["value","tutte"],["type","button",1,"promethea-button","ghost",3,"click"],[1,"tool",2,"display","flex","align-items","center","gap","var(--gutter-sm)","margin","var(--gutter-sm) 0"],["title","Risultati filtrati",1,"chip",2,"margin","0 var(--gutter-lg)"],[1,"table-container"],[1,"crm-table"],["class","row-clickable",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],["class","load-more-container",4,"ngIf"],["style","text-align:center; color:#ef4444; margin-top:1rem;",4,"ngIf"],[3,"closed","open","soggettoId","tipo"],["title","Aggiungi cliente","aria-label","Aggiungi cliente",1,"icon-btn",3,"routerLink"],[3,"value"],[1,"row-clickable"],["data-label","Ragione Sociale"],[1,"cell-content"],[1,"link",3,"click"],["data-label","Referente"],["data-label","Telefono"],["data-label","Localit\xE0"],["style","color: #6b7280; font-style: italic;",4,"ngIf"],["data-label","Prodotto"],["class","selected-badges",4,"ngIf"],["class","product-picker",4,"ngIf"],["data-label","Configurato"],["class","badge badge-success",4,"ngIf"],["class","badge badge-danger",4,"ngIf"],["data-label","Ultimo Esito"],[4,"ngIf","ngIfElse"],["data-label","Azioni"],[1,"actions-container"],["class","action-btn document","title","Configurazione Promethea",3,"click",4,"ngIf"],["class","action-btn email","title","Trattativa YUVI",3,"click",4,"ngIf"],["class","action-btn info-tecniche","title","Informazioni Tecniche",3,"click",4,"ngIf"],[3,"opened","closed","action","row","hideAddProduct","showPromethea","primaryIcons"],[2,"color","#6b7280","font-style","italic"],[1,"selected-badges"],["class","product-badge",3,"ngClass",4,"ngFor","ngForOf"],[1,"product-badge",3,"ngClass"],["class","badge-remove","type","button",3,"title","aria-label","click",4,"ngIf"],["type","button",1,"badge-remove",3,"click","title","aria-label"],["aria-hidden","true",1,"material-icons"],[1,"product-picker"],["multiple","",1,"table-inline-select",3,"change","value","disabled"],[2,"margin-top","0.5rem","display","flex","gap","0.5rem","align-items","center"],[1,"promethea-button","outline",3,"click"],["class","loading-indicator","style","margin-left:0.5rem;",4,"ngIf"],[1,"loading-indicator",2,"margin-left","0.5rem"],[1,"loading-spinner",2,"width","20px","height","20px","border-width","2px"],[1,"badge","badge-success"],[1,"badge","badge-danger"],["title","Configurazione Promethea",1,"action-btn","document",3,"click"],["src","assets/Logo.png","alt","Promethea",1,"icon-img"],["title","Trattativa YUVI",1,"action-btn","email",3,"click"],["src","assets/yuvi.png","alt","YUVI",1,"icon-img"],["title","Informazioni Tecniche",1,"action-btn","info-tecniche",3,"click"],["colspan","8",2,"text-align","center","padding","1.5rem"],[1,"load-more-container"],[1,"promethea-button",3,"click","disabled"],["class","material-icons",4,"ngIf"],[2,"text-align","center","color","#ef4444","margin-top","1rem"]],template:function(t,i){if(t&1){let a=x();P(0,"app-page-loader",5),n(1,"div")(2,"div",6)(3,"div",7)(4,"i",8),s(5,"business"),r(),n(6,"div",9)(7,"h2",10),s(8,"Clienti"),r(),n(9,"p",11),s(10,"Panoramica clienti e filtri rapidi"),r()(),P(11,"div",12),v(12,Se,3,2,"a",13),r(),n(13,"div",14)(14,"div",15),f("click",function(){return u(a),g(i.resetAllFilters())}),n(15,"h3",16),s(16,"Totale"),r(),n(17,"div",17),s(18),r()(),n(19,"div",15),f("click",function(){return u(a),g(i.onFiltroConIban())}),n(20,"h3",16),s(21,"Con IBAN"),r(),n(22,"div",17),s(23),r()(),n(24,"div",15),f("click",function(){return u(a),g(i.onFiltroConReferente())}),n(25,"h3",16),s(26,"Con Referente"),r(),n(27,"div",17),s(28),r()(),n(29,"div",15),f("click",function(){return u(a),g(i.onFiltroConfigurati())}),n(30,"h3",16),s(31,"Configurati"),r(),n(32,"div",17),s(33),r()()()(),n(34,"section",18)(35,"div",19)(36,"div",20)(37,"label",21)(38,"span",22),s(39,"search"),r(),s(40," Cerca "),r(),n(41,"input",23),q("ngModelChange",function(m){return u(a),K(i.searchTerm,m)||(i.searchTerm=m),g(m)}),f("ngModelChange",function(m){return u(a),g(i.onSearchChange(m))}),r()(),n(42,"div",20)(43,"label",24)(44,"span",22),s(45,"filter_list"),r(),s(46," Ultimo esito "),r(),n(47,"select",25,0),f("change",function(){u(a);let m=k(48);return g(i.onChangeFiltroEsito(m.value))}),n(49,"option",26),s(50,"Tutti"),r(),n(51,"option",27),s(52,"Senza esito"),r(),v(53,we,2,2,"option",28),r()(),n(54,"div",20)(55,"label",29)(56,"span",22),s(57,"sort"),r(),s(58," Ordina per: "),r(),n(59,"select",30,1),f("change",function(){u(a);let m=k(60);return g(i.onChangeSortDir(m.value))}),n(61,"option",31),s(62,"Pi\xF9 recente"),r(),n(63,"option",32),s(64,"Meno recente"),r()()(),n(65,"div",20)(66,"label",33)(67,"span",22),s(68,"place"),r(),s(69," Provincia "),r(),n(70,"select",34,2),f("change",function(){u(a);let m=k(71);return g(i.onChangeFiltroProvincia(m.value))}),n(72,"option",35),s(73,"Tutte"),r(),v(74,Pe,2,2,"option",28),r()(),n(75,"div",20)(76,"button",36),f("click",function(){return u(a),g(i.resetAllFilters())}),n(77,"span",22),s(78,"filter_alt_off"),r(),s(79," Azzera filtri "),r()(),n(80,"div",37)(81,"span",38),s(82," Risultati: "),n(83,"strong"),s(84),r()()()(),n(85,"div",39)(86,"table",40)(87,"thead")(88,"tr")(89,"th"),s(90,"Ragione Sociale"),r(),n(91,"th"),s(92,"Referente"),r(),n(93,"th"),s(94,"Telefono"),r(),n(95,"th"),s(96,"Localit\xE0"),r(),n(97,"th"),s(98,"Prodotto"),r(),n(99,"th"),s(100,"Configurato"),r(),n(101,"th"),s(102,"Ultimo Esito"),r(),n(103,"th"),s(104,"Azioni"),r()()(),n(105,"tbody"),v(106,Ye,35,24,"tr",41)(107,je,3,1,"tr",42),r()()(),v(108,qe,5,4,"div",43)(109,We,2,1,"div",44),r(),n(110,"app-esito-popup",45),f("closed",function(m){return u(a),g(i.onPopupClosed(m))}),r()()}t&2&&(d("isLoading",i.isLoading()),l(),S("hidden",i.isLoading()),l(11),d("ngIf",i.isAdmin()),l(2),S("card-active",i.currentFiltri().esito==="tutti"&&i.currentFiltri().provincia==="tutte"&&!i.currentFiltri().conIban&&!i.currentFiltri().conReferente),l(4),y(i.kpi().totale),l(),S("card-active",i.currentFiltri().conIban),l(4),y(i.kpi().conIban),l(),S("card-active",i.currentFiltri().conReferente),l(4),y(i.kpi().conReferente),l(),S("card-active",i.currentFiltri().configurato===!0),l(4),y(i.configuredCardCount),l(8),B("ngModel",i.searchTerm),l(6),d("value",i.currentFiltri().esito),l(6),d("ngForOf",i.esitiTipi),l(6),d("value",i.currentFiltri().sortDir),l(11),d("value",i.currentFiltri().provincia),l(4),d("ngForOf",i.province()),l(10),y(i.filteredCount),l(),S("dropdown-open",i.dropdownAnyOpen()),l(21),d("ngForOf",i.filteredRows())("ngForTrackBy",i.trackById),l(),d("ngIf",!i.loading()&&!i.error()&&i.filteredRows().length===0),l(),d("ngIf",!i.error()&&i.hasMore()),l(),d("ngIf",i.error()),l(),d("open",i.showEsito)("soggettoId",i.selectedId)("tipo","cliente"))},dependencies:[ee,Q,X,Z,ve,pe,ce,de,ae,se,le,ue,ie,he],styles:['.badge-remove[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;margin-left:6px;padding:0;border-radius:50%;border:none;background:transparent;color:var(--text-muted, #6b7280);cursor:pointer;line-height:1;vertical-align:middle;transition:background-color .12s ease,color .12s ease}.badge-remove[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:16px;line-height:1;pointer-events:none}.badge-remove[_ngcontent-%COMP%]:hover, .badge-remove[_ngcontent-%COMP%]:focus{background:#0b5cff14;color:var(--primary, #0b5cff);outline:none}.badge-remove[_ngcontent-%COMP%]:focus-visible{box-shadow:0 0 0 3px #0b5cff1f}.product-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px}.actions-dropdown[_ngcontent-%COMP%]{position:relative;display:inline-flex}.actions-dropdown[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;width:200px;z-index:1000;border:1px solid var(--smoke-color-1);border-radius:12px;box-shadow:0 8px 24px var(--shadow);background:var(--background);animation:_ngcontent-%COMP%_slideDown .2s ease-out}.actions-dropdown.open.centered[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{position:fixed!important;top:50%!important;left:50%!important;transform:translate(-50%,-50%)!important;width:min(90vw,420px)!important;max-height:80vh!important;overflow-y:auto!important;right:auto!important;z-index:1202!important;border-radius:16px!important;box-shadow:0 30px 80px #00000059!important}.actions-dropdown.open.centered[_ngcontent-%COMP%] ~ .mobile-dropdown-backdrop[_ngcontent-%COMP%], .actions-dropdown.open.centered[_ngcontent-%COMP%]   .mobile-dropdown-backdrop[_ngcontent-%COMP%]{display:block!important;z-index:1201!important}.actions-dropdown.open.centered[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]{padding:.5rem 0!important}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}.dropdown-item[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;gap:var(--gutter-sm);padding:.75rem 1rem;border:none;background:transparent;color:var(--text-color);cursor:pointer;transition:background .15s ease;font-size:var(--fs-sm);text-align:left;border-bottom:1px solid var(--smoke-color-1)}.dropdown-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.dropdown-item[_ngcontent-%COMP%]:hover{background:var(--smoke-color-2)}.dropdown-item[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.dropdown-item[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:1.1rem;width:20px}.dropdown-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:transparent;z-index:999;display:none}.actions-dropdown.open[_ngcontent-%COMP%] ~ .dropdown-overlay[_ngcontent-%COMP%]{display:block}@container (max-width: 768px){.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.actions-dropdown){display:none}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-dropdown[_ngcontent-%COMP%]   .dropdown-item[style*="display: none"][_ngcontent-%COMP%]{display:flex!important}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-dropdown.open[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{position:fixed!important;inset:50% auto auto 50%!important;transform:translate(-50%,-50%)!important;width:min(90vw,300px)!important;max-height:70vh!important;overflow-y:auto!important;z-index:1001!important;border-radius:16px!important;box-shadow:0 20px 40px var(--shadow)!important}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-dropdown[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{width:3rem!important;height:3rem!important;font-size:1.3rem!important}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]{justify-content:center!important;padding:var(--gutter-sm) 0}}@container (min-width: 769px){.actions-dropdown[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{min-width:180px}.actions-dropdown.left[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{right:auto;left:0}.actions-dropdown.top[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{top:auto;bottom:100%}}.table-container[_ngcontent-%COMP%]{overflow-x:auto;position:relative}body.dropdown-open[_ngcontent-%COMP%]{overflow:hidden}.mobile-dropdown-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:color-mix(in srgb,var(--text-color) 20%,transparent);-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px);z-index:998;display:none}.actions-dropdown.open[_ngcontent-%COMP%] ~ .mobile-dropdown-backdrop[_ngcontent-%COMP%]{display:block}']})};export{ye as ListaClienti};
