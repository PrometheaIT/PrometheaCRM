import{a as y}from"./chunk-AWKB45VE.js";import{b as S}from"./chunk-7VD3EVFT.js";import{j as h,k,n as b,p as C}from"./chunk-CSZ7WPY7.js";import{Aa as f,Ga as _,La as m,Xa as p,Ya as i,Za as e,_a as x,hb as l,jb as z,mb as t,nb as v,ob as c,ua as r,vb as g,xb as u}from"./chunk-QS6MTI54.js";import"./chunk-X5YLR3NI.js";import{i as d}from"./chunk-ODN5LVDJ.js";function I(a,o){a&1&&(i(0,"div",10),x(1,"span",11),t(2," Caricamento KPI... "),e())}function P(a,o){if(a&1&&(i(0,"div",12)(1,"div",13)(2,"div",14)(3,"i",15),t(4,"check_circle"),e()(),i(5,"div",16)(6,"div",17),t(7),e(),i(8,"p"),t(9,"Contratti Chiusi Totali"),e(),i(10,"div",18),t(11),g(12,"number"),e()()(),i(13,"div",13)(14,"div",19)(15,"i",15),t(16,"calendar_today"),e()(),i(17,"div",16)(18,"div",17),t(19),e(),i(20,"p"),t(21,"Chiusi Questo Mese"),e(),i(22,"div",18),t(23),g(24,"number"),e()()(),i(25,"div",13)(26,"div",20)(27,"i",15),t(28,"contacts"),e()(),i(29,"div",16)(30,"div",17),t(31),g(32,"number"),e(),i(33,"p"),t(34,"Nominativi Presi"),e(),i(35,"small"),t(36,"Quando si chiude contratto"),e()()(),i(37,"div",13)(38,"div",21)(39,"i",15),t(40,"schedule"),e()(),i(41,"div",16)(42,"div",17),t(43),g(44,"number"),e(),i(45,"p"),t(46,"Da Richiamare"),e()()(),i(47,"div",13)(48,"div",20)(49,"i",15),t(50,"group_add"),e()(),i(51,"div",16)(52,"div",17),t(53),e(),i(54,"p"),t(55,"Referenze da CTR"),e()()()()),a&2){let n=l();r(7),v(n.kpiData.contrattiChiusiTotali),r(4),c(" ",u(12,7,n.kpiData.percentualeChiusiTotali,"1.1-1"),"% "),r(8),v(n.kpiData.contrattiChiusiMeseCorrente),r(4),c(" ",u(24,10,n.kpiData.percentualeChiusiMese,"1.1-1"),"% "),r(8),c("",u(32,13,n.kpiData.percentualeNominativiPresi,"1.1-1"),"%"),r(12),c("",u(44,16,n.kpiData.percentualeDaRichiamare,"1.1-1"),"%"),r(10),v(n.kpiData.referenzeDaCtr)}}function M(a,o){if(a&1&&(i(0,"div",33)(1,"span",34),t(2),e(),i(3,"span",35),t(4),e()()),a&2){let n=o.$implicit,s=l(4);r(2),v(n),r(2),c("(",s.kpiData.dettagliSoftware[n],")")}}function E(a,o){if(a&1&&(i(0,"div",31),m(1,M,5,2,"div",32),e()),a&2){let n=l(3);r(),p("ngForOf",n.getSoftwareKeys())}}function D(a,o){if(a&1&&(i(0,"div",24)(1,"div",25)(2,"span",26),t(3),e(),i(4,"span",27),t(5),e()(),m(6,E,2,1,"div",28),i(7,"div",29),x(8,"div",30),e()()),a&2){let n=o.$implicit,s=l(2);r(3),c(" ",s.getTestoMotivazione(n)," "),r(2),c(" ",s.kpiData.motivazioniNonChiusi[n]," "),r(),p("ngIf",n==="usano_software_proprio"&&s.getSoftwareKeys().length>0),r(2),z("width",s.kpiData.motivazioniNonChiusi[n]/s.kpiData.totaleTrattative*100+"%")}}function O(a,o){if(a&1&&(i(0,"div",22)(1,"h3",5),t(2,"Motivazioni Non Chiusura"),e(),i(3,"div",12),m(4,D,9,5,"div",23),e()()),a&2){let n=l();r(4),p("ngForOf",n.getMotivazioniKeys())}}var w=class a{constructor(o,n){this.kpiService=o;this.supabaseService=n}kpiData=null;loading=!0;currentUserId=null;ngOnInit(){return d(this,null,function*(){yield this.getCurrentUser(),yield this.caricaKPI()})}getCurrentUser(){return d(this,null,function*(){try{let{data:{user:o}}=yield this.supabaseService.getUser();this.currentUserId=o?.id||null}catch(o){console.error("Errore nel recupero utente:",o)}})}caricaKPI(){return d(this,null,function*(){this.loading=!0;try{this.kpiData=yield this.kpiService.getKPIYuvi(this.currentUserId||void 0)}catch(o){console.error("Errore nel caricamento KPI:",o)}finally{this.loading=!1}})}getTestoMotivazione(o){return{prezzo_troppo_alto:"Prezzo troppo alto",usano_software_proprio:"Usano gi\xE0 un software e si trovano bene",non_hanno_bisogno:"Non ne hanno bisogno",non_si_fidano:"Non si fidano",da_richiamare:"Da richiamare",contratto_chiuso:"Contratto chiuso",non_chiuso:"Non chiuso"}[o]||o}getMotivazioniKeys(){return!this.kpiData||!this.kpiData.motivazioniNonChiusi?[]:Object.keys(this.kpiData.motivazioniNonChiusi)}getSoftwareKeys(){return!this.kpiData||!this.kpiData.dettagliSoftware?[]:Object.keys(this.kpiData.dettagliSoftware)}ricaricaKPI(){return d(this,null,function*(){yield this.caricaKPI()})}static \u0275fac=function(n){return new(n||a)(f(y),f(S))};static \u0275cmp=_({type:a,selectors:[["app-visualizzazione-kpi"]],decls:13,vars:3,consts:[[1,"kpi-container"],[1,"form-section"],[1,"section-header"],[1,"material-icons","header-icon"],[1,"section-titles"],[1,"section-title"],[1,"sottotitolo"],["class","status-message loading",4,"ngIf"],["class","grid-responsive",4,"ngIf"],["class","form-section","style","margin-top: var(--gutter-lg);",4,"ngIf"],[1,"status-message","loading"],[1,"loading-spinner"],[1,"grid-responsive"],[1,"card","kpi-card"],[1,"kpi-icon","success"],[1,"material-icons"],[1,"kpi-content"],[1,"card-number"],[1,"kpi-percentage"],[1,"kpi-icon","primary"],[1,"kpi-icon","info"],[1,"kpi-icon","warning"],[1,"form-section",2,"margin-top","var(--gutter-lg)"],["class","motivazione-item",4,"ngFor","ngForOf"],[1,"motivazione-item"],[1,"motivazione-header"],[1,"motivazione-text"],[1,"motivazione-count"],["class","software-details",4,"ngIf"],[1,"motivazione-bar"],[1,"motivazione-progress"],[1,"software-details"],["class","software-item",4,"ngFor","ngForOf"],[1,"software-item"],[1,"software-name"],[1,"software-count"]],template:function(n,s){n&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"i",3),t(4,"analytics"),e(),i(5,"div",4)(6,"h2",5),t(7,"KPI Trattative YUVI"),e(),i(8,"p",6),t(9,"Panoramica KPI e referenze da CTR"),e()()(),m(10,I,3,0,"div",7)(11,P,56,19,"div",8)(12,O,5,1,"div",9),e()()),n&2&&(r(10),p("ngIf",s.loading),r(),p("ngIf",s.kpiData&&!s.loading),r(),p("ngIf",s.kpiData&&!s.loading&&s.getMotivazioniKeys().length>0))},dependencies:[C,h,k,b],styles:[".kpi-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm)}.kpi-icon[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:12px;display:grid;place-items:center;font-size:1.5rem}.card-number[_ngcontent-%COMP%]{font-size:var(--fs-md)}.kpi-icon.success[_ngcontent-%COMP%]{background:color-mix(in srgb,#10b981 15%,transparent);color:#10b981}.kpi-icon.primary[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--primary) 15%,transparent);color:var(--primary)}.kpi-icon.info[_ngcontent-%COMP%]{background:color-mix(in srgb,#3b82f6 15%,transparent);color:#3b82f6}.kpi-icon.warning[_ngcontent-%COMP%]{background:color-mix(in srgb,#f59e0b 15%,transparent);color:#f59e0b}.kpi-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:color-mix(in srgb,var(--text-color) 70%,transparent);font-weight:500}.kpi-percentage[_ngcontent-%COMP%]{font-size:var(--fs-sm);font-weight:700;color:var(--primary);margin-top:4px}.motivazione-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:minmax(0,1fr) auto minmax(100px,30%);align-items:center;gap:var(--gutter-md);padding:var(--gutter-sm);border:1px solid var(--smoke-color-1);border-radius:12px;background:var(--background)}.motivazione-text[_ngcontent-%COMP%]{font-weight:500;min-width:0;overflow-wrap:anywhere}.motivazione-count[_ngcontent-%COMP%]{font-weight:700;color:var(--primary);text-align:right}.motivazione-bar[_ngcontent-%COMP%]{height:8px;background:var(--smoke-color-1);border-radius:4px;overflow:hidden}.motivazione-progress[_ngcontent-%COMP%]{height:100%;background:var(--primary);border-radius:4px;transition:width .3s ease}.software-details[_ngcontent-%COMP%]{margin-top:.5rem;padding-left:1rem;border-left:2px solid #e2e8f0}.software-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:.875rem;color:#64748b;margin-bottom:.25rem}.software-name[_ngcontent-%COMP%]{font-style:italic}.software-count[_ngcontent-%COMP%]{font-weight:600;color:#475569}.motivazione-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%}"]})};export{w as VisualizzazioneKpi};
