import{a as pt}from"./chunk-W2R7ISWJ.js";import{a as ct}from"./chunk-LK62RLCC.js";import{a as dt}from"./chunk-53N4BCWU.js";import{a as lt}from"./chunk-2QDHCWUP.js";import{b as et,d as it,f as nt,o as ot,p as at,u as rt}from"./chunk-SRZMZVDW.js";import{a as st}from"./chunk-3WLDIF5C.js";import"./chunk-P5EFXTG7.js";import{a as tt}from"./chunk-WMLYL4YD.js";import{c as Z}from"./chunk-Q4FMGKSF.js";import{d as q,e as G,j as J,o as Q,p as X}from"./chunk-NOCF4HQD.js";import{A as F,Ab as M,Ga as N,I as A,La as f,S,Va as Y,Wa as p,X as g,Xa as n,Y as u,Ya as o,Za as P,bb as U,cb as K,db as x,ea as y,f as L,gb as _,hb as m,ib as w,kb as b,mb as s,nb as h,ob as E,qb as B,rb as j,sa as R,sb as W,ua as l,ub as H,x as z,za as $}from"./chunk-PE6PP35I.js";import"./chunk-X5YLR3NI.js";import{a as D,i as v}from"./chunk-ODN5LVDJ.js";var ut=()=>["/soggetti/nuovo","prospect"];function _t(a,t){if(a&1&&(n(0,"span"),s(1),o()),a&2){let e=m();l(),h(e.totalProspectCount())}}function ft(a,t){if(a&1&&(n(0,"span"),s(1),o()),a&2){let e=m();l(),h(e.kpi().senzaContatto)}}function vt(a,t){if(a&1&&(n(0,"span"),s(1),o()),a&2){let e=m();l(),h(e.kpi().daRichiamare)}}function ht(a,t){if(a&1&&(n(0,"span"),s(1),o()),a&2){let e=m();l(),h(e.kpi().configurati)}}function xt(a,t){a&1&&P(0,"span",45)}function Pt(a,t){if(a&1&&(n(0,"option",46),s(1),o()),a&2){let e=t.$implicit;p("value",e),l(),h(e)}}function St(a,t){if(a&1&&(n(0,"option",46),s(1),o()),a&2){let e=t.$implicit;p("value",e),l(),h(e)}}function wt(a,t){if(a&1&&(n(0,"span"),s(1),o()),a&2){let e=m().$implicit;l(),h(e.comune)}}function bt(a,t){if(a&1&&(n(0,"span"),s(1),o()),a&2){let e=m().$implicit;l(),E(" (",e.provincia,")")}}function Ct(a,t){a&1&&(n(0,"span",70),s(1," Nessun indirizzo "),o())}function yt(a,t){a&1&&(n(0,"span",71),s(1,"S\xEC"),o())}function Et(a,t){a&1&&(n(0,"span",72),s(1,"No"),o())}function It(a,t){if(a&1&&(n(0,"div",76),s(1),o()),a&2){let e=m().ngIf,i=m(2);l(),E(" ",i.formatEsitoDate(e)," ")}}function kt(a,t){if(a&1&&(U(0),n(1,"div",73)(2,"div",74),s(3),o(),f(4,It,2,1,"div",75),o(),K()),a&2){let e=t.ngIf;l(3),h(e.tipo),l(),p("ngIf",e.tipo==="Richiamare"||e.tipo==="Appuntamento")}}function Tt(a,t){a&1&&s(0,"\u2014")}function Lt(a,t){if(a&1){let e=x();n(0,"button",77),_("click",function(r){g(e);let c=m().$implicit,d=m();return r.stopPropagation(),u(d.vediConfigurazionePromethea(c))}),P(1,"img",78),o()}}function Mt(a,t){if(a&1){let e=x();n(0,"button",79),_("click",function(r){g(e);let c=m().$implicit,d=m();return r.stopPropagation(),u(d.vediTrattativaYuvi(c))}),P(1,"img",80),o()}}function Ot(a,t){if(a&1){let e=x();n(0,"button",86),_("click",function(r){g(e);let c=m(2).$implicit,d=m();return r.stopPropagation(),d.vediConfigurazionePromethea(c),u(d.closeAllDropdowns())}),P(1,"img",87),n(2,"span"),s(3,"Configura Promethea"),o()()}}function Vt(a,t){if(a&1){let e=x();n(0,"button",86),_("click",function(r){g(e);let c=m(2).$implicit,d=m();return r.stopPropagation(),d.vediTrattativaYuvi(c),u(d.closeAllDropdowns())}),P(1,"img",88),n(2,"span"),s(3,"Trattativa YUVI"),o()()}}function Dt(a,t){if(a&1){let e=x();n(0,"div",81)(1,"div",82),f(2,Ot,4,0,"button",83)(3,Vt,4,0,"button",83),n(4,"button",84),_("click",function(r){g(e);let c=m().$implicit,d=m();return r.stopPropagation(),d.onEdit(c),u(d.closeAllDropdowns())}),n(5,"span",15),s(6,"edit"),o(),n(7,"span"),s(8,"Modifica"),o()(),n(9,"button",84),_("click",function(r){g(e);let c=m().$implicit,d=m();return r.stopPropagation(),d.openEsito(c),u(d.closeAllDropdowns())}),n(10,"span",15),s(11,"add"),o(),n(12,"span"),s(13,"Aggiungi esito"),o()(),n(14,"button",85),_("click",function(r){g(e);let c=m().$implicit,d=m();return r.stopPropagation(),d.onDelete(c),u(d.closeAllDropdowns())}),n(15,"span",15),s(16,"delete"),o(),n(17,"span"),s(18,"Elimina"),o()()()()}if(a&2){let e=m().$implicit,i=m();l(2),p("ngIf",e.hasConfigPromethea),l(),p("ngIf",e.hasTrattativaYuvi),l(11),p("disabled",i.deletingIds.has(e.id))}}function zt(a,t){if(a&1){let e=x();n(0,"div",89),_("click",function(){g(e);let r=m(2);return u(r.closeAllDropdowns())}),o()}}function Ft(a,t){if(a&1){let e=x();n(0,"tr",47),_("click",function(){let r=g(e).$implicit,c=m();return u(c.apriScheda(r))}),n(1,"td",48)(2,"div",49)(3,"strong"),s(4),o()()(),n(5,"td",50)(6,"div",49),s(7),o()(),n(8,"td",51)(9,"div",49),s(10),o()(),n(11,"td",52)(12,"div",49),f(13,wt,2,1,"span",41)(14,bt,2,1,"span",41)(15,Ct,2,0,"span",53),o()(),n(16,"td",54)(17,"div",49),f(18,yt,2,0,"span",55)(19,Et,2,0,"span",56),o()(),n(20,"td",57)(21,"div",49),f(22,kt,5,2,"ng-container",20)(23,Tt,1,0,"ng-template",null,4,M),o()(),n(25,"td",58)(26,"div",49)(27,"select",59,5),_("change",function(){let r=g(e).$implicit,c=w(28),d=m();return u(d.onChangeProdotto(r,c.value))}),n(29,"option",60),s(30,"Promethea"),o(),n(31,"option",61),s(32,"YUVI"),o()()()(),n(33,"td",62)(34,"div",63),f(35,Lt,2,0,"button",64)(36,Mt,2,0,"button",65),n(37,"div",66)(38,"button",67),_("click",function(r){let c=g(e).$implicit,d=m();return r.stopPropagation(),u(d.toggleActionsDropdown(c.id,r))}),n(39,"span",15),s(40,"more_vert"),o()(),f(41,Dt,19,3,"div",68)(42,zt,1,0,"div",69),o()()()()}if(a&2){let e=t.$implicit,i=w(24),r=m();Y("data-row-id",e.id),l(4),h(e.ragione_sociale),l(3),h(e.referente||"\u2014"),l(3),h(e.telefono||"\u2014"),l(3),p("ngIf",e.comune),l(),p("ngIf",e.provincia),l(),p("ngIf",!e.comune&&!e.provincia),l(3),p("ngIf",e.configurato),l(),p("ngIf",!e.configurato),l(3),p("ngIf",e.ultimoEsito)("ngIfElse",i),l(5),p("value",e.prodotto)("disabled",r.updatingProdottoIds.has(e.id)),l(8),p("ngIf",e.hasConfigPromethea),l(),p("ngIf",e.hasTrattativaYuvi),l(),b("open",r.activeDropdownId===e.id),l(4),p("ngIf",r.activeDropdownId===e.id),l(),p("ngIf",r.activeDropdownId===e.id)}}function At(a,t){if(a&1&&(n(0,"tr")(1,"td",90),s(2),o()()),a&2){let e=m();l(2),E(" ",e.searchTerm?"Nessun prospect trovato":"Nessun prospect"," ")}}function Rt(a,t){a&1&&(n(0,"span",15),s(1,"unfold_more"),o())}function $t(a,t){a&1&&(n(0,"span",15),s(1,"hourglass_bottom"),o())}function Nt(a,t){if(a&1){let e=x();n(0,"div",91)(1,"button",92),_("click",function(){g(e);let r=m();return u(r.caricaTutti())}),f(2,Rt,2,0,"span",93)(3,$t,2,0,"span",93),s(4),o()()}if(a&2){let e=m();l(),p("disabled",e.loading()),l(),p("ngIf",!e.loading()),l(),p("ngIf",e.loading()),l(),E(" ",e.loading()?"Caricamento\u2026":"Carica tutti"," ")}}function Yt(a,t){if(a&1&&(n(0,"div",94),s(1),o()),a&2){let e=m();l(),E(" ",e.error()," ")}}var mt=class a{listaService=S(ct);soggettiService=S(st);authService=S(Z);userService=S(tt);router=S(Q);renderer=S($);searchSubject=new L;destroy$=new L;rows=this.listaService.rows;filteredRows=this.listaService.filteredRows;loading=this.listaService.loading;error=this.listaService.error;hasMore=this.listaService.hasMore;currentFiltri=this.listaService.currentFiltri;province=y([]);kpiLoading=y(!1);kpi=y({senzaContatto:0,daRichiamare:0,configurati:0});totalProspectCount=y(0);deletingIds=new Set;showEsito=!1;selectedId=null;updatingProdottoIds=new Set;activeDropdownId=null;clickListener;esitiTipi=dt;searchTerm="";filtroConfigurato=null;isLoading=y(!0);constructor(){this.searchSubject.pipe(A(this.destroy$),z(300),F()).subscribe(t=>{this.onSearchExecuted(t)})}ngOnInit(){return v(this,null,function*(){console.log("\u{1F680} Lista Prospect - START"),this.isLoading.set(!0),yield this.authService.getAuthState();let t=this.authService.user();if(console.log("\u{1F464} User after auth:",{id:t?.id,email:t?.email}),!t){console.error("\u274C Nessun utente autenticato!"),this.isLoading.set(!1);return}let e=this.userService.isAdmin();console.log("\u{1F511} Admin status:",e),this.listaService.inizializza({tipo:"prospect",abilitaConfigurazioni:!0,abilitaTrattative:!0}),console.log("\u2699\uFE0F Servizio inizializzato");try{console.log("\u{1F4CA} Inizio caricamento dati..."),yield this.listaService.caricaIniziali();let i=this.rows(),r=this.filteredRows();console.log("\u{1F4C4} Dati caricati:",{totalRows:i.length,filteredRows:r.length,firstRow:i[0]?.ragione_sociale||"N/A"}),yield Promise.all([this.loadProvince(),this.loadTotalKPI()]),console.log("\u2705 Init completato")}catch(i){console.error("\u274C Errore durante init:",i),this.refreshLocalKPI()}finally{setTimeout(()=>{this.isLoading.set(!1)},300)}})}refreshData(){return v(this,null,function*(){try{yield this.listaService.caricaTutti(),yield this.loadTotalKPI()}catch(t){console.error("\u274C Errore refresh data:",t),this.refreshLocalKPI()}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.closeAllDropdowns()}loadMore(t=!1){return v(this,null,function*(){yield this.listaService.caricaTutti()})}allLoaded(){return this.listaService.allLoaded()}caricaTutti(){return v(this,null,function*(){yield this.listaService.caricaTutti()})}onSearchExecuted(t){return v(this,null,function*(){yield this.listaService.cerca(t)})}onSearchChange(t){this.searchTerm=t,this.searchSubject.next(t)}onChangeFiltroEsito(t){this.listaService.applicaFiltri({esito:t,configurato:null}),this.filtroConfigurato=null}onChangeFiltroProvincia(t){this.listaService.applicaFiltri({provincia:t})}onChangeSortDir(t){this.listaService.applicaFiltri({sortDir:t})}onFiltroTotale(){this.listaService.applicaFiltri({esito:"tutti",provincia:"tutte",configurato:null}),this.filtroConfigurato=null}onFiltroSenzaContatto(){this.listaService.applicaFiltri({esito:"senza-esito",configurato:null}),this.filtroConfigurato=null}onFiltroDaRichiamare(){this.listaService.applicaFiltri({esito:"Richiamare",configurato:null}),this.filtroConfigurato=null}onFiltroConfigurati(){this.listaService.applicaFiltri({esito:"tutti",configurato:!0}),this.filtroConfigurato=!0}vediConfigurazionePromethea(t){this.router.navigate(["/alchemizzatore"],{queryParams:{prospectId:t.id,step:6}})}vediTrattativaYuvi(t){return v(this,null,function*(){try{let{data:e,error:i}=yield this.soggettiService.supabaseService.supabase.from("trattative_yuvi").select("*").eq("prospect_id",t.id).order("created_at",{ascending:!1}).limit(1).single();if(i)throw i;if(!e){alert("Nessuna trattativa YUVI trovata per questo prospect");return}this.router.navigate(["/yuvi-trattativa"],{queryParams:{prospectId:t.id,trattativaId:e.id,step:7},state:{prospect:t,trattativaEsistente:e,from:"lista-prospect"}})}catch(e){alert("Errore nel caricamento della trattativa: "+e.message)}})}onDelete(t){return v(this,null,function*(){if(!(!t?.id||!confirm(`Eliminare il prospect "${t.ragione_sociale}"?`))){this.deletingIds.add(t.id);try{(yield this.listaService.eliminaSoggetto(t.id))&&(yield this.loadTotalKPI())}catch(i){console.error("Errore durante l'eliminazione:",i)}finally{this.deletingIds.delete(t.id)}}})}onEdit(t){t?.id&&this.router.navigate(["/soggetti/modifica",t.id])}openEsito(t){this.selectedId=t.id,this.showEsito=!0}onPopupClosed(t){return v(this,null,function*(){this.showEsito=!1,this.selectedId=null,t.saved&&(yield Promise.all([this.listaService.caricaTutti(),this.loadTotalKPI()]))})}onChangeProdotto(t,e){return v(this,null,function*(){if(!t?.id)return;let i=e;if(t.prodotto!==i){this.updatingProdottoIds.add(t.id);try{yield this.listaService.aggiornaProdotto(t.id,i)}catch(r){console.error("Errore durante l'aggiornamento del prodotto:",r)}finally{this.updatingProdottoIds.delete(t.id)}}})}trackById=(t,e)=>e.id;toggleActionsDropdown(t,e){e&&e.stopPropagation();let i=this.activeDropdownId===t;this.activeDropdownId=i?null:t,this.activeDropdownId?(this.clickListener=this.renderer.listen("document","click",r=>{r.target.closest(".actions-dropdown")||this.closeAllDropdowns()}),document.body.classList.add("dropdown-open")):this.closeAllDropdowns()}closeAllDropdowns(){this.activeDropdownId=null,document.body.classList.remove("dropdown-open"),this.clickListener&&(this.clickListener(),this.clickListener=void 0)}onWindowScroll(){this.activeDropdownId&&this.closeAllDropdowns()}loadProvince(){return v(this,null,function*(){let{data:t}=yield this.soggettiService.getProvinceByTipo("prospect");t&&this.province.set(t)})}loadTotalKPI(){return v(this,null,function*(){this.kpiLoading.set(!0);try{let e=(yield this.soggettiService.countByTipo("prospect")).data||0;if(this.totalProspectCount.set(e),e===0){this.kpi.set({senzaContatto:0,daRichiamare:0,configurati:0});return}let{data:i,error:r}=yield this.soggettiService.getSoggettiByTipo("prospect",0,Math.max(e,1e3));if(r)throw console.warn("\u26A0\uFE0F Errore caricamento prospect per KPI:",r),r;if(!i||i.length===0){this.kpi.set({senzaContatto:0,daRichiamare:0,configurati:0});return}let c=i.map(C=>C.id).filter(C=>!!C);if(c.length===0){this.kpi.set({senzaContatto:0,daRichiamare:0,configurati:0});return}let[d,O]=yield Promise.all([this.soggettiService.getConfigurazioniPrometheaByCliente(c),this.soggettiService.getTrattativeYuviByProspect(c)]),I=0,k=0,T=0;i.forEach(C=>{let V=this.getLastEsito(C.esiti),gt=d.get(C.id)||!1;V||I++,V?.tipo==="Richiamare"&&k++,gt&&T++}),this.kpi.set({senzaContatto:I,daRichiamare:k,configurati:T}),console.log("\u2705 KPI calcolati:",{total:e,senzaContatto:I,daRichiamare:k,configurati:T,prospectProcessati:i.length})}catch(t){console.error("\u274C Errore nel caricamento KPI totali:",t),this.refreshLocalKPI()}finally{this.kpiLoading.set(!1)}})}refreshLocalKPI(){console.log("\u{1F504} Usando KPI locali come fallback...");let t=this.rows();if(t.length===0){let i=this.kpi();i.senzaContatto===0&&i.daRichiamare===0&&i.configurati===0&&(this.totalProspectCount.set(0),this.kpi.set({senzaContatto:0,daRichiamare:0,configurati:0}));return}let e={senzaContatto:t.filter(i=>!i.ultimoEsito).length,daRichiamare:t.filter(i=>i.ultimoEsito?.tipo==="Richiamare").length,configurati:t.filter(i=>i.configurato).length};this.totalProspectCount.set(t.length),this.kpi.set(e),console.log("\u{1F4CA} KPI locali:",D({totalLocal:t.length},e))}getLastEsito(t){return!Array.isArray(t)||t.length===0?null:t.reduce((e,i)=>{let r=new Date(i.ts).getTime(),c=new Date(e.ts).getTime();return r>c?i:e})}formatEsitoDate(t){if(!t)return"";let e=t.tipo==="Appuntamento"||t.tipo==="Fissato appuntamento";if(t.tipo==="Richiamare"&&t.scheduleAt){let i=new Date(t.scheduleAt),r=i.getDate().toString().padStart(2,"0"),c=(i.getMonth()+1).toString().padStart(2,"0"),d=i.getFullYear(),O=i.getHours().toString().padStart(2,"0"),I=i.getMinutes().toString().padStart(2,"0");return`${r}/${c}/${d} alle ${O}:${I}`}if(e&&t.dataAppuntamento){let i=t.oraAppuntamento?` alle ${t.oraAppuntamento}`:"";return`${this.formatDateString(t.dataAppuntamento)}${i}`}return""}pad(t){return t.toString().padStart(2,"0")}formatDateString(t){if(!t&&t!==0)return"";if(t instanceof Date)return`${this.pad(t.getDate())}/${this.pad(t.getMonth()+1)}/${t.getFullYear()}`;let e=String(t).trim(),i=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(i)return`${i[3]}/${i[2]}/${i[1]}`;let r=Date.parse(e);if(!isNaN(r)){let c=new Date(r);return`${this.pad(c.getDate())}/${this.pad(c.getMonth()+1)}/${c.getFullYear()}`}return e}apriScheda(t){t?.id&&this.router.navigate(["/soggetti",t.tipo??"cliente",t.id])}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=N({type:a,selectors:[["app-lista-prospect"]],hostBindings:function(e,i){e&1&&_("scroll",function(){return i.onWindowScroll()},R)},decls:105,vars:35,consts:[["loadingSpinner",""],["filtroSel",""],["ordinaSel",""],["provSel",""],["noEsito",""],["sel",""],["title","Caricamento Prospect","subtitle","Stiamo caricando i tuoi prospect...",3,"isLoading"],[1,"form-section"],[1,"section-header"],[1,"material-icons","header-icon"],[1,"section-titles"],[1,"section-title"],[1,"sottotitolo"],[1,"flex-1"],["title","Aggiungi prospect","aria-label","Aggiungi prospect",1,"icon-btn",3,"routerLink"],[1,"material-icons"],[1,"prospect-cards"],[1,"card",3,"click"],[1,"card-title"],[1,"card-number"],[4,"ngIf","ngIfElse"],[1,"table-section"],[1,"table-tools"],[1,"tool"],["for","search",1,"label"],["id","search","type","text","placeholder","Nome, telefono, email...",1,"table-inline-input",3,"ngModelChange","ngModel"],["for","filtroEsito",1,"label"],["id","filtroEsito",1,"table-inline-select",3,"change","value"],["value","tutti"],["value","senza-esito"],[3,"value",4,"ngFor","ngForOf"],["for","ordinaPer",1,"label"],["id","ordinaPer",1,"table-inline-select",3,"change","value"],["value","desc"],["value","asc"],["for","filtroProvincia",1,"label"],["id","filtroProvincia",1,"table-inline-select",3,"change","value"],["value","tutte"],[1,"table-container"],[1,"crm-table"],["class","row-clickable",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],["class","load-more-container",4,"ngIf"],["style","text-align:center; color:#ef4444; margin-top:1rem;",4,"ngIf"],[3,"closed","open","soggettoId","tipo"],[1,"loading-spinner"],[3,"value"],[1,"row-clickable",3,"click"],["data-label","Ragione Sociale"],[1,"cell-content"],["data-label","Referente"],["data-label","Telefono"],["data-label","Localit\xE0"],["style","color: #6b7280; font-style: italic;",4,"ngIf"],["data-label","Configurato"],["class","badge badge-success",4,"ngIf"],["class","badge badge-danger",4,"ngIf"],["data-label","Ultimo Esito"],["data-label","Prodotto"],[1,"table-inline-select",3,"change","value","disabled"],["value","Promethea"],["value","YUVI"],["data-label","Azioni"],[1,"actions-container"],["class","action-btn document","title","Configurazione Promethea",3,"click",4,"ngIf"],["class","action-btn email","title","Trattativa YUVI",3,"click",4,"ngIf"],[1,"actions-dropdown"],["title","Altre azioni",1,"action-btn",3,"click"],["class","modal",4,"ngIf"],["class","mobile-dropdown-backdrop",3,"click",4,"ngIf"],[2,"color","#6b7280","font-style","italic"],[1,"badge","badge-success"],[1,"badge","badge-danger"],[1,"esito-container"],[1,"esito-tipo"],["class","esito-details text-muted",4,"ngIf"],[1,"esito-details","text-muted"],["title","Configurazione Promethea",1,"action-btn","document",3,"click"],["src","assets/Logo.png","alt","Promethea",1,"icon-img"],["title","Trattativa YUVI",1,"action-btn","email",3,"click"],["src","assets/yuvi.png","alt","YUVI",1,"icon-img"],[1,"modal"],[1,"modal-body",2,"padding","0"],["class","dropdown-item mobile-only",3,"click",4,"ngIf"],[1,"dropdown-item",3,"click"],[1,"dropdown-item",3,"click","disabled"],[1,"dropdown-item","mobile-only",3,"click"],["src","assets/Logo.png","alt","Promethea",1,"icon-img",2,"width","16px","height","16px"],["src","assets/yuvi.png","alt","YUVI",1,"icon-img",2,"width","16px","height","16px"],[1,"mobile-dropdown-backdrop",3,"click"],["colspan","8",2,"text-align","center","padding","1.5rem"],[1,"load-more-container"],[1,"promethea-button",3,"click","disabled"],["class","material-icons",4,"ngIf"],[2,"text-align","center","color","#ef4444","margin-top","1rem"]],template:function(e,i){if(e&1){let r=x();P(0,"app-page-loader",6),n(1,"div")(2,"div",7)(3,"div",8)(4,"i",9),s(5,"group"),o(),n(6,"div",10)(7,"h2",11),s(8,"Prospect"),o(),n(9,"p",12),s(10,"Panoramica prospect e filtri rapidi"),o()(),P(11,"div",13),n(12,"a",14)(13,"span",15),s(14,"add_circle"),o()()(),n(15,"div",16)(16,"div",17),_("click",function(){return g(r),u(i.onFiltroTotale())}),n(17,"h3",18),s(18,"Totale"),o(),n(19,"div",19),f(20,_t,2,1,"span",20),o()(),n(21,"div",17),_("click",function(){return g(r),u(i.onFiltroSenzaContatto())}),n(22,"h3",18),s(23,"Senza Contatto"),o(),n(24,"div",19),f(25,ft,2,1,"span",20),o()(),n(26,"div",17),_("click",function(){return g(r),u(i.onFiltroDaRichiamare())}),n(27,"h3",18),s(28,"Da Richiamare"),o(),n(29,"div",19),f(30,vt,2,1,"span",20),o()(),n(31,"div",17),_("click",function(){return g(r),u(i.onFiltroConfigurati())}),n(32,"h3",18),s(33,"Configurati"),o(),n(34,"div",19),f(35,ht,2,1,"span",20),o()(),f(36,xt,1,0,"ng-template",null,0,M),o()(),n(38,"section",21)(39,"div",22)(40,"div",23)(41,"label",24)(42,"span",15),s(43,"search"),o(),s(44," Cerca "),o(),n(45,"input",25),W("ngModelChange",function(d){return g(r),j(i.searchTerm,d)||(i.searchTerm=d),u(d)}),_("ngModelChange",function(d){return g(r),u(i.onSearchChange(d))}),o()(),n(46,"div",23)(47,"label",26)(48,"span",15),s(49,"filter_list"),o(),s(50," Ultimo esito "),o(),n(51,"select",27,1),_("change",function(){g(r);let d=w(52);return u(i.onChangeFiltroEsito(d.value))}),n(53,"option",28),s(54,"Tutti"),o(),n(55,"option",29),s(56,"Senza esito"),o(),f(57,Pt,2,2,"option",30),o()(),n(58,"div",23)(59,"label",31)(60,"span",15),s(61,"sort"),o(),s(62," Ordina per: "),o(),n(63,"select",32,2),_("change",function(){g(r);let d=w(64);return u(i.onChangeSortDir(d.value))}),n(65,"option",33),s(66,"Pi\xF9 recente"),o(),n(67,"option",34),s(68,"Meno recente"),o()()(),n(69,"div",23)(70,"label",35)(71,"span",15),s(72,"place"),o(),s(73," Provincia "),o(),n(74,"select",36,3),_("change",function(){g(r);let d=w(75);return u(i.onChangeFiltroProvincia(d.value))}),n(76,"option",37),s(77,"Tutte"),o(),f(78,St,2,2,"option",30),o()()(),n(79,"div",38)(80,"table",39)(81,"thead")(82,"tr")(83,"th"),s(84,"Ragione Sociale"),o(),n(85,"th"),s(86,"Referente"),o(),n(87,"th"),s(88,"Telefono"),o(),n(89,"th"),s(90,"Localit\xE0"),o(),n(91,"th"),s(92,"Configurato"),o(),n(93,"th"),s(94,"Ultimo Esito"),o(),n(95,"th"),s(96,"Prodotto"),o(),n(97,"th"),s(98,"Azioni"),o()()(),n(99,"tbody"),f(100,Ft,43,19,"tr",40)(101,At,3,1,"tr",41),o()()(),f(102,Nt,5,4,"div",42)(103,Yt,2,1,"div",43),o(),n(104,"app-esito-popup",44),_("closed",function(d){return g(r),u(i.onPopupClosed(d))}),o()()}if(e&2){let r=w(37);p("isLoading",i.isLoading()),l(),b("hidden",i.isLoading()),l(11),p("routerLink",H(34,ut)),l(4),b("card-active",i.currentFiltri().esito==="tutti"&&i.filtroConfigurato===null),l(4),p("ngIf",!i.kpiLoading())("ngIfElse",r),l(),b("card-active",i.currentFiltri().esito==="senza-esito"),l(4),p("ngIf",!i.kpiLoading())("ngIfElse",r),l(),b("card-active",i.currentFiltri().esito==="Richiamare"),l(4),p("ngIf",!i.kpiLoading())("ngIfElse",r),l(),b("card-active",i.filtroConfigurato===!0),l(4),p("ngIf",!i.kpiLoading())("ngIfElse",r),l(10),B("ngModel",i.searchTerm),l(6),p("value",i.currentFiltri().esito),l(6),p("ngForOf",i.esitiTipi),l(6),p("value",i.currentFiltri().sortDir),l(11),p("value",i.currentFiltri().provincia),l(4),p("ngForOf",i.province()),l(22),p("ngForOf",i.filteredRows())("ngForTrackBy",i.trackById),l(),p("ngIf",!i.loading()&&!i.error()&&i.filteredRows().length===0),l(),p("ngIf",!i.error()&&i.hasMore()),l(),p("ngIf",i.error()),l(),p("open",i.showEsito)("soggettoId",i.selectedId)("tipo","prospect")}},dependencies:[J,q,G,pt,rt,ot,at,et,it,nt,X,lt],styles:['.actions-dropdown[_ngcontent-%COMP%]{position:relative;display:inline-flex}.actions-dropdown[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;width:200px;z-index:1000;border:1px solid var(--smoke-color-1);border-radius:12px;box-shadow:0 8px 24px var(--shadow);background:var(--background);animation:_ngcontent-%COMP%_slideDown .2s ease-out}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}.dropdown-item[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;gap:var(--gutter-sm);padding:.75rem 1rem;border:none;background:transparent;color:var(--text-color);cursor:pointer;transition:background .15s ease;font-size:var(--fs-sm);text-align:left;border-bottom:1px solid var(--smoke-color-1)}.dropdown-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.dropdown-item[_ngcontent-%COMP%]:hover{background:var(--smoke-color-2)}.dropdown-item[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.dropdown-item[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:1.1rem;width:20px}.dropdown-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:transparent;z-index:999;display:none}.actions-dropdown.open[_ngcontent-%COMP%] ~ .dropdown-overlay[_ngcontent-%COMP%]{display:block}@container (max-width: 768px){.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.actions-dropdown){display:none}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-dropdown[_ngcontent-%COMP%]   .dropdown-item[style*="display: none"][_ngcontent-%COMP%]{display:flex!important}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-dropdown.open[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{position:fixed!important;inset:50% auto auto 50%!important;transform:translate(-50%,-50%)!important;width:min(90vw,300px)!important;max-height:70vh!important;overflow-y:auto!important;z-index:1001!important;border-radius:16px!important;box-shadow:0 20px 40px var(--shadow)!important}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-dropdown[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{width:3rem!important;height:3rem!important;font-size:1.3rem!important}.crm-table[_ngcontent-%COMP%]   td[data-label=Azioni][_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]{justify-content:center!important;padding:var(--gutter-sm) 0}}@container (min-width: 769px){.actions-dropdown[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{min-width:180px}.actions-dropdown.left[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{right:auto;left:0}.actions-dropdown.top[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{top:auto;bottom:100%}}.table-container[_ngcontent-%COMP%]{overflow-x:auto;position:relative}body.dropdown-open[_ngcontent-%COMP%]{overflow:hidden}.mobile-dropdown-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:color-mix(in srgb,var(--text-color) 20%,transparent);-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px);z-index:998;display:none}.actions-dropdown.open[_ngcontent-%COMP%] ~ .mobile-dropdown-backdrop[_ngcontent-%COMP%]{display:block}.esito-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.2rem}.esito-details[_ngcontent-%COMP%]{line-height:1.2;font-size:calc(var(--fs-sm) / 1.25)}.crm-table[_ngcontent-%COMP%]   td[data-label="Ultimo Esito"][_ngcontent-%COMP%]{min-width:120px}@media (max-width: 768px){.crm-table[_ngcontent-%COMP%]   td[data-label="Ultimo Esito"][_ngcontent-%COMP%]{min-width:auto}.esito-details[_ngcontent-%COMP%]{font-size:.7rem}}']})};export{mt as ListaProspect};
