import{a as ie}from"./chunk-VHHLB7VF.js";import"./chunk-CZQHU2W7.js";import{a as ee}from"./chunk-64LBLDON.js";import{a as te}from"./chunk-Y5JPG2CL.js";import"./chunk-Z6GIDEG7.js";import{b as Z}from"./chunk-H4JMM7IJ.js";import"./chunk-XDKKMB7K.js";import"./chunk-WPZ527DH.js";import{d as J,e as K,g as Q,h as W,j as X,m as Y}from"./chunk-PJ4DYJTI.js";import{Bb as O,Ga as q,Gb as x,La as m,S as z,Wa as p,X as j,Xa as t,Y as V,Ya as e,Za as U,db as G,ea as C,gb as b,hb as g,ib as M,mb as n,nb as d,ob as _,ua as l,yb as v,zb as f}from"./chunk-R5VHGKSY.js";import"./chunk-X5YLR3NI.js";import{i as y}from"./chunk-ODN5LVDJ.js";function le(a,o){if(a&1&&(t(0,"span",23),n(1),e()),a&2){let i,r=g(2);l(),_(" Prodotto: ",(i=r.cliente())==null?null:i.prodotto," ")}}function oe(a,o){if(a&1&&(t(0,"div",24),n(1),e()),a&2){let i=g(2);l(),_(" ",i.error()," ")}}function re(a,o){if(a&1&&(t(0,"p",33),n(1),v(2,"date"),e()),a&2){let i,r=g(4);l(),_(" Ultimo aggiornamento: ",f(2,1,(i=r.configurazione())==null||i.dettagli==null||i.dettagli.meta==null?null:i.dettagli.meta.aggiornato_il,"dd/MM/yyyy HH:mm")," ")}}function se(a,o){a&1&&(t(0,"span",40),n(1,"Attivo"),e())}function pe(a,o){a&1&&(t(0,"span",41),n(1,"Non attivo"),e())}function de(a,o){if(a&1&&(t(0,"li")(1,"span"),n(2),e(),t(3,"strong"),n(4),v(5,"number"),e()()),a&2){let i=o.$implicit;l(2),d(i.nome),l(2),_("",f(5,2,i.prezzo,"1.0-0")," \u20AC")}}function ce(a,o){if(a&1&&(t(0,"ul",42),m(1,de,6,5,"li",43),e()),a&2){let i=g().$implicit;l(),p("ngForOf",i.servizi)}}function me(a,o){a&1&&(t(0,"p",33),n(1,"Nessun servizio selezionato."),e())}function ge(a,o){if(a&1&&(t(0,"div",34)(1,"div",35)(2,"h3",28),n(3),e(),m(4,se,2,0,"span",36)(5,pe,2,0,"span",37),e(),t(6,"p",38),n(7," Totale: "),t(8,"strong"),n(9),v(10,"number"),e()(),m(11,ce,2,1,"ul",39)(12,me,2,0,"p",30),e()),a&2){let i=o.$implicit;l(3),d(i.nome),l(),p("ngIf",i.attivo),l(),p("ngIf",!i.attivo),l(4),_("",f(10,6,i.totale,"1.0-0")," \u20AC"),l(2),p("ngIf",i.servizi==null?null:i.servizi.length),l(),p("ngIf",!(i.servizi!=null&&i.servizi.length))}}function _e(a,o){if(a&1&&(t(0,"div",26)(1,"div",27)(2,"h3",28),n(3,"Riepilogo"),e(),t(4,"p",29),n(5," Totale configurazione "),t(6,"strong"),n(7),v(8,"number"),e()(),m(9,re,3,4,"p",30),e(),t(10,"div",31),m(11,ge,13,9,"div",32),e()()),a&2){let i,r,c=g(3);l(7),_("",f(8,3,(i=c.configurazione())==null?null:i.totale,"1.0-0")," \u20AC"),l(2),p("ngIf",(r=c.configurazione())==null||r.dettagli==null||r.dettagli.meta==null?null:r.dettagli.meta.aggiornato_il),l(2),p("ngForOf",c.moduliConfigurazione())}}function ue(a,o){a&1&&(t(0,"div",44),n(1," Nessuna configurazione Promethea associata a questo cliente. "),e())}function ve(a,o){if(a&1&&(t(0,"section",15)(1,"h2",16),n(2,"Configurazione Promethea"),e(),m(3,_e,12,6,"div",25)(4,ue,2,0,"ng-template",null,1,O),e()),a&2){let i=M(5),r=g(2);l(3),p("ngIf",r.configurazione())("ngIfElse",i)}}function fe(a,o){if(a&1&&(t(0,"p",33),n(1),e()),a&2){let i=g().$implicit;l(),d(i.note)}}function xe(a,o){a&1&&(t(0,"p",33),n(1,"Nessuna nota aggiuntiva."),e())}function Ee(a,o){if(a&1&&(t(0,"span",23),n(1),v(2,"date"),e()),a&2){let i=g(2).$implicit;l(),_(" Follow-up: ",f(2,1,i.scheduleAt,"dd/MM/yyyy HH:mm")," ")}}function he(a,o){if(a&1&&(t(0,"span",23),n(1),v(2,"date"),e()),a&2){let i=g(2).$implicit;l(),_(" Appuntamento: ",f(2,1,i.dataAppuntamento,"dd/MM/yyyy")," ")}}function Se(a,o){if(a&1&&(t(0,"span",23),n(1),e()),a&2){let i=g(2).$implicit;l(),_(" Ora: ",i.oraAppuntamento," ")}}function Ce(a,o){if(a&1&&(t(0,"div",49),m(1,Ee,3,4,"span",10)(2,he,3,4,"span",10)(3,Se,2,1,"span",10),e()),a&2){let i=g().$implicit;l(),p("ngIf",i.scheduleAt),l(),p("ngIf",i.dataAppuntamento),l(),p("ngIf",i.oraAppuntamento)}}function Ie(a,o){if(a&1&&(t(0,"div",47)(1,"div",35)(2,"h3",28),n(3),e(),t(4,"span",11),n(5),v(6,"date"),e()(),m(7,fe,2,1,"p",30)(8,xe,2,0,"p",30)(9,Ce,4,3,"div",48),e()),a&2){let i=o.$implicit;l(3),d(i.tipo),l(2),d(f(6,5,i.ts,"dd/MM/yyyy HH:mm")),l(2),p("ngIf",i.note),l(),p("ngIf",!i.note),l(),p("ngIf",i.scheduleAt||i.dataAppuntamento)}}function Pe(a,o){if(a&1&&(t(0,"div",45),m(1,Ie,10,8,"div",46),e()),a&2){let i=g(2);l(),p("ngForOf",i.esitiOrdinati())}}function ye(a,o){a&1&&(t(0,"div",50),n(1," Nessun esito registrato per questo cliente. "),e())}function ze(a,o){if(a&1&&(t(0,"section",15)(1,"h2",16),n(2,"Note interne"),e(),t(3,"div",34)(4,"p"),n(5),e()()()),a&2){let i,r=g(2);l(5),d((i=r.cliente())==null?null:i.note)}}function be(a,o){if(a&1){let i=G();t(0,"div",5)(1,"div",6)(2,"div")(3,"h1",7),n(4),e(),t(5,"p",8),n(6),e(),t(7,"div",9),m(8,le,2,1,"span",10),t(9,"span",11),n(10),v(11,"date"),e(),t(12,"span",11),n(13),v(14,"date"),e()()(),t(15,"button",12),b("click",function(){j(i);let c=g();return V(c.apriEsito())}),t(16,"span",13),n(17,"note_add"),e(),n(18," Aggiungi esito "),e()(),m(19,oe,2,1,"div",14),t(20,"section",15)(21,"h2",16),n(22,"Profilo aziendale"),e(),t(23,"div",17)(24,"section",18)(25,"h3",19),n(26,"Anagrafica"),e(),t(27,"ul",20)(28,"li")(29,"span"),n(30,"P. IVA"),e(),t(31,"strong"),n(32),e()(),t(33,"li")(34,"span"),n(35,"Formula societaria"),e(),t(36,"strong"),n(37),e()(),t(38,"li")(39,"span"),n(40,"Categoria ATECO"),e(),t(41,"strong"),n(42),e()()()(),t(43,"section",18)(44,"h3",19),n(45,"Contatti principali"),e(),t(46,"ul",20)(47,"li")(48,"span"),n(49,"Referente"),e(),t(50,"strong"),n(51),e()(),t(52,"li")(53,"span"),n(54,"Telefono"),e(),t(55,"strong"),n(56),e()(),t(57,"li")(58,"span"),n(59,"Email"),e(),t(60,"strong"),n(61),e()()()(),t(62,"section",18)(63,"h3",19),n(64,"Pagamenti"),e(),t(65,"ul",20)(66,"li")(67,"span"),n(68,"Metodo di pagamento"),e(),t(69,"strong"),n(70),e()(),t(71,"li")(72,"span"),n(73,"IBAN"),e(),t(74,"strong"),n(75),e()()()(),t(76,"section",18)(77,"h3",19),n(78,"Presenza digitale"),e(),t(79,"ul",20)(80,"li")(81,"span"),n(82,"Sito web"),e(),t(83,"strong"),n(84),e()(),t(85,"li")(86,"span"),n(87,"Facebook"),e(),t(88,"strong"),n(89),e()(),t(90,"li")(91,"span"),n(92,"Instagram"),e(),t(93,"strong"),n(94),e()()()(),t(95,"section",18)(96,"h3",19),n(97,"Localizzazione"),e(),t(98,"ul",20)(99,"li")(100,"span"),n(101,"Provincia"),e(),t(102,"strong"),n(103),e()(),t(104,"li")(105,"span"),n(106,"Comune"),e(),t(107,"strong"),n(108),e()(),t(109,"li")(110,"span"),n(111,"Indirizzo"),e(),t(112,"strong"),n(113),e()(),t(114,"li")(115,"span"),n(116,"Numero civico"),e(),t(117,"strong"),n(118),e()(),t(119,"li")(120,"span"),n(121,"Coordinate"),e(),t(122,"strong"),n(123),v(124,"number"),v(125,"number"),e()()()()()(),m(126,ve,6,2,"section",21),t(127,"section",15)(128,"h2",16),n(129,"Cronologia esiti"),e(),m(130,Pe,2,1,"div",22)(131,ye,2,0,"ng-template",null,0,O),e(),m(133,ze,6,1,"section",21),e()}if(a&2){let i,r,c,u,E,h,I,P,T,w,N,A,D,F,B,k,H,$,R,S,L,ae=M(132),s=g();l(4),_(" ",s.titoloPagina()," "),l(2),_(" ",s.sottotitolo()," "),l(2),p("ngIf",(i=s.cliente())==null?null:i.prodotto),l(2),_(" Creato il ",f(11,27,(r=s.cliente())==null?null:r.created_at,"dd/MM/yyyy HH:mm")," "),l(3),_(" Aggiornato il ",f(14,30,(c=s.cliente())==null?null:c.updated_at,"dd/MM/yyyy HH:mm")," "),l(2),p("disabled",!((u=s.cliente())!=null&&u.id)),l(4),p("ngIf",s.error()),l(13),d(((E=s.cliente())==null?null:E.piva)||"\u2014"),l(5),d(((h=s.cliente())==null?null:h.formula_societaria)||"\u2014"),l(5),d(((I=s.cliente())==null?null:I.categoria_ateco)||"\u2014"),l(9),d(((P=s.cliente())==null?null:P.referente)||"\u2014"),l(5),d(((T=s.cliente())==null?null:T.telefono)||"\u2014"),l(5),d(((w=s.cliente())==null?null:w.email)||"\u2014"),l(9),d(((N=s.cliente())==null?null:N.metodo_pagamento)||"\u2014"),l(5),d(((A=s.cliente())==null?null:A.iban)||"\u2014"),l(9),d(((D=s.cliente())==null?null:D.sito_web)||"\u2014"),l(5),d(((F=s.cliente())==null?null:F.facebook)||"\u2014"),l(5),d(((B=s.cliente())==null?null:B.instagram)||"\u2014"),l(9),d(((k=s.cliente())==null?null:k.provincia)||"\u2014"),l(5),d(((H=s.cliente())==null?null:H.comune)||"\u2014"),l(5),d((($=s.cliente())==null?null:$.indirizzo)||"\u2014"),l(5),d(((R=s.cliente())==null?null:R.numero_civico)||"\u2014"),l(5),_(" ",(S=s.cliente())!=null&&S.latitude&&((S=s.cliente())!=null&&S.longitude)?f(124,33,(S=s.cliente())==null?null:S.latitude,"1.4-4")+", "+f(125,36,(S=s.cliente())==null?null:S.longitude,"1.4-4"):"\u2014"," "),l(3),p("ngIf",s.isCliente()),l(4),p("ngIf",s.esitiOrdinati().length)("ngIfElse",ae),l(3),p("ngIf",(L=s.cliente())==null?null:L.note)}}var ne=class a{route=z(Y);soggettiService=z(Z);alchemizzatoreService=z(te);loading=C(!0);error=C(null);tipoLabel=x(()=>{switch(this.tipoSoggetto()){case"fornitore":return"Fornitore";case"prospect":return"Prospect";default:return"Cliente"}});titoloPagina=x(()=>this.cliente()?.ragione_sociale??"Scheda soggetto");sottotitolo=x(()=>this.tipoLabel());soggetto=C(null);configurazionePromethea=C(null);tipo=C("cliente");soggettoId=C(null);esitoPopupOpen=C(!1);cliente=x(()=>this.soggetto());configurazione=x(()=>this.configurazionePromethea());tipoSoggetto=x(()=>this.cliente()?.tipo??this.tipo());isCliente=x(()=>this.tipoSoggetto()==="cliente");esitiOrdinati=x(()=>[...Array.isArray(this.cliente()?.esiti)?this.cliente()?.esiti:[]].sort((i,r)=>new Date(r.ts).getTime()-new Date(i.ts).getTime()));moduliConfigurazione=x(()=>{let o=this.configurazione()?.dettagli;return!o||typeof o!="object"?[]:Object.entries({immagine_marketing:"Immagine & Marketing",digitalizzazione_automatismi:"Digitalizzazione & Automatismi",contabilita_fiscalita:"Contabilit\xE0 & Fiscalit\xE0",ottimizzazione_management:"Ottimizzazione & Management"}).map(([r,c])=>{let u=o[r]??{},E=Array.isArray(u.servizi_selezionati)?u.servizi_selezionati:Array.isArray(u.servizi)?u.servizi:[],h=Number(u.totale??u.totale_modulo??0),I=Number.isFinite(h)&&h>0||E.length>0;return{nome:c,totale:h,attivo:I,servizi:E}})});ngOnInit(){return y(this,null,function*(){let o=this.route.snapshot.paramMap.get("id"),i=this.route.snapshot.paramMap.get("tipo")??"cliente";if(this.tipo.set(i),!o){this.error.set("Cliente non valido."),this.loading.set(!1);return}this.soggettoId.set(o),yield this.caricaDettagli(o)})}caricaDettagli(o){return y(this,null,function*(){this.loading.set(!0),this.error.set(null);try{let i=this.soggettiService.getSoggettoById(o),r=this.tipo()==="cliente"?this.alchemizzatoreService.getConfigurazioniByProspect(o):Promise.resolve(null),[{data:c,error:u},E]=yield Promise.all([i,r]);if(u||!c){this.error.set(u?.message||"Impossibile recuperare il soggetto richiesto.");return}if(this.soggetto.set(c),E){let{data:h,error:I}=E;if(I)console.warn("Configurazione Promethea non disponibile:",I.message),this.configurazionePromethea.set(null);else{let P=(h??[]).at(0)??null;this.configurazionePromethea.set(P)}}else this.configurazionePromethea.set(null)}catch(i){console.error("Errore nel caricamento della pagina cliente:",i),this.error.set(i?.message||"Errore inatteso durante il caricamento.")}finally{this.loading.set(!1)}})}apriEsito(){this.cliente()?.id&&this.esitoPopupOpen.set(!0)}onEsitoPopupClosed(o){return y(this,null,function*(){if(this.esitoPopupOpen.set(!1),o.saved){let i=this.soggettoId();i&&(yield this.caricaDettagli(i))}})}static \u0275fac=function(i){return new(i||a)};static \u0275cmp=q({type:a,selectors:[["app-pagina-cliente"]],decls:3,vars:5,consts:[["noEsiti",""],["noConfig",""],["title","Caricamento cliente","subtitle","Recupero informazioni dal database...",3,"isLoading"],["class","form-section pagina-cliente-container",4,"ngIf"],[3,"closed","open","soggettoId","tipo"],[1,"form-section","pagina-cliente-container"],[1,"section-header"],[1,"section-title"],[1,"section-subtitle","text-muted"],[1,"chips-row"],["class","chip info",4,"ngIf"],[1,"chip","outline"],["type","button",1,"promethea-button",3,"click","disabled"],[1,"material-icons"],["class","status-message error",4,"ngIf"],[1,"section-block"],[1,"section-subtitle"],[1,"detail-stack"],[1,"detail-row"],[1,"detail-heading"],[1,"detail-list"],["class","section-block",4,"ngIf"],["class","esiti-timeline",4,"ngIf","ngIfElse"],[1,"chip","info"],[1,"status-message","error"],["class","config-section",4,"ngIf","ngIfElse"],[1,"config-section"],[1,"card","highlight"],[1,"card-title"],[1,"totale"],["class","text-muted",4,"ngIf"],[1,"grid-responsive"],["class","card soft",4,"ngFor","ngForOf"],[1,"text-muted"],[1,"card","soft"],[1,"card-title-row"],["class","chip success",4,"ngIf"],["class","chip muted",4,"ngIf"],[1,"totale-modulo"],["class","servizi-list",4,"ngIf"],[1,"chip","success"],[1,"chip","muted"],[1,"servizi-list"],[4,"ngFor","ngForOf"],[1,"status-message","info"],[1,"esiti-timeline"],["class","card soft esito-card",4,"ngFor","ngForOf"],[1,"card","soft","esito-card"],["class","chip-row",4,"ngIf"],[1,"chip-row"],[1,"status-message","warning"]],template:function(i,r){if(i&1&&(U(0,"app-page-loader",2),m(1,be,134,39,"div",3),t(2,"app-esito-popup",4),b("closed",function(u){return r.onEsitoPopupClosed(u)}),e()),i&2){let c;p("isLoading",r.loading()),l(),p("ngIf",!r.loading()),l(),p("open",r.esitoPopupOpen())("soggettoId",((c=r.cliente())==null?null:c.id)??"")("tipo",r.tipoSoggetto())}},dependencies:[X,J,K,ee,ie,W,Q],styles:[".pagina-cliente-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-xl)}.chips-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:var(--gutter-sm);align-items:center}.section-block[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-lg)}.detail-stack[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-xl)}.detail-row[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-md)}.detail-row[_ngcontent-%COMP%] + .detail-row[_ngcontent-%COMP%]{padding-top:var(--gutter-lg);border-top:1px solid var(--smoke-color-1)}.detail-heading[_ngcontent-%COMP%]{font-size:var(--fs-md);font-weight:600}.detail-list[_ngcontent-%COMP%]{display:grid;gap:var(--gutter-sm);font-size:var(--fs-sm)}.detail-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-xs)}@media (min-width: 768px){.detail-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{flex-direction:row;justify-content:space-between;align-items:baseline}}.detail-list[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--text-muted)}.section-subtitle[_ngcontent-%COMP%]{margin:var(--gutter-md) 0}"]})};export{ne as PaginaCliente};
