import{a as ee}from"./chunk-KF64YYTK.js";import{a as ie}from"./chunk-IPXXNBDT.js";import{c as te}from"./chunk-DS74SF54.js";import{a as Y}from"./chunk-5KN6QFI4.js";import{a as Z}from"./chunk-4Z4MM4C2.js";import{b as U,d as W,f as q,o as G,p as J,u as Q}from"./chunk-EXOBR4AO.js";import{b as X}from"./chunk-JUOMJRR2.js";import"./chunk-Y2XJCRVM.js";import"./chunk-3ZXX2K2L.js";import{d as B,e as $,k as K,p as j,q as H}from"./chunk-3DLJ4ULO.js";import{A as T,Ab as A,Eb as N,Ga as R,I as L,La as _,Mb as z,S,Wa as D,X as m,Xa as s,Y as f,Ya as i,Za as t,_a as y,cb as P,db as V,ea as F,f as x,fb as I,ib as g,jb as h,qb as E,sb as b,ta as k,ua as a,ub as o,vb as u,wb as w,x as C,yb as M,zb as O}from"./chunk-6W5NKFNP.js";import"./chunk-X5YLR3NI.js";import{i as v}from"./chunk-ODN5LVDJ.js";var re=()=>["/soggetto","nuovo","fornitore"];function oe(l,e){if(l&1&&(i(0,"option",41),o(1),t()),l&2){let r=e.$implicit;s("value",r),a(),u(r)}}function ae(l,e){if(l&1&&(i(0,"option",41),o(1),t()),l&2){let r=e.$implicit;s("value",r),a(),u(r)}}function le(l,e){if(l&1&&(P(0),i(1,"span"),o(2),t(),V()),l&2){let r=e.ngIf;a(2),u(r.tipo)}}function se(l,e){l&1&&o(0,"\u2014")}function ce(l,e){if(l&1){let r=I();i(0,"tr",42)(1,"td",43)(2,"div",44)(3,"strong",45),g("click",function(){let c=m(r).$implicit,d=h();return f(d.apriScheda(c))}),o(4),t()()(),i(5,"td",46)(6,"div",44),o(7),t()(),i(8,"td",47)(9,"div",44),o(10),t()(),i(11,"td",48)(12,"div",44),o(13),t()(),i(14,"td",49)(15,"div",44),o(16),t()(),i(17,"td",50)(18,"div",44),_(19,le,3,1,"ng-container",51)(20,se,1,0,"ng-template",null,3,z),t()(),i(22,"td",52)(23,"div",53)(24,"app-action-dropdown",54),g("action",function(c){let d=m(r).$implicit,p=h();return f(p.handleRowAction(c,d))}),t()()()()}if(l&2){let r=e.$implicit,n=E(21);D("data-row-id",r.id),a(4),u(r.ragione_sociale),a(3),u(r.referente||"\u2014"),a(3),u(r.telefono||"\u2014"),a(3),u(r.email||"\u2014"),a(3),u(r.metodo_pagamento||"\u2014"),a(3),s("ngIf",r.ultimoEsito)("ngIfElse",n),a(5),s("row",r)}}function de(l,e){if(l&1&&(i(0,"tr")(1,"td",55),o(2),t()()),l&2){let r=h();a(2),w(" ",r.searchTerm?"Nessun fornitore trovato":"Nessun fornitore"," ")}}function pe(l,e){l&1&&(i(0,"span",13),o(1,"unfold_more"),t())}function me(l,e){l&1&&(i(0,"span",13),o(1,"hourglass_bottom"),t())}function fe(l,e){if(l&1){let r=I();i(0,"div",56)(1,"button",57),g("click",function(){m(r);let c=h();return f(c.caricaTutti())}),_(2,pe,2,0,"span",58)(3,me,2,0,"span",58),o(4),t()()}if(l&2){let r=h();a(),s("disabled",r.loading()),a(),s("ngIf",!r.loading()),a(),s("ngIf",r.loading()),a(),w(" ",r.loading()?"Caricamento\u2026":"Carica tutti"," ")}}function ge(l,e){if(l&1&&(i(0,"div",59),o(1),t()),l&2){let r=h();a(),w(" ",r.error()," ")}}var ne=class l{listaService=S(ee);soggettiService=S(X);kpiService=S(Z);router=S(j);searchSubject=new x;destroy$=new x;rows=this.listaService.rows;filteredRows=this.listaService.filteredRows;loading=this.listaService.loading;error=this.listaService.error;hasMore=this.listaService.hasMore;currentFiltri=this.listaService.currentFiltri;allLoaded=this.listaService.allLoaded;province=F([]);kpi=F({totale:0,conIban:0,conReferente:0});deletingIds=new Set;activeDropdownId=null;esitiTipi=te;searchTerm="";filtroConIban=!1;filtroConReferente=!1;isLoading=F(!0);constructor(){this.searchSubject.pipe(L(this.destroy$),C(300),T()).subscribe(e=>{this.onSearchExecuted(e)})}ngOnInit(){return v(this,null,function*(){console.log("\u{1F680} Lista Fornitori - START"),this.isLoading.set(!0);try{this.listaService.inizializza({tipo:"fornitore",abilitaConfigurazioni:!1,abilitaTrattative:!1}),console.log("\u2699\uFE0F Servizio fornitori inizializzato"),yield Promise.all([this.listaService.caricaIniziali(),this.loadProvince(),this.refreshKpi()]);let e=this.rows();console.log("\u{1F4C4} Fornitori caricati:",{totalRows:e.length,firstRow:e[0]?.ragione_sociale||"N/A"}),console.log("\u2705 Init fornitori completato")}catch(e){console.error("\u274C Errore caricamento fornitori:",e)}finally{setTimeout(()=>{this.isLoading.set(!1)},300)}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}caricaTutti(){return v(this,null,function*(){yield this.listaService.caricaTutti()})}allLoadedFn(){return this.allLoaded()}onSearchExecuted(e){return v(this,null,function*(){yield this.listaService.cerca(e)})}onSearchChange(e){this.searchTerm=e,this.searchSubject.next(e)}onChangeFiltroEsito(e){this.listaService.applicaFiltri({esito:e,conIban:this.filtroConIban,conReferente:this.filtroConReferente})}onChangeFiltroProvincia(e){this.listaService.applicaFiltri({provincia:e})}onChangeSortDir(e){this.listaService.applicaFiltri({sortDir:e})}onFiltroTotale(){this.filtroConIban=!1,this.filtroConReferente=!1,this.listaService.applicaFiltri({esito:"tutti",provincia:"tutte",conIban:!1,conReferente:!1})}onFiltroConIban(){this.filtroConIban=!0,this.filtroConReferente=!1,this.listaService.applicaFiltri({esito:"tutti",conIban:!0,conReferente:!1})}onFiltroConReferente(){this.filtroConIban=!1,this.filtroConReferente=!0,this.listaService.applicaFiltri({esito:"tutti",conIban:!1,conReferente:!0})}onDelete(e){return v(this,null,function*(){if(!(!e?.id||!confirm(`Eliminare il fornitore "${e.ragione_sociale}"?`))){this.deletingIds.add(e.id);try{(yield this.listaService.eliminaSoggetto(e.id))&&(yield this.refreshKpi())}catch(n){console.error("Errore durante l'eliminazione:",n)}finally{this.deletingIds.delete(e.id)}}})}onEdit(e){e?.id&&this.router.navigate(["/soggetto",e.id,"edit"])}onAddDocument(e){console.log("Aggiungi documento per:",e.ragione_sociale)}trackById=(e,r)=>r.id;toggleActionsDropdown(e){let r=this.activeDropdownId===e;this.activeDropdownId=r?null:e;let n=document.querySelector(".table-container");n&&(this.activeDropdownId?n.classList.add("dropdown-open"):n.classList.remove("dropdown-open"))}closeDropdown(e){e.target.closest(".actions-dropdown")||(this.activeDropdownId=null)}loadProvince(){return v(this,null,function*(){let{data:e}=yield this.soggettiService.getProvinceByTipo("fornitore");e&&this.province.set(e)})}refreshKpi(){return v(this,null,function*(){try{let e=yield this.kpiService.getAnagraficaKPI("fornitore");this.kpi.set({totale:e.totale,conIban:e.conIban,conReferente:e.conReferente})}catch(e){console.error("Errore nel caricamento KPI:",e)}})}apriScheda(e){e?.id&&this.router.navigate(["/soggetto",e.id])}handleRowAction(e,r){switch(e){case"edit":this.onEdit(r);break;case"delete":this.onDelete(r);break}}static \u0275fac=function(r){return new(r||l)};static \u0275cmp=R({type:l,selectors:[["app-lista-fornitori"]],hostBindings:function(r,n){r&1&&g("click",function(d){return n.closeDropdown(d)},k)},decls:95,vars:25,consts:[["filtroSel",""],["ordinaSel",""],["provSel",""],["noEsito",""],["title","Caricamento Fornitori","subtitle","Stiamo caricando i tuoi fornitori...",3,"isLoading"],[1,"form-section"],[1,"section-header"],[1,"material-icons","header-icon"],[1,"section-titles"],[1,"section-title"],[1,"sottotitolo"],[1,"flex-1"],["title","Aggiungi fornitore","aria-label","Aggiungi fornitore",1,"icon-btn",3,"routerLink"],[1,"material-icons"],[1,"prospect-cards"],[1,"card",3,"click"],[1,"card-title"],[1,"card-number"],[1,"table-section"],[1,"table-tools"],[1,"tool"],["for","search",1,"label"],["id","search","type","text","placeholder","Ragione sociale, telefono, email\u2026",1,"table-inline-input",3,"ngModelChange","ngModel"],["for","filtroEsito",1,"label"],["id","filtroEsito",1,"table-inline-select",3,"change","value"],["value","tutti"],["value","senza-esito"],[3,"value",4,"ngFor","ngForOf"],["for","ordinaPer",1,"label"],["id","ordinaPer",1,"table-inline-select",3,"change","value"],["value","desc"],["value","asc"],["for","filtroProvincia",1,"label"],["id","filtroProvincia",1,"table-inline-select",3,"change","value"],["value","tutte"],[1,"table-container"],[1,"crm-table"],["class","row-clickable",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],["class","load-more-container",4,"ngIf"],["style","text-align:center; color:#ef4444; margin-top:1rem;",4,"ngIf"],[3,"value"],[1,"row-clickable"],["data-label","Ragione Sociale"],[1,"cell-content"],[1,"link",3,"click"],["data-label","Referente"],["data-label","Telefono"],["data-label","Email"],["data-label","Metodo Pagamento"],["data-label","Ultimo Esito"],[4,"ngIf","ngIfElse"],["data-label","Azioni"],[1,"actions-container"],[3,"action","row"],["colspan","7",2,"text-align","center","padding","1.5rem"],[1,"load-more-container"],[1,"promethea-button",3,"click","disabled"],["class","material-icons",4,"ngIf"],[2,"text-align","center","color","#ef4444","margin-top","1rem"]],template:function(r,n){if(r&1){let c=I();y(0,"app-page-loader",4),i(1,"div")(2,"div",5)(3,"div",6)(4,"i",7),o(5,"local_shipping"),t(),i(6,"div",8)(7,"h2",9),o(8,"Fornitori"),t(),i(9,"p",10),o(10,"Panoramica fornitori e KPI"),t()(),y(11,"div",11),i(12,"a",12)(13,"span",13),o(14,"add_circle"),t()()(),i(15,"div",14)(16,"div",15),g("click",function(){return m(c),f(n.onFiltroTotale())}),i(17,"h3",16),o(18,"Totale Fornitori"),t(),i(19,"div",17),o(20),t()(),i(21,"div",15),g("click",function(){return m(c),f(n.onFiltroConIban())}),i(22,"h3",16),o(23,"Con IBAN"),t(),i(24,"div",17),o(25),t()(),i(26,"div",15),g("click",function(){return m(c),f(n.onFiltroConReferente())}),i(27,"h3",16),o(28,"Con Referente"),t(),i(29,"div",17),o(30),t()()()(),i(31,"section",18)(32,"div",19)(33,"div",20)(34,"label",21)(35,"span",13),o(36,"search"),t(),o(37," Cerca "),t(),i(38,"input",22),A("ngModelChange",function(p){return m(c),O(n.searchTerm,p)||(n.searchTerm=p),f(p)}),g("ngModelChange",function(p){return m(c),f(n.onSearchChange(p))}),t()(),i(39,"div",20)(40,"label",23)(41,"span",13),o(42,"filter_list"),t(),o(43," Ultimo esito "),t(),i(44,"select",24,0),g("change",function(){m(c);let p=E(45);return f(n.onChangeFiltroEsito(p.value))}),i(46,"option",25),o(47,"Tutti"),t(),i(48,"option",26),o(49,"Senza esito"),t(),_(50,oe,2,2,"option",27),t()(),i(51,"div",20)(52,"label",28)(53,"span",13),o(54,"sort"),t(),o(55," Ordina per: "),t(),i(56,"select",29,1),g("change",function(){m(c);let p=E(57);return f(n.onChangeSortDir(p.value))}),i(58,"option",30),o(59,"Pi\xF9 recente"),t(),i(60,"option",31),o(61,"Meno recente"),t()()(),i(62,"div",20)(63,"label",32)(64,"span",13),o(65,"place"),t(),o(66," Provincia "),t(),i(67,"select",33,2),g("change",function(){m(c);let p=E(68);return f(n.onChangeFiltroProvincia(p.value))}),i(69,"option",34),o(70,"Tutte"),t(),_(71,ae,2,2,"option",27),t()()(),i(72,"div",35)(73,"table",36)(74,"thead")(75,"tr")(76,"th"),o(77,"Ragione Sociale"),t(),i(78,"th"),o(79,"Referente"),t(),i(80,"th"),o(81,"Telefono"),t(),i(82,"th"),o(83,"Email"),t(),i(84,"th"),o(85,"Metodo Pagamento"),t(),i(86,"th"),o(87,"Ultimo Esito"),t(),i(88,"th"),o(89,"Azioni"),t()()(),i(90,"tbody"),_(91,ce,25,9,"tr",37)(92,de,3,1,"tr",38),t()()(),_(93,fe,5,4,"div",39)(94,ge,2,1,"div",40),t()()}r&2&&(s("isLoading",n.isLoading()),a(),b("hidden",n.isLoading()),a(11),s("routerLink",N(24,re)),a(4),b("card-active",n.currentFiltri().esito==="tutti"&&n.currentFiltri().provincia==="tutte"&&!n.currentFiltri().conIban&&!n.currentFiltri().conReferente),a(4),u(n.kpi().totale),a(),b("card-active",n.currentFiltri().conIban),a(4),u(n.kpi().conIban),a(),b("card-active",n.currentFiltri().conReferente),a(4),u(n.kpi().conReferente),a(8),M("ngModel",n.searchTerm),a(6),s("value",n.currentFiltri().esito),a(6),s("ngForOf",n.esitiTipi),a(6),s("value",n.currentFiltri().sortDir),a(11),s("value",n.currentFiltri().provincia),a(4),s("ngForOf",n.province()),a(20),s("ngForOf",n.filteredRows())("ngForTrackBy",n.trackById),a(),s("ngIf",!n.loading()&&!n.error()&&n.filteredRows().length===0),a(),s("ngIf",!n.error()&&n.hasMore()),a(),s("ngIf",n.error()))},dependencies:[K,B,$,Q,G,J,U,W,q,Y,H,ie],encapsulation:2})};export{ne as ListaFornitori};
