import{a as V}from"./chunk-B2TAGDN2.js";import{a as K}from"./chunk-5STMSNPF.js";import{a as D}from"./chunk-QQWCK2ZL.js";import{j as I,k as S,n as M,p as E,v as O}from"./chunk-VUYFDMJB.js";import{Ga as w,La as d,S as f,X as z,Xa as l,Y as b,Ya as t,Za as e,_a as x,eb as C,fa as k,hb as P,ib as c,kb as y,lb as _,nb as n,ob as m,pb as p,qb as h,ua as a,xb as g,zb as v}from"./chunk-CVFHM34U.js";import"./chunk-X5YLR3NI.js";import{i as u}from"./chunk-ODN5LVDJ.js";function L(o,s){if(o&1){let i=C();t(0,"button",13),P("click",function(){z(i);let N=c();return b(N.toggleView())}),t(1,"span",14),n(2),e(),t(3,"span",15),n(4),e()()}if(o&2){let i=c();_("active",i.currentView==="global"),l("title",i.currentView==="personal"?"Visualizza KPI di tutti gli utenti":"Visualizza i miei KPI"),a(2),p(" ",i.currentView==="personal"?"groups":"person"," "),a(2),p(" ",i.currentView==="personal"?"KPI Globali":"I miei KPI"," ")}}function U(o,s){if(o&1&&(t(0,"div",16)(1,"div",17)(2,"div",18)(3,"i",14),n(4,"assignment"),e()(),t(5,"div",19)(6,"div",20),n(7),e(),t(8,"p"),n(9,"Totale Trattative"),e()()(),t(10,"div",17)(11,"div",21)(12,"i",14),n(13,"check_circle"),e()(),t(14,"div",19)(15,"div",20),n(16),e(),t(17,"p"),n(18,"Contratti Chiusi Totali"),e(),t(19,"div",22),n(20),g(21,"number"),e()()(),t(22,"div",17)(23,"div",23)(24,"i",14),n(25,"calendar_today"),e()(),t(26,"div",19)(27,"div",20),n(28),e(),t(29,"p"),n(30,"Chiusi Questo Mese"),e(),t(31,"div",22),n(32),g(33,"number"),e()()(),t(34,"div",17)(35,"div",24)(36,"i",14),n(37,"contacts"),e()(),t(38,"div",19)(39,"div",20),n(40),g(41,"number"),e(),t(42,"p"),n(43,"Nominativi Presi"),e(),t(44,"small"),n(45,"Quando si chiude contratto"),e()()(),t(46,"div",17)(47,"div",25)(48,"i",14),n(49,"schedule"),e()(),t(50,"div",19)(51,"div",20),n(52),g(53,"number"),e(),t(54,"p"),n(55,"Da Richiamare"),e()()(),t(56,"div",17)(57,"div",26)(58,"i",14),n(59,"group_add"),e()(),t(60,"div",19)(61,"div",20),n(62),e(),t(63,"p"),n(64,"Referenze da CTR"),e()()()()),o&2){let i=c();a(7),m(i.kpiData.totaleTrattative),a(9),m(i.kpiData.contrattiChiusiTotali),a(4),p(" ",v(21,8,i.kpiData.percentualeChiusiTotali,"1.1-1"),"% "),a(8),m(i.kpiData.contrattiChiusiMeseCorrente),a(4),p(" ",v(33,11,i.kpiData.percentualeChiusiMese,"1.1-1"),"% "),a(8),p("",v(41,14,i.kpiData.percentualeNominativiPresi,"1.1-1"),"%"),a(12),p("",v(53,17,i.kpiData.percentualeDaRichiamare,"1.1-1"),"%"),a(10),m(i.kpiData.referenzeDaCtr)}}function F(o,s){if(o&1&&(t(0,"div",38)(1,"span",39),n(2),e(),t(3,"span",40),n(4),e()()),o&2){let i=s.$implicit,r=c(4);a(2),m(i),a(2),p("(",r.kpiData.dettagliSoftware[i],")")}}function j(o,s){if(o&1&&(t(0,"div",36),d(1,F,5,2,"div",37),e()),o&2){let i=c(3);a(),l("ngForOf",i.getSoftwareKeys())}}function A(o,s){if(o&1&&(t(0,"div",29)(1,"div",30)(2,"span",31),n(3),e(),t(4,"span",32),n(5),g(6,"number"),e()(),d(7,j,2,1,"div",33),t(8,"div",34),x(9,"div",35),e()()),o&2){let i=s.$implicit,r=c(2);a(3),p(" ",r.getTestoMotivazione(i)," "),a(2),h(" ",r.kpiData.motivazioniNonChiusi[i]," (",v(6,6,r.kpiData.motivazioniNonChiusi[i]/r.kpiData.totaleTrattative*100,"1.1-1"),"%) "),a(2),l("ngIf",i==="usano_software_proprio"&&r.getSoftwareKeys().length>0),a(2),y("width",r.kpiData.motivazioniNonChiusi[i]/r.kpiData.totaleTrattative*100+"%")}}function B(o,s){if(o&1&&(t(0,"div",27)(1,"h3",6),n(2,"Motivazioni Non Chiusura"),e(),t(3,"div",16),d(4,A,10,9,"div",28),e()()),o&2){let i=c();a(4),l("ngForOf",i.getMotivazioniKeys())}}function R(o,s){o&1&&(t(0,"div",41)(1,"span",14),n(2,"analytics"),e(),t(3,"p"),n(4,"Nessun dato KPI disponibile"),e()())}var T=class o{kpiService=f(V);supabaseService=f(O);userService=f(D);kpiData=null;currentUserId=null;isLoading=k(!0);isAdmin=!1;showGlobalKPI=!1;currentView="personal";ngOnInit(){return u(this,null,function*(){this.isLoading.set(!0);try{yield this.getCurrentUser(),this.isAdmin=this.userService.isAdmin(),yield this.caricaKPI()}finally{setTimeout(()=>{this.isLoading.set(!1)},300)}})}getCurrentUser(){return u(this,null,function*(){try{let{data:{user:s}}=yield this.supabaseService.getUser();this.currentUserId=s?.id||null}catch(s){console.error("Errore nel recupero utente:",s)}})}caricaKPI(){return u(this,null,function*(){try{let s=this.isAdmin&&this.currentView==="global"?void 0:this.currentUserId;this.kpiData=yield this.kpiService.getKPIYuvi(s||void 0)}catch(s){console.error("Errore nel caricamento KPI:",s)}})}toggleView(){return u(this,null,function*(){if(this.isAdmin){this.isLoading.set(!0);try{this.currentView=this.currentView==="personal"?"global":"personal",yield this.caricaKPI()}finally{setTimeout(()=>{this.isLoading.set(!1)},300)}}})}getTestoMotivazione(s){return{prezzo_troppo_alto:"Prezzo troppo alto",usano_software_proprio:"Usano gi\xE0 un software e si trovano bene",non_hanno_bisogno:"Non ne hanno bisogno",non_si_fidano:"Non si fidano",da_richiamare:"Da richiamare",contratto_chiuso:"Contratto chiuso",non_chiuso:"Non chiuso"}[s]||s}getMotivazioniKeys(){return!this.kpiData||!this.kpiData.motivazioniNonChiusi?[]:Object.keys(this.kpiData.motivazioniNonChiusi)}getSoftwareKeys(){return!this.kpiData||!this.kpiData.dettagliSoftware?[]:Object.keys(this.kpiData.dettagliSoftware)}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=w({type:o,selectors:[["app-visualizzazione-kpi"]],decls:17,vars:11,consts:[[3,"isLoading","title","subtitle"],[1,"kpi-container"],[1,"form-section"],[1,"section-header"],[1,"material-icons","header-icon"],[1,"section-titles"],[1,"section-title"],[1,"sottotitolo"],[1,"flex-1"],["class","promethea-button outline",3,"active","title","click",4,"ngIf"],["class","grid-responsive",4,"ngIf"],["class","form-section","style","margin-top: var(--gutter-lg);",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"promethea-button","outline",3,"click","title"],[1,"material-icons"],[1,"view-toggle-text"],[1,"grid-responsive"],[1,"card","kpi-card"],[1,"kpi-icon","primary"],[1,"kpi-content"],[1,"card-number"],[1,"kpi-icon","success"],[1,"kpi-percentage"],[1,"kpi-icon","calendar"],[1,"kpi-icon","info"],[1,"kpi-icon","warning"],[1,"kpi-icon","secondary"],[1,"form-section",2,"margin-top","var(--gutter-lg)"],["class","motivazione-item",4,"ngFor","ngForOf"],[1,"motivazione-item"],[1,"motivazione-header"],[1,"motivazione-text"],[1,"motivazione-count"],["class","software-details",4,"ngIf"],[1,"motivazione-bar"],[1,"motivazione-progress"],[1,"software-details"],["class","software-item text-muted",4,"ngFor","ngForOf"],[1,"software-item","text-muted"],[1,"software-name"],[1,"software-count"],[1,"empty-state"]],template:function(i,r){i&1&&(x(0,"app-page-loader",0),t(1,"div")(2,"div",1)(3,"div",2)(4,"div",3)(5,"i",4),n(6,"analytics"),e(),t(7,"div",5)(8,"h2",6),n(9,"KPI Trattative YUVI"),e(),t(10,"p",7),n(11),e()(),x(12,"div",8),d(13,L,5,5,"button",9),e(),d(14,U,65,20,"div",10)(15,B,5,1,"div",11)(16,R,5,0,"div",12),e()()()),i&2&&(l("isLoading",r.isLoading())("title",r.currentView==="personal"?"Caricamento KPI Personali":"Caricamento KPI Globali")("subtitle","Stiamo analizzando i dati delle trattative..."),a(),_("hidden",r.isLoading()),a(10),h(" ",r.currentView==="personal"?"Panoramica KPI personali":"Panoramica KPI globali"," ",r.currentView==="global"?"(Tutti gli utenti)":""," "),a(2),l("ngIf",r.isAdmin),a(),l("ngIf",r.kpiData),a(),l("ngIf",r.kpiData&&r.getMotivazioniKeys().length>0),a(),l("ngIf",!r.kpiData&&!r.isLoading()))},dependencies:[E,I,S,K,M],styles:[".kpi-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm)}.kpi-icon[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:12px;display:grid;place-items:center;font-size:1.5rem}.card-number[_ngcontent-%COMP%]{font-size:var(--fs-md)}.kpi-icon.success[_ngcontent-%COMP%]{background:color-mix(in srgb,#10b981 15%,transparent);color:#10b981}.kpi-icon.primary[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--primary) 15%,transparent);color:var(--primary)}.kpi-icon.info[_ngcontent-%COMP%]{background:color-mix(in srgb,#3b82f6 15%,transparent);color:#3b82f6}.kpi-icon.warning[_ngcontent-%COMP%]{background:color-mix(in srgb,#f59e0b 15%,transparent);color:#f59e0b}.kpi-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:color-mix(in srgb,var(--text-color) 70%,transparent);font-weight:500}.kpi-percentage[_ngcontent-%COMP%]{font-size:var(--fs-sm);font-weight:700;color:var(--primary);margin-top:4px}.motivazione-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:minmax(0,1fr) auto minmax(100px,30%);align-items:center;gap:var(--gutter-md);padding:var(--gutter-sm);border:1px solid var(--smoke-color-1);border-radius:12px;background:var(--background)}.motivazione-text[_ngcontent-%COMP%]{font-weight:500;min-width:0;overflow-wrap:anywhere}.motivazione-count[_ngcontent-%COMP%]{font-weight:700;color:var(--primary);text-align:right}.motivazione-bar[_ngcontent-%COMP%]{height:8px;background:var(--smoke-color-1);border-radius:4px;overflow:hidden}.motivazione-progress[_ngcontent-%COMP%]{height:100%;background:var(--primary);border-radius:4px;transition:width .3s ease}.software-details[_ngcontent-%COMP%]{margin-top:.5rem;padding-left:1rem;border-left:2px solid #e2e8f0}.software-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:.25rem}.software-name[_ngcontent-%COMP%]{margin-right:var(--gutter-sm)}.software-count[_ngcontent-%COMP%]{font-weight:600}.motivazione-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%}.view-toggle-text[_ngcontent-%COMP%]{font-weight:500}.kpi-card[_ngcontent-%COMP%]   .kpi-icon.calendar[_ngcontent-%COMP%]{background:#3b82f6}.kpi-card[_ngcontent-%COMP%]   .kpi-icon.secondary[_ngcontent-%COMP%]{background:#8b5cf6}.software-details[_ngcontent-%COMP%]{margin-top:8px;padding-left:16px;border-left:2px solid #e5e7eb}.software-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:4px 0;font-size:14px}.software-name[_ngcontent-%COMP%]{color:var(--color-text)}.software-count[_ngcontent-%COMP%]{color:var(--color-text-light);font-weight:500}"]})};export{T as VisualizzazioneKpi};
