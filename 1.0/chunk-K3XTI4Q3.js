import{a as I}from"./chunk-OQ64DC27.js";import{a as k,b as u,c as E,d as S,f as R,g as z,h as F,n as D,p as N}from"./chunk-QHMRLWV2.js";import{b as M,d as O}from"./chunk-A73PPQIR.js";import{b as y}from"./chunk-7VD3EVFT.js";import{k as w,p as P}from"./chunk-CSZ7WPY7.js";import{Ga as x,La as m,S as p,Xa as l,Ya as a,Za as n,_a as c,gb as _,hb as v,mb as i,nb as C,ob as f,ua as s}from"./chunk-QS6MTI54.js";import"./chunk-X5YLR3NI.js";import{i as h}from"./chunk-ODN5LVDJ.js";function G(r,e){if(r&1&&(a(0,"div",17),i(1," \u{1F389} Sei stato invitato a join Promethea CRM!"),c(2,"br"),a(3,"strong"),i(4,"Email:"),n(),i(5),n()),r&2){let o=v();s(5),f(" ",o.inviteData.email," ")}}function V(r,e){r&1&&(a(0,"div",18),i(1," Inserisci una email valida "),n())}function Y(r,e){r&1&&(a(0,"div",18),i(1," Password richiesta (min. 6 caratteri) "),n())}function q(r,e){r&1&&(a(0,"div",18),i(1," Le password non coincidono "),n())}function A(r,e){r&1&&c(0,"span",19)}function j(r,e){if(r&1&&(a(0,"div",20),i(1),n()),r&2){let o=v();s(),f(" ",o.error," ")}}var T=class r{fb=p(D);auth=p(I);router=p(O);route=p(M);supabase=p(y);form;loading=!1;error=null;inviteData=null;token=null;constructor(){this.form=this.fb.group({email:["",[u.required,u.email]],password:["",[u.required,u.minLength(6)]],confirmPassword:["",[u.required]]},{validators:this.passwordMatchValidator})}ngOnInit(){this.route.queryParams.subscribe(e=>{this.token=e.token||null;let o=e.email||null;this.token&&this.validateInvite(),o&&(this.form.patchValue({email:o}),this.form.get("email")?.disable())})}passwordMatchValidator(e){let o=e.get("password"),t=e.get("confirmPassword");return o&&t&&o.value===t.value?null:{mismatch:!0}}validateInvite(){return h(this,null,function*(){if(this.token)try{let e=yield this.supabase.validateInvite(this.token);if(e.error)throw new Error(e.error.message||"Invito non valido");this.inviteData=e.data,this.form.patchValue({email:this.inviteData.email}),this.form.get("email")?.disable()}catch(e){this.error=e.message||"Invito non valido"}})}onSubmit(){return h(this,null,function*(){if(this.form.invalid||this.loading)return;this.loading=!0,this.error=null;let{email:e,password:o}=this.form.value;try{if(yield this.auth.register(e,o),this.token){let t=this.auth.user();if(!t)throw new Error("Utente non trovato");let d=yield this.supabase.completeInvite(this.token,t.id);if(d.error)throw new Error(d.error.message||"Errore nel completamento invito")}this.router.navigate(["/home"])}catch(t){this.error=t.message||"Registrazione fallita"}finally{this.loading=!1}})}get isInviteFlow(){return!!this.token}static \u0275fac=function(o){return new(o||r)};static \u0275cmp=x({type:r,selectors:[["app-register"]],decls:29,vars:11,consts:[[1,"auth-container"],[1,"auth-card"],["class","auth-info",4,"ngIf"],["novalidate","",3,"ngSubmit","formGroup"],[1,"form-field"],["for","email",1,"auth-label"],["id","email","type","email","formControlName","email","placeholder","es. nome@azienda.it",1,"auth-input",3,"disabled"],["class","error",4,"ngIf"],["for","password",1,"auth-label"],["id","password","type","password","formControlName","password","placeholder","Minimo 6 caratteri",1,"auth-input"],["for","confirmPassword",1,"auth-label"],["id","confirmPassword","type","password","formControlName","confirmPassword","placeholder","Ripeti la password",1,"auth-input"],["type","submit",1,"promethea-button",3,"disabled"],["class","loading-spinner",4,"ngIf"],["class","auth-error",4,"ngIf"],[1,"auth-alt"],["routerLink","/login"],[1,"auth-info"],[1,"error"],[1,"loading-spinner"],[1,"auth-error"]],template:function(o,t){if(o&1&&(a(0,"div",0)(1,"div",1)(2,"h2"),i(3),n(),m(4,G,6,1,"div",2),a(5,"form",3),_("ngSubmit",function(){return t.onSubmit()}),a(6,"div",4)(7,"label",5),i(8,"Email"),n(),c(9,"input",6),m(10,V,2,0,"div",7),n(),a(11,"div",4)(12,"label",8),i(13,"Password"),n(),c(14,"input",9),m(15,Y,2,0,"div",7),n(),a(16,"div",4)(17,"label",10),i(18,"Conferma Password"),n(),c(19,"input",11),m(20,q,2,0,"div",7),n(),a(21,"button",12),m(22,A,1,0,"span",13),i(23),n(),m(24,j,2,1,"div",14),n(),a(25,"div",15),i(26," Hai gi\xE0 un account? "),a(27,"a",16),i(28,"Accedi"),n()()()()),o&2){let d,g,b;s(3),C(t.isInviteFlow?"Completa Registrazione":"Registrati"),s(),l("ngIf",t.isInviteFlow&&t.inviteData),s(),l("formGroup",t.form),s(4),l("disabled",t.isInviteFlow),s(),l("ngIf",((d=t.form.get("email"))==null?null:d.invalid)&&((d=t.form.get("email"))==null?null:d.touched)),s(5),l("ngIf",((g=t.form.get("password"))==null?null:g.invalid)&&((g=t.form.get("password"))==null?null:g.touched)),s(5),l("ngIf",t.form.hasError("mismatch")&&((b=t.form.get("confirmPassword"))==null?null:b.touched)),s(),l("disabled",t.loading||t.form.invalid),s(),l("ngIf",t.loading),s(),f(" ",t.loading?"Registrazione...":"Registrati"," "),s(),l("ngIf",t.error)}},dependencies:[P,w,N,R,k,E,S,z,F],styles:['.auth-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:var(--gutter-lg);position:relative;overflow:hidden}.auth-container[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:radial-gradient(circle at 20% 80%,var(--primary) 0%,transparent 50%),radial-gradient(circle at 80% 20%,var(--secondary) 0%,transparent 50%),radial-gradient(circle at 40% 40%,var(--tertiary) 0%,transparent 50%);pointer-events:none;z-index:0}.auth-card[_ngcontent-%COMP%]{background:var(--background);padding:clamp(1.5rem,5vw,3rem);border-radius:24px;box-shadow:0 8px 32px var(--shadow),0 2px 8px var(--smoke-color-1);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid var(--smoke-color-1);width:100%;max-width:440px;position:relative;z-index:2;transition:all .3s cubic-bezier(.4,0,.2,1)}.auth-card[_ngcontent-%COMP%]:hover{box-shadow:0 12px 48px var(--shadow2),0 4px 16px var(--smoke-color-2);transform:translateY(-2px)}.auth-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;font-size:var(--fs-lg);color:var(--primary);margin-bottom:var(--gutter-lg);font-weight:700;position:relative}.auth-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-8px;left:50%;transform:translate(-50%);width:60px;height:3px;background:var(--gradiente);border-radius:2px}.auth-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-lg)}.auth-label[_ngcontent-%COMP%]{display:block;font-size:var(--fs-sm);font-weight:600;color:var(--text-color);margin-bottom:var(--gutter-sm);transition:color .2s ease}.auth-input[_ngcontent-%COMP%]{width:100%;height:52px;padding:0 var(--gutter-lg);border:2px solid var(--smoke-color-1);border-radius:12px;background:var(--background);color:var(--text-color);font-size:var(--fs-sm);transition:all .3s ease;outline:none}.auth-input[_ngcontent-%COMP%]:focus{border-color:var(--primary);box-shadow:0 0 0 4px color-mix(in srgb,var(--primary) 20%,transparent);transform:translateY(-1px)}.auth-input[_ngcontent-%COMP%]::placeholder{color:color-mix(in srgb,var(--text-color) 40%,transparent)}.auth-input[_ngcontent-%COMP%]:invalid:not(:focus):not(:placeholder-shown){border-color:#ef4444;box-shadow:0 0 0 4px color-mix(in srgb,#ef4444 20%,transparent)}.promethea-button[_ngcontent-%COMP%]{width:100%;height:52px;margin-top:var(--gutter-sm);font-size:var(--fs-md);font-weight:600;letter-spacing:.5px;background:var(--gradiente);color:#fffaf7;border:none;border-radius:40px 10px;cursor:pointer;transition:all .3s cubic-bezier(.4,0,.2,1);box-shadow:0 4px 16px var(--shadow);position:relative;overflow:hidden}.promethea-button[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:left .5s ease}.promethea-button[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px) scale(1.02);box-shadow:0 8px 32px var(--shadow2),0 4px 16px var(--shadow3)}.promethea-button[_ngcontent-%COMP%]:hover:not(:disabled):before{left:100%}.promethea-button[_ngcontent-%COMP%]:active:not(:disabled){transform:translateY(0) scale(1)}.promethea-button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none;box-shadow:0 2px 8px var(--shadow)}.auth-error[_ngcontent-%COMP%]{background:color-mix(in srgb,#ef4444 10%,transparent);color:#ef4444;padding:var(--gutter-lg);border-radius:12px;border:1px solid color-mix(in srgb,#ef4444 30%,transparent);margin-top:var(--gutter-lg);font-size:var(--fs-sm);font-weight:500;text-align:center;animation:_ngcontent-%COMP%_slideIn .3s ease-out}.auth-info[_ngcontent-%COMP%]{background:color-mix(in srgb,#10b981 10%,transparent);color:#10b981;padding:var(--gutter-lg);border-radius:12px;border:1px solid color-mix(in srgb,#10b981 30%,transparent);margin-top:var(--gutter-lg);font-size:var(--fs-sm);font-weight:500;text-align:center;animation:_ngcontent-%COMP%_slideIn .3s ease-out}.auth-alt[_ngcontent-%COMP%]{text-align:center;margin-top:var(--gutter-lg);padding-top:var(--gutter-lg);border-top:1px solid var(--smoke-color-1);color:var(--text-color);font-size:var(--fs-sm)}.auth-alt[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary);font-weight:600;text-decoration:none;transition:all .2s ease;margin-left:4px}.auth-alt[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--secondary);text-decoration:underline}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}@media (max-width: 480px){.auth-container[_ngcontent-%COMP%]{padding:var(--gutter-sm)}.auth-card[_ngcontent-%COMP%]{padding:var(--gutter-lg);margin:var(--gutter-sm)}.auth-input[_ngcontent-%COMP%]{height:48px;padding:0 var(--gutter-lg)}.promethea-button[_ngcontent-%COMP%]{height:48px}}@media (prefers-reduced-motion: reduce){.auth-card[_ngcontent-%COMP%], .auth-input[_ngcontent-%COMP%], .promethea-button[_ngcontent-%COMP%], .auth-error[_ngcontent-%COMP%], .auth-info[_ngcontent-%COMP%]{transition:none;animation:none}.promethea-button[_ngcontent-%COMP%]:before{display:none}}.auth-input[_ngcontent-%COMP%]:focus-visible{outline:2px solid var(--primary);outline-offset:2px}.promethea-button[_ngcontent-%COMP%]:focus-visible{outline:2px solid var(--text-color);outline-offset:2px}.auth-card[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]{margin-bottom:var(--gutter-md)}.auth-card[_ngcontent-%COMP%]   input[disabled][_ngcontent-%COMP%]{opacity:.7;background:var(--smoke-color-2);cursor:not-allowed}.auth-card[_ngcontent-%COMP%]   .status-message[_ngcontent-%COMP%]{margin-top:var(--gutter-md)}']})};export{T as RegisterComponent};
