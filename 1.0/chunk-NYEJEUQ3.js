import{a as W,c as H,e as J,o as K}from"./chunk-QHMRLWV2.js";import{a as Q}from"./chunk-MYIP52J4.js";import{b as N,d as P}from"./chunk-A73PPQIR.js";import{b as L}from"./chunk-7VD3EVFT.js";import{j as B,k as j,o as q,p as G}from"./chunk-CSZ7WPY7.js";import{Aa as k,Ga as M,La as v,N as T,S as A,X as _,Xa as d,Y as u,Ya as i,Za as n,_a as V,db as h,gb as z,hb as s,kb as g,mb as a,nb as p,ob as f,pb as E,qb as O,rb as F,sb as D,ua as l,vb as $,yb as R}from"./chunk-QS6MTI54.js";import"./chunk-X5YLR3NI.js";import{a as I,b as w,i as x}from"./chunk-ODN5LVDJ.js";var y=class r{supabaseService=A(L);router=A(P);salvaConfigurazione(o){return x(this,null,function*(){let e=new Date().toISOString(),{data:t,error:c}=yield this.supabaseService.supabase.from("configurazioni_promethea").insert([w(I({},o),{created_at:e,updated_at:e})]).select().single();return{data:t,error:c}})}getConfigurazioniByProspect(o){return x(this,null,function*(){let{data:e,error:t}=yield this.supabaseService.supabase.from("configurazioni_promethea").select("*").eq("prospect_id",o).order("created_at",{ascending:!1});return{data:e,error:t}})}getConfigurazioneById(o){return x(this,null,function*(){let{data:e,error:t}=yield this.supabaseService.supabase.from("configurazioni_promethea").select("*").eq("id",o).single();return{data:e,error:t}})}vaiAConfigurazionePromethea(o,e){this.router.navigate(["/alchemizzatore"],{queryParams:{prospectId:o.id,step:6},state:{prospect:o,goToStep:6,from:e}})}verificaConfigurazioniPromethea(o){return x(this,null,function*(){if(!o.length)return new Map;let{data:e,error:t}=yield this.supabaseService.supabase.from("configurazioni_promethea").select("prospect_id").in("prospect_id",o);if(t)return console.error("Errore verifica configurazioni Promethea:",t),new Map;let c=new Map;return o.forEach(m=>c.set(m,!1)),e&&e.forEach(m=>{m.prospect_id&&c.set(m.prospect_id,!0)}),c})}static \u0275fac=function(e){return new(e||r)};static \u0275prov=T({token:r,factory:r.\u0275fac,providedIn:"root"})};function Z(r,o){r&1&&(i(0,"div",18),V(1,"span",19),a(2," Ricerca in corso... "),n())}function ee(r,o){if(r&1&&(i(0,"div",20),a(1),n()),r&2){let e=s(2);l(),p(e.searchError)}}function te(r,o){if(r&1){let e=h();i(0,"div",23),z("click",function(){let c=_(e).$implicit,m=s(3);return u(m.onSelectProspect(c))}),i(1,"div",24)(2,"div",25)(3,"strong"),a(4),n()(),i(5,"div",26),a(6),n()(),i(7,"div",27),a(8,"\u2795"),n()()}if(r&2){let e=o.$implicit;l(4),p(e.ragione_sociale),l(2),E(" ",e.email||"\u2014"," \u2022 ",e.telefono||"\u2014"," ")}}function ie(r,o){if(r&1&&(i(0,"div",21),v(1,te,9,3,"div",22),$(2,"slice"),n()),r&2){let e=s(2);l(),d("ngForOf",R(2,1,e.searchResults,0,8))}}function ne(r,o){if(r&1&&(i(0,"div",28)(1,"i",7),a(2,"check_circle"),n(),a(3," Selezionato: "),i(4,"strong"),a(5),n()()),r&2){let e=s(2);l(5),p(e.selectedProspect.ragione_sociale)}}function oe(r,o){if(r&1){let e=h();i(0,"section",5)(1,"h2",6)(2,"i",7),a(3,"person_search"),n(),a(4," Seleziona il Prospect "),n(),i(5,"div",8)(6,"label",9),a(7,"Cerca Prospect"),n(),i(8,"div",10)(9,"input",11),D("ngModelChange",function(c){_(e);let m=s();return F(m.queryProspect,c)||(m.queryProspect=c),u(c)}),z("input",function(){_(e);let c=s();return u(c.onSearchProspect(c.queryProspect))}),n(),v(10,Z,3,0,"div",12)(11,ee,2,1,"div",13)(12,ie,3,5,"div",14),n(),v(13,ne,6,1,"div",15),n(),i(14,"div",16)(15,"button",17),z("click",function(){_(e);let c=s();return u(c.avanti())}),a(16," Inizia Configurazione "),n()()()}if(r&2){let e=s();l(9),O("ngModel",e.queryProspect),l(),d("ngIf",e.searchLoading),l(),d("ngIf",e.searchError),l(),d("ngIf",e.searchResults.length),l(),d("ngIf",e.selectedProspect),l(),g("blocked",e.searchResults.length),l(),d("disabled",!e.selectedProspect||e.searchResults.length)}}function ae(r,o){if(r&1&&(i(0,"span",43),a(1),n()),r&2){let e=s().$implicit;l(),p(e.pacchetto)}}function re(r,o){if(r&1){let e=h();i(0,"div",37),z("click",function(){let c=_(e).$implicit,m=s(2);return u(m.toggleServizio("immagine_marketing",c))}),i(1,"div",38)(2,"h4"),a(3),n(),i(4,"div",39),a(5),n()(),i(6,"p",40),a(7),n(),v(8,ae,2,1,"span",41),i(9,"div",42)(10,"i",7),a(11,"check"),n()()()}if(r&2){let e=o.$implicit,t=s(2);g("selezionato",e.selezionato)("disabled",t.isServizioDisabled("immagine_marketing",e)),l(3),p(e.nome),l(2),f("",e.prezzo," \u20AC"),l(2),p(e.descrizione),l(),d("ngIf",e.pacchetto),l(),g("attivo",e.selezionato)}}function le(r,o){if(r&1){let e=h();i(0,"div",37),z("click",function(){let c=_(e).$implicit,m=s(2);return u(m.toggleServizio("immagine_marketing",c))}),i(1,"div",38)(2,"h4"),a(3),n(),i(4,"div",39),a(5),n()(),i(6,"p",40),a(7),n(),i(8,"div",42)(9,"i",7),a(10,"check"),n()()()}if(r&2){let e=o.$implicit;g("selezionato",e.selezionato),l(3),p(e.nome),l(2),f("",e.prezzo," \u20AC"),l(2),p(e.descrizione),l(),g("attivo",e.selezionato)}}function ce(r,o){if(r&1){let e=h();i(0,"section",5)(1,"h2",6)(2,"i",7),a(3,"brush"),n(),a(4," Immagine & Marketing "),n(),i(5,"p",29),a(6,"Configura i servizi di branding e comunicazione"),n(),i(7,"h3",30),a(8,"Social Media Manager"),n(),i(9,"div",31),v(10,re,12,10,"div",32),n(),i(11,"h3",30),a(12,"Servizi singoli"),n(),i(13,"div",31),v(14,le,11,7,"div",33),n(),i(15,"div",34)(16,"strong"),a(17),n()(),i(18,"div",16)(19,"button",35),z("click",function(){_(e);let c=s();return u(c.indietro())}),a(20,"Indietro"),n(),i(21,"button",36),z("click",function(){_(e);let c=s();return u(c.avanti())}),a(22,"Continua"),n()()()}if(r&2){let e=s();l(10),d("ngForOf",e.getServiziPacchetto("immagine_marketing")),l(4),d("ngForOf",e.getServiziSingoli("immagine_marketing")),l(3),f("Totale modulo: ",e.moduli.immagine_marketing.totale," \u20AC")}}function se(r,o){if(r&1&&(i(0,"span",43),a(1),n()),r&2){let e=s().$implicit;l(),p(e.pacchetto)}}function me(r,o){if(r&1){let e=h();i(0,"div",37),z("click",function(){let c=_(e).$implicit,m=s(2);return u(m.toggleServizio("digitalizzazione_automatismi",c))}),i(1,"div",38)(2,"h4"),a(3),n(),i(4,"div",39),a(5),n()(),i(6,"p",40),a(7),n(),v(8,se,2,1,"span",41),i(9,"div",42)(10,"i",7),a(11,"check"),n()()()}if(r&2){let e=o.$implicit,t=s(2);g("selezionato",e.selezionato)("disabled",t.isServizioDisabled("digitalizzazione_automatismi",e)),l(3),p(e.nome),l(2),f("",e.prezzo," \u20AC"),l(2),p(e.descrizione),l(),d("ngIf",e.pacchetto),l(),g("attivo",e.selezionato)}}function de(r,o){if(r&1){let e=h();i(0,"div",37),z("click",function(){let c=_(e).$implicit,m=s(2);return u(m.toggleServizio("digitalizzazione_automatismi",c))}),i(1,"div",38)(2,"h4"),a(3),n(),i(4,"div",39),a(5),n()(),i(6,"p",40),a(7),n(),i(8,"div",42)(9,"i",7),a(10,"check"),n()()()}if(r&2){let e=o.$implicit;g("selezionato",e.selezionato),l(3),p(e.nome),l(2),f("",e.prezzo," \u20AC"),l(2),p(e.descrizione),l(),g("attivo",e.selezionato)}}function ze(r,o){if(r&1){let e=h();i(0,"section",5)(1,"h2",6)(2,"i",7),a(3,"memory"),n(),a(4," Digitalizzazione & Automatismi "),n(),i(5,"p",29),a(6,"Configura i servizi digitali e di automazione"),n(),i(7,"h3",30),a(8,"Sito"),n(),i(9,"div",31),v(10,me,12,10,"div",32),n(),i(11,"h3",30),a(12,"Servizi singoli"),n(),i(13,"div",31),v(14,de,11,7,"div",33),n(),i(15,"div",34)(16,"strong"),a(17),n()(),i(18,"div",16)(19,"button",35),z("click",function(){_(e);let c=s();return u(c.indietro())}),a(20,"Indietro"),n(),i(21,"button",36),z("click",function(){_(e);let c=s();return u(c.avanti())}),a(22,"Continua"),n()()()}if(r&2){let e=s();l(10),d("ngForOf",e.getServiziPacchetto("digitalizzazione_automatismi")),l(4),d("ngForOf",e.getServiziSingoli("digitalizzazione_automatismi")),l(3),f("Totale modulo: ",e.moduli.digitalizzazione_automatismi.totale," \u20AC")}}function pe(r,o){if(r&1){let e=h();i(0,"div",37),z("click",function(){let c=_(e).$implicit,m=s(2);return u(m.toggleServizio("contabilita_fiscalita",c))}),i(1,"div",38)(2,"h4"),a(3),n(),i(4,"div",39),a(5),n()(),i(6,"p",40),a(7),n(),i(8,"div",42)(9,"i",7),a(10,"check"),n()()()}if(r&2){let e=o.$implicit;g("selezionato",e.selezionato),l(3),p(e.nome),l(2),f("",e.prezzo," \u20AC"),l(2),p(e.descrizione),l(),g("attivo",e.selezionato)}}function _e(r,o){if(r&1){let e=h();i(0,"section",5)(1,"h2",6)(2,"i",7),a(3,"calculate"),n(),a(4," Contabilit\xE0 e Fiscalit\xE0 "),n(),i(5,"div",31),v(6,pe,11,7,"div",33),n(),i(7,"div",34)(8,"strong"),a(9),n()(),i(10,"div",16)(11,"button",35),z("click",function(){_(e);let c=s();return u(c.indietro())}),a(12,"Indietro"),n(),i(13,"button",36),z("click",function(){_(e);let c=s();return u(c.avanti())}),a(14,"Continua"),n()()()}if(r&2){let e=s();l(6),d("ngForOf",e.moduli.contabilita_fiscalita.servizi),l(3),f("Totale modulo: ",e.moduli.contabilita_fiscalita.totale," \u20AC")}}function ue(r,o){if(r&1&&(i(0,"span",43),a(1),n()),r&2){let e=s().$implicit;l(),p(e.pacchetto)}}function ve(r,o){if(r&1){let e=h();i(0,"div",45),z("click",function(){let c=_(e).$implicit,m=s(2);return u(m.toggleServizio("ottimizzazione_management",c))}),i(1,"div",38)(2,"h4"),a(3),n(),i(4,"div",39),a(5),n()(),i(6,"p",40),a(7),n(),v(8,ue,2,1,"span",41),i(9,"div",42)(10,"i",7),a(11,"check"),n()()()}if(r&2){let e=o.$implicit,t=s(2);g("selezionato",e.selezionato)("disabled",t.isServizioDisabled("ottimizzazione_management",e)),d("hidden",!e.id.startsWith("consulenza_impresa_")),l(3),p(e.nome),l(2),f("",e.prezzo," \u20AC"),l(2),p(e.descrizione),l(),d("ngIf",e.pacchetto),l(),g("attivo",e.selezionato)}}function ge(r,o){if(r&1&&(i(0,"span",43),a(1),n()),r&2){let e=s().$implicit;l(),p(e.pacchetto)}}function fe(r,o){if(r&1){let e=h();i(0,"div",45),z("click",function(){let c=_(e).$implicit,m=s(2);return u(m.toggleServizio("ottimizzazione_management",c))}),i(1,"div",38)(2,"h4"),a(3),n(),i(4,"div",39),a(5),n()(),i(6,"p",40),a(7),n(),v(8,ge,2,1,"span",41),i(9,"div",42)(10,"i",7),a(11,"check"),n()()()}if(r&2){let e=o.$implicit,t=s(2);g("selezionato",e.selezionato)("disabled",t.isServizioDisabled("ottimizzazione_management",e)),d("hidden",!e.id.startsWith("formazione_commerciale_")),l(3),p(e.nome),l(2),f("",e.prezzo," \u20AC"),l(2),p(e.descrizione),l(),d("ngIf",e.pacchetto),l(),g("attivo",e.selezionato)}}function he(r,o){if(r&1){let e=h();i(0,"div",37),z("click",function(){let c=_(e).$implicit,m=s(2);return u(m.toggleServizio("ottimizzazione_management",c))}),i(1,"div",38)(2,"h4"),a(3),n(),i(4,"div",39),a(5),n()(),i(6,"p",40),a(7),n(),i(8,"div",42)(9,"i",7),a(10,"check"),n()()()}if(r&2){let e=o.$implicit;g("selezionato",e.selezionato),l(3),p(e.nome),l(2),f("",e.prezzo," \u20AC"),l(2),p(e.descrizione),l(),g("attivo",e.selezionato)}}function xe(r,o){if(r&1){let e=h();i(0,"section",5)(1,"h2",6)(2,"i",7),a(3,"tune"),n(),a(4," Ottimizzazione e Management "),n(),i(5,"p",29),a(6,"Configura i servizi di ottimizzazione"),n(),i(7,"h3",30),a(8,"Pacchetti \u2014 Consulenze di Impresa"),n(),i(9,"div",31),v(10,ve,12,11,"div",44),n(),i(11,"h3",30),a(12,"Pacchetti \u2014 Formazione Commerciale"),n(),i(13,"div",31),v(14,fe,12,11,"div",44),n(),i(15,"h3",30),a(16,"Servizi singoli"),n(),i(17,"div",31),v(18,he,11,7,"div",33),n(),i(19,"div",34)(20,"strong"),a(21),n()(),i(22,"div",16)(23,"button",35),z("click",function(){_(e);let c=s();return u(c.indietro())}),a(24,"Indietro"),n(),i(25,"button",36),z("click",function(){_(e);let c=s();return u(c.avanti())}),a(26,"Vedi Riepilogo"),n()()()}if(r&2){let e=s();l(10),d("ngForOf",e.getServiziPacchetto("ottimizzazione_management")),l(4),d("ngForOf",e.getServiziPacchetto("ottimizzazione_management")),l(4),d("ngForOf",e.getServiziSingoli("ottimizzazione_management")),l(3),f("Totale modulo: ",e.moduli.ottimizzazione_management.totale," \u20AC")}}function Se(r,o){if(r&1&&(i(0,"div",28)(1,"i",7),a(2,"business"),n(),a(3," Prospect: "),i(4,"strong"),a(5),n()()),r&2){let e=s(2);l(5),p(e.selectedProspect.ragione_sociale)}}function Ce(r,o){if(r&1&&(i(0,"div",54),a(1),n()),r&2){let e=o.$implicit;l(),E(" \u2713 ",e.nome," - ",e.prezzo," \u20AC ")}}function be(r,o){if(r&1&&(i(0,"div",50)(1,"h4"),a(2,"Immagine & Marketing"),n(),i(3,"div",51),v(4,Ce,2,2,"div",52),n(),i(5,"div",53),a(6),n()()),r&2){let e=s(2);l(4),d("ngForOf",e.getServiziSelezionatiModulo("immagine_marketing")),l(2),f("Totale: ",e.moduli.immagine_marketing.totale," \u20AC")}}function Ee(r,o){if(r&1&&(i(0,"div",54),a(1),n()),r&2){let e=o.$implicit;l(),E(" \u2713 ",e.nome," - ",e.prezzo," \u20AC ")}}function ke(r,o){if(r&1&&(i(0,"div",50)(1,"h4"),a(2,"Digitalizzazione & Automatismi"),n(),i(3,"div",51),v(4,Ee,2,2,"div",52),n(),i(5,"div",53),a(6),n()()),r&2){let e=s(2);l(4),d("ngForOf",e.getServiziSelezionatiModulo("digitalizzazione_automatismi")),l(2),f("Totale: ",e.moduli.digitalizzazione_automatismi.totale," \u20AC")}}function Pe(r,o){if(r&1&&(i(0,"div",54),a(1),n()),r&2){let e=o.$implicit;l(),E(" \u2713 ",e.nome," - ",e.prezzo," \u20AC ")}}function ye(r,o){if(r&1&&(i(0,"div",50)(1,"h4"),a(2,"Contabilit\xE0 e Fiscalit\xE0"),n(),i(3,"div",51),v(4,Pe,2,2,"div",52),n(),i(5,"div",53),a(6),n()()),r&2){let e=s(2);l(4),d("ngForOf",e.getServiziSelezionatiModulo("contabilita_fiscalita")),l(2),f("Totale: ",e.moduli.contabilita_fiscalita.totale," \u20AC")}}function Ae(r,o){if(r&1&&(i(0,"div",54),a(1),n()),r&2){let e=o.$implicit;l(),E(" \u2713 ",e.nome," - ",e.prezzo," \u20AC ")}}function Ie(r,o){if(r&1&&(i(0,"div",50)(1,"h4"),a(2,"Ottimizzazione e Management"),n(),i(3,"div",51),v(4,Ae,2,2,"div",52),n(),i(5,"div",53),a(6),n()()),r&2){let e=s(2);l(4),d("ngForOf",e.getServiziSelezionatiModulo("ottimizzazione_management")),l(2),f("Totale: ",e.moduli.ottimizzazione_management.totale," \u20AC")}}function we(r,o){if(r&1){let e=h();i(0,"button",55),z("click",function(){_(e);let c=s(2);return u(c.procediPerFirme())}),i(1,"i",7),a(2,"assignment_turned_in"),n(),a(3," Procedi per le Firme "),n()}if(r&2){let e=s(2);d("disabled",!e.selectedProspect||e.totaleGenerale===0)}}function Te(r,o){if(r&1){let e=h();i(0,"section",5)(1,"h2",6)(2,"i",7),a(3,"receipt_long"),n(),a(4," Riepilogo Configurazione "),n(),i(5,"div",8),v(6,Se,6,1,"div",15),i(7,"div",31),v(8,be,7,2,"div",46)(9,ke,7,2,"div",46)(10,ye,7,2,"div",46)(11,Ie,7,2,"div",46),n(),i(12,"div",47)(13,"h3"),a(14),n()()(),i(15,"div",16)(16,"button",35),z("click",function(){_(e);let c=s();return u(c.indietro())}),a(17,"Modifica"),n(),i(18,"button",48),z("click",function(){_(e);let c=s();return u(c.salvaConfigurazione())}),i(19,"i",7),a(20,"save"),n(),a(21," Salva Configurazione "),n(),v(22,we,4,1,"button",49),n()()}if(r&2){let e=s();l(6),d("ngIf",e.selectedProspect),l(2),d("ngIf",e.moduli.immagine_marketing.totale>0),l(),d("ngIf",e.moduli.digitalizzazione_automatismi.totale>0),l(),d("ngIf",e.moduli.contabilita_fiscalita.totale>0),l(),d("ngIf",e.moduli.ottimizzazione_management.totale>0),l(3),f("Totale Generale: ",e.totaleGenerale," \u20AC"),l(8),d("ngIf",!e.isCliente)}}var U=class r{constructor(o,e,t,c){this.soggettiService=o;this.alchemizzatoreService=e;this.router=t;this.route=c}currentStep=1;totaleSteps=6;queryProspect="";searchResults=[];searchLoading=!1;searchError=null;selectedProspect=null;moduli={immagine_marketing:{nome:"Immagine & Marketing",servizi:[{id:"creazione_logo",nome:"Creazione del Logo",prezzo:300,selezionato:!1,descrizione:"Design professionale del logo aziendale"},{id:"creazione_brand",nome:"Creazione del Brand (include logo)",prezzo:800,selezionato:!1,descrizione:"Identit\xE0 visiva completa: logo, palette colori, typography"},{id:"social_2_post",nome:"Gestione Social Media (2 post/settimana)",prezzo:400,selezionato:!1,pacchetto:"base",descrizione:"2 post settimanali su Facebook e Instagram"},{id:"social_3_post",nome:"Gestione Social Media (3 post/settimana)",prezzo:600,selezionato:!1,pacchetto:"avanzato",descrizione:"3 post settimanali su Facebook, Instagram e LinkedIn"},{id:"social_5_post",nome:"Gestione Social Media (5 post/settimana)",prezzo:800,selezionato:!1,pacchetto:"premium",descrizione:"5 post settimanali su tutti i social + stories"},{id:"servizio_fotografico",nome:"Servizio Fotografico",prezzo:500,selezionato:!1,descrizione:"Servizio fotografico professionale per prodotti/azienda"}],totale:0},digitalizzazione_automatismi:{nome:"Digitalizzazione & Automatismi",servizi:[{id:"landing_page",nome:"Landing Page",prezzo:1e3,selezionato:!1,pacchetto:"base",descrizione:"Pagina di destinazione ottimizzata per conversioni"},{id:"sito_completo",nome:"Sito Web Completo",prezzo:2e3,selezionato:!1,pacchetto:"avanzato",descrizione:"Sito web responsive"},{id:"sito_pro",nome:"Sito Web Pro",prezzo:3500,selezionato:!1,pacchetto:"premium",descrizione:"Sito web avanzato con funzionalit\xE0 personalizzate"},{id:"software_personalizzato",nome:"Software Personalizzato",prezzo:0,selezionato:!1,descrizione:"Richiesta di valutazione per software su misura"},{id:"consulenza_digitale",nome:"Consulenza Digitale",prezzo:300,selezionato:!1,descrizione:"Consulenza per mailing list, automazioni e digital strategy"}],totale:0},contabilita_fiscalita:{nome:"Contabilit\xE0 e Fiscalit\xE0",servizi:[{id:"contabilita_base",nome:"Contabilit\xE0 Base",prezzo:1200,selezionato:!1,descrizione:"Gestione contabilit\xE0 ordinaria e adempimenti fiscali"},{id:"contabilita_avanzata",nome:"Contabilit\xE0 Avanzata",prezzo:2e3,selezionato:!1,descrizione:"Contabilit\xE0 completa con analisi di bilancio"},{id:"consulenza_fiscale",nome:"Consulenza Fiscale",prezzo:500,selezionato:!1,descrizione:"Consulenza fiscale strategica e pianificazione"},{id:"dichiarazioni_redditi",nome:"Dichiarazioni Redditi",prezzo:400,selezionato:!1,descrizione:"Compilazione e presentazione dichiarazioni"}],totale:0},ottimizzazione_management:{nome:"Ottimizzazione e Management",servizi:[{id:"consulenza_impresa_base",nome:"Consulenza di Impresa Base",prezzo:800,selezionato:!1,pacchetto:"base",descrizione:"Analisi iniziale e piano di miglioramento base"},{id:"consulenza_impresa_avanzata",nome:"Consulenza di Impresa Avanzata",prezzo:1500,selezionato:!1,pacchetto:"avanzato",descrizione:"Consulenza strategica con piano d'azione dettagliato"},{id:"consulenza_impresa_premium",nome:"Consulenza di Impresa Premium",prezzo:2500,selezionato:!1,pacchetto:"premium",descrizione:"Consulenza completa con supporto continuativo"},{id:"formazione_commerciale_base",nome:"Formazione Commerciale Base",prezzo:600,selezionato:!1,pacchetto:"base",descrizione:"Corso base di tecniche di vendita"},{id:"formazione_commerciale_avanzata",nome:"Formazione Commerciale Avanzata",prezzo:1200,selezionato:!1,pacchetto:"avanzato",descrizione:"Formazione avanzata con simulazioni pratiche"},{id:"formazione_commerciale_premium",nome:"Formazione Commerciale Premium",prezzo:2e3,selezionato:!1,pacchetto:"premium",descrizione:"Programma completo con coaching individuale"}],totale:0}};totaleGenerale=0;ngOnInit(){return x(this,null,function*(){let e=this.router.getCurrentNavigation()?.extras?.state||history?.state||{},t=e?.prospect,c=this.route.snapshot.queryParamMap,m=t?.id||c.get("prospectId"),S=Number(e?.goToStep||c.get("step"))||0;if(t?.id)this.selectedProspect=t;else if(m)try{let{data:C,error:b}=yield this.soggettiService.getSoggettoById(m);!b&&C&&(this.selectedProspect=C)}catch{}m&&(yield this.loadConfigurazioneEsistente(m),this.currentStep=S&&S>=1&&S<=this.totaleSteps?S:6)})}loadConfigurazioneEsistente(o){return x(this,null,function*(){let{data:e,error:t}=yield this.alchemizzatoreService.getConfigurazioniByProspect(o);if(t||!Array.isArray(e)||e.length===0)return;let m=[...e].sort((S,C)=>new Date(C.created_at||C.data_configurazione||0).getTime()-new Date(S.created_at||S.data_configurazione||0).getTime())[0]?.dettagli||{};this.applyConfigurazioneDettagli(m)})}applyConfigurazioneDettagli(o){let e=o||{},t=["immagine_marketing","digitalizzazione_automatismi","contabilita_fiscalita","ottimizzazione_management"];for(let c of t){let m=e[c];if(!m)continue;let S=Array.isArray(m.servizi_selezionati)?m.servizi_selezionati:Array.isArray(m.servizi)?m.servizi:[],C=new Set(S.map(b=>b.id));this.moduli[c].servizi.forEach(b=>{b.selezionato=C.has(b.id)})}this.calcolaTotali()}avanti(){this.currentStep<this.totaleSteps&&this.currentStep++}indietro(){this.currentStep>1&&this.currentStep--}vaiAStep(o){o>=1&&o<=this.totaleSteps&&(this.currentStep=o)}onSearchProspect(o){return x(this,null,function*(){this.searchError=null;let e=(o??"").trim();if(e.length<2){this.searchResults=[];return}this.searchLoading=!0;let{data:t,error:c}=yield this.soggettiService.searchSoggetti(e,"prospect");if(this.searchLoading=!1,c){this.searchError=c.message??"Errore ricerca",this.searchResults=[];return}this.searchResults=t??[]})}onSelectProspect(o){this.selectedProspect=o,this.searchResults=[],this.queryProspect=o.ragione_sociale||""}toggleServizio(o,e){let t=this.moduli[o];e.pacchetto&&t.servizi.forEach(c=>{c.pacchetto===e.pacchetto&&c.id!==e.id&&(c.selezionato=!1)}),e.selezionato=!e.selezionato,this.calcolaTotali()}isServizioDisabled(o,e){return e.pacchetto?this.moduli[o].servizi.filter(m=>m.pacchetto===e.pacchetto&&m.id!==e.id&&m.selezionato).length>0:!1}calcolaTotali(){Object.keys(this.moduli).forEach(o=>{let e=this.moduli[o];e.totale=e.servizi.filter(t=>t.selezionato).reduce((t,c)=>t+c.prezzo,0)}),this.totaleGenerale=Object.keys(this.moduli).reduce((o,e)=>o+this.moduli[e].totale,0)}salvaConfigurazione(){return x(this,null,function*(){if(!this.selectedProspect){alert("Seleziona un prospect prima di salvare!");return}let o={immagine_marketing:{servizi_selezionati:this.moduli.immagine_marketing.servizi.filter(t=>t.selezionato).map(t=>({id:t.id,nome:t.nome,prezzo:t.prezzo,pacchetto:t.pacchetto})),totale_modulo:this.moduli.immagine_marketing.totale},digitalizzazione_automatismi:{servizi_selezionati:this.moduli.digitalizzazione_automatismi.servizi.filter(t=>t.selezionato).map(t=>({id:t.id,nome:t.nome,prezzo:t.prezzo,pacchetto:t.pacchetto})),totale_modulo:this.moduli.digitalizzazione_automatismi.totale},contabilita_fiscalita:{servizi_selezionati:this.moduli.contabilita_fiscalita.servizi.filter(t=>t.selezionato).map(t=>({id:t.id,nome:t.nome,prezzo:t.prezzo,pacchetto:t.pacchetto})),totale_modulo:this.moduli.contabilita_fiscalita.totale},ottimizzazione_management:{servizi_selezionati:this.moduli.ottimizzazione_management.servizi.filter(t=>t.selezionato).map(t=>({id:t.id,nome:t.nome,prezzo:t.prezzo,pacchetto:t.pacchetto})),totale_modulo:this.moduli.ottimizzazione_management.totale}},e={prospect_id:this.selectedProspect.id,data_configurazione:new Date().toISOString(),totale:this.totaleGenerale,dettagli:o};try{let t=yield this.alchemizzatoreService.salvaConfigurazione(e);if(t.error)throw t.error;alert("Configurazione salvata correttamente.")}catch(t){console.error("Errore nel salvataggio:",t),alert("Errore nel salvataggio: "+(t?.message||"operazione non riuscita"))}})}resetConfigurazione(){this.currentStep=1,this.queryProspect="",Object.keys(this.moduli).forEach(o=>{let e=this.moduli[o];e.servizi.forEach(t=>{t.selezionato=!1}),e.totale=0}),this.totaleGenerale=0}getServiziSelezionatiModulo(o){return this.moduli[o].servizi.filter(t=>t.selezionato)}getTotaleModulo(o){return this.moduli[o].totale}getServiziPacchetto(o){return this.moduli[o].servizi.filter(e=>!!e.pacchetto)}getServiziSingoli(o){return this.moduli[o].servizi.filter(e=>!e.pacchetto)}getTuttiServiziSelezionati(){let o=[];return Object.keys(this.moduli).forEach(e=>{let t=this.moduli[e].servizi.filter(c=>c.selezionato);o.push(...t)}),o}procediPerFirme(){return x(this,null,function*(){if(!this.selectedProspect||this.totaleGenerale===0){alert("Seleziona un prospect e configura almeno un servizio!");return}try{let o=[{percorso:"/assets/contratti/privacy-promethea.pdf",nomeBase:"Privacy"},{percorso:"/assets/contratti/contratto-promethea.pdf",nomeBase:"Contratto Servizi Promethea"}];if(this.haServiziDigitaliSelezionati()&&o.push({percorso:"/assets/contratti/allegato-digitale.pdf",nomeBase:"Allegato Digitale"}),this.haServiziContabiliSelezionati()&&o.push({percorso:"/assets/contratti/allegato-contabile.pdf",nomeBase:"Allegato Contabile"}),!(yield this.convertiProspectInCliente())){alert("Errore nella conversione del prospect in cliente. Operazione annullata.");return}this.scaricaDocumenti(o),yield this.salvaConfigurazione(),alert("Operazione completata! Il prospect \xE8 stato convertito in cliente e i documenti sono stati scaricati.")}catch(o){console.error("Errore nel processo di firma:",o),alert("Errore nel processo di firma: "+o.message)}})}convertiProspectInCliente(){return x(this,null,function*(){if(!this.selectedProspect)return!1;try{console.log("Conversione prospect in cliente:",this.selectedProspect.id);let o=yield this.soggettiService.convertiProspectInCliente(this.selectedProspect.id);return o.error?(console.error("Errore nella conversione:",o.error),!1):o.data?(this.selectedProspect=o.data,console.log("Prospect convertito in cliente con successo:",this.selectedProspect),!0):!1}catch(o){return console.error("Errore durante la conversione:",o),!1}})}haServiziDigitaliSelezionati(){let o=this.moduli.digitalizzazione_automatismi.servizi.some(t=>t.selezionato),e=this.moduli.immagine_marketing.servizi.some(t=>t.selezionato&&t.id.startsWith("social_"));return o||e}haServiziContabiliSelezionati(){return this.moduli.contabilita_fiscalita.servizi.some(o=>o.selezionato)}scaricaDocumenti(o){let e=this.sanitizeFileName(this.selectedProspect.ragione_sociale);o.forEach((t,c)=>{setTimeout(()=>{let m=`${t.nomeBase} - ${e}.pdf`;this.scaricaPDF(t.percorso,m)},c*300)})}scaricaPDF(o,e){let t=document.createElement("a");t.href=o,t.download=e,t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}sanitizeFileName(o){return o.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g," ").trim()}get isCliente(){return this.selectedProspect?.tipo==="cliente"}static \u0275fac=function(e){return new(e||r)(k(Q),k(y),k(P),k(N))};static \u0275cmp=M({type:r,selectors:[["app-alchemizzatore"]],decls:21,vars:18,consts:[[1,"alchemizzatore-container"],[1,"form-section"],[1,"progress-steps"],[1,"step",3,"click"],["class","form-section trattativa-section",4,"ngIf"],[1,"form-section","trattativa-section"],[1,"section-title"],[1,"material-icons"],[1,"card"],[1,"form-label"],[1,"search-input-container"],["type","text","placeholder","Cerca per ragione sociale, P.IVA o referente...",3,"ngModelChange","input","ngModel"],["class","status-message loading",4,"ngIf"],["class","status-message error",4,"ngIf"],["class","search-results","role","listbox",4,"ngIf"],["class","status-message info",4,"ngIf"],[1,"actions-container"],[1,"promethea-button",3,"click","disabled"],[1,"status-message","loading"],[1,"loading-spinner"],[1,"status-message","error"],["role","listbox",1,"search-results"],["class","search-result-item","role","option",3,"click",4,"ngFor","ngForOf"],["role","option",1,"search-result-item",3,"click"],[1,"result-text"],[1,"result-title"],[1,"result-subtitle"],[1,"result-icon"],[1,"status-message","info"],[1,"sottotitolo"],[1,"section-title","sotto"],[1,"grid-responsive"],["class","card servizio-card",3,"selezionato","disabled","click",4,"ngFor","ngForOf"],["class","card servizio-card",3,"selezionato","click",4,"ngFor","ngForOf"],[1,"modulo-totale"],[1,"promethea-button","secondary",3,"click"],[1,"promethea-button",3,"click"],[1,"card","servizio-card",3,"click"],[1,"servizio-header"],[1,"servizio-prezzo"],[1,"servizio-descrizione"],["class","chip",4,"ngIf"],[1,"checkmark"],[1,"chip"],["class","card servizio-card",3,"hidden","selezionato","disabled","click",4,"ngFor","ngForOf"],[1,"card","servizio-card",3,"click","hidden"],["class","riepilogo-modulo",4,"ngIf"],[1,"riepilogo-totale","text-center"],[1,"promethea-button","success",3,"click"],["class","promethea-button success",3,"disabled","click",4,"ngIf"],[1,"riepilogo-modulo"],[1,"servizi-elenco"],["class","servizio-riepilogo",4,"ngFor","ngForOf"],[1,"totale-modulo"],[1,"servizio-riepilogo"],[1,"promethea-button","success",3,"click","disabled"]],template:function(e,t){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),z("click",function(){return t.vaiAStep(1)}),a(4,"1"),n(),i(5,"button",3),z("click",function(){return t.vaiAStep(2)}),a(6,"2"),n(),i(7,"button",3),z("click",function(){return t.vaiAStep(3)}),a(8,"3"),n(),i(9,"button",3),z("click",function(){return t.vaiAStep(4)}),a(10,"4"),n(),i(11,"button",3),z("click",function(){return t.vaiAStep(5)}),a(12,"5"),n(),i(13,"button",3),z("click",function(){return t.vaiAStep(6)}),a(14,"6"),n()()(),v(15,oe,17,8,"section",4)(16,ce,23,3,"section",4)(17,ze,23,3,"section",4)(18,_e,15,2,"section",4)(19,xe,27,4,"section",4)(20,Te,23,7,"section",4),n()),e&2&&(l(3),g("active",t.currentStep===1),l(2),g("active",t.currentStep===2),l(2),g("active",t.currentStep===3),l(2),g("active",t.currentStep===4),l(2),g("active",t.currentStep===5),l(2),g("active",t.currentStep===6),l(2),d("ngIf",t.currentStep===1),l(),d("ngIf",t.currentStep===2),l(),d("ngIf",t.currentStep===3),l(),d("ngIf",t.currentStep===4),l(),d("ngIf",t.currentStep===5),l(),d("ngIf",t.currentStep===6))},dependencies:[G,B,j,K,W,H,J,q],styles:[".alchemizzatore-container[_ngcontent-%COMP%]{padding:var(--gutter-lg)}.trattativa-section[_ngcontent-%COMP%]{margin:var(--gutter-lg) 0}.section-title.sotto[_ngcontent-%COMP%]{margin-top:var(--gutter-md);margin-bottom:var(--gutter-md)}.servizio-card[_ngcontent-%COMP%]{position:relative;cursor:pointer;border-left:4px solid transparent;padding-right:calc(var(--gutter-lg) + var(--gutter-sm))}.servizio-card.selezionato[_ngcontent-%COMP%]{border-color:var(--primary);box-shadow:0 6px 16px var(--shadow2)}.servizio-card.disabled[_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed}.servizio-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;gap:var(--gutter-sm);margin-bottom:var(--gutter-sm)}.servizio-prezzo[_ngcontent-%COMP%]{font-weight:700;color:var(--primary);font-size:var(--fs-md);width:max-content;text-wrap:nowrap;padding-right:var(--gutter-lg)}.servizio-descrizione[_ngcontent-%COMP%]{color:color-mix(in srgb,var(--text-color) 70%,transparent);font-size:var(--fs-sm);margin:0 0 var(--gutter-sm) 0;line-height:1.4}.checkmark[_ngcontent-%COMP%]{position:absolute;top:var(--gutter-md);right:var(--gutter-md);width:24px;height:24px;border:2px solid var(--smoke-color-1);border-radius:50%;display:grid;place-items:center;color:transparent;transition:all .2s ease;background:transparent}.checkmark.attivo[_ngcontent-%COMP%]{background:var(--primary);border-color:var(--primary);color:#fff}.modulo-totale[_ngcontent-%COMP%]{text-align:right;font-size:var(--fs-md);margin:var(--gutter-lg) 0 0 0;padding:var(--gutter-md);background:var(--smoke-color-2);border-radius:8px;border:1px solid var(--smoke-color-1)}.riepilogo-modulo[_ngcontent-%COMP%]{background:var(--smoke-color-2);border:1px solid var(--smoke-color-1);border-radius:12px;padding:var(--gutter-md)}.riepilogo-modulo[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 var(--gutter-sm) 0;color:var(--primary)}.servizi-elenco[_ngcontent-%COMP%]{margin-bottom:var(--gutter-sm)}.servizio-riepilogo[_ngcontent-%COMP%]{padding:.25rem 0;color:var(--text-color)}.totale-modulo[_ngcontent-%COMP%]{font-weight:700;text-align:right;color:var(--primary);border-top:1px solid var(--smoke-color-1);padding-top:var(--gutter-sm);margin-top:var(--gutter-sm)}.riepilogo-totale[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:var(--fs-lg);margin-top:var(--gutter-lg)}.promethea-button.success[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669)}.actions-container[_ngcontent-%COMP%]{margin-top:var(--gutter-sm)}"]})};export{U as Alchemizzatore};
